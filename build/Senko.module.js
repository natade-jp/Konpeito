/*!
 * SenkoJS
 * https://github.com/natade-jp/SenkoJS
 * Copyright 2013-2019 natade
 *
 * The MIT license.
 * https://opensource.org/licenses/MIT
 */
class ArrayList{constructor(){if(this.element=[],1===arguments.length)for(let t=0;t<arguments[0].element.length;t++)this.element[t]=arguments[0].element[t]}each(t){let e=!0;for(let n=0;n<this.element.length;n++){const i=this.element[n];if(!1===t.call(i,n,i)){e=!1;break}}return e}toString(){return this.join(", ")}isEmpty(){return 0===this.element.length}contains(t){return this.element.contains(t)}size(){return this.element.length}clear(){this.element.length=0}join(t){return 0===arguments.length&&(t=","),this.element.join(t)}clone(){const t=new ArrayList;for(let e=0;e<this.element.length;e++)t.element[e]=this.element[e];return t}indexOf(t){for(let e=0;e<this.element.length;e++)if(this.element[e]===t)return e;return-1}lastIndexOf(t){for(let e=this.element.length-1;-1!==e;e--)if(this.element[e]===t)return e;return-1}get(t){return this.element[t]}add(){if(1===arguments.length){const t=arguments[0];this.element.push(t)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.element.splice(t,0,e)}}addAll(){if(1===arguments.length){const t=arguments[0];let e=this.element.length;for(let n=0;n<t.length;n++)this.element[e++]=t.element[n]}else if(2===arguments.length){let t=arguments[0],e=arguments[1].element;e===this.element&&(e=this.element.slice(0));let n=this.element.length-t,i=this.element.length+e.length-1,o=this.element.length-1;for(let t=0;t<n;t++)this.element[i--]=this.element[o--];n=e.length;for(let i=0;i<n;i++)this.element[t++]=e[i]}}set(t,e){this.element[t]=e}remove(t){this.element.splice(t,1)}removeRange(t,e){this.element.splice(t,e-t)}sort(t){let e;e=0===arguments.length?ArrayList.COMPARE.DEFAULT:t;const n=[],i=function(t,e,o,r){if(e<o){const s=Math.floor((e+o)/2);i(t,e,s,r),i(t,s+1,o,r);let h,l,a,u=0;for(h=e;h<=s;h++)n[u++]=t[h];for(h=s+1,l=0,a=e;h<=o&&l<u;)r(t[h],n[l])>=0?t[a++]=n[l++]:t[a++]=t[h++];for(;l<u;)t[a++]=n[l++]}return!0};i(this.element,0,this.element.length-1,e)}}ArrayList.COMPARE={},ArrayList.COMPARE.DEFAULT=function(t,e){return t===e?0:typeof t==typeof e?t<e?-1:1:typeof t<typeof e?-1:1};class Color{constructor(){this.r=0,this.g=0,this.b=0,this.a=1}limit(){const t=new Color;return t.r=Color._limit(this.r),t.g=Color._limit(this.g),t.b=Color._limit(this.b),t.a=Color._limit(this.a),t}bake(){const t=new Color;return t.r=this.r*this.a,t.g=this.g*this.a,t.b=this.b*this.a,t.a=1,t.limit()}addColorMixture(t){if(!(t instanceof Color))throw"IllegalArgumentException";return Color.newColorNormalizedRGB(this.r+t.r*t.a,this.g+t.g*t.a,this.b+t.b*t.a,this.a)}subColorMixture(t){if(!(t instanceof Color))throw"IllegalArgumentException";const e=Math.min(this.r,t.r),n=Math.min(this.g,t.g),i=Math.min(this.b,t.b);return Color.newColorNormalizedRGB(Color._mix(this.r,e,t.a),Color._mix(this.g,n,t.a),Color._mix(this.b,i,t.a),this.a)}mul(t){if(t instanceof Color)return Color.newColorNormalizedRGB(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a);if("number"==typeof t||t instanceof Number)return Color.newColorNormalizedRGB(this.r*t,this.g*t,this.b*t,this.a);throw"IllegalArgumentException"}clone(){const t=new Color;return t.r=this.r,t.g=this.g,t.b=this.b,t.a=this.a,t}toString(){return"Color["+this.getCSSHex()+", "+this.getCSS255()+", "+this.getCSSPercent()+"]"}static _mix(t,e,n){return t+(e-t)*n}static _limit(t){return Math.max(Math.min(t,1),0)}static _flact(t){return t-Math.floor(t)}static _hex(t){return t=Math.round(255*t).toString(16),1===t.length?"0"+t:t}_setRGB(t,e,n,i){return this.r=t,this.g=e,this.b=n,i&&(this.a=i),this}_setHSV(t,e,n,i){let o,r;return this.r=n,this.g=n,this.b=n,i&&(this.a=i),e>0&&(r=(t*=6)-(o=~~Math.floor(t)),0===o?(this.g*=1-e*(1-r),this.b*=1-e):1===o?(this.r*=1-e*r,this.b*=1-e):2===o?(this.r*=1-e,this.b*=1-e*(1-r)):3===o?(this.r*=1-e,this.g*=1-e*r):4===o?(this.r*=1-e*(1-r),this.g*=1-e):5===o&&(this.g*=1-e,this.b*=1-e*r)),this}_setHSL(t,e,n,i){if(i&&(this.a=i),0===e)return this.r=0,this.g=0,this.b=0,this;let o;const r=2*n-(o=n<.5?n*(1+e):n*(1-e)+e),s=o-r;t*=6;const h=~~Math.floor(t),l=t-h;return 0===h?(this.r=o,this.g=o-s*(1-l),this.b=r):1===h?(this.r=r+s*(1-l),this.g=o,this.b=r):2===h?(this.r=r,this.g=o,this.b=o-s*(1-l)):3===h?(this.r=r,this.g=r+s*(1-l),this.b=o):4===h?(this.r=o-s*(1-l),this.g=r,this.b=o):5===h&&(this.r=o,this.g=r,this.b=r+s*(1-l)),this}_getRGB(){return{r:this.r,g:this.g,b:this.b,a:this.a}}_getHSV(){const t=Math.max(this.r,this.g,this.b),e=Math.min(this.r,this.g,this.b),n=t-e;let i=0,o=t-e;const r=t;return 0!==t&&(o/=t),0===n?[i,o,r]:(t===this.r?(i=(this.g-this.b)/n)<0&&(i+=6):i=t===this.g?2+(this.b-this.r)/n:4+(this.r-this.g)/n,i/=6,{h:i,s:o,v:r,a:this.a})}_getHSL(){const t=Math.max(this.r,this.g,this.b),e=Math.min(this.r,this.g,this.b),n=.5*(t+e),i=t-e;if(0===i)return[0,n,0];let o;o=n<.5?i/(t+e):i/(2-t-e);let r;return t===this.r?(r=(this.g-this.b)/i)<0&&(r+=6):r=t===this.g?2+(this.b-this.r)/i:4+(this.r-this.g)/i,r/=6,{h:r,s:o,l:n,a:this.a}}getNormalizedRGB(){return this._getRGB()}getRGB(){return{r:Math.round(255*this.r),g:Math.round(255*this.g),b:Math.round(255*this.b),a:Math.round(255*this.a)}}getRRGGBB(){return Math.round(255*Color._limit(this.r))<<16|Math.round(255*Color._limit(this.g))<<8|Math.round(255*Color._limit(this.b))}getAARRGGBB(){return Math.round(255*Color._limit(this.a))<<24|Math.round(255*Color._limit(this.r))<<16|Math.round(255*Color._limit(this.g))<<8|Math.round(255*Color._limit(this.b))}getNormalizedHSV(){return this._getHSV()}getHSV(){const t=this.getNormalizedHSV();return t.h=Math.round(360*t.h),t.s=Math.round(255*t.s),t.v=Math.round(255*t.v),t.a=Math.round(255*t.a),t}getNormalizedHSL(){return this._getHSL()}getHSL(){const t=this.getNormalizedHSL();return t.h=Math.round(360*t.h),t.s=Math.round(255*t.s),t.l=Math.round(255*t.l),t.a=Math.round(255*t.a),t}getRed(){return Math.round(255*this.r)}getGreen(){return Math.round(255*this.g)}getBlue(){return Math.round(255*this.b)}getAlpha(){return Math.round(255*this.b)}brighter(){return this.mul(1/.7).limit()}darker(){return this.mul(.7).limit()}getCSSHex(){return 1===this.a?"#"+Color._hex(Color._limit(this.r))+Color._hex(Color._limit(this.g))+Color._hex(Color._limit(this.b)):"#"+Color._hex(Color._limit(this.a))+Color._hex(Color._limit(this.r))+Color._hex(Color._limit(this.g))+Color._hex(Color._limit(this.b))}getCSS255(){return 1===this.a?"rgb("+Math.round(255*Color._limit(this.r))+","+Math.round(255*Color._limit(this.g))+","+Math.round(255*Color._limit(this.b))+")":"rgba("+Math.round(255*Color._limit(this.r))+","+Math.round(255*Color._limit(this.g))+","+Math.round(255*Color._limit(this.b))+","+this.a+")"}getCSSPercent(){return 1===this.a?"rgb("+Math.round(100*Color._limit(this.r))+"%,"+Math.round(100*Color._limit(this.g))+"%,"+Math.round(100*Color._limit(this.b))+"%)":"rgba("+Math.round(100*Color._limit(this.r))+"%,"+Math.round(100*Color._limit(this.g))+"%,"+Math.round(100*Color._limit(this.b))+"%,"+Math.round(100*Color._limit(this.a))+"%)"}setAlpha(t){const e=this.clone();return e.a=t,e}static newColorNormalizedRGB(){let t=0,e=0,n=0,i=1;1===arguments.length?(arguments[0].r&&(t=arguments[0].r),arguments[0].g&&(e=arguments[0].g),arguments[0].b&&(n=arguments[0].b),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3]));const o=new Color;return o._setRGB(t,e,n,i),o}static newColorRGB(){let t=0,e=0,n=0,i=255;arguments.length>=3?(t=arguments[0],e=arguments[1],n=arguments[2],arguments.length>=4&&(i=arguments[3])):arguments.length>=1&&("number"==typeof arguments[0]?(t=arguments[0]>>16&255,e=arguments[0]>>8&255,n=255&arguments[0],arguments[1]&&(i=arguments[0]>>24&255)):void 0===arguments[0].length?(arguments[0].r&&(t=arguments[0].r),arguments[0].g&&(e=arguments[0].g),arguments[0].b&&(n=arguments[0].b),arguments[0].a&&(i=arguments[0].a)):arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2],arguments[0].length>=4&&(i=arguments[0][3])));const o=new Color;return o._setRGB(t/255,e/255,n/255,i/255),o}static newColorNormalizedHSV(){let t=0,e=0,n=0,i=1;1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].v&&(n=arguments[0].v),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),e=Color._limit(e),n=Color._limit(n);const o=new Color;return o._setHSV(Color._flact(t),e,n,i),o}static newColorHSV(){let t=0,e=0,n=0,i=255;return 1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].v&&(n=arguments[0].v),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),Color.newColorNormalizedHSV(t/360,e/255,n/255,i/255)}static newColorNormalizedHSL(){let t=0,e=0,n=0,i=1;1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].l&&(n=arguments[0].l),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),e=Color._limit(e),n=Color._limit(n);const o=new Color;return o._setHSL(Color._flact(t),e,n,i),o}static newColorHSL(){let t=0,e=0,n=0,i=255;return 1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].l&&(n=arguments[0].l),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),Color.newColorNormalizedHSL(t/360,e/255,n/255,i/255)}}Color.white=Color.newColorRGB(16777215),Color.lightGray=Color.newColorRGB(13882323),Color.gray=Color.newColorRGB(8421504),Color.darkGray=Color.newColorRGB(11119017),Color.black=Color.newColorRGB(0),Color.red=Color.newColorRGB(16711680),Color.pink=Color.newColorRGB(16761035),Color.orange=Color.newColorRGB(16753920),Color.yellow=Color.newColorRGB(16776960),Color.green=Color.newColorRGB(32768),Color.magenta=Color.newColorRGB(16711935),Color.cyan=Color.newColorRGB(65535),Color.blue=Color.newColorRGB(255),Color.WHITE=Color.white,Color.LIGHT_GRAY=Color.lightGray,Color.GRAY=Color.gray,Color.DARK_GRAY=Color.darkGray,Color.RED=Color.red,Color.PINK=Color.pink,Color.ORANGE=Color.orange,Color.YELLOW=Color.yellow,Color.GREEN=Color.green,Color.MAGENTA=Color.magenta,Color.CYAN=Color.cyan,Color.BLUE=Color.blue;const CSVTool={parseCSV:function(t,e){arguments.length<2&&(e=","),t=t.replace(/\r\n?|\n/g,"\n");const n=e.charCodeAt(0),i=[],o=t.length;let r="",s=0,h=0,l=!1,a=!1;for(let e=0;e<o;e++){let u=t.charCodeAt(e);if(34===u&&0===r.length)for(e++;e<o;e++)if(34===(u=t.charCodeAt(e))){if(e+1===o-1)break;if(34!==t.charCodeAt(e+1))break;e++,r+='"'}else r+=t.charAt(e);else{switch(u){case n:l=!0;break;case 13:case 10:a=!0}l?(l=!1,void 0===i[s]&&(i[s]=[]),i[s][h]=r,r="",h+=1):a?(a=!1,""===r&&0===h||(void 0===i[s]&&(i[s]=[]),i[s][h]=r,r="",s+=1,h=0)):r+=t.charAt(e)}e===o-1&&0!==h&&(i[s][h]=r)}return i},makeCSV:function(t,e,n){arguments.length<2&&(e=","),arguments.length<3&&(n="\r\n");let i="";const o=/["\r\n,\t]/;if(void 0!==t)for(let r=0;r<t.length;r++){if(void 0!==t[r])for(let n=0;n<t[r].length;n++){let s=t[r][n];o.test(s)&&(s='"'+(s=s.replace(/"/g,'""'))+'"'),i+=s,n!==t[r].length-1&&(i+=e)}i+=n}return i}};class File$1{constructor(t){if(this.isHTML="undefined"!=typeof window,this.isNode=!1,1!==arguments.length)throw"IllegalArgumentException";if("string"==typeof t||t instanceof String)this.pathname=t.replace(/\\/g,"/");else{if(!(t instanceof File$1))throw"IllegalArgumentException";this.pathname=t.getAbsolutePath()}}delete_(){throw"IllegalMethod"}exists(){throw"IllegalMethod"}copy(){throw"IllegalMethod"}move(){throw"IllegalMethod"}toString(){return this.getAbsolutePath()}getName(){if(this.isHTML){if(this.isDirectory())return"";const t=this.pathname.split("/");return t[t.length-1]}if(this.isNode)throw"IllegalMethod"}getParent(){const t=this.getAbsolutePath().match(/.*[\/\\]/)[0];return t.substring(0,t.length-1)}getParentFile(){return new File$1(this.getParent())}getExtensionName(){if(this.isHTML){const t=this.getName().split(".");return t[t.length-1]}if(this.isNode)throw"IllegalMethod"}isAbsolute(){if(this.isHTML)return this.getAbsolutePath()===this.pathname;if(this.isNode)throw"IllegalMethod"}isDirectory(){if(this.isHTML)return/\/$/.test(this.pathname);if(this.isNode)throw"IllegalMethod"}isFile(){if(this.isHTML)return/[^\/]$/.test(this.pathname);if(this.isNode)throw"IllegalMethod"}isHidden(){if(this.isNode)throw"IllegalMethod"}lastModified(){if(this.isNode)throw"IllegalMethod"}setLastModified(){if(this.isNode)throw"IllegalMethod"}length(){if(this.isNode)throw"IllegalMethod"}getFiles(){if(this.isNode)throw"IllegalMethod"}getSubFolders(){if(this.isNode)throw"IllegalMethod"}getNormalizedPathName(){if(""===this.pathname)return".\\";let t=this.pathname.replace(/\//g,"\\");return"\\"!==t.slice(-1)&&(t+="\\"),t}getAllFiles(){if(this.isNode)throw"IllegalMethod"}list(){if(this.isNode)throw"IllegalMethod"}getAbsolutePath(){if(this.isHTML){let t=null;if(/^http/.test(this.pathname))t=this.pathname;else{let e=window.location.toString();/\/$/.test(e)||(e=e.match(/.*\//)[0]),t=e+this.pathname}const e=t.match(/^http[^\/]+\/\/[^\/]+\//)[0],n=t.substr(e.length);let i=e;const o=n.split("/");let r;for(r=0;r<o.length;r++)""!==o[r]&&"."!==o[r]&&(".."!==o[r]?(i+=o[r],r!==o.length-1&&(i+="/")):i=i.substring(0,i.length-1).match(/.*\//)[0]);return i}if(this.isNode)throw"IllegalMethod"}mkdir(){if(this.isNode)throw"IllegalMethod"}mkdirs(){if(this.isNode)throw"IllegalMethod"}renameTo(){if(this.isNode)throw"IllegalMethod"}run(){if(this.isNode)throw"IllegalMethod"}writeLine(){if(this.isNode)throw"IllegalMethod"}download(t){if(this.isHTML){const e=this.getExtensionName().toLocaleString(),n=this;if("gif"===e||"jpg"===e||"png"===e||"bmp"===e||"svg"===e||"jpeg"===e){const e=new Image;e.onload=function(){n.dataImage=e,t(n)},e.src=this.pathname}else{const e=File$1.createXMLHttpRequest();if(null===e)return null;const i=function(){if(4===e.readyState){if(200!==e.status)return console.log("error downloadText "+n.pathname),null;n.dataText=e.responseText,t(n)}};e.onreadystatechange=i,e.open("GET",this.pathname,!0),e.send(null)}}else if(this.isNode)throw"IllegalMethod"}getImage(){if(this.isHTML)return this.dataImage}getText(){if(this.isHTML)return this.dataText;if(this.isNode)throw"IllegalMethod"}setText(){if(this.isNode)throw"IllegalMethod"}getCSV(t,e,n){if(this.isHTML)return CSVTool.parseCSV(this.dataText,t,n);if(this.isNode)throw"IllegalMethod"}setCSV(){if(this.isNode)throw"IllegalMethod"}getByte(){if(this.isNode)throw"IllegalMethod"}setByte(){if(this.isNode)throw"IllegalMethod"}static createTempFile(){if("undefined"!=typeof window)throw"not createTempFile"}static getCurrentDirectory(){if("undefined"!=typeof window){const t=new File$1("./");return t.getParent()}}static setCurrentDirectory(){if("undefined"!=typeof window)throw"not setCurrentDirectory"}static searchFile(){if("undefined"!=typeof window)throw"not searchFile"}static downloadFileList(t,e,n){let i,o=0;for(i=0;i<t.length;i++)t[i].download(function(i){return function(){o++,n&&n.length&&n[i]&&n[i](t[i]),o===t.length&&e&&e(t)}}(i))}static createXMLHttpRequest(){return new XMLHttpRequest}static getCSVTool(){return CSVTool}}class HashMap{constructor(){if(this.map=[],this.size_=0,1===arguments.length){for(const t in arguments[0].map)this.map[t]=arguments[0].map[t];this.size_=arguments[0].size_}}each(t){let e=!0;for(const n in this.map){const i=this.map[n];if(!1===t.call(i,n,i)){e=!1;break}}return e}toString(){let t="",e=0;for(const n in this.map)t+=n+"=>"+this.map[n],++e!==this.size_&&(t+="\n");return t}containsKey(t){return void 0!==this.map[t]}containsValue(t){for(const e in this.map)if(this.map[e]===t)return!0;return!1}isEmpty(){return 0===this.size_}clear(){this.map=[],this.size_=0}clone(){const t=new HashMap;for(const e in this.map)t.map[e]=this.map[e];return t.size_=this.size_,t}size(){return this.size_}get(t){return this.map[t]}put(t,e){if(!1===this.containsKey(t))return this.map[t]=e,this.size_=this.size_+1,null;{const n=this.map[t];return this.map[t]=e,n}}putAll(t){for(const e in t.map)void 0===this.map[e]&&(this.map[e]=t.map[e],this.size_=this.size_+1)}remove(t){if(!1===this.containsKey(t))return null;{const e=this.map[t];return delete this.map[t],this.size_=this.size_-1,e}}}class Format{static format(){let t=1;const e=arguments,n=function(t){if(t>=0)return t;{let e=~(t=-t)>>16&65535;const n=65535&~t;return(e*=65536)+n+1}},i=function(i){let o;const r=(o=(i=i.substring(1,i.length)).match(/.$/))[0];if("%"===r)return"%";null!==(o=i.match(/^[0-9]+\$/))&&(o=o[0],i=i.substring(o.length,i.length),o=o.substring(0,o.length-1),t=parseInt(o,10));let s=e[t];t+=1;let h=!1,l=!1,a=!1,u="";null!==(o=i.match(/^[-+ #0]+/))&&(o=o[0],i=i.substring(o.length,i.length),-1!==o.indexOf("#")&&(h=!0),-1!==o.indexOf("-")&&(l=!0),-1!==o.indexOf(" ")&&(u=" "),-1!==o.indexOf("+")&&(u="+"),-1!==o.indexOf("0")&&(a=!0));let c=0;null!==(o=i.match(/^([0-9]+|\*)/))&&(o=o[0],i=i.substring(o.length,i.length),-1!==o.indexOf("*")?(c=s,s=e[t],t+=1):c=parseInt(o,10));let g=!1,f=0;null!==(o=i.match(/^(\.((-?[0-9]+)|\*)|\.)/))&&(o=o[0],i=i.substring(o.length,i.length),g=!0,-1!==o.indexOf("*")?(f=s,s=e[t],t+=1):1===o.length?f=0:(o=o.substring(1,o.length),f=parseInt(o,10))),null!==(o=i.match(/^hh|h|ll|l|L|z|j|t/))&&(i=i.substring(o.length,i.length));let m="",d=!1;switch(r.toLowerCase()){case"d":case"i":case"u":case"b":case"o":case"x":d=!0;case"e":case"f":case"g":{let t,e="",i=0;switch(d?(isNaN(s)&&(s=parseInt(s,10)),"d"===r||"i"===r?(s<0&&(u="-",s=-s),s=Math.floor(s)):s=s>=0?Math.floor(s):Math.ceil(s)):(isNaN(s)&&(s=parseFloat(s)),s<0&&(u="-",s=-s),g||(f=6)),r.toLowerCase()){case"d":case"i":m+=s.toString(10);break;case"u":m+=n(s).toString(10);break;case"b":m+=n(s).toString(2),h&&(e="0b");break;case"o":m+=n(s).toString(8),h&&(e="0");break;case"x":case"X":m+=n(s).toString(16),h&&(e="0x");break;case"e":m+=s.toExponential(f);break;case"f":m+=s.toFixed(f);break;case"g":0===f&&(f=1),m+=s.toPrecision(f),h||-1===m.indexOf(".")||(m=(m=m.replace(/\.?0+$/,"")).replace(/\.?0+e/,"e"))}if(d){if(g){t=f-m.length;for(let e=0;e<t;e++)m="0"+m}}else h&&-1===m.indexOf(".")&&(-1!==m.indexOf("e")?m=m.replace("e",".e"):m+=".");if(-1!==m.indexOf("e")){const t=function(t){const e=t.length;return 3===t.length?t.substring(0,e-1)+"00"+t.substring(e-1,e):t.substring(0,e-2)+"0"+t.substring(e-2,e)};m=m.replace(/e[+-][0-9]{1,2}$/,t)}if(i=m.length+e.length+u.length,t=c-i,l)for(let e=0;e<t;e++)m+=" ";if(a)for(let e=0;e<t;e++)m="0"+m;if(m=e+m,m=u+m,!a&&!l)for(let e=0;e<t;e++)m=" "+m;r.toUpperCase()===r&&(m=m.toUpperCase());break}case"c":isNaN(s)||(s=String.fromCharCode(s));case"s":{isNaN(s)||(s=s.toString(10)),m=s,g&&m.length>f&&(m=m.substring(0,f));const t=m.length,e=c-t;if(l)for(let t=0;t<e;t++)m+=" ";else{const t=a?"0":" ";for(let n=0;n<e;n++)m=t+m}break}case"%":m="%";break;case"p":case"n":m="(変換できません)"}return m};return e[0].replace(/%[^diubBoxXeEfFgGaAcspn%]*[diubBoxXeEfFgGaAcspn%]/g,i)}}const format=Format.format,toStringFromObj=function(t){return"string"==typeof t||t instanceof String?0===t.length?" ":t:void 0===t?typeof t:null===t?"null":"function"==typeof t.toString?t.toString():t instanceof Object?"Object":"null"};class CUIConsole{constructor(){this.output=CUIConsole._getOutput()}static _getOutput(){const t=function(){return"undefined"!=typeof WSH?null:"undefined"!=typeof console?console:"undefined"!=typeof window&&void 0!==window.console?window.console:null};let e=null;if(function(){return"undefined"!=typeof WSH}())e=/cscript\.exe$/i.test(WSH.FullName)?function(t){/\n$/.test(t)?WSH.StdOut.Write(t):WSH.StdOut.Write(t+"\n")}:WScript.Echo;else if(function(){return null!==t()}()){const n=t();e=n.log}else"undefined"!=typeof alert&&(e=alert);return e}getOutput(){return this.output}}class HtmlConsole{constructor(){this.root=null,this.element=null,this.isshow=!1,this.loglength=250,this.linelength=0}_getElement(){if(null!==this.element)return this.element;const t=document.createElement("div");return t.style.backgroundColor="black",t.style.color="white",t.style.display="block",t.style.margin="0px",t.style.padding="5px",t.style.fontFamily="Consolas, Courier New, Courier, Monaco, monospace",t.style.whiteSpace="pre",this.element=t,this.element}_initHTML(){if(null===this.root){let t;if(t=document.getElementById("senko_console")){let e=t.lastChild;for(;e;)t.removeChild(e),e=t.lastChild}else t=document.body;t.style.backgroundColor="black",t.style.margin="0px",t.style.padding="0px",t.style.overflowY="scroll",t.appendChild(this._getElement()),this.root=t}}isShow(){return this.isshow}setShow(t){if("boolean"!=typeof t)throw"not boolean";this._initHTML();const e=this._getElement();this.isshow!==t&&(this.isshow=t,e&&(e.style.display=this.isshow?"block":"none"))}_autoScroll(){if(null!==this.element&&null!==this.root){const t=this.root.clientHeight,e=this.element.clientHeight;e-t-1*t<=this.root.scrollTop&&(this.root.scrollTop=e)}}_addNewLine(){this._initHTML();const t=this._getElement(),e=document.createElement("p");e.innerText="> ",e.style.margin="0.2em 0px 0.2em 0px",e.style.padding="0px",t.appendChild(e),this.linelength++,this._cleaningLog()}_appendText(t){this._initHTML();const e=this._getElement().lastElementChild;e.innerText=e.innerText+t}_cleaningLog(){if(null!==this.element)for(;this.linelength>this.loglength;)this.element.removeChild(this.element.firstElementChild),this.linelength--}setLogLength(t){this.loglength=t}println(t){this._initHTML();const e=this._getElement();e&&(e.lastElementChild||this._addNewLine(),this._appendText(t),this._addNewLine()),this._autoScroll()}}const cui=(new CUIConsole).getOutput();let gui_obj=null,gui=null;(console||window&&window.console)&&(gui_obj=new HtmlConsole,gui=function(t){gui_obj.println(t)});let show_gui=!1,printbuffer="";class Log{static setGUI(){gui&&(show_gui=!0)}static setCUI(){show_gui=!1}static println(t){const e=printbuffer+toStringFromObj(t);printbuffer="",show_gui?gui(e):cui(e)}static print(t){printbuffer+=toStringFromObj(t)}static printf(){const t=[];for(let e=0;e<arguments.length;e++)t.push(arguments[e]);Log.print(format.apply(this,t))}}class Random{constructor(){this.x=[];for(let t=0;t<521;t++)this.x[t]=0;if(arguments.length>=1)this.setSeed(arguments[0]);else{const t=(new Date).getTime()+Random.seedUniquifier&4294967295;Random.seedUniquifier=Random.seedUniquifier+1&4294967295,this.setSeed(t)}}static _unsigned32(t){return t<0?2147483648+(2147483647&t):t}_multiplication32(t,e){let n=(65535&t)*(65535&e),i=Random._unsigned32(n);return n=(65535&t)*(e>>>16),i=Random._unsigned32(i+((65535&n)<<16)),n=(t>>>16)*(65535&e),4294967295&(i=Random._unsigned32(i+((65535&n)<<16)))}_rnd521(){const t=this.x;for(let e=0;e<32;e++)t[e]^=t[e+489];for(let e=32;e<521;e++)t[e]^=t[e-32]}setSeed(t){let e=0;const n=this.x;for(let i=0;i<=16;i++){for(let n=0;n<32;n++)e=(e>>>1)+((t=this._multiplication32(t,1566083941)+1)<0?2147483648:0);n[i]=e}for(let t=16;t<521;t++)e=16===t?t:t-17,n[t]=n[e]<<23&4294967295^n[t-16]>>>9^n[t-1];for(let t=0;t<4;t++)this._rnd521();this.xi=0,this.haveNextNextGaussian=!1,this.nextNextGaussian=0}genrand_int32(){521===this.xi&&(this._rnd521(),this.xi=0);const t=Random._unsigned32(this.x[this.xi]);return this.xi=this.xi+1,t}next(t){return 0===t?0:32===t?this.genrand_int32():t<32?this.genrand_int32()>>>32-t:63===t?2147483648*this.next(32)+this.next(32):64===t?4294967296*this.next(32)+this.next(32):t<64?this.genrand_int32()*(1<<t-32)+(this.genrand_int32()>>>64-t):void 0}nextBytes(t){for(let e=0;e<t.length;e++)t[e]=this.next(8)}nextInt(){if(1===arguments.length){let t,e;const n=arguments[0];do{e=(t=Random._unsigned32(this.genrand_int32()))%n}while(t-e+n>4294967296);return e}return 4294967295&this.next(32)}nextLong(){return this.next(64)}nextBoolean(){return 0!==this.next(1)}nextFloat(){return this.next(24)/16777216}nextDouble(){return(134217728*this.next(26)+this.next(27))/9007199254740992}nextGaussian(){if(this.haveNextNextGaussian)return this.haveNextNextGaussian=!1,this.nextNextGaussian;const t=Math.sqrt(-2*Math.log(this.nextDouble())),e=2*Math.PI*this.nextDouble(),n=t*Math.sin(e);return this.nextNextGaussian=t*Math.cos(e),this.haveNextNextGaussian=!0,n}}Random.seedUniquifier=2271560481;class BigInteger{constructor(){if(this.element=[],this.sign=0,2===arguments.length&&void 0!==Random&&arguments[1]instanceof Random){this.sign=1;const t=arguments[0],e=arguments[1],n=1+(t-1>>4);let i;if(0===t)return;for(let t=0,o=0;t<n;t++)0===o?(i=e.nextInt(),this.element[t]=65535&i,o=1):(this.element[t]=i>>>16&65535,o=0);t%16!=0&&(this.element[this.element.length-1]&=(1<<t%16)-1),this._memory_reduction()}else if(3===arguments.length){if(void 0===Random)return;for(;;){const t=new BigInteger(arguments[0],arguments[2]);if(t.isProbablePrime(arguments[1])){this.element=t.element,this.sign=t.sign;break}}}else if(arguments.length>=1){this.sign=1;const t=arguments[0];if(t instanceof BigInteger){for(let t=0;t<arguments[0].element.length;t++)this.element[t]=arguments[0].element[t];this.sign=arguments[0].sign}else if("number"==typeof t||t instanceof Number){let t=arguments[0];t<0&&(this.sign=-1,t=-t),this.element=this._number_to_binary_number(t)}else if("string"==typeof t||t instanceof String){let t=arguments[0].replace(/\s/g,"").toLowerCase(),e=t.match(/^[-+]+/);null!==e&&(e=e[0],t=t.substring(e.length,t.length),-1!==e.indexOf("-")&&(this.sign=-1)),2===arguments.length?this.element=this._string_to_binary_number(t,arguments[1]):/^0x/.test(t)?this.element=this._string_to_binary_number(t.substring(2,t.length),16):/^0b/.test(t)?this.element=this._string_to_binary_number(t.substring(2,t.length),2):/^0/.test(t)?this.element=this._string_to_binary_number(t.substring(1,t.length),8):this.element=this._string_to_binary_number(t,10),1===this.element.length&&0===this.element[0]&&(this.element=[])}}}equals(t){if(t instanceof BigInteger||(t=new BigInteger(t)),this.signum()!==t.signum())return!1;if(this.element.length!==t.element.length)return!1;for(let e=0;e<t.element.length;e++)if(this.element[e]!==t.element[e])return!1;return!0}toString(t){0===arguments.length&&(t=10);const e=Math.floor(Math.log(1073741823)/Math.log(t)),n=Math.round(Math.pow(t,e));let i,o=[];for(i=0;i<e;i++)o[i]="0";o=o.join("");const r=this._binary_number_to_string(this.element,n),s=[];let h="";for(this.signum()<0&&(s[s.length]="-"),i=r.length-1;i>=0;i--)h=r[i].toString(t),i<r.length-1&&(s[s.length]=o.substring(0,e-h.length)),s[s.length]=h;return s.join("")}getShort(t){return t<0||this.element.length<=t?0:this.element[t]}byteValue(){let t=this.getShort(0);return(t&=255)>0&&this.sign<0&&(t=-t),t}shortValue(){let t=this.getShort(0);return(t&=65535)>0&&this.sign<0&&(t=-t),t}intValue(){let t=this.getShort(0)+(this.getShort(1)<<16);return(t&=4294967295)>0&&this.sign<0&&(t=-t),t}longValue(){let t=0;for(let e=3;e>=0;e--)t*=65536,t+=this.getShort(e);return this.sign<0&&(t=-t),t}floatValue(){return parseFloat(this.toString())}doubleValue(){return parseFloat(this.toString())}clone(){const t=new BigInteger;return t.element=this.element.slice(0),t.sign=this.sign,t}getLowestSetBit(){for(let t=0;t<this.element.length;t++)if(0!==this.element[t]){const e=this.element[t];for(let n=0;n<16;n++)if(0!=(e>>>n&1))return 16*t+n}return-1}bitLength(){for(let t=this.element.length-1;t>=0;t--)if(0!==this.element[t]){const e=this.element[t];for(let n=15;n>=0;n--)if(0!=(e>>>n&1))return 16*t+n+1}return 0}bitCount(){let t;const e=(t=this.sign>=0?this:this.add(new BigInteger(1))).bitLength();let n=0,i=0;for(let o=0;n<e;o++){const r=t.element[o];for(let t=0;t<16&&n<e;t++,n++)0!=(r>>>t&1)&&(i+=1)}return i}getTwosComplement(t){const e=this.clone();if(e.sign>=0)return e;{e.sign=1,0===arguments.length&&(t=e.bitLength());const n=e.element;for(let t=0;t<n.length;t++)n[t]^=65535;return t%16!=0&&(n[n.length-1]&=(1<<t%16)-1),e._add(new BigInteger(1)),e}}_and(t){t instanceof BigInteger||(t=new BigInteger(t));let e=this,n=t;const i=e.signum(),o=n.signum(),r=Math.max(e.bitLength(),n.bitLength());e=e.getTwosComplement(r).element,n=n.getTwosComplement(r).element;const s=Math.max(e.length,n.length);this.element=[];for(let t=0;t<s;t++){const i=t>=e.length?0:e[t],o=t>=n.length?0:n[t];this.element[t]=i&o}return 0===this.bitLength()&&(this.element=[],this.sign=0),1===i||1===o?this.sign=1:-1===this.sign&&(this.element=this.getTwosComplement(r).element),this}and(t){return this.clone()._and(t)}_or(t){t instanceof BigInteger||(t=new BigInteger(t));let e=this,n=t;const i=e.signum(),o=n.signum(),r=Math.max(e.bitLength(),n.bitLength());e=e.getTwosComplement(r).element,n=n.getTwosComplement(r).element;const s=Math.max(e.length,n.length);this.element=[];for(let t=0;t<s;t++){const i=t>=e.length?0:e[t],o=t>=n.length?0:n[t];this.element[t]=i|o}return this.sign=-1===i||-1===o?-1:Math.max(i,o),-1===this.sign&&(this.element=this.getTwosComplement(r).element),this}or(t){return this.clone()._or(t)}_xor(t){t instanceof BigInteger||(t=new BigInteger(t));let e=this,n=t;const i=e.signum(),o=n.signum(),r=Math.max(e.bitLength(),n.bitLength());e=e.getTwosComplement(r).element,n=n.getTwosComplement(r).element;const s=Math.max(e.length,n.length);this.element=[];for(let t=0;t<s;t++){const i=t>=e.length?0:e[t],o=t>=n.length?0:n[t];this.element[t]=i^o}return this.sign=0!==i&&i!==o?-1:1,-1===this.sign&&(this.element=this.getTwosComplement(r).element),this}xor(t){return this.clone()._xor(t)}_not(){return this._add(new BigInteger(1))._negate()}not(){return this.clone()._not()}_andNot(t){return t instanceof BigInteger||(t=new BigInteger(t)),this._and(t.not())}andNot(t){return this.clone()._andNot(t)}_number_to_binary_number(t){if(t>4294967295)return this._string_to_binary_number(t.toFixed(),10);const e=[];for(;0!==t;)e[e.length]=1&t,t>>>=1;t=[];for(let n=0;n<e.length;n++)t[n>>>4]|=e[n]<<(15&n);return t}_string_to_binary_number(t,e){const n=Math.floor(Math.log(1073741823)/Math.log(e)),i=Math.round(Math.pow(e,n));let o=[];const r=[],s=Math.ceil(t.length/n);let h=t.length;for(let i=0;i<s;i++)h-=n,o[i]=h>=0?parseInt(t.substring(h,h+n),e):parseInt(t.substring(0,h+n),e);for(e=i;0!==o.length;){let t=0;for(let n=o.length-1;n>=0;n--){const i=o[n]+t*e;o[n]=i>>>1,t=1&i}r[r.length]=t,0===o[o.length-1]&&o.pop()}o=[];for(let t=0;t<r.length;t++)o[t>>>4]|=r[t]<<(15&t);return o}_binary_number_to_string(t,e){const n=function(t,n,i){const o=t.length;let r=0;for(let s=0;s<o;s++)i[s]=t[s]+(n.length>=s+1?n[s]:0)+r,i[s]>=e?(r=1,i[s]-=e):r=0;1===r&&(i[o]=1)},i=[0],o=[1];for(let e=0;e<t.length;e++)for(let r=0;r<16;r++)t[e]>>>r&1&&n(o,i,i),n(o,o,o);return i}_memory_allocation(t){const e=this.element.length<<4;if(e<t){const n=1+((t-e-1&4294967280)>>>4);for(let t=0;t<n;t++)this.element[this.element.length]=0}}_memory_reduction(){for(let t=this.element.length-1;t>=0;t--)if(0!==this.element[t])return void(t<this.element.length-1&&this.element.splice(t+1,this.element.length-t-1));this.sign=0,this.element=[]}gcd(t){t instanceof BigInteger||(t=new BigInteger(t));let e,n=this,i=t;for(;0!==i.signum();)e=n.remainder(i),n=i,i=e;return n}extgcd(t){t instanceof BigInteger||(t=new BigInteger(t));const e=new BigInteger(1),n=new BigInteger(0);let i,o,r,s,h=this,l=t,a=e,u=n,c=n,g=e;for(;0!==l.signum();){const t=h.divideAndRemainder(l);o=t[0],i=t[1],r=a.subtract(o.multiply(u)),s=c.subtract(o.multiply(g)),a=u,u=r,c=g,g=s,h=l,l=i}return[a,c,h]}_abs(){return this.sign*=this.sign,this}abs(){return this.clone()._abs()}_negate(){return this.sign*=-1,this}negate(){return this.clone()._negate()}signum(){return 0===this.element.length?0:this.sign}compareToAbs(t){if(t instanceof BigInteger||(t=new BigInteger(t)),this.element.length<t.element.length)return-1;if(this.element.length>t.element.length)return 1;for(let e=this.element.length-1;e>=0;e--)if(this.element[e]!==t.element[e]){const n=this.element[e]-t.element[e];return 0===n?0:n>0?1:-1}return 0}compareTo(t){return t instanceof BigInteger||(t=new BigInteger(t)),this.signum()!==t.signum()?this.sign>t.sign?1:-1:0===this.signum()?0:this.compareToAbs(t)*this.sign}max(t){return this.compareTo(t)>=0?this.clone():t.clone()}min(t){return this.compareTo(t)>=0?t.clone():this.clone()}_shift(t){if(0===t)return this;const e=this.element;if(1===t){let t=e.length-1;for(0!=(32768&e[t])&&(e[e.length]=1);t>=0;t--)e[t]<<=1,e[t]&=65535,t>0&&0!=(32768&e[t-1])&&(e[t]+=1)}else if(-1===t){for(let t=0;t<e.length;t++)e[t]>>>=1,t<e.length-1&&0!=(1&e[t+1])&&(e[t]|=32768);0===e[e.length-1]&&e.pop()}else{if(t>=16){const n=t>>>4;for(let t=e.length-1;t>=0;t--)e[t+n]=e[t];for(let t=n-1;t>=0;t--)e[t]=0;t&=15}else if(t<=-16){const n=-t>>>4;e.splice(0,n),t+=n<<4}if(0!==t)if(0<t){let n=0;for(let i=0;i<e.length;i++)e[i]=(e[i]<<t)+n,e[i]>65535?(n=e[i]>>>16,e[i]&=65535):n=0;0!==n&&(e[e.length]=n)}else{t=-t;for(let n=0;n<e.length;n++)n!==e.length-1?(e[n]+=e[n+1]<<16,e[n]>>>=t,e[n]&=65535):e[n]>>>=t;0===e[e.length-1]&&e.pop()}}return this}shift(t){return this.clone()._shift(t)}shiftLeft(t){return this.shift(t)}shiftRight(t){return this.shift(-t)}_add(t){t instanceof BigInteger||(t=new BigInteger(t));const e=this,n=t;let i=e.element,o=n.element;if(e.sign===n.sign){this._memory_allocation(o.length<<4);let t=0;for(let e=0;e<i.length;e++)i[e]+=(o.length>=e+1?o[e]:0)+t,i[e]>65535?(t=1,i[e]&=65535):t=0;0!==t&&(i[i.length]=t)}else{const t=e.compareToAbs(n);if(0===t)return this.element=[],this.sign=1,this;if(-1===t){this.sign=n.sign;const t=i;i=o.slice(0),o=t}let r=0;for(let t=0;t<i.length;t++)i[t]-=(o.length>=t+1?o[t]:0)+r,i[t]<0?(i[t]+=65536,r=1):r=0;this.element=i,this._memory_reduction()}return this}add(t){return this.clone()._add(t)}_subtract(t){t instanceof BigInteger||(t=new BigInteger(t));const e=t.sign,n=this._add(t._negate());return t.sign=e,n}subtract(t){return this.clone()._subtract(t)}_multiply(t){const e=this.multiply(t);return this.element=e.element,this.sign=e.sign,this}multiply(t){t instanceof BigInteger||(t=new BigInteger(t));const e=new BigInteger,n=new BigInteger,i=t,o=this.element,r=i.element,s=e.element;for(let t=0;t<o.length;t++){n.element=[];const i=n.element;let h=0;for(let e=0;e<r.length;e++)i[e]=o[t]*r[e]+h,i[e]>65535?(h=i[e]>>>16,i[e]&=65535):h=0;0!==h&&(i[i.length]=h);for(let e=i.length-1;e>=0;e--)i[e+t]=i[e];for(let e=t-1;e>=0;e--)i[e]=0;h=0,e._memory_allocation(i.length<<4);for(let e=t;e<s.length;e++)s[e]+=(i.length>=e+1?i[e]:0)+h,s[e]>65535?(h=1,s[e]&=65535):h=0;0!==h&&(s[s.length]=h)}return e.sign=this.sign*t.sign,e}_divideAndRemainder(t){t instanceof BigInteger||(t=new BigInteger(t));const e=[];if(0===t.signum())return e[0]=1/0,e[1]=NaN,e;const n=this.compareToAbs(t);if(n<0)return e[0]=new BigInteger(0),e[1]=this.clone(),e;if(0===n)return e[0]=new BigInteger(1),e[0].sign=this.sign*t.sign,e[1]=new BigInteger(0),e;const i=new BigInteger(1),o=this.bitLength()-t.bitLength(),r=this.clone()._abs(),s=t.shift(o)._abs(),h=new BigInteger;for(let t=0;t<=o&&(r.compareToAbs(s)>=0&&(r._subtract(s),h._add(i)),t!==o);t++)s._shift(-1),h._shift(1);return e[0]=h,e[0].sign=this.sign*t.sign,e[1]=r,e[1].sign=this.sign,e}divideAndRemainder(t){return this.clone()._divideAndRemainder(t)}_divide(t){return this._divideAndRemainder(t)[0]}divide(t){return this.clone()._divide(t)}_remainder(t){return this._divideAndRemainder(t)[1]}remainder(t){return this.clone()._remainder(t)}_mod(t){if(t instanceof BigInteger||(t=new BigInteger(t)),t.signum()<0)return null;const e=this._divideAndRemainder(t);return e[1]instanceof BigInteger?e[1].signum()>=0?e[1]:e[1]._add(t):null}mod(t){return this.clone()._mod(t)}_setBit(t){return this._memory_allocation(t+1),this.element[t>>>4]|=1<<(15&t),this}setBit(t){return this.clone()._setBit(t)}_flipBit(t){return this._memory_allocation(t+1),this.element[t>>>4]^=1<<(15&t),this}flipBit(t){return this.clone()._flipBit(t)}clearBit(t){const e=this.clone();return e.element[t>>>4]&=~(1<<(15&t)),e._memory_reduction(),e}testBit(t){return this.element[t>>>4]>>>(15&t)&1}pow(t){let e,n;for(e=new BigInteger(this),n=new BigInteger(1);0!==t;)0!=(1&t)&&(n=n.multiply(e)),e=e.multiply(e),t>>>=1;return n}modPow(t,e){e=new BigInteger(e);let n=new BigInteger(this),i=new BigInteger(1);const o=new BigInteger(t);for(;0!==o.element.length;)0!=(1&o.element[0])&&(i=i.multiply(n).mod(e)),n=n.multiply(n).mod(e),o._shift(-1);return i}modInverse(t){t=new BigInteger(t);const e=this.extgcd(t),n=new BigInteger(1);return 0!==e[2].compareTo(n)?null:e[0]._add(t)._mod(t)}isProbablePrime(t){const e=this.element;if(0===e.length||1===e.length&&e[0]<=2)return!0;if(0==(1&e[0])||t<=0)return!1;if(void 0===Random)return!1;t>>=1;const n=new BigInteger(0),i=new BigInteger(1),o=this,r=o.bitLength(),s=o.subtract(i),h=s.getLowestSetBit(),l=s.shift(-h),a=new Random;let u,c;for(let e=0;e<t;e++){do{u=new BigInteger(r,a)}while(0===u.compareTo(n)||-1!==u.compareTo(o));if(0!==(u=u.modPow(l,o)).compareTo(i)){c=!0;for(let t=0;t<=h;t++){if(0===u.compareTo(s)){c=!1;break}t<h&&(u=u.multiply(u)._mod(o))}if(c)return!1}}return!0}nextProbablePrime(){if(void 0===Random)return new BigInteger(0);const t=this.clone(),e=new BigInteger(1);for(;;)if(t._add(e),t.isProbablePrime(100))break;return t}static valueOf(t){return new BigInteger(t)}static probablePrime(t,e){return new BigInteger(t,100,e)}}BigInteger.ONE=new BigInteger(1),BigInteger.TEN=new BigInteger(10),BigInteger.ZERO=new BigInteger(0);class BigDecimal{constructor(){this.integer=0,this._scale=0;let t=0,e=0,n=null;if(arguments.length>=1&&(t=arguments[0]),arguments.length>=2&&(e=arguments[1]),arguments.length>=3&&(n=arguments[2]),e instanceof MathContext&&(n=e),t instanceof BigDecimal)this.integer=t.integer.clone(),this._scale=t._scale,this.int_string=t.int_string;else if(t instanceof BigInteger)this.integer=t.clone(),this._scale=e;else if("number"==typeof t)if(t===Math.floor(t))this.integer=new BigInteger(t),this._scale=0;else{for(this._scale=0;;)if(t*=10,this._scale=this._scale+1,t===Math.floor(t))break;this.integer=new BigInteger(t)}else if("string"==typeof t){this._scale=0;let e,n=t.replace(/\s/g,"").toLowerCase(),i="";null!==(e=n.match(/^[+-]+/))&&(e=e[0],n=n.substr(e.length),-1!==e.indexOf("-")&&(i+="-")),null!==(e=n.match(/^[0-9]+/))&&(e=e[0],n=n.substr(e.length),i+=e),null!==(e=n.match(/^\.[0-9]+/))&&(e=e[0],n=n.substr(e.length),e=e.substr(1),this._scale=this._scale+e.length,i+=e),null!==(e=n.match(/^e[+-]?[0-9]+/))&&(e=e[0].substr(1),this._scale=this._scale-parseInt(e,10)),this.integer=new BigInteger(i,10)}if(n instanceof MathContext){const t=this.round(n);this.integer=t.integer,this._scale=t._scale}}_getUnsignedIntegerString(){return void 0===this.int_string&&(this.int_string=this.integer.toString(10).replace(/^-/,"")),this.int_string}clone(){return new BigDecimal(this)}scale(){return this._scale}signum(){return this.integer.signum()}precision(){return this._getUnsignedIntegerString().length}unscaledValue(){return new BigInteger(this.integer)}toScientificNotation(t){const e=this._getUnsignedIntegerString();let n=this.scale();const i=[];let o,r;if(-1===this.signum()&&(i[i.length]="-"),(n=-t-n)>=0)for(i[i.length]=e,o=0;o<n;o++)i[i.length]="0";else if(0<(r=this.precision()+n))i[i.length]=e.substring(0,r),i[i.length]=".",i[i.length]=e.substring(r,e.length);else{for(r=-r,i[i.length]="0.",o=0;o<r;o++)i[i.length]="0";i[i.length]=e}return i[i.length]="E",t>=0&&(i[i.length]="+"),i[i.length]=t,i.join("")}toString(){const t=-this.scale()+(this.precision()-1);return this.scale()>=0&&t>=-6?this.toPlainString():this.toScientificNotation(t)}toEngineeringString(){const t=-this.scale()+(this.precision()-1);return this.scale()>=0&&t>=-6?this.toPlainString():this.toScientificNotation(3*Math.floor(t/3))}toPlainString(){return 0===this.scale()?this.signum()<0?"-"+this._getUnsignedIntegerString():this._getUnsignedIntegerString():this.toScientificNotation(0).match(/^[^E]*/)[0]}ulp(){return new BigDecimal(BigInteger.ONE,this.scale())}setScale(t,e){if(this.scale()===t)return this.clone();e=1===arguments.length?RoundingMode.UNNECESSARY:RoundingMode.getRoundingMode(e);let n=this._getUnsignedIntegerString();const i=this.signum(),o=i>=0?"":"-",r=t-this.scale();if(0<=r){let e;for(e=0;e<r;e++)n+="0";return new BigDecimal(new BigInteger(o+n),t)}const s=n.length+r,h=s+1;if(s<=0){const n=(i+e.getAddNumber(i))/10;return new BigDecimal(new BigInteger(n),t)}{const i=n.match(/0+$/),h=null!==i?i[0].length:0;if(h+r>=0||e===RoundingMode.DOWN)return new BigDecimal(new BigInteger(o+n.substring(0,s)),t)}{const r=(n=n.substring(0,h)).length>1?2:1,s=parseInt(n.substring(n.length-r,n.length))*i,l=new BigInteger(o+n),a=new BigInteger(e.getAddNumber(s));return n=l.add(a).toString(),new BigDecimal(new BigInteger(n.substring(0,n.length-1)),t)}}round(t){if(!(t instanceof MathContext))throw"not MathContext";const e=t.getPrecision(),n=e-this.precision();if(0===n||0===e)return this.clone();const i=this.setScale(this.scale()+n,t.getRoundingMode());if(n>0)return i;if(i.precision()===t.getPrecision())return i;const o=i.integer.signum()>=0?"":"-",r=i._getUnsignedIntegerString(),s=o+r.substring(0,r.length-1);return new BigDecimal(new BigInteger(s),i.scale()-1)}abs(t){const e=this.clone();if(e.integer=e.integer.abs(),1===arguments.length)return e;if(!(t instanceof MathContext))throw"not MathContext";return e.round(t)}plus(t){const e=this.clone();if(1===arguments.length)return e;if(!(t instanceof MathContext))throw"not MathContext";return e.round(t)}negate(t){const e=this.clone();if(e.integer=e.integer.negate(),1===arguments.length)return e;if(!(t instanceof MathContext))throw"not MathContext";return e.round(t)}compareTo(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";const e=this,n=t;{const t=e.signum(),i=n.signum();if(0===t&&t===i)return 0;if(0===t)return-i;if(0===i)return t}if(e._scale===n._scale)return e.integer.compareTo(n.integer);if(e._scale>n._scale){const t=n.setScale(e._scale);return e.integer.compareTo(t.integer)}{const t=e.setScale(n._scale);return t.integer.compareTo(n.integer)}}equals(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";return this._scale===t._scale&&this.integer.equals(t.integer)}min(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";return this.compareTo(t)<=0?this.clone():t.clone()}max(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";return this.compareTo(t)>=0?this.clone():t.clone()}movePointLeft(t){let e=this.scaleByPowerOfTen(-t);return e=e.setScale(Math.max(this.scale()+t,0))}movePointRight(t){let e=this.scaleByPowerOfTen(t);return e=e.setScale(Math.max(this.scale()-t,0))}scaleByPowerOfTen(t){const e=this.clone();return e._scale=this.scale()-t,e}stripTrailingZeros(){const t=this.signum()>=0?"":"-",e=this.integer.toString(10).replace(/^-/,""),n=e.match(/0+$/);let i=null!==n?n[0].length:0;i===e.length&&(i=e.length-1);const o=this.scale()-i;return new BigDecimal(new BigInteger(t+e.substring(0,e.length-i)),o)}add(t,e){if(1===arguments.length&&(e=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(e instanceof MathContext))throw"not MathContext";const n=this,i=t,o=Math.max(n._scale,i._scale);if(n._scale===i._scale)return new BigDecimal(n.integer.add(i.integer),o,e);if(n._scale>i._scale){const t=i.setScale(n._scale);return new BigDecimal(n.integer.add(t.integer),o,e)}{const t=n.setScale(i._scale);return new BigDecimal(t.integer.add(i.integer),o,e)}}subtract(t,e){if(1===arguments.length&&(e=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(e instanceof MathContext))throw"not MathContext";const n=this,i=t,o=Math.max(n._scale,i._scale);if(n._scale===i._scale)return new BigDecimal(n.integer.subtract(i.integer),o,e);if(n._scale>i._scale){const t=i.setScale(n._scale);return new BigDecimal(n.integer.subtract(t.integer),o,e)}{const t=n.setScale(i._scale);return new BigDecimal(t.integer.subtract(i.integer),o,e)}}multiply(t,e){if(1===arguments.length&&(e=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(e instanceof MathContext))throw"not MathContext";const n=this,i=t,o=n.integer.multiply(i.integer),r=n._scale+i._scale;return new BigDecimal(o,r,e)}divideToIntegralValue(t,e){if(1===arguments.length&&(e=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(e instanceof MathContext))throw"not MathContext";const n=function(t){let e,n="1";for(e=0;e<t;e++)n+="0";return new BigInteger(n)};if(0===t.compareTo(BigDecimal.ZERO))throw"ArithmeticException";const i=this,o=t;let r=i.integer,s=o.integer;const h=i._scale-o._scale;i._scale>o._scale?s=s.multiply(n(h)):i._scale<o._scale&&(r=r.multiply(n(-h)));const l=r.divide(s),a=l.signum();if(0!==a){const t=l.toString(10).replace(/^-/,"");if(0!==e.getPrecision()&&t.length>e.getPrecision())throw"ArithmeticException";if(t.length<=-h){const e=t.match(/0+$/),n=null!==e?e[0].length:0,i=a>=0?"":"-";return new BigDecimal(new BigInteger(i+t.substring(0,t.length-n)),-n)}}let u=new BigDecimal(l);return u=u.setScale(h,RoundingMode.UP),u=u.round(e)}divideAndRemainder(t,e){if(1===arguments.length&&(e=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(e instanceof MathContext))throw"not MathContext";const n=this.divideToIntegralValue(t,e);return[n,this.subtract(n.multiply(t,e),e)]}divide(t,e,n){if(!(t instanceof BigDecimal))throw"not BigDecimal";const i=this,o=t;let r,s=null,h=MathContext.UNLIMITED,l=0,a=!1;if(1===arguments.length)l=i.scale()-o.scale(),a=!0;else if(2===arguments.length)r=e,l=i.scale(),a=!0,s=r instanceof MathContext?(h=r).getRoundingMode():RoundingMode.getRoundingMode(arguments[0]);else{if(3!==arguments.length)throw"The argument is over.";if(!("number"==typeof e||e instanceof Number))throw"scale is not Integer";l=e,s=(r=n)instanceof MathContext?(h=r).getRoundingMode():RoundingMode.getRoundingMode(arguments[0])}if(0===o.compareTo(BigDecimal.ZERO))throw"ArithmeticException";let u,c=i;const g=[];let f,m,d,p;p=BigDecimal.ZERO;const _=h.getPrecision(),C=0!==_?_+8:262143;for(u=0;u<C&&(f=c.divideAndRemainder(o,MathContext.UNLIMITED),m=f[0],d=f[1],p=p.add(m.scaleByPowerOfTen(-u),MathContext.UNLIMITED),0!==d.compareTo(BigDecimal.ZERO));u++){if(0===_){if(g[d._getUnsignedIntegerString()])throw"ArithmeticException "+p+"["+d._getUnsignedIntegerString()+"]";g[d._getUnsignedIntegerString()]=!0}c=d.scaleByPowerOfTen(1)}if(a)try{p=p.setScale(l,s)}catch(t){}else p=p.setScale(l,s);return p=p.round(h)}toBigInteger(){const t=this.toPlainString().replace(/\.\d*$/,"");return new BigInteger(t.toPlainString())}toBigIntegerExact(){const t=this.setScale(0,RoundingMode.UNNECESSARY);return new BigInteger(t.toPlainString())}longValue(){let t=this.toBigInteger();return t=t.longValue()}longValueExact(){let t=this.toBigIntegerExact();return t=t.longValue()}intValue(){let t=this.toBigInteger();return 4294967295&(t=t.intValue())}intValueExact(){let t=this.toBigIntegerExact();if((t=t.longValue())<-2147483648||2147483647<t)throw"ArithmeticException";return t}floatValue(){const t=this.precision();return MathContext.DECIMAL32.getPrecision()<t?this.signum()>=0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:parseFloat(t.toEngineeringString())}doubleValue(){const t=this.precision();return MathContext.DECIMAL64.getPrecision()<t?this.signum()>=0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:parseFloat(t.toEngineeringString())}pow(t,e){if(Math.abs(t)>999999999)throw"ArithmeticException";if(1===arguments.length&&(e=MathContext.UNLIMITED),!(e instanceof MathContext))throw"not MathContext";if(0===e.getPrecision()&&t<0)throw"ArithmeticException";if(e.getPrecision()>0&&t>e.getPrecision())throw"ArithmeticException";let n,i;for(n=this.clone(),i=BigDecimal.ONE;0!==t;)0!=(1&t)&&(i=i.multiply(n,MathContext.UNLIMITED)),n=n.multiply(n,MathContext.UNLIMITED),t>>>=1;return i.round(e)}static valueOf(t,e){if(1===arguments.length)return new BigDecimal(t);if(2===arguments.length){if("number"==typeof t&&t===Math.floor(t))return new BigDecimal(new BigInteger(t),e);throw"IllegalArgumentException"}throw"IllegalArgumentException"}}const RoundingMode={UP:{toString:function(){return"UP"},getAddNumber:function(t){return t%=10,0===t?0:t>0?10-t:-(10+t)}},DOWN:{toString:function(){return"DOWN"},getAddNumber:function(t){return-(t%=10)}},CEILING:{toString:function(){return"CEILING"},getAddNumber:function(t){return t%=10,0===t?0:t>0?10-t:-t}},FLOOR:{toString:function(){return"FLOOR"},getAddNumber:function(t){return t%=10,0===t?0:t>0?-t:-(10+t)}},HALF_UP:{toString:function(){return"HALF_UP"},getAddNumber:function(t){const e=(t%=10)>=0?1:-1;return Math.abs(t)<5?-1*t:e*(10-Math.abs(t))}},HALF_DOWN:{toString:function(){return"HALF_DOWN"},getAddNumber:function(t){const e=(t%=10)>=0?1:-1;return Math.abs(t)<6?-1*t:e*(10-Math.abs(t))}},HALF_EVEN:{toString:function(){return"HALF_EVEN"},getAddNumber:function(t){let e,n;(t%=100)<0?(e=-1,n=1&Math.ceil(t/10)):(e=1,n=1&Math.floor(t/10));let i;return i=1===n?5:6,t%=10,Math.abs(t)<i?-1*t:e*(10-Math.abs(t))}},UNNECESSARY:{toString:function(){return"UNNECESSARY"},getAddNumber:function(t){if(0===(t%=10))return 0;throw"ArithmeticException"}},valueOf:function(t){if(null===t)throw"NullPointerException";const e=RoundingMode.values;for(let n=0;n<e.length;n++)if(e[n].toString()===t)return e[n];throw"IllegalArgumentException"},getRoundingMode:function(t){let e;switch(t){case RoundingMode.CEILING:case RoundingMode.DOWN:case RoundingMode.FLOOR:case RoundingMode.HALF_DOWN:case RoundingMode.HALF_EVEN:case RoundingMode.HALF_UP:case RoundingMode.UNNECESSARY:case RoundingMode.UP:e=t;break;default:"number"==typeof t||t instanceof Number?e=RoundingMode.values[t]:("string"==typeof t||t instanceof String)&&(e=RoundingMode.valueOf(t))}if(!e)throw"Not RoundingMode";return e}};RoundingMode.values={0:RoundingMode.CEILING,1:RoundingMode.DOWN,2:RoundingMode.FLOOR,3:RoundingMode.HALF_DOWN,4:RoundingMode.HALF_EVEN,5:RoundingMode.HALF_UP,6:RoundingMode.UNNECESSARY,7:RoundingMode.UP};class MathContext{constructor(){this.precision=0,this.roundingMode=RoundingMode.HALF_UP;let t,e=0,n=0;if(arguments.length>=1&&(e=arguments[0]),arguments.length>=2&&(n=arguments[1]),"string"==typeof e||e instanceof String?(null!==(t=e.match(/precision=\d+/))&&(t=t[0].substring("precision=".length,t[0].length),this.precision=parseInt(t,10)),null!==(t=e.match(/roundingMode=\w+/))&&(t=t[0].substring("roundingMode=".length,t[0].length),this.roundingMode=RoundingMode.valueOf(t))):1===arguments.length?this.precision=e:2===arguments.length&&(this.precision=e,this.roundingMode=n),this.precision<0)throw"IllegalArgumentException"}getPrecision(){return this.precision}getRoundingMode(){return this.roundingMode}equals(t){return t instanceof MathContext&&t.toString()===this.toString()}toString(){return"precision="+this.precision+" roundingMode="+this.roundingMode.toString()}}MathContext.UNLIMITED=new MathContext(0,RoundingMode.HALF_UP),MathContext.DECIMAL32=new MathContext(7,RoundingMode.HALF_EVEN),MathContext.DECIMAL64=new MathContext(16,RoundingMode.HALF_EVEN),MathContext.DECIMAL128=new MathContext(34,RoundingMode.HALF_EVEN),BigDecimal.RoundingMode=RoundingMode,BigDecimal.MathContext=MathContext,BigDecimal.ZERO=new BigDecimal(0),BigDecimal.ONE=new BigDecimal(1),BigDecimal.TEN=new BigDecimal(10),BigDecimal.ROUND_CEILING=RoundingMode.CEILING,BigDecimal.ROUND_DOWN=RoundingMode.DOWN,BigDecimal.ROUND_FLOOR=RoundingMode.FLOOR,BigDecimal.ROUND_HALF_DOWN=RoundingMode.HALF_DOWN,BigDecimal.ROUND_HALF_EVEN=RoundingMode.HALF_EVEN,BigDecimal.ROUND_HALF_UP=RoundingMode.HALF_UP,BigDecimal.ROUND_UNNECESSARY=RoundingMode.UNNECESSARY,BigDecimal.ROUND_UP=RoundingMode.UP;const random_class=new Random,ToComplexFromString=function(t,e){const n=t.replace(/\s/g,"").toLowerCase();if(!/[ij]/.test(n))return e._re=parseFloat(n),void(e._im=0);let i,o=0,r=0;(i=n.match(/[+-]?[0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?($|[+-])/))&&(o=parseFloat(i[0])),(i=n.match(/[+-]?([0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?)?[ij]/))&&(i=i[0].substring(0,i[0].length-1),r=/^[-+]$/.test(i)||0===i.length?"-"===i?-1:1:parseFloat(i)),e._re=o,e._im=r};class Complex{constructor(t){if(1!==arguments.length)throw"Many arguments : "+arguments.length;{const e=t;if(e instanceof Complex||e instanceof Object&&e._re&&e._im)this._re=e._re,this._im=e._im;else if("number"==typeof e||e instanceof Number)this._re=e,this._im=0;else if(e instanceof Array&&2===e.length)this._re=e[0],this._im=e[1];else if("string"==typeof e||e instanceof String)ToComplexFromString(e,this);else{if(!(e instanceof Object&&e.toString))throw"Unsupported argument";ToComplexFromString(e.toString(),this)}}}clone(){return this}toString(){const t=function(t){let e=t.toPrecision(6);return-1!==e.indexOf(".")&&(e=(e=e.replace(/\.?0+$/,"")).replace(/\.?0+e/,"e")),e};return this.isReal()?t(this._re):0===this._re?t(this._im)+"i":this._im>=0?t(this._re)+" + "+t(this._im)+"i":t(this._re)+" - "+t(-this._im)+"i"}static createConstComplex(t){return t instanceof Complex?t:new Complex(t)}static rand(){return new Complex(random_class.nextDouble())}static randn(){return new Complex(random_class.nextGaussian())}equals(t,e){const n=Complex.createConstComplex(t),i=e||Number.EPSILON;return Math.abs(this._re-n._re)<i&&Math.abs(this._im-n._im)<i}get real(){return this._re}get imag(){return this._im}get norm(){return 0===this._im?Math.abs(this._re):0===this._re?Math.abs(this._im):Math.sqrt(this._re*this._re+this._im*this._im)}get angle(){return 0===this._im?0:0===this._re?Math.PI*(this._im>=0?.5:-.5):Math.atan2(this._im,this._re)}getDecimalPosition(){let t=0,e=this;for(let n=0;n<20&&!e.isComplexInteger();n++)e=e.mul(Complex.TEN),t++;return t}add(t){const e=new Complex(t);return e._re=this._re+e._re,e._im=this._im+e._im,e}sub(t){const e=new Complex(t);return e._re=this._re-e._re,e._im=this._im-e._im,e}mul(t){const e=new Complex(t);if(0===this._im&&0===e._im)return e._re=this._re*e._re,e;if(0===this._re&&0===e._re)return e._re=-this._im*e._im,e._im=0,e;{const t=this._re*e._re-this._im*e._im,n=this._im*e._re+this._re*e._im;return e._re=t,e._im=n,e}}div(t){const e=new Complex(t);if(0===this._im&&0===e._im)return e._re=this._re/e._re,e;if(0===this._re&&0===e._re)return e._re=this._im/e._im,e._im=0,e;{const t=this._re*e._re+this._im*e._im,n=this._im*e._re-this._re*e._im,i=1/(e._re*e._re+e._im*e._im);return e._re=t*i,e._im=n*i,e}}mod(t){const e=new Complex(t);if(0!==this._im||0!==e._im)throw"calculation method is undefined.";let n=this._re-e._re*(0|this._re/e._re);return n<0&&(n+=e._re),e._re=n,e}inv(){return 0===this._im?new Complex(1/this._re):0===this._re?new Complex([0,-1/this._im]):Complex.ONE.div(this)}sign(){return 0===this._im?new Complex(0===this._re?0:this._re>0?1:-1):this.div(this.norm)}max(t,e){const n=Complex.createConstComplex(t);return this.compareTo(n,e)<=0?this:n}min(t,e){const n=Complex.createConstComplex(t);return this.compareTo(n,e)>=0?this:n}compareTo(t,e){const n=Complex.createConstComplex(t);return this.equals(n,e)?0:this.real+this.imag<n.real+n.imag?1:-1}isInteger(t){const e=t||Number.EPSILON;return this.isReal()&&Math.abs(this._re-(0|this._re))<e}isComplexInteger(t){const e=t||Number.EPSILON;return Math.abs(this._re-(0|this._re))<e&&Math.abs(this._im-(0|this._im))<e}isZero(t){const e=t||Number.EPSILON;return Math.abs(this._re)<e&&Math.abs(this._im)<e}isOne(t){const e=t||Number.EPSILON;return Math.abs(this._re-1)<e&&Math.abs(this._im)<e}isComplex(t){const e=t||Number.EPSILON;return Math.abs(this._im)>=e}isReal(t){const e=t||Number.EPSILON;return Math.abs(this._im)<e}isNaN(){return Math.isNaN(this._re)||Math.isNaN(this._im)}isPositive(){return 0<this._re}isNegative(){return 0>this._re}isNotNegative(){return 0<=this._re}isInfinite(){return this._re===Number.POSITIVE_INFINITY||this._im===Number.POSITIVE_INFINITY||this._re===Number.NEGATIVE_INFINITY||this._im===Number.NEGATIVE_INFINITY}isFinite(){return!this.isNaN()&&!this.isInfinite()}abs(){return new Complex(this.norm)}conj(){return new Complex([this._re,-this._im])}negate(){return new Complex([-this._re,-this._im])}pow(t){const e=new Complex(t);if(this.isReal()&&e.isReal()&&this.isNotNegative())return e._re=Math.pow(this._re,e._re),e;if(e.isReal()){const t=Math.pow(this.norm,e._re),n=this.angle*e._re;return e._re=t*Math.cos(n),e._im=t*Math.sin(n),e}return e.mul(this.log()).exp()}square(){return new Complex(this._re*this._re+this._im*this._im)}sqrt(){if(this.isReal())return new Complex(this.isNotNegative()?Math.sqrt(this._re):[0,Math.sqrt(this._re)]);const t=Math.sqrt(this.norm),e=.5*this.angle;return new Complex([t*Math.cos(e),t*Math.sin(e)])}log(){return new Complex(this.isReal()&&this.isNotNegative()?Math.log(this._re):[Math.log(this.norm),this.angle])}exp(){if(this.isReal())return new Complex(Math.exp(this._re));const t=Math.exp(this._re);return new Complex([t*Math.cos(this._im),t*Math.sin(this._im)])}sin(){if(this.isReal())return new Complex(Math.sin(this._re));const t=this.mul(Complex.I).exp(),e=this.mul(Complex.I.negate()).exp();return t.sub(e).div([0,2])}cos(){if(this.isReal())return new Complex(Math.cos(this._re));const t=this.mul(Complex.I).exp(),e=this.mul(Complex.I.negate()).exp();return t.add(e).div(2)}tan(){return this.isReal()?new Complex(Math.tan(this._re)):this.sin().div(this.cos())}atan(){return this.isReal()?new Complex(Math.atan(this._re)):Complex.I.div(Complex.TWO).mul(Complex.I.add(this).div(Complex.I.sub(this)).log())}atan2(){if(0===arguments.length)return new Complex(this.angle);const t=this,e=new Complex(...arguments);if(t.isReal()&&e.isReal())return new Complex(Math.atan2(t._re,e._re));throw"calculation method is undefined."}floor(){return new Complex([Math.floor(this._im),Math.floor(this._re)])}ceil(){return new Complex([Math.ceil(this._im),Math.ceil(this._re)])}round(){return new Complex([Math.round(this._im),Math.round(this._re)])}}Complex.I=new Complex([0,1]),Complex.ZERO=new Complex(0),Complex.HALF=new Complex(.5),Complex.ONE=new Complex(1),Complex.TWO=new Complex(2),Complex.TEN=new Complex(10);const ConstructorTool={match2:function(t,e){const n=[];let i=t,o=!0;for(let t=0;t<1e3;t++){if(null===(o=i.match(e))){i.length&&n.push([!1,i]);break}o.index>0&&n.push([!1,i.substr(0,o.index)]),n.push([!0,o[0]]),i=i.substr(o.index+o[0].length)}return n},trimBracket:function(t){return/^\[/.test(t)&&/\]$/.test(t)?t.substring(1,t.length-1):null},toMatrixFromStringForArrayJSON:function(t){const e=[];let n=t.match(/\[[^\]]+\]/g);null===n&&(n=[t]);for(let t=0;t<n.length;t++){const i=n[t],o=i.substring(1,i.length-1).split(","),r=[];for(let t=0;t<o.length;t++){const e=o[t];r[t]=new Complex(e)}e[t]=r}return e},InterpolationCalculation:function(t,e,n){const i=n.compareTo(t);if(0===i)return t;if(e.isZero())throw"IllegalArgumentException";if(e.isNegative()&&-1===i)throw"IllegalArgumentException";const o=[];let r=t;o[0]=r;for(let t=1;t<65536&&(r=r.add(e)).compareTo(n)!==i;t++)o[t]=r;return o},toArrayFromString:function(t){if(":"===t.trim())return":";const e=new RegExp("("+/[+-]? *([0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?)?[ij]( *[+] *[- ]([0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?)?)?/.source+")|("+/[+-]? *[0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?( *[+-] *[- ]([0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?)?[ij])?/.source+")","i"),n=ConstructorTool.match2(t,e),i=[];for(let t=0;t<n.length;t++){const e=n[t];if(e[0])if(t<n.length-2&&!n[t+1][0]&&/:/.test(n[t+1][1])){let o,r,s;t<n.length-4&&!n[t+3][0]&&/:/.test(n[t+3][1])?(o=new Complex(e[1]),r=new Complex(n[t+2][1]),s=new Complex(n[t+4][1]),t+=4):(o=new Complex(e[1]),r=Complex.ONE,s=new Complex(n[t+2][1]),t+=2);const h=ConstructorTool.InterpolationCalculation(o,r,s);for(let t=0;t<h.length;t++)i.push(h[t])}else i.push(new Complex(e[1]))}return i},toMatrixFromStringForArrayETC:function(t){const e=[],n=t.split(";");for(let t=0;t<n.length;t++)e[t]=ConstructorTool.toArrayFromString(n[t]);return e},toMatrixFromStringForArray:function(t){return/[[\],]/.test(t)?ConstructorTool.toMatrixFromStringForArrayJSON(t):ConstructorTool.toMatrixFromStringForArrayETC(t)},toMatrixFromString:function(t){const e=t.replace(/^\s*|\s*$/g,""),n=ConstructorTool.trimBracket(e);return n?ConstructorTool.toMatrixFromStringForArray(n):[[new Complex(t)]]},isCorrectMatrixArray:function(t){if(0===t.length)return!1;const e=t[0].length;if(0===e)return!1;for(let n=1;n<t.length;n++)if(t[n].length!==e)return!1;return!0}};class Matrix{constructor(t){let e=null,n=!1;if(1!==arguments.length)throw"Many arguments : "+arguments.length;{const i=t;if(i instanceof Matrix){e=[];for(let t=0;t<i.row_length;t++){e[t]=[];for(let n=0;n<i.column_length;n++)e[t][n]=i.matrix_array[t][n]}}else if(i instanceof Complex)e=[[i]];else if(i instanceof Array){e=[];for(let t=0;t<i.length;t++){const n=i[t];if(n instanceof Array){const i=[];for(let t=0;t<n.length;t++){const e=n[t];if(e instanceof Complex)i[t]=e;else if(e instanceof Matrix){if(!e.isScalar())throw"Matrix in matrix";i[t]=e.scalar}else i[t]=new Complex(e)}e[t]=i}else if(0===t&&(e[0]=[]),n instanceof Complex)e[0][t]=n;else if(n instanceof Matrix){if(!n.isScalar())throw"Matrix in matrix";e[0][t]=n.scalar}else e[0][t]=new Complex(n)}}else"string"==typeof i||i instanceof String?(n=!0,e=ConstructorTool.toMatrixFromString(i)):i instanceof Object&&i.toString?(n=!0,e=ConstructorTool.toMatrixFromString(i.toString())):e=[[new Complex(i)]]}if(n)for(let t=0;t<e.length;t++)":"===e[t]&&e.splice(t--,1);if(!ConstructorTool.isCorrectMatrixArray(e))throw"new Matrix IllegalArgumentException";this.matrix_array=e,this.row_length=this.matrix_array.length,this.column_length=this.matrix_array[0].length,this.string_cash=null}clone(){return new Matrix(this.matrix_array)}toString(){if(this.string_cash)return this.string_cash;const t=Math.pow(10,9);let e=!1,n=!1,i=0;this._each(function(o){o.isReal()||(e=!0),Math.abs(o.real)>=t&&(n=!0),Math.abs(o.imag)>=t&&(n=!0),i=Math.max(i,o.getDecimalPosition())}),i>0&&(i=4);let o=0;const r=[],s=function(t){if(!n)return t.toFixed(i);const e=t.toExponential(4).split("e");let o=e[1];return 2===o.length?o=o.substr(0,1)+"00"+o.substr(1):3===o.length&&(o=o.substr(0,1)+"0"+o.substr(1)),e[0]+"e"+o};this._each(function(t){const n={};let i=t.real;if(n.re_sign=i<0?"-":" ",i=Math.abs(i),n.re_str=s(i),o=Math.max(o,n.re_str.length+1),e){let e=t.imag;n.im_sign=e<0?"-":"+",e=Math.abs(e),n.im_str=s(e),o=Math.max(o,n.im_str.length+1)}r.push(n)});const h=function(t,e){return"                                        ".substr(0,e-t.length)+t},l=[],a=this;return this._each(function(t,n,i){const s=r.shift();let u=h(s.re_sign+s.re_str,o);e&&(u+=" "+s.im_sign+h(s.im_str,o)+"i"),l.push(u),l.push(i<a.column_length-1?" ":"\n")}),this.string_cash=l.join(""),this.string_cash}equals(t,e){const n=this,i=Matrix.createConstMatrix(t);if(n.row_length!==i.row_length||n.column_length!==i.column_length)return!1;if(1===n.row_length||1===n.column_length)return n.scalar.equals(i.scalar);const o=n.matrix_array,r=i.matrix_array;for(let t=0;t<this.row_length;t++)for(let n=0;n<this.column_length;n++)if(!o[t][n].equals(r[t][n],e))return!1;return!0}static createConstMatrix(t){return 1===arguments.length&&t instanceof Matrix?t:new Matrix(t)}_clearCash(){this.string_cash&&delete this.string_cash}_each(t){let e=!1;for(let n=0;n<this.row_length;n++)for(let i=0;i<this.column_length;i++){const o=t(this.matrix_array[n][i],n,i);void 0!==o&&(this.matrix_array[n][i]=o instanceof Complex?o:o instanceof Matrix?o.scalar:new Complex(o),e=!0)}return e&&this._clearCash(),this}_delete_row(t){if(1===this.row_length||this.row_length<=t)throw"_delete_row";return this.matrix_array.splice(t,1),this.row_length--,this._clearCash(),this}_delete_column(t){if(1===this.column_length||this.column_length<=t)throw"_delete_column";for(let e=0;e<this.row_length;e++)this.matrix_array[e].splice(t,1);return this.column_length--,this._clearCash(),this}_exchange_row(t,e){if(1===this.row_length||this.row_length<=t||this.row_length<=e)throw"_exchange_row";if(t===e)return this;const n=this.matrix_array[t];return this.matrix_array[t]=this.matrix_array[e],this.matrix_array[e]=n,this._clearCash(),this}_exchange_column(t,e){if(1===this.column_length||this.column_length<=t||this.column_length<=e)throw"_exchange_column";if(t===e)return this;for(let n=0;n<this.row_length;n++){const i=this.matrix_array[n][t];this.matrix_array[n][t]=this.matrix_array[n][e],this.matrix_array[n][e]=i}return this._clearCash(),this}static createMatrixDoEachCalculation(t,e,n){if(0===arguments.length||arguments.length>3)throw"IllegalArgumentException";const i=[],o=e,r=n||e;for(let e=0;e<o;e++){i[e]=[];for(let n=0;n<r;n++){const o=t(e,n);void 0!==o&&(i[e][n]=o instanceof Complex?o:o instanceof Matrix?o.scalar:new Complex(o))}}return new Matrix(i)}cloneMatrixDoEachCalculation(t){return this.clone()._each(t)}get scalar(){return this.matrix_array[0][0]}get length(){return this.row_length>this.column_length?this.row_length:this.column_length}get norm1(){const t=this.matrix_array;if(this.isRow()){let e=0;for(let n=0;n<this.column_length;n++)e+=t[0][n].norm;return e}if(this.isColumn()){let e=0;for(let n=0;n<this.row_length;n++)e=t[n][0].norm;return e}let e=0;for(let n=0;n<this.column_length;n++){let i=0;for(let e=0;e<this.row_length;e++)i+=t[e][n].norm;e<i&&(e=i)}return e}get norm2(){const t=this.matrix_array;if(this.isRow()){let e=0;for(let n=0;n<this.column_length;n++)e+=t[0][n].square().real;return Math.sqrt(e)}if(this.isColumn()){let e=0;for(let n=0;n<this.row_length;n++)e=t[n][0].square().real;return Math.sqrt(e)}throw"norm2"}get(t,e){let n=null,i=null;n="string"==typeof t||t instanceof String?new Matrix(t):t,2===arguments.length&&(i="string"==typeof e||e instanceof String?new Matrix(e):e);const o=function(e){let n,i=!1;return"number"==typeof t||t instanceof Number?(n=Math.round(e),i=!0):t instanceof Complex?(n=Math.round(e.real),i=!0):t instanceof Matrix&&t.isScalar()&&(n=Math.round(e.scalar.real),i=!0),{number:n,is_scalar:i}};let r=!0,s=null,h=null;return 1===arguments.length?r&=(s=o(n)).is_scalar:2===arguments.length&&(r&=(s=o(n)).is_scalar,r&=(h=o(i)).is_scalar),r?this.isRow()?this.matrix_array[0][s.number]:this.isColumn()?this.matrix_array[s.number][0]:this.matrix_array[s.number][h.number]:null}static eye(t,e){return Matrix.createMatrixDoEachCalculation(function(t,e){return t===e?Complex.ONE:Complex.ZERO},t,e)}static memset(t,e,n){if(0===arguments.length||arguments.length>3)throw"IllegalArgumentException";if(t instanceof Matrix&&!t.isScalar()){const i=t.matrix_array,o=t.row_length,r=t.column_length;return Matrix.createMatrixDoEachCalculation(function(t,e){return i[t%o][e%r]},e,n)}{let i=0;return i=t instanceof Matrix&&t.isScalar()?t.scalar:Complex.createConstComplex(t),Matrix.createMatrixDoEachCalculation(function(){return i},e,n)}}static zeros(t,e){if(0===arguments.length||arguments.length>2)throw"IllegalArgumentException";return Matrix.memset(Complex.ZERO,t,e)}static ones(t,e){if(0===arguments.length||arguments.length>2)throw"IllegalArgumentException";return Matrix.memset(Complex.ONE,t,e)}static rand(t,e){return Matrix.createMatrixDoEachCalculation(function(){return Complex.rand()},t,e)}static randn(t,e){return Matrix.createMatrixDoEachCalculation(function(){return Complex.randn()},t,e)}isScalar(){return 1===this.row_length&&1==this.column_length}isRow(){return 1===this.row_length}isColumn(){return 1===this.column_length}isVector(){return 1===this.row_length||1===this.column_length}isMatrix(){return 1!==this.row_length&&1!==this.column_length}isSquare(){return this.row_length===this.column_length}isReal(t){let e=!0;return this._each(function(n){e&&n.isComplex(t)&&(e=!1)}),e}isComplex(t){let e=!0;return this._each(function(n){e&&n.isReal(t)&&(e=!1)}),e}isZero(t){let e=!0;const n=t||1e-10;return this._each(function(t){e&&!t.isZero(n)&&(e=!1)}),e}isIdentity(t){if(!this.isDiagonal())return!1;const e=t||1e-10;for(let t=0;t<this.row_length;t++)if(!this.matrix_array[t][t].isOne(e))return!1;return!0}isDiagonal(t){if(!this.isSquare())return!1;let e=!0;const n=t||1e-10;return this._each(function(t,i,o){e&&i!==o&&!t.isZero(n)&&(e=!1)}),e}isTridiagonal(t){if(!this.isSquare())return!1;let e=!0;const n=t||1e-10;return this._each(function(t,i,o){e&&Math.abs(i-o)>1&&!t.isZero(n)&&(e=!1)}),e}isRegular(t){if(!this.isSquare())return!1;const e=t||1e-10;return this.rank(1e-10).equals(this.row_length,e)}isOrthogonal(t){if(!this.isSquare())return!1;const e=t||1e-10;return this.mul(this.transpose()).isIdentity(e)}isUnitary(t){if(!this.isSquare())return!1;const e=t||1e-10;return this.mul(this.ctranspose()).isIdentity(e)}isSymmetric(t){if(!this.isSquare())return!1;const e=t||1e-10;for(let t=0;t<this.row_length;t++)for(let n=t+1;n<this.column_length;n++)if(!this.matrix_array[t][n].equals(this.matrix_array[n][t],e))return!1;return!0}isHermitian(t){if(!this.isSquare())return!1;const e=t||1e-10;for(let t=0;t<this.row_length;t++)for(let n=t;n<this.column_length;n++)if(t===n){if(!this.matrix_array[t][n].isReal(e))return!1}else if(!this.matrix_array[t][n].equals(this.matrix_array[n][t].conj(),e))return!1;return!0}size(){return new Matrix([[this.row_length,this.column_length]])}max(t){if(this.isRow()){let e=this.matrix_array[0][0];for(let n=1;n<this.column_length;n++)e.compareTo(this.matrix_array[0][n],t)>0&&(e=this.matrix_array[0][n]);return new Matrix(e)}{const e=[];e[0]=[];for(let n=0;n<this.column_length;n++){e[0][n]=this.matrix_array[0][n];for(let i=1;i<this.row_length;i++)e[0][n].compareTo(this.matrix_array[i][n],t)>0&&(e[0][n]=this.matrix_array[i][n])}return new Matrix(e)}}min(t){if(this.isRow()){let e=this.matrix_array[0][0];for(let n=1;n<this.column_length;n++)e.compareTo(this.matrix_array[0][n],t)<0&&(e=this.matrix_array[0][n]);return new Matrix(e)}{const e=[];e[0]=[];for(let n=0;n<this.column_length;n++){e[0][n]=this.matrix_array[0][n];for(let i=1;i<this.row_length;i++)e[0][n].compareTo(this.matrix_array[i][n],t)<0&&(e[0][n]=this.matrix_array[i][n])}return new Matrix(e)}}add(t){const e=this,n=Matrix.createConstMatrix(t);if(!(e.row_length%n.row_length!=0&&n.row_length%e.row_length!=0||e.column_length%n.column_length!=0&&n.column_length%e.column_length!=0))throw"Matrix size does not match";const i=e.matrix_array,o=n.matrix_array,r=Math.max(e.row_length,n.row_length),s=Math.max(e.column_length,n.column_length);return Matrix.createMatrixDoEachCalculation(function(t,r){return i[t%e.row_length][r%e.column_length].add(o[t%n.row_length][r%n.column_length])},r,s)}sub(t){const e=this,n=Matrix.createConstMatrix(t);if(!(e.row_length%n.row_length!=0&&n.row_length%e.row_length!=0||e.column_length%n.column_length!=0&&n.column_length%e.column_length!=0))throw"Matrix size does not match";const i=e.matrix_array,o=n.matrix_array,r=Math.max(e.row_length,n.row_length),s=Math.max(e.column_length,n.column_length);return Matrix.createMatrixDoEachCalculation(function(t,r){return i[t%e.row_length][r%e.column_length].sub(o[t%n.row_length][r%n.column_length])},r,s)}mul(t){const e=this,n=Matrix.createConstMatrix(t),i=e.matrix_array,o=n.matrix_array;if(e.isScalar()&&n.isScalar())return new Matrix(i.scalar.mul(o.scalar));const r=[];if(e.isScalar()){for(let t=0;t<n.row_length;t++){r[t]=[];for(let i=0;i<n.column_length;i++)r[t][i]=e.scalar.mul(o[t][i])}return new Matrix(r)}if(n.isScalar()){for(let t=0;t<e.row_length;t++){r[t]=[];for(let o=0;o<e.column_length;o++)r[t][o]=i[t][o].mul(n.scalar)}return new Matrix(r)}if(e.row_length!==n.column_length||n.row_length!==e.column_length)throw"Matrix size does not match";for(let t=0;t<e.row_length;t++){r[t]=[];for(let n=0;n<e.column_length;n++){let s=Complex.ZERO;for(let r=0;r<e.row_length;r++)s=s.add(i[t][r].mul(o[r][n]));r[t][n]=s}}return new Matrix(r)}inv(){if(this.isScalar())return new Matrix(Complex.ONE.div(this.scalar));if(!this.isSquare())throw"not square";if(this.isDiagonal()){const t=new Matrix(this);for(let e=0;e<t.row_length;e++)t.matrix_array[e][e]=t.matrix_array[e][e].inv();return t}const t=this.column_length,e=[],n=2*t;for(let n=0;n<t;n++){e[n]=[];for(let i=0;i<t;i++)e[n][i]=this.matrix_array[n][i],e[n][t+i]=n===i?Complex.ONE:Complex.ZERO}for(let i=0;i<t;i++){{let n=Complex.ZERO,o=i;for(let r=i,s=i;r<t;r++){const t=e[r][s].abs();n.compareTo(t)>0&&(n=t,o=r)}if(o!==i){const t=e[i];e[i]=e[o],e[o]=t}}{const t=e[i][i].inv();for(let o=i,r=i;r<n;r++)e[o][r]=e[o][r].mul(t)}for(let o=0;o<t;o++)if(o!==i){const t=e[o][i];for(let r=i;r<n;r++)e[o][r]=e[o][r].sub(e[i][r].mul(t))}}const i=[];for(let n=0;n<t;n++){i[n]=[];for(let o=0;o<t;o++)i[n][o]=e[n][t+o]}return new Matrix(i)}div(t){const e=this,n=Matrix.createConstMatrix(t),i=e.matrix_array,o=n.matrix_array;if(e.isScalar()&&n.isScalar())return new Matrix(i.scalar.div(o.scalar));const r=[];if(n.isScalar()){for(let t=0;t<e.row_length;t++){r[t]=[];for(let o=0;o<e.column_length;o++)r[t][o]=i[t][o].div(n.scalar)}return new Matrix(r)}if(n.row_length===n.column_length)return this.mul(n.inv());if(e.column_length!==n.column_length)throw"Matrix size does not match";throw"Unimplemented"}nmul(t){const e=this,n=Matrix.createConstMatrix(t);if(!(e.row_length%n.row_length!=0&&n.row_length%e.row_length!=0||e.column_length%n.column_length!=0&&n.column_length%e.column_length!=0))throw"Matrix size does not match";const i=e.matrix_array,o=n.matrix_array,r=Math.max(e.row_length,n.row_length),s=Math.max(e.column_length,n.column_length);return Matrix.createMatrixDoEachCalculation(function(t,r){return i[t%e.row_length][r%e.column_length].mul(o[t%n.row_length][r%n.column_length])},r,s)}ndiv(t){const e=this,n=Matrix.createConstMatrix(t);if(!(e.row_length%n.row_length!=0&&n.row_length%e.row_length!=0||e.column_length%n.column_length!=0&&n.column_length%e.column_length!=0))throw"Matrix size does not match";const i=e.matrix_array,o=n.matrix_array,r=Math.max(e.row_length,n.row_length),s=Math.max(e.column_length,n.column_length);return Matrix.createMatrixDoEachCalculation(function(t,r){return i[t%e.row_length][r%e.column_length].div(o[t%n.row_length][r%n.column_length])},r,s)}real(){return this.cloneMatrixDoEachCalculation(function(t){return new Complex(t.real)})}imag(){return this.cloneMatrixDoEachCalculation(function(t){return new Complex(t.imag)})}angle(){return this.cloneMatrixDoEachCalculation(function(t){return new Complex(t.angle)})}sign(){return this.cloneMatrixDoEachCalculation(function(t){return new Complex(t.sign())})}testInteger(t){return this.cloneMatrixDoEachCalculation(function(e){return e.isInteger(t)?Complex.ONE:Complex.ZERO})}testComplexInteger(t){return this.cloneMatrixDoEachCalculation(function(e){return e.isComplexInteger(t)?Complex.ONE:Complex.ZERO})}testZero(t){return this.cloneMatrixDoEachCalculation(function(e){return e.isZero(t)?Complex.ONE:Complex.ZERO})}testOne(t){return this.cloneMatrixDoEachCalculation(function(e){return e.isOne(t)?Complex.ONE:Complex.ZERO})}testComplex(t){return this.cloneMatrixDoEachCalculation(function(e){return e.isComplex(t)?Complex.ONE:Complex.ZERO})}testReal(t){return this.cloneMatrixDoEachCalculation(function(e){return e.isReal(t)?Complex.ONE:Complex.ZERO})}testNaN(){return this.cloneMatrixDoEachCalculation(function(t){return t.isNaN()?Complex.ONE:Complex.ZERO})}testPositive(){return this.cloneMatrixDoEachCalculation(function(t){return t.isPositive()?Complex.ONE:Complex.ZERO})}testNegative(){return this.cloneMatrixDoEachCalculation(function(t){return t.isNegative()?Complex.ONE:Complex.ZERO})}testNotNegative(){return this.cloneMatrixDoEachCalculation(function(t){return t.isNotNegative()?Complex.ONE:Complex.ZERO})}testInfinite(){return this.cloneMatrixDoEachCalculation(function(t){return t.isInfinite()?Complex.ONE:Complex.ZERO})}testFinite(){return this.cloneMatrixDoEachCalculation(function(t){return t.isFinite()?Complex.ONE:Complex.ZERO})}abs(){return this.cloneMatrixDoEachCalculation(function(t){return t.abs()})}conj(){return this.cloneMatrixDoEachCalculation(function(t){return t.conj()})}negate(){return this.cloneMatrixDoEachCalculation(function(t){return t.negate()})}sqrt(){return this.cloneMatrixDoEachCalculation(function(t){return t.sqrt()})}pow(t){const e=Matrix.createConstMatrix(t);if(!e.isScalar())throw"not set Scalar";return this.cloneMatrixDoEachCalculation(function(t){return t.pow(e.scalar)})}log(){return this.cloneMatrixDoEachCalculation(function(t){return t.log()})}exp(){return this.cloneMatrixDoEachCalculation(function(t){return t.exp()})}sin(){return this.cloneMatrixDoEachCalculation(function(t){return t.sin()})}cos(){return this.cloneMatrixDoEachCalculation(function(t){return t.cos()})}tan(){return this.cloneMatrixDoEachCalculation(function(t){return t.tan()})}atan(){return this.cloneMatrixDoEachCalculation(function(t){return t.atan()})}atan2(t){const e=Matrix.createConstMatrix(t);if(!e.isScalar)throw"not set Scalar";return this.cloneMatrixDoEachCalculation(function(t){return t.atan2(e.scalar)})}floor(){return this.cloneMatrixDoEachCalculation(function(t){return t.floor()})}ceil(){return this.cloneMatrixDoEachCalculation(function(t){return t.ceil()})}round(){return this.cloneMatrixDoEachCalculation(function(t){return t.round()})}norm(t){if(0===arguments.length)return this.norm2;if(1===t)return this.norm1;if(2===t)return this.norm2;if(t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY){const e=this.matrix_array;let n=t===Number.POSITIVE_INFINITY?0:Number.POSITIVE_INFINITY;for(let i=0;i<this.row_length;i++){let o=0;for(let t=0;t<this.column_length;t++)o+=e[i][t].norm;n=t===Number.POSITIVE_INFINITY?Math.max(n,o):Math.min(n,o)}return n}if(this.isVector()){let e=0;for(let n=0;n<this.length;n++)e=Math.pow(this.get(n).norm,t);return Math.pow(e,1/t)}throw"norm"}dot(t,e){const n=this,i=Matrix.createConstMatrix(t),o=n.matrix_array,r=i.matrix_array,s=e||1;if(n.isScalar()&&i.isScalar())return new Matrix(o.scalar.mul(r.scalar));if(n.isVector()&&i.isVector()){let t=Complex.ZERO;for(let e=0;e<n.length;e++)t=t.add(o.get(e).mul(r.get(e)));return new Matrix(t)}if(n.row_length!==i.row_length||n.column_length!==i.column_length)throw"Matrix size does not match";if(1===s){const t=[];t[0]=[];for(let e=0;e<n.column_length;e++){let i=Complex.ZERO;for(let t=0;t<n.row_length;t++)i=i.add(o[t][e].mul(r[t][e]));t[0][e]=i}return new Matrix(t)}if(2===s){const t=[];for(let e=0;e<n.row_length;e++){let i=Complex.ZERO;for(let t=0;t<n.column_length;t++)i=i.add(o[e][t].mul(r[e][t]));t[e]=[i]}return new Matrix(t)}throw"dim"}rank(t){const e=t||1e-10;if(this.isScalar())return this.scalar.norm<=e?0:1;let n=0;const i=new Matrix(this),o=i.matrix_array;for(;;){if(i.isRow()||i.isColumn())return n+=i.max().max().scalar.norm<=e?0:1;let t=0,r=0;for(let e=0;e<i.row_length;e++){const n=o[e][0].norm;n>r&&(r=n,t=e)}if(r>e){n++,i._exchange_row(0,t);for(let t=1;t<i.row_length;t++){const e=o[t][0].div(r);for(let n=1;n<i.column_length;n++)o[t][n]=o[t][n].sub(o[0][n].mul(e))}i._delete_row(0)}i._delete_column(0)}}transpose(){const t=[];for(let e=0;e<this.column_length;e++){t[e]=[];for(let n=0;n<this.row_length;n++)t[e][n]=this.matrix_array[n][e]}return new Matrix(t)}ctranspose(){return this.transpose().conj()}T(){return this.ctranspose()}det(){if(!this.isSquare())throw"not square";const t=this.matrix_array,e=function(t){if(2===t.length)return t[0][0].mul(t[1][1]).sub(t[0][1].mul(t[1][0]));let n=Complex.ZERO;for(let i=0;i<t.length;i++){const o=[],r=t[i][0];for(let e=0,n=0;e<t.length;e++)if(i!==e){o[n]=[];for(let i=1,r=0;i<t.length;i++,r++)o[n][r]=t[e][i];n++}n=i%2==0?n.add(r.mul(e(o))):n.sub(r.mul(e(o)))}return n};return new Matrix(e(t))}linsolve(t){if(!this.isSquare())throw"Matrix size does not match";const e=this.column_length,n=Matrix.createConstMatrix(t),i=this.matrix_array,o=n.matrix_array;if(n.row_length!==this.row_length||n.column_length>1)throw"Matrix size does not match";const r=[],s=e+1;for(let t=0;t<e;t++){r[t]=[];for(let n=0;n<e;n++)r[t][n]=i[t][n];r[t][s-1]=o[t][0]}for(let t=0;t<e-1;t++){{let n=Complex.ZERO,i=t;for(let o=t,s=t;o<e;o++){const t=r[o][s].abs();n.compareTo(t)>0&&(n=t,i=o)}if(i!==t){const e=r[t];r[t]=r[i],r[i]=e}}{const e=r[t][t].inv();for(let n=t,i=t;i<s;i++)r[n][i]=r[n][i].mul(e)}for(let n=t+1;n<e;n++){const e=r[n][t];for(let i=t;i<s;i++)r[n][i]=r[n][i].sub(r[t][i].mul(e))}}const h=[];h[e-1]=r[e-1][e].div(r[e-1][e-1]);for(let t=e-2;t>=0;t--){h[t]=r[t][s-1];for(let n=t+1;n<e;n++)h[t]=h[t].sub(r[t][n]*h[n]);h[t]=h[t].div(r[t][t])}const l=[];for(let t=0;t<this.row_length;t++)l[t]=[h[t]];return new Matrix(l)}qr(){return this.isSquare()?function(t){const e=t.column_length,n=t.matrix_array,i=Matrix.zeros(e),o=Matrix.zeros(e),r=i.matrix_array,s=o.matrix_array,h=[];for(let t=0;t<e;t++){for(let i=0;i<e;i++)h[i]=n[i][t];if(t>0){for(let i=0;i<t;i++)for(let o=0;o<e;o++)s[i][t]=s[i][t].add(r[o][i].mul(n[o][t]));for(let n=0;n<t;n++)for(let i=0;i<e;i++)h[i]=h[i].sub(s[n][t].mul(r[i][n]))}for(let n=0;n<e;n++)s[t][t]=s[t][t].add(h[n].mul(h[n]));s[t][t]=s[t][t].sqrt();for(let n=0;n<e;n++)r[n][t]=h[n].div(s[t][t])}return{Q:new Matrix(r),R:new Matrix(s)}}(this):null}static createGivensRotation(t,e,n,i){const o=Matrix.eye(t);return o.matrix_array[e][e]=new Complex(Math.cos(i)),o.matrix_array[e][n]=new Complex(Math.sin(i)),o.matrix_array[n][e]=new Complex(-Math.sin(i)),o.matrix_array[n][n]=o.matrix_array[e][e],o}eigForJacobiMethod(){if(this.isScalar())return new Matrix(this.scalar);if(!this.isSquare())throw"not square matrix";if(!this.isSymmetric())throw"not Symmetric";if(this.isComplex())throw"not Real Matrix";const t=this.row_length;let e=Matrix.eye(t);const n=new Matrix(this);let i=n.matrix_array;for(let n=0;n<150;n++){let n=0,o=1,r=i[n][o].norm;for(let e=0;e<t;e++)for(let s=e+1;s<t;s++){const t=i[e][s].norm;r<t&&(r=t,n=e,o=s)}if(r<1e-14)break;const s=i[n][n].add(i[o][o]),h=i[n][n].sub(i[o][o]),l=s.mul(Complex.HALF),a=h.mul(Complex.HALF);let u,c;h.isZero()?(u=new Complex(Math.PI/4),c=new Complex(Math.PI/2)):c=(u=Complex.HALF.mul(Complex.TWO.negate().mul(i[n][o]).div(h).atan())).mul(Complex.TWO);const g=u.cos(),f=u.sin(),m=c.cos(),d=c.sin(),p=[];for(let e=0;e<t;e++){p[e]=[];for(let r=0;r<t;r++){let t;t=e===n&&r===n?l.add(a.mul(m)).sub(i[n][o].mul(d)):e===o&&r===o?l.sub(a.mul(m)).add(i[n][o].mul(d)):e===n&&r===o||e===o&&r===n?Complex.ZERO:e===n?i[n][r].mul(g).sub(i[o][r].mul(f)):r===n?i[n][e].mul(g).sub(i[o][e].mul(f)):e===o?i[n][r].mul(f).add(i[o][r].mul(g)):r===o?i[n][e].mul(f).add(i[o][e].mul(g)):i[e][r],p[e][r]=t}}i=p,e=e.mul(Matrix.createGivensRotation(t,n,o,u))}return n.matrix_array=i,{V:e,D:n}}eig(t){if(this.isScalar())return new Matrix(this.scalar);if(!this.isSquare())throw"not square matrix";let e;if(!this.isSymmetric()||!this.isReal())throw"Unimplemented";if(e=this.eigForJacobiMethod(),!t)return e;if(t.is_sort){const t=function(t,e){const n=e.row_length,i=[];for(let t=0;t<n;t++)i[t]={sigma:e.matrix_array[t][t],index:t};const o=function(t,e){return t.sigma.compareTo(e.sigma)};i.sort(o);const r=Matrix.zeros(n),s=Matrix.zeros(n);for(let t=0;t<n;t++)s.matrix_array[t][t]=i[t].sigma,r.matrix_array[i[t].index][t]=Complex.ONE;return{V:t.mul(r),D:s}};return t(e.V,e.D)}}svd(){if(!this.isSquare())throw"Unimplemented";if(this.isComplex())throw"Unimplemented";const t=this.rank(1e-10).scalar.norm;if(t!==this.column_length)throw"Unimplemented";const e=this.T().mul(this).eig({is_sort:!0}),n=Matrix.zeros(this.row_length,this.column_length);return n._each(function(n,i,o){if(i===o&&i<t)return e.D.get(i,i).sqrt()}),{U:this.mul(e.V).mul(n.inv()).qr().Q,S:n,V:e.V.T()}}}const SMath={Complex:Complex,Matrix:Matrix},MathX={BigDecimal:BigDecimal,BigInteger:BigInteger,Random:Random,SMath:SMath};class IDSwitch{constructor(){this._initIDSwitch()}_initIDSwitch(){this.istyped=!1,this.ispressed=!1,this.isreleased=!1,this.pressed_time=0}clone(){const t=new IDSwitch;return t.istyped=this.istyped,t.ispressed=this.ispressed,t.isreleased=this.isreleased,t.pressed_time=this.pressed_time,t}keyPressed(){this.ispressed||(this.istyped=!0),this.ispressed=!0,this.pressed_time++}keyReleased(){this.ispressed=!1,this.isreleased=!0,this.pressed_time=0}focusLost(){this.keyReleased()}pickInput(t){if(!(t instanceof IDSwitch))throw"IllegalArgumentException";t.ispressed=this.ispressed,t.istyped=this.istyped,t.isreleased=this.isreleased,t.pressed_time=this.pressed_time,this.isreleased=!1,this.istyped=!1}}class IDPosition{constructor(t,e){this._initIDPosition(t,e)}_initIDPosition(t,e){if(t instanceof IDPosition){const e=t;this.set(e)}else void 0===t?(this.x=0,this.y=0):2===arguments.length?this.set(t,e):(this.x=0,this.y=0)}clone(){return new IDPosition(this)}set(t,e){if(t instanceof IDPosition){const e=t;this.x=e.x,this.y=e.y}else this.x=t,this.y=e}add(t,e){if(t instanceof IDPosition){const e=t;this.x+=e.x,this.y+=e.y}else this.x+=t,this.y+=e}sub(t,e){if(t instanceof IDPosition){const e=t;this.x-=e.x,this.y-=e.y}else this.x-=t,this.y-=e}static norm(t,e){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}}class IDDraggableSwitch{constructor(t){this._initIDDraggableSwitch(t)}_initIDDraggableSwitch(t){this.mask=t,this.switch=new IDSwitch,this.client=new IDPosition,this.deltaBase=new IDPosition,this.dragged=new IDPosition}clone(){const t=new IDDraggableSwitch;return t.mask=this.mask,t.switch=this.switch.clone(),t.client=this.client.clone(),t.deltaBase=this.deltaBase.clone(),t.dragged=this.dragged.clone(),t}correctionForDOM(t){let e=t.target;return e||(e=t.currentTarget),void 0===e?new IDPosition(t.clientX,t.clientY):new IDPosition(t.clientX/e.clientWidth*e.width,t.clientY/e.clientHeight*e.height)}setPosition(t){const e=this.correctionForDOM(t);this.client.set(e),this.deltaBase.set(e),this.dragged._initIDPosition()}mousePressed(t){const e=this.correctionForDOM(t);t.button===this.mask&&(this.switch.ispressed||this.dragged._initIDPosition(),this.switch.keyPressed(),this.client.set(e),this.deltaBase.set(e))}mouseReleased(t){t.button===this.mask&&this.switch.ispressed&&this.switch.keyReleased()}mouseMoved(t){const e=this.correctionForDOM(t);if(this.switch.ispressed){const t=new IDPosition(e);t.sub(this.deltaBase),this.dragged.add(t)}this.client.set(e.x,e.y),this.deltaBase.set(e.x,e.y)}focusLost(){this.switch.focusLost()}pickInput(t){if(!(t instanceof IDDraggableSwitch))throw"IllegalArgumentException";this.switch.pickInput(t.switch),t.client.set(this.client),t.dragged.set(this.dragged),this.dragged._initIDPosition()}}class IDMouse{constructor(){this._initIDMouse()}_initIDMouse(){this.left=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON1_MASK),this.center=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON2_MASK),this.right=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON3_MASK),this.position=new IDPosition,this.wheelrotation=0}clone(){const t=new IDMouse;return t.left=this.left.clone(),t.center=this.center.clone(),t.right=this.right.clone(),t.position=this.position.clone(),t.wheelrotation=this.wheelrotation,t}mousePressed(t){this.left.mousePressed(t),this.center.mousePressed(t),this.right.mousePressed(t)}mouseReleased(t){this.left.mouseReleased(t),this.center.mouseReleased(t),this.right.mouseReleased(t)}mouseMoved(t){this.left.mouseMoved(t),this.center.mouseMoved(t),this.right.mouseMoved(t),this.position.x=this.left.client.x,this.position.y=this.left.client.y}mouseWheelMoved(t){0!==t.wheelDelta&&(this.wheelrotation+=t.deltaY>0?-1:1)}focusLost(){this.left.focusLost(),this.center.focusLost(),this.right.focusLost()}pickInput(t){if(!(t instanceof IDMouse))throw"IllegalArgumentException";this.left.pickInput(t.left),this.center.pickInput(t.center),this.right.pickInput(t.right),t.position.set(this.position),t.wheelrotation=this.wheelrotation,this.wheelrotation=0}setListenerOnElement(t){const e=this,n=function(t){e.mousePressed(t)},i=function(t){e.mouseReleased(t)},o=function(t){e.mouseMoved(t)},r=function(){e.focusLost()},s=function(t){e.mouseWheelMoved(t),t.preventDefault()},h=function(t){t.preventDefault()};t.style.cursor="crosshair",t.style.mozUserSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.webkitTouchCallout="none",t.style.webkitTapHighlightColor="rgba(0,0,0,0)",t.addEventListener("mousedown",n,!1),t.addEventListener("mouseup",i,!1),t.addEventListener("mousemove",o,!1),t.addEventListener("mouseout",r,!1),t.addEventListener("wheel",s,!1),t.addEventListener("contextmenu",h,!1)}}IDMouse.MOUSE_EVENTS={BUTTON1_MASK:0,BUTTON2_MASK:1,BUTTON3_MASK:2};class IDTouch extends IDMouse{constructor(){super(),this._initIDTouch()}_initIDTouch(){this.touchcount_to_mask={1:IDMouse.MOUSE_EVENTS.BUTTON1_MASK,2:IDMouse.MOUSE_EVENTS.BUTTON3_MASK,3:IDMouse.MOUSE_EVENTS.BUTTON2_MASK};const t=this;this._mousePressed=function(e){t.mousePressed(e)},this._mouseReleased=function(e){t.mouseReleased(e)},this._mouseMoved=function(e){t.mouseMoved(e)},this.isdoubletouch=!1}_initPosition(t){this.left.setPosition(t),this.right.setPosition(t),this.center.setPosition(t)}_MultiTouchToMouse(t){let e=0,n=0;for(let i=0;i<t.touches.length;i++)e+=t.touches[i].clientX,n+=t.touches[i].clientY;const i={};if(t.touches.length>0){i.clientX=e/t.touches.length,i.clientY=n/t.touches.length,i.button=this.touchcount_to_mask[t.touches.length];const o=t.touches[0];i.target=o.target?o.target:o.currentTarget}else i.clientX=0,i.clientY=0,i.button=0;return i.touchcount=t.touches.length,i}_MoveMultiTouch(t){if(2===t.touches.length){const e=t.touches[0],n=t.touches[1];if(!1===this.isdoubletouch)this.isdoubletouch=!0,this.doubleposition=[],this.doubleposition[0]=new IDPosition(e.clientX,e.clientY),this.doubleposition[1]=new IDPosition(n.clientX,n.clientY);else{const t=new IDPosition(e.clientX,e.clientY),i=new IDPosition(n.clientX,n.clientY),o=IDPosition.norm(this.doubleposition[0],this.doubleposition[1])-IDPosition.norm(t,i);this.doubleposition[0]=t,this.doubleposition[1]=i;const r=Math.abs(o)<10?.01*Math.abs(o):.5;this.wheelrotation+=(o>0?-1:1)*r}}else this.isdoubletouch}_actFuncMask(t,e,n,i){for(const o in IDMouse.MOUSE_EVENTS)t.button=IDMouse.MOUSE_EVENTS[o],IDMouse.MOUSE_EVENTS[o]===i?e(t):n(t)}touchStart(t){const e=this._MultiTouchToMouse(t);this._initPosition(e),this._actFuncMask(e,this._mousePressed,this._mouseReleased,e.button)}touchEnd(t){const e=this._MultiTouchToMouse(t);this._actFuncMask(e,this._mouseReleased,this._mouseReleased,e.button)}touchMove(t){this._MoveMultiTouch(t);const e=this._MultiTouchToMouse(t);this._actFuncMask(e,this._mouseMoved,this._mouseMoved,e.button)}setListenerOnElement(t){super.setListenerOnElement(t);const e=this,n=function(t){e.touchStart(t)},i=function(t){e.touchEnd(t)},o=function(t){e.touchMove(t),t.preventDefault()};t.addEventListener("touchstart",n,!1),t.addEventListener("touchend",i,!1),t.addEventListener("touchmove",o,!1),t.addEventListener("touchcancel",i,!1)}}const IDTools={noScroll:function(){const t=function(){document.body.style.height="100%",document.body.style.overflow="hidden",document.documentElement.height="100%",document.documentElement.overflow="hidden"};window.addEventListener("load",t,!1)}},Device={DraggableSwitch:IDDraggableSwitch,Mouse:IDMouse,Position:IDPosition,Switch:IDSwitch,Touch:IDTouch,Tools:IDTools},BlendFunctions={ipLerp:function(t,e,n){const i=e.subColor(t);return t.addColor(i.mul(n))},brendNone:function(t,e,n){return e},brendAlpha:function(t,e,n){const i=t.getBlendAlpha(),o=e.getBlendAlpha()*n;return(t=BlendFunctions.ipLerp(t,e,o)).setBlendAlpha(Math.max(i,o))},brendAdd:function(t,e,n){const i=t.getBlendAlpha(),o=e.getBlendAlpha()*n;return(t=t.addColor(e.mul(o))).setBlendAlpha(Math.max(i,o))},brendSub:function(t,e,n){const i=t.getBlendAlpha(),o=e.getBlendAlpha()*n;return(t=t.subColor(e.mul(o))).setBlendAlpha(i)},brendRevSub:function(t,e,n){const i=e.getBlendAlpha(),o=t.getBlendAlpha()*n;return(e=e.subColor(t.mul(o))).setBlendAlpha(i)},brendMul:function(t,e,n){const i=t.getBlendAlpha(),o=e.getBlendAlpha()*n;return(t=t.mulColor(e.mul(o).div(255))).setBlendAlpha(i)}};class ImgBlend{constructor(t){this.blendfunc=BlendFunctions.brendNone,1===arguments.length&&this.setBlendMode(t)}clone(){return new ImgBlend(this.blendmode)}setBlendMode(t){this.blendmode=t,t===ImgBlend.MODE.NONE?this.blendfunc=BlendFunctions.brendNone:t===ImgBlend.MODE.ALPHA?this.blendfunc=BlendFunctions.brendAlpha:t===ImgBlend.MODE.ADD?this.blendfunc=BlendFunctions.brendAdd:t===ImgBlend.MODE.SUB?this.blendfunc=BlendFunctions.brendSub:t===ImgBlend.MODE.REVSUB?this.blendfunc=BlendFunctions.brendRevSub:t===ImgBlend.MODE.MUL&&(this.blendfunc=BlendFunctions.brendMul)}blend(t,e,n){return this.blendfunc(t,e,n)}}ImgBlend.MODE={NONE:"NONE",ALPHA:"ALPHA",ADD:"ADD",SUB:"SUB",REVSUB:"REVSUB",MUL:"MUL"};class ImgColor{constructor(){}getColor(){return null}clone(){return null}zero(){return null}one(){return null}add(){return null}sub(){return null}mul(){return null}div(){return null}exp(){return null}log(){return null}pow(){return null}baselog(){return null}table(){return null}random(){return null}luminance(){return null}addColor(){return null}subColor(){return null}mulColor(){return null}divColor(){return null}maxColor(){return null}minColor(){return null}norm(){return null}normFast(){return null}normColor(t,e){return this.subColor(t).norm(e)}normColorFast(t,e){return this.subColor(t).normFast(e)}getBlendAlpha(){return null}setBlendAlpha(){return null}exchangeColorAlpha(){return null}equals(){return!1}searchColor(t,e){let n=0,i=2147483647,o=null,r=2147483646,s=null;for(let h=0;h<t.length;h++)(n=this.normColorFast(t[h],e))<r&&(n<i?(r=i,s=o,i=n,o=t[h]):(r=n,s=t[h]));return{c1:{color:o,norm:i},c2:{color:s,norm:r}}}}ImgColor.NORM_MODE={MANHATTEN:0,EUGRID:1};class ImgWrapInside{constructor(t,e){2===arguments.length?this.setSize(t,e):this.setSize(0,0)}clone(){return new ImgWrapInside(this.width,this.height)}setSize(t,e){this.width=t,this.height=e}getPixelPosition(t,e){return t=~~Math.floor(t),e=~~Math.floor(e),t>=0&&e>=0&&t<this.width&&e<this.height?[t,e]:null}}class ImgWrapClamp extends ImgWrapInside{constructor(t,e){super(t,e)}clone(){return new ImgWrapClamp(this.width,this.height)}getPixelPosition(t,e){return t=~~Math.floor(t),e=~~Math.floor(e),t>=0&&e>=0&&t<this.width&&e<this.height?[t,e]:(t=~~Math.floor(Math.min(Math.max(0,t),this.width-1)),e=~~Math.floor(Math.min(Math.max(0,e),this.height-1)),[t,e])}}class ImgWrapRepeat extends ImgWrapInside{constructor(t,e){super(t,e)}clone(){return new ImgWrapRepeat(this.width,this.height)}getPixelPosition(t,e){if(t=~~Math.floor(t),e=~~Math.floor(e),t>=0&&e>=0&&t<this.width&&e<this.height)return[t,e];const n=Math.floor(t/this.width),i=Math.floor(e/this.height);return t-=Math.floor(this.width*n),e-=Math.floor(this.height*i),t<0&&(t+=this.width),e<0&&(e+=this.height),[t,e]}}class ImgWrap{constructor(t,e,n){this.width=1,this.height=1,arguments.length>=2&&(this.width=e,this.height=n),3==arguments.length?this.setImgWrapMode(t):this.setImgWrapMode(ImgWrap.MODE.INSIDE)}clone(){return new ImgWrap(this.wrapmode,this.width,this.height)}setImgWrapMode(t){this.wrapmode=t,t===ImgWrap.MODE.INSIDE?this.wrap=new ImgWrapInside(this.width,this.height):t===ImgWrap.MODE.CLAMP?this.wrap=new ImgWrapClamp(this.width,this.height):t===ImgWrap.MODE.REPEAT&&(this.wrap=new ImgWrapRepeat(this.width,this.height))}setSize(t,e){this.width=t,this.height=e,this.wrap&&this.wrap.setSize(t,e)}getPixelPosition(t,e){return this.wrap.getPixelPosition(t,e)}}ImgWrap.MODE={INSIDE:"INSIDE",CLAMP:"CLAMP",REPEAT:"REPEAT"};const InterpolationFunctions={ipLerp:function(t,e,n){const i=e.subColor(t);return t.addColor(i.mul(n))},ipCosine:function(t,e,n){return InterpolationFunctions.ipLerp(t,e,.5*(1-Math.cos(Math.PI*n)))},ipHermite2p3:function(t,e,n){return InterpolationFunctions.ipLerp(t,e,n*n*(3-2*n))},ipHermite2p5:function(t,e,n){return InterpolationFunctions.ipLerp(t,e,n*n*n*(6*n*n-15*n+10))},ipHermite4p:function(t,e,n,i,o){const r=i.subColor(n).subColor(t.subColor(e)),s=t.subColor(e).subColor(r),h=n.subColor(t),l=e;return r.mul(o*o*o).addColor(s.mul(o*o)).addColor(h.mul(o)).addColor(l)},funcInBicubic:function(t,e){return t<=1?1-(e+3)*t*t+(e+2)*t*t*t:-4*e+8*e*t-5*e*t*t+e*t*t*t},ipBicubic:function(t,e,n,i,o,r){const s=InterpolationFunctions.funcInBicubic(o+1,r),h=InterpolationFunctions.funcInBicubic(o,r),l=InterpolationFunctions.funcInBicubic(1-o,r),a=InterpolationFunctions.funcInBicubic(2-o,r);return t.mul(s).addColor(e.mul(h)).addColor(n.mul(l)).addColor(i.mul(a)).mul(1/(s+h+l+a))},ipBicubicSoft:function(t,e,n,i,o){return InterpolationFunctions.ipBicubic(t,e,n,i,o,-.5)},ipBicubicNormal:function(t,e,n,i,o){return InterpolationFunctions.ipBicubic(t,e,n,i,o,-1)},ipBicubicSharp:function(t,e,n,i,o){return InterpolationFunctions.ipBicubic(t,e,n,i,o,-1.2)},ipBicubic2D:function(t,e,n,i){let o,r,s,h,l=t[0][0].zero(),a=0;for(r=0;r<4;r++)for(s=InterpolationFunctions.funcInBicubic(Math.abs(-n+r-1),i),o=0;o<4;o++)h=InterpolationFunctions.funcInBicubic(Math.abs(-e+o-1),i),a+=h*=s,l=l.addColor(t[r][o].mul(h));return l=l.mul(1/a)},ipBicubic2DSoft:function(t,e,n){return InterpolationFunctions.ipBicubic2D(t,e,n,-.5)},ipBicubic2DNormal:function(t,e,n){return InterpolationFunctions.ipBicubic2D(t,e,n,-1)},ipBicubic2DSharp:function(t,e,n){return InterpolationFunctions.ipBicubic2D(t,e,n,-1.2)}};class ImgInterpolation{constructor(t){0===arguments.length&&(t=ImgInterpolation.MODE.NEAREST_NEIGHBOR),this.setInterpolationMode(t)}clone(){return new ImgInterpolation(this.ipmode)}setInterpolationMode(t){this.ipmode=t,t===ImgInterpolation.MODE.NEAREST_NEIGHBOR?(this.ipfunc=InterpolationFunctions.ipLerp,this.ipn=1):t===ImgInterpolation.MODE.BILINEAR?(this.ipfunc=InterpolationFunctions.ipLerp,this.ipn=2):t===ImgInterpolation.MODE.COSINE?(this.ipfunc=InterpolationFunctions.ipCosine,this.ipn=2):t===ImgInterpolation.MODE.HERMITE4_3?(this.ipfunc=InterpolationFunctions.ipHermite2p3,this.ipn=2):t===ImgInterpolation.MODE.HERMITE4_5?(this.ipfunc=InterpolationFunctions.ipHermite2p5,this.ipn=2):t===ImgInterpolation.MODE.HERMITE16?(this.ipfunc=InterpolationFunctions.ipHermite4p,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC?(this.ipfunc=InterpolationFunctions.ipBicubic2DNormal,this.ipn=16):t===ImgInterpolation.MODE.BICUBIC_SOFT?(this.ipfunc=InterpolationFunctions.ipBicubicSoft,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC_NORMAL?(this.ipfunc=InterpolationFunctions.ipBicubicNormal,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC_SHARP&&(this.ipfunc=InterpolationFunctions.ipBicubicSharp,this.ipn=4)}getColor(t,e,n){const i=Math.floor(e),o=Math.floor(n);if(1===this.ipn||i===e&&o===n)return t.getPixel(i,o);if(2===this.ipn){const r=e-i,s=n-o;let h,l;h=t.getPixel(i,o),l=t.getPixel(i+1,o);const a=this.ipfunc(h,l,r);h=t.getPixel(i,o+1),l=t.getPixel(i+1,o+1);const u=this.ipfunc(h,l,r);return this.ipfunc(a,u,s)}if(4===this.ipn){const r=e-i,s=n-o;let h,l,a,u;h=t.getPixel(i-1,o-1),l=t.getPixel(i,o-1),a=t.getPixel(i+1,o-1),u=t.getPixel(i+2,o-1);const c=this.ipfunc(h,l,a,u,r);h=t.getPixel(i-1,o),l=t.getPixel(i,o),a=t.getPixel(i+1,o),u=t.getPixel(i+2,o);const g=this.ipfunc(h,l,a,u,r);h=t.getPixel(i-1,o+1),l=t.getPixel(i,o+1),a=t.getPixel(i+1,o+1),u=t.getPixel(i+2,o+1);const f=this.ipfunc(h,l,a,u,r);h=t.getPixel(i-1,o+2),l=t.getPixel(i,o+2),a=t.getPixel(i+1,o+2),u=t.getPixel(i+2,o+2);const m=this.ipfunc(h,l,a,u,r);return this.ipfunc(c,g,f,m,s)}if(16===this.ipn){const r=e-i,s=n-o;let h,l;const a=[];for(l=-1;l<3;l++){const e=[];for(h=-1;h<3;h++)e[e.length]=t.getPixel(i+h,o+l);a[a.length]=e}return this.ipfunc(a,r,s)}return null}}ImgInterpolation.MODE={NEAREST_NEIGHBOR:"NEAREST_NEIGHBOR",BILINEAR:"BILINEAR",COSINE:"COSINE",HERMITE4_3:"HERMITE4_3",HERMITE4_5:"HERMITE4_5",HERMITE16:"HERMITE16",BICUBIC:"BICUBIC",BICUBIC_SOFT:"BICUBIC_SOFT",BICUBIC_NORMAL:"BICUBIC_NORMAL",BICUBIC_SHARP:"BICUBIC_SHARP"};class ImgFIRMatrix{constructor(t){this.height=t.length,this.width=t[0].length,this.matrix=[];let e;for(e=0;e<t.length;e++)this.matrix[e]=t[e].slice()}clone(){return new ImgFIRMatrix(this.matrix)}rotateEdge(t){const e=this.clone(),n=[],i=[];let o,r;for(o=0;o<this.width-1;o++)n.push(e.matrix[0][o]);for(o=0;o<this.height-1;o++)n.push(e.matrix[o][this.width-1]);for(o=this.width-1;o>0;o--)n.push(e.matrix[this.height-1][o]);for(o=this.height-1;o>0;o--)n.push(e.matrix[o][0]);for(o=0;o<n.length;o++)i[o]=n[((o+t)%n.length+n.length)%n.length];for(e.matrix[0]=i.slice(0,this.width),o=0;o<this.height;o++)e.matrix[o][this.width-1]=i[this.width+o];for(e.matrix[this.height-1]=i.slice(this.width+this.height-2,this.width+this.height-2+this.width).reverse(),o=this.height-1,r=0;o>0;o--,r++)e.matrix[o][0]=i[this.width+this.height+this.width-3+r];return e}mul(t){const e=this.clone();let n,i;for(i=0;i<e.height;i++)for(n=0;n<e.width;n++)e.matrix[i][n]*=t;return e}sum(){let t,e,n=0;for(e=0;e<this.height;e++)for(t=0;t<this.width;t++)n+=this.matrix[e][t];return n}normalize(){return this.clone().mul(1/this.sum())}addCenter(t){const e=this.clone();return e.matrix[e.height>>1][e.width>>1]+=t,e}static makeLaplacianFilter(){return new ImgFIRMatrix([[0,-1,0],[-1,4,-1],[0,-1,0]])}static makeSharpenFilter(t){return ImgFIRMatrix.makeLaplacianFilter().mul(t).addCenter(1)}static makeBlur(t,e){const n=[],i=1/(t*e);let o,r;for(r=0;r<e;r++)for(n[r]=[],o=0;o<t;o++)n[r][o]=i;return new ImgFIRMatrix(n)}static makeGaussianFilter(t,e,n){void 0===n&&(n=1);const i=[];let o,r,s;const h=[],l=Math.max(t,e);let a=-Math.floor(l/2);for(o=0;o<l;o++,a++)h[o]=Math.exp(-a*a/(n*n*2));for(s=0;s<e;s++)for(i[s]=[],r=0;r<t;r++)i[s][r]=h[r]*h[s];return new ImgFIRMatrix(i).normalize()}static makeCircle(t){const e=[],n=.5*t,i=t>>1;let o,r;for(r=0;r<t;r++)for(e[r]=[],o=0;o<t;o++)Math.sqrt((i-o)*(i-o)+(i-r)*(i-r))<n?e[r][o]=1:e[r][o]=0;return new ImgFIRMatrix(e).normalize()}}class ImgData{constructor(){if(this.width=1,this.height=1,this.globalAlpha=1,this.data=null,this.blend=new ImgBlend(ImgBlend.MODE.NONE),this.wrap=new ImgWrap(ImgWrap.MODE.INSIDE,this.width,this.height),this.ip=new ImgInterpolation(ImgInterpolation.MODE.NEAREST_NEIGHBOR),1===arguments.length){const t=arguments[0];this.putImageData(t)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.setSize(t,e)}}putImageData(t){}setSize(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.wrap.setSize(t,e))}_copyData(t){t.blend=this.blend.clone(),t.wrap=this.wrap.clone(),t.ip=this.ip.clone(),t.setSize(this.width,this.height),t.data.set(this.data),t.globalAlpha=this.globalAlpha}clone(){const t=new ImgData;return this._copyData(t),t}setWrapMode(t){this.wrap.setImgWrapMode(t)}getWrapMode(){return this.wrap.wrapmode}setInterpolationMode(t){this.ip.setInterpolationMode(t)}getInterpolationMode(){return this.ip.ipmode}setBlendType(t){this.blend.setBlendMode(t)}getBlendType(){return this.blend.blendmode}clear(){this.data&&this.data.fill(0)}getPixelInside(t,e){return null}setPixelInside(t,e,n){}getPixel(t,e){const n=this.wrap.getPixelPosition(t,e);return n?this.getPixelInside(n[0],n[1]):this.getPixelInside(0,0).zero()}setPixel(t,e,n){const i=this.wrap.getPixelPosition(t,e);if(i)if(this._blendtype===ImgData.MODE_BLEND.NONE)this.setPixelInside(i[0],i[1],n);else{const t=this.getPixelInside(i[0],i[1]),e=this.blend.blend(t,n,this.globalAlpha);this.setPixelInside(i[0],i[1],e)}}getColor(t,e){return this.ip.getColor(this,t,e)}getColorUV(t,e){return this.getColor(t*this.width,e*this.height)}setColor(t,e,n){this.setPixel(Math.floor(t),Math.floor(e),n)}drawImgData(t,e,n,i,o,r,s,h,l){if(!(t instanceof ImgData))throw"IllegalArgumentException";if(3===arguments.length)r=e,s=n,h=t.width,l=t.height,e=0,n=0,i=t.width,o=t.height;else if(5===arguments.length)r=e,s=n,h=i,l=o,e=0,n=0,i=t.width,o=t.height;else if(9!==arguments.length)throw"IllegalArgumentException";const a=i/h,u=o/l;let c,g,f,m;for(g=n,m=s;m<s+l;m++){for(c=e,f=r;f<r+h;f++){const e=t.getColor(c,g);e&&this.setColor(f,m,e),c+=a}g+=u}}forEach(t){let e=0,n=0;for(;n<this.height;n++)for(e=0;e<this.width;e++)t(this.getPixelInside(e,n),e,n,this)}convolution(t){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";let e,n,i,o,r,s;const h=-(t.width>>1),l=-(t.height>>1),a=t.matrix,u=this.getPixelInside(0,0).zero(),c=this.clone();for(n=0;n<this.height;n++)for(e=0;e<this.width;e++){let g=u;for(o=n+l,s=0;s<t.height;s++,o++)for(i=e+h,r=0;r<t.width;r++,i++){const t=c.getPixel(i,o);t&&(g=g.addColor(t.mul(a[s][r])))}this.setPixelInside(e,n,g)}}convolutionBilateral(t,e){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";void 0===e&&(e=.8);let n,i,o,r,s,h;const l=-(t.width>>1),a=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),g=this.clone(),f=.01*-(1-e)-.001,m=[];for(n=0;n<768;n++)m[n]=Math.exp(n*n*f);for(i=0;i<this.height;i++)for(n=0;n<this.width;n++){const e=g.getPixel(n,i),f=e.getBlendAlpha();let d=0,p=c;const _=[];for(r=i+a,h=0;h<t.height;h++,r++)for(o=n+l,_[h]=[],s=0;s<t.width;s++,o++){const t=g.getPixel(o,r);if(t){const n=m[Math.floor(t.normColor(e,ImgColor.NORM_MODE.EUGRID))]*u[h][s];p=p.addColor(t.mul(n)),d+=n}}p=p.div(d).setBlendAlpha(f),this.setPixelInside(n,i,p)}}convolutionExp(t,e){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";void 0===e&&(e=1.2);let n,i,o,r,s,h;const l=-(t.width>>1),a=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),g=this.clone(),f=[];for(n=0;n<256;n++)f[n]=Math.pow(e,n);for(i=0;i<this.height;i++)for(n=0;n<this.width;n++){let m=c;for(r=i+a,h=0;h<t.height;h++,r++)for(o=n+l,s=0;s<t.width;s++,o++){const t=g.getPixel(o,r);t&&(m=m.addColor(t.table(f).mul(u[h][s])))}this.setPixelInside(n,i,m.baselog(e))}}convolutionUnSharp(t,e){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";let n,i,o,r,s,h;const l=-(t.width>>1),a=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),g=this.clone();for(i=0;i<this.height;i++)for(n=0;n<this.width;n++){let f=c;for(r=i+a,h=0;h<t.height;h++,r++)for(o=n+l,s=0;s<t.width;s++,o++){const t=g.getPixel(o,r);t&&(f=f.addColor(t.mul(u[h][s])))}const m=g.getPixel(n,i),d=m.subColor(f).mul(e);this.setPixelInside(n,i,m.addColor(d))}}filterSharp(t){const e=ImgFIRMatrix.makeSharpenFilter(t);this.convolution(e)}filterBlur(t){let e;e=ImgFIRMatrix.makeBlur(t,1),this.convolution(e),e=ImgFIRMatrix.makeBlur(1,t),this.convolution(e)}filterGaussian(t){let e;e=ImgFIRMatrix.makeGaussianFilter(t,1),this.convolution(e),e=ImgFIRMatrix.makeGaussianFilter(1,t),this.convolution(e)}filterUnSharp(t,e){const n=ImgFIRMatrix.makeGaussianFilter(t,t);this.convolutionUnSharp(n,e)}filterBilateral(t,e){const n=ImgFIRMatrix.makeGaussianFilter(t,t);this.convolutionBilateral(n,e)}filterSoftLens(t,e){const n=ImgFIRMatrix.makeCircle(t);this.convolutionExp(n,e)}}ImgData.MODE_WRAP=ImgWrap.MODE,ImgData.MODE_IP=ImgInterpolation.MODE,ImgData.MODE_BLEND=ImgBlend.MODE;class ImgColorRGBA extends ImgColor{constructor(t){super(),this.rgba=[t[0],t[1],t[2],t[3]]}get r(){return this.rgba[0]}get g(){return this.rgba[1]}get b(){return this.rgba[2]}get a(){return this.rgba[3]}getColor(){return this.rgba}clone(){return new ImgColorRGBA(this.rgba)}zero(){return new ImgColorRGBA([0,0,0,0])}one(){return new ImgColorRGBA([1,1,1,1])}add(t){return new ImgColorRGBA([this.r+t,this.g+t,this.b+t,this.a+t])}sub(t){return new ImgColorRGBA([this.r-t,this.g-t,this.b-t,this.a-t])}mul(t){return new ImgColorRGBA([this.r*t,this.g*t,this.b*t,this.a*t])}div(t){return new ImgColorRGBA([this.r/t,this.g/t,this.b/t,this.a/t])}exp(){return new ImgColorRGBA([Math.exp(this.r),Math.exp(this.g),Math.exp(this.b),Math.exp(this.a)])}log(){return new ImgColorRGBA([Math.log(this.r),Math.log(this.g),Math.log(this.b),Math.log(this.a)])}pow(t){return new ImgColorRGBA([Math.pow(t,this.r),Math.pow(t,this.g),Math.pow(t,this.b),Math.pow(t,this.a)])}baselog(t){const e=1/Math.log(t);return new ImgColorRGBA([Math.log(this.r)*e,Math.log(this.g)*e,Math.log(this.b)*e,Math.log(this.a)*e])}table(t){return new ImgColorRGBA([t[Math.round(this.r)],t[Math.round(this.g)],t[Math.round(this.b)],t[Math.round(this.a)]])}random(){return new ImgColorRGBA([Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())])}luminance(){return.2126*this.r+.7152*this.g+.0722*this.b}addColor(t){return new ImgColorRGBA([this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a])}subColor(t){return new ImgColorRGBA([this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a])}mulColor(t){return new ImgColorRGBA([this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a])}divColor(t){return new ImgColorRGBA([this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a])}maxColor(t){return new ImgColorRGBA([Math.max(t.r,this.r),Math.max(t.g,this.g),Math.max(t.b,this.b),Math.max(t.a,this.a)])}minColor(t){return new ImgColorRGBA([Math.min(t.r,this.r),Math.min(t.g,this.g),Math.min(t.b,this.b),Math.min(t.a,this.a)])}norm(t){return t===ImgColor.NORM_MODE.MANHATTEN?(Math.abs(this.r)+Math.abs(this.g)+Math.abs(this.b))/3:t===ImgColor.NORM_MODE.EUGRID?Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b)/3:void 0}normFast(t){return t===ImgColor.NORM_MODE.MANHATTEN?Math.abs(this.r)+Math.abs(this.g)+Math.abs(this.b):t===ImgColor.NORM_MODE.EUGRID?this.r*this.r+this.g*this.g+this.b*this.b:void 0}getBlendAlpha(){return this.a/255}setBlendAlpha(t){const e=this.clone();return e.rgba[3]=255*t,e}exchangeColorAlpha(t){return new ImgColorRGBA([this.r,this.g,this.b,t.a])}getRRGGBB(){return this.r<<16|this.g<<8|255&this.b}getRed(){return this.r}getGreen(){return this.g}getBlue(){return this.b}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}toString(){return"color("+this.r+","+this.g+","+this.b+","+this.a+")"}mulMatrix(t){const e=new ImgColorRGBA;return e.rgba[0]=this.r*t[0][0]+this.g*t[0][1]+this.b*t[0][2]+this.a*t[0][3],e.rgba[1]=this.r*t[1][0]+this.g*t[1][1]+this.b*t[1][2]+this.a*t[1][3],e.rgba[2]=this.r*t[2][0]+this.g*t[2][1]+this.b*t[2][2]+this.a*t[2][3],e.rgba[3]=this.r*t[3][0]+this.g*t[3][1]+this.b*t[3][2]+this.a*t[3][3],e}}class ImgColorY extends ImgColor{constructor(t){super(),this.y=t}getColor(){return this.y}clone(){return new ImgColorY(this.y)}zero(){return new ImgColorY(0)}one(){return new ImgColorY(1)}add(t){return new ImgColorY(this.y+t)}sub(t){return new ImgColorY(this.y-t)}mul(t){return new ImgColorY(this.y*t)}div(t){return new ImgColorY(this.y/t)}exp(){return new ImgColorY(Math.exp(this.y))}log(){return new ImgColorY(Math.log(this.y))}pow(t){return new ImgColorY(Math.pow(t,this.y))}baselog(t){return new ImgColorY(Math.log(this.y)/Math.log(t))}table(t){return new ImgColorY(t[Math.floor(this.y)])}random(){return new ImgColorY(256*Math.random())}luminance(){return this.y}addColor(t){return new ImgColorY(this.y+t.y)}subColor(t){return new ImgColorY(this.y-t.y)}mulColor(t){return new ImgColorY(this.y*t.y)}divColor(t){return new ImgColorY(this.y/t.y)}maxColor(t){return new ImgColorY(Math.max(t.y,this.y))}minColor(t){return new ImgColorY(Math.min(t.y,this.y))}norm(){return Math.abs(this.y)}normFast(){return Math.abs(this.y)}getBlendAlpha(){return 1}setBlendAlpha(){return this}exchangeColorAlpha(){return this}equals(t){return this.y===t.y}toString(){return"color("+this.y+")"}}class ImgVector{constructor(t,e,n){this.x=t,this.y=e,this.z=n}cross(t){return new ImgVector(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}getDirection(t){return new ImgVector(t.x-this.x,t.y-this.y,t.z-this.z)}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z;return t=Math.sqrt(1/t),new ImgVector(this.x*t,this.y*t,this.z*t)}getNormalMapColor(){return new ImgColorRGBA([Math.round(127.5*(1+this.x)),Math.round(127.5*(1-this.y)),Math.round(127.5*(1+this.z)),255])}static createNormalVector(t){if(!(t instanceof ImgColorRGBA))throw"not ImgColorRGBA";return new ImgVector(t.r/128-1,-t.g/128+1,t.b/128-1)}}class ImgDataY extends ImgData{constructor(){1===arguments.length?super(arguments[0]):2===arguments.length?super(arguments[0],arguments[1]):super()}clone(){const t=new ImgDataY(this.width,this.height);return this._copyData(t),t}setSize(t,e){super.setSize(t,e),this.data=new Float32Array(this.width*this.height)}getPixelInside(t,e){const n=e*this.width+t;return new ImgColorY(this.data[n])}setPixelInside(t,e,n){const i=e*this.width+t;this.data[i]=n.getColor()}putImageData(t,e){if(t instanceof ImageData||t instanceof ImgDataRGBA){this.setSize(t.width,t.height),void 0===e&&(e=0);let n=0;for(let i=0;i<this.data.length;i++)this.data[i]=t.data[n+e],n+=4}else{if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.setSize(t.width,t.height),this.data.set(t.data)}}putImageDataR(t){this.putImageData(t,0)}putImageDataG(t){this.putImageData(t,1)}putImageDataB(t){this.putImageData(t,2)}putImageDataA(t){this.putImageData(t,3)}getImageData(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height;const e=t.getContext("2d").getImageData(0,0,t.width,t.height);let n=0,i=0;for(;i<this.data.length;i++){const t=Math.floor(this.data[i]);e.data[n+0]=t,e.data[n+1]=t,e.data[n+2]=t,e.data[n+3]=255,n+=4}return e}getNormalMap(){if(this.getWrapMode()===ImgData.MODE_WRAP.INSIDE)throw"not inside";const t=new ImgDataRGBA(this.width,this.height);let e,n;for(n=0;n<this.height;n++)for(e=0;e<this.width;e++){const i=new ImgVector(e-1,n,this.getPixel(e-1,n).getColor()),o=new ImgVector(e+1,n,this.getPixel(e+1,n).getColor()),r=i.getDirection(o),s=new ImgVector(e,n-1,this.getPixel(e,n-1).getColor()),h=new ImgVector(e,n+1,this.getPixel(e,n+1).getColor()),l=s.getDirection(h),a=r.cross(l).normalize();t.setPixelInside(e,n,a.getNormalMapColor())}return t}filterEnvironmentMapping(t){}}class ImgDataRGBA extends ImgData{constructor(){1===arguments.length?super(arguments[0]):2===arguments.length?super(arguments[0],arguments[1]):super()}clone(){const t=new ImgDataRGBA(this.width,this.height);return this._copyData(t),t}setSize(t,e){super.setSize(t,e),this.data=new Uint8ClampedArray(this.width*this.height*4)}getPixelInside(t,e){const n=4*(e*this.width+t);return new ImgColorRGBA([this.data[n],this.data[n+1],this.data[n+2],this.data[n+3]])}setPixelInside(t,e,n){const i=4*(e*this.width+t);this.data[i]=n.getColor()[0],this.data[i+1]=n.getColor()[1],this.data[i+2]=n.getColor()[2],this.data[i+3]=n.getColor()[3]}putDataY(t,e){if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.setSize(t.width,t.height),void 0===e&&(e=0);let n=0,i=0;for(;i<t.data.length;i++)this.data[n+e]=Math.floor(t.data[i]),n+=4}putDataYToR(t){this.putDataS(t,0)}putDataYToG(t){this.putDataS(t,1)}putDataYToB(t){this.putDataS(t,2)}putDataYToA(t){this.putDataS(t,3)}putImageData(t){if(t instanceof ImageData||t instanceof ImgDataRGBA)this.setSize(t.width,t.height),this.data.set(t.data);else{if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.putImageData(t.getImageData())}}getImageData(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height;const e=t.getContext("2d").getImageData(0,0,t.width,t.height);return e.data.set(this.data),e}grayscale(){this.forEach(function(t,e,n,i){const o=~~t.luminance(),r=new ImgColorRGBA([o,o,o,t.rgba[3]]);i.setPixelInside(e,n,r)})}getColorCount(){const t=new Uint8ClampedArray(2097152);let e=0;return this.forEach(function(n){const i=n.getRRGGBB(),o=i>>3,r=i%7;0==(t[o]>>r&1)&&(e++,t[o]=255&(t[o]^1<<r))}),e}getPalletMedianCut(t){if(this.getColorCount()<=t)return null;let e,n,i,o;const r=new Uint32Array(2097152);let s=0;const h=function(t){return t.getRed()>>1<<14|t.getGreen()>>1<<7|t.getBlue()>>1},l=[],a=[[],[],[]],u=[[],[],[]];for(l[0]=this.width*this.height,e=0;e<3;e++)u[e][s]=0,a[e][s]=127;this.forEach(function(t){r[h(t)]++});let c,g,f,m,d,p,_;for(s++,_=1;s<t;){let t=0,h=0;for(e=0;e<_;e++){const n=(c=a[0][e]-u[0][e])*(g=a[1][e]-u[1][e])*(f=a[2][e]-u[2][e]);t<n&&(t=n,m=c,d=g,p=f,h=e)}let C=d,x=1;if(C<m&&(C=m,x=0),C<p&&(C=p,x=2),0===C)break;{const t=u[x][h]+(C>>1);for(t===a[x][h]?(u[x][_]=t,a[x][_]=a[x][h],a[x][h]=t-1):(u[x][_]=t+1,a[x][_]=a[x][h],a[x][h]=t),e=0;e<3;e++)e!==x&&(u[e][_]=u[e][h],a[e][_]=a[e][h])}for(l[_]=0,n=u[0][_];n<=a[0][_];n++)for(i=u[1][_];i<=a[1][_];i++)for(o=u[2][_];o<=a[2][_];o++)l[_]+=r[n<<14|i<<7|o];if(l[h]-=l[_],0===l[h])for(l[h]=l[_],e=0;e<3;e++)u[e][h]=u[e][_],a[e][h]=a[e][_];else 0===l[_]||(_++,s++)}const C=[];for(e=0;e<s;e++){let t=0,s=0,h=0;for(n=u[0][e];n<=a[0][e];n++)for(i=u[1][e];i<=a[1][e];i++)for(o=u[2][e];o<=a[2][e];o++){const e=r[n<<14|i<<7|o];t+=e*(n<<1),s+=e*(i<<1),h+=e*(o<<1)}n=Math.round(t/l[e]),i=Math.round(s/l[e]),o=Math.round(h/l[e]),n=n<0?0:n>255?255:n,i=i<0?0:i>255?255:i,o=o<0?0:o>255?255:o,C[e]=new ImgColorRGBA([n,i,o,255])}return C}getPallet(){const t=[],e=new Uint32Array(256);let n=0,i=0;return this.forEach(function(o){if(!(n>255)){const r=o.getRRGGBB();for(i=0;i<n;i++)if(e[i]===r)return;e[n]=r,t[n]=o,n++}}),t}getPalletGrayscale(t){const e=t<2?2:t>256?256:t,n=[],i=255/(e-1);let o,r=0;for(o=0;o<e;o++){let t=Math.round(r);t=t<0?0:t>255?255:t,n[o]=new ImgColorRGBA([t,t,t,255]),r+=i}return n}quantizationSimple(t){this.forEach(function(e,n,i,o){const r=e.searchColor(t,ImgColor.NORM_MODE.EUGRID);o.setPixelInside(n,i,r.c1.color.exchangeColorAlpha(e))})}quantizationOrdered(t,e,n){this.forEach(function(i,o,r,s){const h=i.searchColor(t,n),l=h.c1.color,a=h.c1.norm,u=h.c2.color,c=h.c2.norm;let g=a+c;g=0===g?1:g;const f=e.pattern[r%e.height][o%e.width];let m=null;m=l.luminance>u.luminance?f<=Math.floor(c*e.maxnumber/g)?l.exchangeColorAlpha(i):u.exchangeColorAlpha(i):f>=Math.floor(a*e.maxnumber/g)?l.exchangeColorAlpha(i):u.exchangeColorAlpha(i),s.setPixelInside(o,r,m)})}quantizationDiffusion(t,e){const n=this.width*this.height,i=new Int16Array(n),o=new Int16Array(n),r=new Int16Array(n);let s=0;this.forEach(function(t,e,n,h){s=n*h.width+e,i[s]=t.getRed(),o[s]=t.getGreen(),r[s]=t.getBlue()});const h=this.width-e.width+e.center;let l,a,u=0;for(a=0;a<e.height;a++)for(l=0;l<e.width;l++)u+=e.pattern[a][l];const c=[];for(a=0;a<e.height;a++)for(c[a]=[],l=0;l<e.width;l++)c[a][l]=e.pattern[a][l]/u;this.forEach(function(n,u,g,f){s=g*f.width+u;const m=new ImgColorRGBA([i[s],o[s],r[s],255]);let d=m.searchColor(t,ImgColor.NORM_MODE.EUGRID);if(d=d.c1.color,f.setPixelInside(u,g,d.exchangeColorAlpha(n)),!(u>h)){const t=m.subColor(d);for(a=0;a<e.height;a++)for(l=0===a?e.center:0;l<e.width;l++){const n=u+l-e.center,s=g+a;if(!(n<0||s>=f.height)){const e=s*f.width+n;i[e]+=t.getRed()*c[a][l],o[e]+=t.getGreen()*c[a][l],r[e]+=t.getBlue()*c[a][l]}}}})}filterQuantizationSimple(t){if(this.getColorCount()>t){const e=this.getPalletMedianCut(t);this.quantizationSimple(e)}}filterQuantizationOrdered(t,e){if(void 0===e&&(e=ImgColor.NORM_MODE.EUGRID),this.getColorCount()>t){const n=this.getPalletMedianCut(t);this.quantizationOrdered(n,ImgDataRGBA.quantization.orderPattern.patternBayer,e)}}filterQuantizationDiffusion(t,e){if(void 0===e&&(e=ImgDataRGBA.quantization.diffusionPattern.patternFloydSteinberg),this.getColorCount()>t){const n=this.getPalletMedianCut(t);this.quantizationDiffusion(n,e)}}}ImgDataRGBA.quantization={diffusionPattern:{patternFloydSteinberg:{width:3,height:2,center:1,pattern:[[0,0,7],[3,5,1]]},patternJarvisJudiceNinke:{width:5,height:3,center:2,pattern:[[0,0,0,7,5],[3,5,7,5,3],[1,3,5,3,1]]}},orderPattern:{patternBayer:{width:4,height:4,maxnumber:16,pattern:[[0,8,2,10],[12,4,14,6],[3,11,1,9],[15,7,13,5]]}}};const ImageProcessing={ImgDataRGBA:ImgDataRGBA,ImgColorRGBA:ImgColorRGBA,ImgDataY:ImgDataY,ImgColorY:ImgColorY,MODE_WRAP:ImgData.MODE_WRAP,MODE_IP:ImgData.MODE_IP,MODE_BLEND:ImgData.MODE_BLEND};class SBase{constructor(t,e){this.id="SComponent_"+(SBase._counter++).toString(16),this.wallid="SComponent_"+(SBase._counter++).toString(16),this.isshow=!1,this._element=null,this._wall=null,this.elementtype=t,this.unit=SBase.UNIT_TYPE.EM;const n=this,i={over:function(){SBase.node_tool.addClass(n.getElement(),SBase.CLASS_NAME.MOUSEOVER)},out:function(){SBase.node_tool.removeClass(n.getElement(),SBase.CLASS_NAME.MOUSEOVER),SBase.node_tool.removeClass(n.getElement(),SBase.CLASS_NAME.MOUSEDOWN)},down:function(){SBase.node_tool.addClass(n.getElement(),SBase.CLASS_NAME.MOUSEDOWN)},up:function(){SBase.node_tool.removeClass(n.getElement(),SBase.CLASS_NAME.MOUSEDOWN)}};this.tool={attachMouseEvent:function(t){t.addEventListener("touchstart",i.over,!1),t.addEventListener("touchend",i.up,!1),t.addEventListener("mouseover",i.over,!1),t.addEventListener("mouseout",i.out,!1),t.addEventListener("mousedown",i.down,!1),t.addEventListener("mouseup",i.up,!1)},removeNodeForId:function(t){const e=document.getElementById(t);return SBase.node_tool.removeNode(e),e},AputB:function(t,e,n){if(!(t&&e&&e instanceof SBase))throw"IllegalArgumentException";if(t===e)throw"it referenced me";if(n!==SBase.PUT_TYPE.IN&&n!==SBase.PUT_TYPE.RIGHT&&n!==SBase.PUT_TYPE.NEWLINE)throw"IllegalArgumentException";let i=null;if("string"==typeof t||t instanceof String)i=document.getElementById(t);else if(t instanceof SBase)if(n===SBase.PUT_TYPE.IN){if(!t.isContainer())throw"not Container";i=t.getContainerElement()}else i=t.getElement();if(null===i)throw"Not Found "+t;const o=function(t,e){e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)};if(e.removeMe(),n===SBase.PUT_TYPE.IN)e.onAdded(),null!==i.lastChild&&(e.getWall(SBase.PUT_TYPE.NEWLINE).style.display="block",i.appendChild(e.getWall())),e.getElement().style.display="inline-block",i.appendChild(e.getElement());else{if(null===i.parentNode)throw"not found element on the html";e.onAdded(),o(e.getWall(n),i),o(e.getElement(),e.getWall(n)),n===SBase.PUT_TYPE.RIGHT?(i.style.display="inline-block",e.getWall(n).style.display="inline-block",e.getElement().style.display="inline-block"):n===SBase.PUT_TYPE.NEWLINE&&(i.style.display="inline-block",e.getWall(n).style.display="block",e.getElement().style.display="inline-block")}}},this.setText(e)}getWidth(){let t=this.getElement().style.width;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getHeight(){let t=this.getElement().style.height;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getSize(){return{width:this.getWidth(),height:this.getHeight()}}setWidth(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.getElement().style.width=t.toString()+this.unit}setHeight(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.getElement().style.height=t.toString()+this.unit}setSize(t,e){this.setWidth(t),this.setHeight(e)}removeMe(){this.tool.removeNodeForId(this.id),this.tool.removeNodeForId(this.space_id)}onAdded(){}getWall(t){if(this._wall)return this._wall;const e=document.createElement("span");return e.id=this.wallid,t===SBase.PUT_TYPE.RIGHT?e.className=SBase.CLASS_NAME.SPACE:t===SBase.PUT_TYPE.NEWLINE&&(e.className=SBase.CLASS_NAME.NEWLINE),e.style.display="inline-block",this._wall=e,e}isContainer(){return null!==this.getContainerElement()}getContainerElement(){return null}getElement(){if(this._element)return this._element;const t=document.createElement(this.elementtype);return t.id=this.id,t.className=SBase.CLASS_NAME.COMPONENT,t.style.display="inline-block",this._element=t,this.tool.attachMouseEvent(t),t}put(t,e){this.tool.AputB(this,t,e)}putMe(t,e){this.tool.AputB(t,this,e)}isVisible(){return null===this.getElement().style.visibility||"hidden"!==this.getElement().style.visibility}setVisible(t){t?(this.getElement().style.visibility="visible",this.getWall().style.visibility="visible"):(this.getElement().style.visibility="hidden",this.getWall().style.visibility="hidden")}getTextNode(){const t=this.getElement().childNodes;let e=null,n=0;for(n=0;n<t.length;n++)if(t[n]instanceof Text){e=t[n];break}return e}getElementNode(){const t=this.getElement().children;let e=null,n=0;for(n=0;n<t.length;n++)if(!(t[n]instanceof Text)){e=t[n];break}return e}getEditableNodeForValue(){return null}getEditableNodeForNodeValue(){if(this.getEditableNodeForValue())return null;let t=this.getTextNode();if(null===t){const e=this.getElement();t=document.createTextNode(""),e.appendChild(t)}return t}setText(t){if(t){let e=null;return(e=this.getEditableNodeForValue())?void(e.value=t):(e=this.getEditableNodeForNodeValue(),e?void(e.nodeValue=t):void 0)}}getText(){let t=null,e=null;return(e=this.getEditableNodeForValue())&&(t=e.value),(e=this.getEditableNodeForNodeValue())&&(t=e.nodeValue.trim()),null===t?"":t}getEnabledElement(){return null}setEnabled(t){t?SBase.node_tool.removeClass(this.getElement(),SBase.CLASS_NAME.DISABLED):SBase.node_tool.addClass(this.getElement(),SBase.CLASS_NAME.DISABLED);const e=this.getEnabledElement();null!==e&&SBase.node_tool.setBooleanAttribute(e,"disabled",t)}isEnabled(){return!SBase.node_tool.isSetClass(this.getElement(),SBase.CLASS_NAME.DISABLED)}getId(){return this.id}getUnit(){return this.unit}setUnit(t){this.unit=t}addClass(t){return SBase.node_tool.addClass(this.getElement(),t)}toString(){return this._elementtype+"("+this.id+")"}}SBase.PUT_TYPE={IN:0,RIGHT:1,NEWLINE:2},SBase.UNIT_TYPE={PX:"px",EM:"em",PERCENT:"%"},SBase.LABEL_POSITION={LEFT:0,RIGHT:1},SBase.CLASS_NAME={MOUSEOVER:"SCOMPONENT_MouseOver",MOUSEDOWN:"SCOMPONENT_MouseDown",DISABLED:"SCOMPONENT_Disabled",COMPONENT:"SCOMPONENT_Component",NEWLINE:"SCOMPONENT_Newline",CLOSE:"SCOMPONENT_Close",OPEN:"SCOMPONENT_Open",SPACE:"SCOMPONENT_Space",CONTENTSBOX:"SCOMPONENT_ContentsBox",PANEL:"SCOMPONENT_Panel",PANEL_LEGEND:"SCOMPONENT_PanelLegend",SLIDEPANEL:"SCOMPONENT_SlidePanel",SLIDEPANEL_LEGEND:"SCOMPONENT_SlidePanelLegend",SLIDEPANEL_SLIDE:"SCOMPONENT_SlidePanelSlide",GROUPBOX:"SCOMPONENT_GroupBox",GROUPBOX_LEGEND:"SCOMPONENT_GroupBoxLegend",IMAGEPANEL:"SCOMPONENT_ImagePanel",LABEL:"SCOMPONENT_Label",SELECT:"SCOMPONENT_Select",COMBOBOX:"SCOMPONENT_ComboBox",CHECKBOX:"SCOMPONENT_CheckBox",CHECKBOX_IMAGE:"SCOMPONENT_CheckBoxImage",BUTTON:"SCOMPONENT_Button",FILELOAD:"SCOMPONENT_FileLoad",FILESAVE:"SCOMPONENT_FileSave",CANVAS:"SCOMPONENT_Canvas",PROGRESSBAR:"SCOMPONENT_ProgressBar",SLIDER:"SCOMPONENT_Slider",COLORPICKER:"SCOMPONENT_ColorPicker"},SBase._counter=0,SBase.node_tool={setBooleanAttribute:function(t,e,n){if("string"!=typeof e&&!(e instanceof String)||"boolean"!=typeof n)throw"IllegalArgumentException";const i=t.getAttribute(e);n||null!==i?n&&null!==i&&t.removeAttribute(e):t.setAttribute(e,e)},isBooleanAttribute:function(t,e){if("string"!=typeof e&&!(e instanceof String))throw"IllegalArgumentException";return null===t.getAttribute(e)},removeNode:function(t){return t&&t.parentNode&&t.parentNode.removeChild(t),t},removeChildNodes:function(t){let e=t.lastChild;for(;e;)t.removeChild(e),e=t.lastChild},isSetClass:function(t,e){const n=t.className;return null!==n&&new RegExp("(^"+e+"$)|( +"+e+")","g").test(n)},addClass:function(t,e){const n=t.className;if(null===n)return void(t.className=e);new RegExp("(^"+e+"$)|( +"+e+")","g").test(n)||(t.className=n+" "+e)},removeClass:function(t,e){const n=t.className;if(null!==n){const i=new RegExp("(^"+e+"$)|( +"+e+")","g");i.test(n)&&(t.className=n.replace(i,""))}}};class SButton extends SBase{constructor(t){super("input",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.getElement().type="button"}getEditableNodeForValue(){return this.getElement()}getEnabledElement(){return this.getElement()}addListener(t){this.getElement().addEventListener("click",t,!1)}}class SCanvas extends SBase{constructor(){super("canvas"),this.addClass(SBase.CLASS_NAME.CANVAS),this.canvas=super.getElement(),this.glmode=!1,this.setPixelSize(300,150)}getPixelSize(){return{width:this.canvas.width,height:this.canvas.height}}getCanvas(){return this.canvas}setPixelSize(t,e){if(2!==arguments.length||"number"!=typeof t||"number"!=typeof e||t<0||e<0)throw"IllegalArgumentException";t=~~Math.floor(t),e=~~Math.floor(e),this.canvas.width=t,this.canvas.height=e}getContext(){return void 0===this.context&&(this.context=this.canvas.getContext("2d"),null===this.context&&(this.glmode=!0,this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),this.context=this.gl)),this.context}clear(){this.glmode?this.getContext().clear(this.gl.COLOR_BUFFER_BIT):this.getContext().clearRect(0,0,this.canvas.width,this.canvas.height)}getImageData(){if(!this.glmode)return this.getContext().getImageData(0,0,this.canvas.width,this.canvas.height)}putImageData(t){this.glmode||this.getContext().putImageData(t,0,0)}_putImage(t,e,n){const i=this.canvas;let o=0,r=0,s=i.width,h=i.height;SCanvas.drawtype.ORIGINAL===n?(s=t.width,h=t.height):SCanvas.drawtype.STRETCH===n?(s=i.width,h=i.height):SCanvas.drawtype.FILL_ASPECT_RATIO===n?(s=i.width,h=i.height):(s=t.width,h=t.height,SCanvas.drawtype.ASPECT_RATIO===n&&(s>i.width&&(s=i.width,h=Math.floor(h*(s/t.width))),h>i.height&&(s=Math.floor(s*(i.height/h)),h=i.height)),SCanvas.drawtype.LETTER_BOX===n&&(s=i.width,(h=Math.floor(h*(s/t.width)))>i.height&&(s=Math.floor(s*(i.height/h)),h=i.height),o=Math.floor((i.width-s)/2),r=Math.floor((i.height-h)/2),e=!1)),e&&(this.setUnit(SBase.UNIT_TYPE.PX),this.setSize(s,h),this.setPixelSize(s,h)),this.clear(),t instanceof Image?this.context.drawImage(t,0,0,t.width,t.height,o,r,s,h):t instanceof ImageData&&this.context.putImageData(t,0,0,o,r,s,h)}putImage(t,e,n,i){if(e||(e=null),void 0===n&&(n=SCanvas.drawtype.LETTER_BOX),void 0===i&&(i=!1),t instanceof Image||t instanceof ImageData)this._putImage(t,i,n),"function"==typeof e&&e();else if("string"==typeof t){const o=this,r=new Image;r.onload=function(){o.putImage(r,i,n,e)},r.src=t}else if(t instanceof SCanvas)this.putImage(t.getElement(),i,n,e);else if(t instanceof Element&&"CANVAS"===t.tagName)this.putImage(t.toDataURL(),i,n,e);else{if(!(t instanceof Blob||t instanceof File))throw"IllegalArgumentException";{const o=this,r=new FileReader;r.onload=function(){o.putImage(r.result,i,n,e)},r.readAsDataURL(t)}}}toDataURL(t){return t||(t="image/png"),this.canvas.toDataURL(t)}}SCanvas.drawtype={ORIGINAL:0,ASPECT_RATIO:1,STRETCH:2,LETTER_BOX:3};class SCheckBox extends SBase{constructor(t){super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.CHECKBOX);const e=document.createElement("input");e.type="checkbox",e.id=this.getId()+"_checkbox",e.className=SBase.CLASS_NAME.CHECKBOX_IMAGE,this.checkbox=e,this.textnode=document.createTextNode(t||"");const n=this.getElement();n.appendChild(this.checkbox),n.appendChild(this.textnode)}getEnabledElement(){return this.checkbox}getTextNode(){return this.textnode}getElementNode(){return this.checkbox}setLabelPosition(t){const e=this.getElement(),n=this.getTextNode(),i=this.getElementNode();this.node_tool.removeChildNodes(e),t===SBase.LABEL_POSITION.LEFT?(e.appendChild(n),e.appendChild(i)):(e.appendChild(i),e.appendChild(n))}setCheckBoxImageSize(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.checkbox.style.height=t.toString()+this.unit,this.checkbox.style.width=t.toString()+this.unit}addListener(t){this.checkbox.addEventListener("change",t,!1)}setChecked(t){this.checkbox.checked=t}isChecked(){return this.checkbox.checked}}class SColorPicker extends SBase{constructor(){super("div"),this.addClass(SBase.CLASS_NAME.COLORPICKER);const t=this.getElement(),e=this,n={H:{div:document.createElement("div"),split:6,value:0,input:null,gauge:null,color_data:[],color_node:[],is_press:!1},S:{div:document.createElement("div"),split:1,value:.5,input:null,gauge:null,color_data:[],color_node:[],is_press:!1},L:{div:document.createElement("div"),split:2,value:.5,input:null,gauge:null,color_data:[],color_node:[],is_press:!1}};for(let t=0;t<=n.H.split;t++){const e=1/n.H.split*t;n.H.color_data.push(Color.newColorNormalizedHSL([e,1,.5]).getCSSHex())}const i=function(t){return function(i){if(i.length&&(i=i[0]),n[t].is_press){let o=i.target;o=o||i.currentTarget,n[t].value=i.offsetX/o.clientWidth,e.redraw()}}},o=function(t,e){return function(o){o.length&&(o=o[0]);let r=o.target;r=r||o.currentTarget,n[t].is_press=e,e&&i(t)(o)}},r=function(t){return function(i){let o=i.target;o=o||i.currentTarget,n[t].value=o.value/100,e.redraw()}},s=function(t,e){const r=document.createElement("div"),s=document.createElement("div"),h=document.createElement("div");t.style.position="relative",r.style.position="absolute",s.style.position="absolute",h.style.position="absolute",r.style.margin="0px",r.style.padding="0px",s.style.margin="0px",s.style.padding="0px",h.style.margin="0px",h.style.padding="0px",r.addEventListener("mousedown",o(e,!0),!1),r.addEventListener("mouseup",o(e,!1),!1),r.addEventListener("mouseout",o(e,!1),!1),r.addEventListener("mousemove",i(e),!1),r.addEventListener("touchstart",o(e,!0),!1),r.addEventListener("touchend",o(e,!1),!1),r.addEventListener("touchcancel",o(e,!1),!1),r.dataset.name=e,r.style.width="100%",r.style.height="100%",r.style.bottom="0px",s.style.width="33%",s.style.height="100%",s.style.bottom="0px",s.style.borderStyle="ridge",s.style.borderWidth="0px 2px 0px 0px",n[e].gauge=s;const l=n[e].split;h.style.width="100%",h.style.height="100%",h.style.overflow="hidden";for(let t=0;t<l;t++){const t=document.createElement("div");t.style.display="inline-block",t.style.margin="0px",t.style.padding="0px",t.style.height="100%",t.style.width=100/l+"%",t.style.background="linear-gradient(to right, #000, #FFF)",n[e].color_node.push(t),h.appendChild(t)}t.appendChild(h),t.appendChild(s),t.appendChild(r)};for(const t in n)!function(t){const e=document.createElement("span"),i=document.createElement("div"),o=document.createElement("input");e.style.display="inline-block",i.style.display="inline-block",o.style.display="inline-block",e.style.verticalAlign="top",i.style.verticalAlign="top",o.style.verticalAlign="top",e.style.height="100%",i.style.height="100%",o.style.height="100%",e.style.margin="0px",e.style.padding="0px",e.style.textAlign="center",i.style.margin="0px 0.5em 0px 0.5em",i.style.padding="0px",i.style.borderStyle="solid",i.style.borderWidth="1px",o.addEventListener("input",r(t),!1),o.type="number",o.style.margin="0px",o.style.padding="0px",o.style.borderStyle="none",o.min=0,o.max=100,o.step=1,n[t].input=o,e.style.width="1.5em",i.style.width="calc(100% - 6.0em)",o.style.width="3.5em",s(i,t);const h=n[t].div;h.style.height="1.2em",h.style.margin="0.5em 0px 0.5em 0px",e.appendChild(document.createTextNode(t)),h.appendChild(e),h.appendChild(i),h.appendChild(o)}(t);this.hls=n,this.listener=[],this.redraw(),t.appendChild(this.hls.H.div),t.appendChild(this.hls.S.div),t.appendChild(this.hls.L.div)}setColor(t){if(!(t instanceof Color))throw"ArithmeticException";const e=this.hls,n=t.getNormalizedHSL();e.H.value=n.h,e.S.value=n.s,e.L.value=n.l,this.redraw()}getColor(){const t=this.hls,e=t.H.value,n=t.S.value,i=t.L.value;return Color.newColorNormalizedHSL([e,n,i])}redraw(){const t=this.hls,e=t.H.value,n=t.S.value,i=t.L.value;t.S.color_data=[Color.newColorNormalizedHSL([e,0,i]).getCSSHex(),Color.newColorNormalizedHSL([e,1,i]).getCSSHex()],t.L.color_data=[Color.newColorNormalizedHSL([e,n,0]).getCSSHex(),Color.newColorNormalizedHSL([e,n,.5]).getCSSHex(),Color.newColorNormalizedHSL([e,n,1]).getCSSHex()];for(const e in t){const n=t[e].color_data,i=t[e].color_node;for(let t=0;t<i.length;t++)i[t].style.background="linear-gradient(to right, "+n[t]+", "+n[t+1]+")";const o=Math.round(100*t[e].value);t[e].gauge.style.width=o+"%",t[e].input.value=o}for(let t=0;t<this.listener.length;t++)this.listener[t]()}addListener(t){this.listener.push(t)}}class SComboBox extends SBase{constructor(t){super("select",t),this.addClass(SBase.CLASS_NAME.SELECT),this.addClass(SBase.CLASS_NAME.COMBOBOX)}getEnabledElement(){return this.getElement()}addListener(t){this.getElement().addEventListener("change",t,!1)}setText(t){if(t){const e=this.getElement();"string"==typeof t&&t instanceof String&&(t=[t]);let n=e.lastChild;for(;n;)e.removeChild(n),n=e.lastChild;let i=0;for(i=0;i<t.length;i++){const n=document.createElement("option");n.text=t[i].toString(),n.value=t[i].toString(),e.appendChild(n)}}}getText(){const t=this.getElement().children;let e=0;const n=[];for(e=0;e<t.length;e++)"OPTION"===t[e].tagName&&(n[n.length]=t[e].text);return n}setSelectedItem(t){const e=this.getElement().children;let n=0,i=0;for(n=0;n<e.length;n++)if("OPTION"===e[n].tagName){if(e[n].value===t.toString()){this.getElement().selectedIndex=i;break}i++}}getSelectedItem(){const t=this.getElement().children,e=this.getElement().selectedIndex;let n=0,i=0;for(n=0;n<t.length;n++)if("OPTION"===t[n].tagName){if(e===i)return t[n].value;i++}return""}}class SFileLoadButton extends SBase{constructor(t){super("label",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.addClass(SBase.CLASS_NAME.FILELOAD);const e=super.getElement(),n=document.createElement("input");e.style.textAlign="center",n.setAttribute("type","file"),n.id=this.getId()+"_file",n.style.display="none",this.file=n,e.appendChild(n)}getEnabledElement(){return this.file}getFileAccept(){const t=this.file.getAttribute("accept");return null===t?"":t}setFileAccept(t){t===SFileLoadButton.FILE_ACCEPT.DEFAULT?null!==this.file.getAttribute("accept")&&this.file.removeAttribute("accept"):this.file.accept=t}addListener(t){this.file.addEventListener("change",function(e){t(e.target.files)},!1)}}SFileLoadButton.FILE_ACCEPT={DEFAULT:"",IMAGE:"image/*",AUDIO:"audio/*",VIDEO:"video/*",TEXT:"text/*",PNG:"image/png",JPEG:"image/jpg",GIF:"image/gif"};class SFileSaveButton extends SBase{constructor(t){super("a",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.addClass(SBase.CLASS_NAME.FILESAVE),this.filename="",this.url="",this.getElement().setAttribute("download",this.filename)}getFileName(){return this.filename}setFileName(t){this.filename=t,this.getElement().setAttribute("download",this.filenam)}setURL(t){this.getElement().href=t,this.url=t}setEnabled(t){this.isEnabled()!==t&&(t?this.getElement().href=this.url:this.getElement().removeAttribute("href")),super.setEnabled(t)}}class SGroupBox extends SBase{constructor(t){super("fieldset"),this.addClass(SBase.CLASS_NAME.GROUPBOX),this.legend=document.createElement("legend"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.GROUPBOX_LEGEND),this.legend.id=this.getId()+"_legend",this.legend.textContent=t,this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const e=this.getElement();e.appendChild(this.legend),e.appendChild(this.body)}getEnabledElement(){return this.getElement()}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SImagePanel extends SBase{constructor(){super("div"),this.addClass(SBase.CLASS_NAME.IMAGEPANEL);const t=document.createElement("img");t.id=this.id+"_img",this.image=t,this.getElement().appendChild(this.image)}clear(){this.node_tool.removeChildNodes(this.getElement())}toDataURL(){return this.image.src}putImageData(t){this.putImage(t)}putImage(t,e){if(e||(e=null),"string"==typeof t)this.image.onload=function(){"function"==typeof e&&e()},this.image.src=t;else if(t instanceof ImageData){const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const i=n.getContext("2d");i.putImageData(t,0,0),this.putImage(n,e)}else if(t instanceof Image)this.image.src=t.src;else if(t instanceof SCanvas)this.putImage(t.getElement(),e);else if(t instanceof Element&&"CANVAS"===t.tagName)try{this.putImage(t.toDataURL("image/png"),e)}catch(n){try{this.putImage(t.toDataURL("image/jpeg"),e)}catch(t){}}else{if(!(t instanceof Blob||t instanceof File))throw"IllegalArgumentException";{const n=this,i=new FileReader;i.onload=function(){n.putImage(i.result,e)},i.readAsDataURL(t)}}}}class SLabel extends SBase{constructor(t){super("div",t),this.addClass(SBase.CLASS_NAME.LABEL)}getContainerElement(){return this.getElement()}}class SPanel extends SBase{constructor(t){super("div",null),this.addClass(SBase.CLASS_NAME.PANEL);const e=this.getElement();this.legend=document.createElement("span"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.PANEL_LEGEND),this.legend.id=this.getId()+"_legend",this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const n=this;this.paneltool={setText:function(t){t?(n.legend.textContent=t,n.legend.style.display="block"):n.legend.style.display="none"}},this.paneltool.setText(t),e.appendChild(this.legend),e.appendChild(this.body)}setText(t){this.paneltool&&this.paneltool.setText(t)}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SProgressBar extends SBase{constructor(t,e){if(super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.PROGRESSBAR),this.min=0,this.max=0,this.value=t,this.is_indeterminate=!1,0===arguments.length)this.min=0,this.max=1;else{if(2!==arguments.length)throw"IllegalArgumentException";this.min=t,this.max=e}this.progress=document.createElement("progress"),this.getElement().appendChild(this.progress),this.progress.id=this.getId()+"_progress",this.progress.className=SBase.CLASS_NAME.PROGRESSBAR,this.progress.value=0,this.progress.max=1}setMaximum(t){this.max=t}setMinimum(t){this.min=t}getMaximum(){return this.max}getMinimum(){return this.min}setValue(t){this.value=t,this.progress.value=this.getPercentComplete()}getValue(){return this.value}setIndeterminate(t){this.is_indeterminate=t,this.is_indeterminate?this.progress.removeAttribute("value"):this.setValue(this.value)}isIndeterminate(){return this.is_indeterminate}getPercentComplete(){const t=this.max-this.min;return(this.value-this.min)/t}}class SSlidePanel extends SBase{constructor(t){super("div"),this.addClass(SBase.CLASS_NAME.SLIDEPANEL),this.textnode=document.createTextNode(t||""),this.legend=document.createElement("span"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.SLIDEPANEL_LEGEND),this.legend.id=this.getId()+"_legend",this.legend.appendChild(this.textnode),this.slide=document.createElement("div"),SBase.node_tool.addClass(this.slide,SBase.CLASS_NAME.SLIDEPANEL_SLIDE),this.slide.id=this.getId()+"_slide",this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const e=this,n=function(){e.setOpen(!e.isOpen())};this.legend.addEventListener("click",n),this.setOpen(!1),this.slide.appendChild(this.body);const i=super.getElement();i.appendChild(this.legend),i.appendChild(this.slide)}setOpen(t){this.is_open=t,this.is_open?(this.slide.style.maxHeight=this.body.scrollHeight+"px",SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.OPEN),SBase.node_tool.removeClass(this.legend,SBase.CLASS_NAME.CLOSE)):(this.slide.style.maxHeight=null,SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.CLOSE),SBase.node_tool.removeClass(this.legend,SBase.CLASS_NAME.OPEN))}isOpen(){return this.is_open}getTextNode(){return this.textnode}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SSlider extends SBase{constructor(t,e){if(super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.SLIDER),0===arguments.length)t=0,e=1;else if(2!==arguments.length)throw"IllegalArgumentException";this.slider=document.createElement("input"),this.slider.id=this.getId()+"_slider",this.slider.type="range",this.slider.className=SBase.CLASS_NAME.SLIDER,this.slider.value=t,this.slider.min=t,this.slider.max=e,this.slider.step=(e-t)/100,this.datalist=document.createElement("datalist"),this.datalist.id=this.getId()+"_datalist",this.slider.setAttribute("list",this.datalist.id),this.getElement().appendChild(this.slider),this.getElement().appendChild(this.datalist)}getEnabledElement(){return this.slider}setMaximum(t){this.slider.max=t}setMinimum(t){this.slider.min=t}getMaximum(){return parseFloat(this.slider.max)}getMinimum(){return parseFloat(this.slider.min)}setValue(t){this.slider.value=t}getValue(){return parseFloat(this.slider.value)}setMinorTickSpacing(t){this.slider.step=t}getMinorTickSpacing(){return parseFloat(this.slider.step)}setMajorTickSpacing(t){this.majortick=t,this.removeMajorTickSpacing();let e;const n=this.getMinimum(),i=this.getMaximum();for(e=n;e<=i;e+=t){const t=document.createElement("option");t.value=e.toString(),this.datalist.appendChild(t)}}getMajorTickSpacing(){return this.majortick}removeMajorTickSpacing(){const t=this.datalist;let e=t.lastChild;for(;e;)t.removeChild(e),e=t.lastChild}addListener(t){let e=!1;const n=this,i=function(){e=!0},o=function(){e&&("disabled"!==n.slider.disabled&&t(),e=!1)};this.slider.addEventListener("touchstart",i,!1),this.slider.addEventListener("touchend",o,!1),this.slider.addEventListener("mousedown",i,!1),this.slider.addEventListener("mouseup",o,!1)}getWidth(){let t=this.slider.width;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getHeight(){let t=this.slider.height;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}setWidth(t){if("number"!=typeof t)throw"IllegalArgumentException not number";super.setWidth(t),this.slider.style.width=t.toString()+this.unit}setHeight(t){if("number"!=typeof t)throw"IllegalArgumentException not number";super.setHeight(t),this.slider.style.height=t.toString()+this.unit}}const SComponent={Button:SButton,Canvas:SCanvas,CheckBox:SCheckBox,ColorPicker:SColorPicker,ComboBox:SComboBox,FileLoadButton:SFileLoadButton,FileSaveButton:SFileSaveButton,GroupBox:SGroupBox,ImagePanel:SImagePanel,Label:SLabel,Panel:SPanel,ProgressBar:SProgressBar,SlidePanel:SSlidePanel,Slider:SSlider,PUT_TYPE:SBase.PUT_TYPE,UNIT_TYPE:SBase.UNIT_TYPE,LABEL_POSITION:SBase.LABEL_POSITION,FILE_ACCEPT:SFileLoadButton.FILE_ACCEPT},Senko={};Senko._printbuffer="",Senko.ArrayList=ArrayList,Senko.Color=Color,Senko.File=File$1,Senko.HashMap=HashMap,Senko.format=Format.format,Senko.Log=Log,Senko.MathX=MathX,Senko.Device=Device,Senko.ImageProcessing=ImageProcessing,Senko.SComponent=SComponent;export default Senko;
