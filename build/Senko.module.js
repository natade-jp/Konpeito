class ArrayList{constructor(){if(this.element=[],1===arguments.length)for(let t=0;t<arguments[0].element.length;t++)this.element[t]=arguments[0].element[t]}each(t){let e=!0;for(let n=0;n<this.element.length;n++){const i=this.element[n];if(!1===t.call(i,n,i)){e=!1;break}}return e}toString(){return this.join(", ")}isEmpty(){return 0===this.element.length}contains(t){return this.element.contains(t)}size(){return this.element.length}clear(){this.element.length=0}join(t){return 0===arguments.length&&(t=","),this.element.join(t)}clone(){const t=new ArrayList;for(let e=0;e<this.element.length;e++)t.element[e]=this.element[e];return t}indexOf(t){for(let e=0;e<this.element.length;e++)if(this.element[e]===t)return e;return-1}lastIndexOf(t){for(let e=this.element.length-1;-1!==e;e--)if(this.element[e]===t)return e;return-1}get(t){return this.element[t]}add(){if(1===arguments.length){const t=arguments[0];this.element.push(t)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.element.splice(t,0,e)}}addAll(){if(1===arguments.length){const t=arguments[0];let e=this.element.length;for(let n=0;n<t.length;n++)this.element[e++]=t.element[n]}else if(2===arguments.length){let t=arguments[0],e=arguments[1].element;e===this.element&&(e=this.element.slice(0));let n=this.element.length-t,i=this.element.length+e.length-1,s=this.element.length-1;for(let t=0;t<n;t++)this.element[i--]=this.element[s--];n=e.length;for(let i=0;i<n;i++)this.element[t++]=e[i]}}set(t,e){this.element[t]=e}remove(t){this.element.splice(t,1)}removeRange(t,e){this.element.splice(t,e-t)}sort(t){let e;e=0===arguments.length?function(t,e){return t===e?0:typeof t==typeof e?t<e?-1:1:typeof t<typeof e?-1:1}:t;const n=[],i=function(t,e,s,o){if(e<s){const r=Math.floor((e+s)/2);i(t,e,r,o),i(t,r+1,s,o);let h,a,l,u=0;for(h=e;h<=r;h++)n[u++]=t[h];for(h=r+1,a=0,l=e;h<=s&&a<u;)o(t[h],n[a])>=0?t[l++]=n[a++]:t[l++]=t[h++];for(;a<u;)t[l++]=n[a++]}return!0};i(this.element,0,this.element.length-1,e)}}class Color{constructor(){this.r=0,this.g=0,this.b=0,this.a=1}clone(){const t=new Color;return t.r=this.r,t.g=this.g,t.b=this.b,t.a=this.a,t}toString(){return"Color["+this.getCSSHex()+", "+this.getCSS255()+", "+this.getCSSPercent()+"]"}static _flact(t){return t-Math.floor(t)}static _hex(t){return t=Math.round(255*t).toString(16),1===t.length?"0"+t:t}_setRGB(t,e,n,i){return this.r=t,this.g=e,this.b=n,i&&(this.a=i),this}_setHSV(t,e,n,i){let s,o;return this.r=n,this.g=n,this.b=n,i&&(this.a=i),e>0&&(o=(t*=6)-(s=~~Math.floor(t)),0===s?(this.g*=1-e*(1-o),this.b*=1-e):1===s?(this.r*=1-e*o,this.b*=1-e):2===s?(this.r*=1-e,this.b*=1-e*(1-o)):3===s?(this.r*=1-e,this.g*=1-e*o):4===s?(this.r*=1-e*(1-o),this.g*=1-e):5===s&&(this.g*=1-e,this.b*=1-e*o)),this}_setHSL(t,e,n,i){if(i&&(this.a=i),0===e)return this.r=0,this.g=0,this.b=0,this;let s;const o=2*n-(s=n<.5?n*(1+e):n*(1-e)+e),r=s-o;t*=6;const h=~~Math.floor(t),a=t-h;return 0===h?(this.r=s,this.g=s-r*(1-a),this.b=o):1===h?(this.r=o+r*(1-a),this.g=s,this.b=o):2===h?(this.r=o,this.g=s,this.b=s-r*(1-a)):3===h?(this.r=o,this.g=o+r*(1-a),this.b=s):4===h?(this.r=s-r*(1-a),this.g=o,this.b=s):5===h&&(this.r=s,this.g=o,this.b=o+r*(1-a)),this}_getRGB(){return{r:this.r,g:this.g,b:this.b,a:this.a}}_getHSV(){const t=Math.max(this.r,this.g,this.b),e=Math.min(this.r,this.g,this.b),n=t-e;let i=0,s=t-e;const o=t;return 0!==t&&(s/=t),0===n?[i,s,o]:(t===this.r?(i=(this.g-this.b)/n)<0&&(i+=6):i=t===this.g?2+(this.b-this.r)/n:4+(this.r-this.g)/n,i/=6,{h:i,s:s,v:o,a:this.a})}_getHSL(){const t=Math.max(this.r,this.g,this.b),e=Math.min(this.r,this.g,this.b),n=.5*(t+e),i=t-e;if(0===i)return[0,n,0];let s;s=n<.5?i/(t+e):i/(2-t-e);let o;return t===this.r?(o=(this.g-this.b)/i)<0&&(o+=6):o=t===this.g?2+(this.b-this.r)/i:4+(this.r-this.g)/i,o/=6,{h:o,s:s,l:n,a:this.a}}getNormalizedRGB(){return this._getRGB()}getRGB(){return{r:Math.round(255*this.r),g:Math.round(255*this.g),b:Math.round(255*this.b),a:Math.round(255*this.a)}}getRGB24(){return Math.round(255*this.r)<<16|Math.round(255*this.g)<<8|Math.round(255*this.b)}getRGB32(){return Math.round(255*this.a)<<24|Math.round(255*this.r)<<16|Math.round(255*this.g)<<8|Math.round(255*this.b)}getNormalizedHSV(){return this._getHSV()}getHSV(){const t=this.getNormalizedHSV();return t.h=Math.round(360*t.h),t.s=Math.round(255*t.s),t.v=Math.round(255*t.v),t.a=Math.round(255*t.a),t}getNormalizedHSL(){return this._getHSL()}getHSL(){const t=this.getNormalizedHSL();return t.h=Math.round(360*t.h),t.s=Math.round(255*t.s),t.l=Math.round(255*t.l),t.a=Math.round(255*t.a),t}getRed(){return Math.round(255*this.r)}getGreen(){return Math.round(255*this.g)}getBlue(){return Math.round(255*this.b)}getAlpha(){return Math.round(255*this.b)}brighter(){const t=new Color;return t.r=Math.min(this.r*(1/.7),1),t.g=Math.min(this.g*(1/.7),1),t.b=Math.min(this.b*(1/.7),1),t.a=this.a,t}darker(){const t=new Color;return t.r=Math.max(.7*this.r,0),t.g=Math.max(.7*this.g,0),t.b=Math.max(.7*this.b,0),t.a=this.a,t}getCSSHex(){return 1===this.a?"#"+Color._hex(this.r)+Color._hex(this.g)+Color._hex(this.b):"#"+Color._hex(this.a)+Color._hex(this.r)+Color._hex(this.g)+Color._hex(this.b)}getCSS255(){return 1===this.a?"rgb("+Math.round(255*this.r)+","+Math.round(255*this.g)+","+Math.round(255*this.b)+")":"rgba("+Math.round(255*this.r)+","+Math.round(255*this.g)+","+Math.round(255*this.b)+","+this.a+")"}getCSSPercent(){return 1===this.a?"rgb("+Math.round(100*this.r)+"%,"+Math.round(100*this.g)+"%,"+Math.round(100*this.b)+"%)":"rgba("+Math.round(100*this.r)+"%,"+Math.round(100*this.g)+"%,"+Math.round(100*this.b)+"%,"+Math.round(100*this.a)+"%)"}static newColorNormalizedRGB(){let t=0,e=0,n=0,i=1;1===arguments.length?(arguments[0].r&&(t=arguments[0].r),arguments[0].g&&(e=arguments[0].g),arguments[0].b&&(n=arguments[0].b),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3]));const s=new Color;return s.r=Math.min(Math.max(t,0),1),s.g=Math.min(Math.max(e,0),1),s.b=Math.min(Math.max(n,0),1),s.a=Math.min(Math.max(i,0),1),s}static newColorRGB(){let t=0,e=0,n=0,i=255;arguments.length>=3?(t=arguments[0],e=arguments[1],n=arguments[2],arguments.length>=4&&(i=arguments[3])):arguments.length>=1&&("number"==typeof arguments[0]?(t=arguments[0]>>16&255,e=arguments[0]>>8&255,n=255&arguments[0],arguments[1]&&(i=arguments[0]>>24&255)):void 0===arguments[0].length?(arguments[0].r&&(t=arguments[0].r),arguments[0].g&&(e=arguments[0].g),arguments[0].b&&(n=arguments[0].b),arguments[0].a&&(i=arguments[0].a)):arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2],arguments[0].length>=4&&(i=arguments[0][3])));const s=new Color;return s.r=Math.min(Math.max(t/255,0),1),s.g=Math.min(Math.max(e/255,0),1),s.b=Math.min(Math.max(n/255,0),1),s.a=Math.min(Math.max(i/255,0),1),s}static newColorNormalizedHSV(){let t=0,e=0,n=0,i=1;1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].v&&(n=arguments[0].v),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),e=Math.min(Math.max(e,0),1),n=Math.min(Math.max(n,0),1),i=Math.min(Math.max(i,0),1);const s=new Color;return s._setHSV(Color._flact(t),e,n,i),s}static newColorHSV(){let t=0,e=0,n=0,i=255;return 1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].v&&(n=arguments[0].v),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),Color.newColorNormalizedHSV(t/360,e/255,n/255,i/255)}static newColorNormalizedHSL(){let t=0,e=0,n=0,i=1;1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].l&&(n=arguments[0].l),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),e=Math.min(Math.max(e,0),1),n=Math.min(Math.max(n,0),1),i=Math.min(Math.max(i,0),1);const s=new Color;return s._setHSL(Color._flact(t),e,n,i),s}static newColorHSL(){let t=0,e=0,n=0,i=255;return 1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(e=arguments[0].s),arguments[0].l&&(n=arguments[0].l),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],e=arguments[0][1],n=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],e=arguments[1],n=arguments[2]),arguments.length>=4&&(i=arguments[3])),Color.newColorNormalizedHSL(t/360,e/255,n/255,i/255)}}Color.white=Color.newColorRGB(16777215),Color.lightGray=Color.newColorRGB(13882323),Color.gray=Color.newColorRGB(8421504),Color.darkGray=Color.newColorRGB(11119017),Color.black=Color.newColorRGB(0),Color.red=Color.newColorRGB(16711680),Color.pink=Color.newColorRGB(16761035),Color.orange=Color.newColorRGB(16753920),Color.yellow=Color.newColorRGB(16776960),Color.green=Color.newColorRGB(32768),Color.magenta=Color.newColorRGB(16711935),Color.cyan=Color.newColorRGB(65535),Color.blue=Color.newColorRGB(255),Color.WHITE=Color.white,Color.LIGHT_GRAY=Color.lightGray,Color.GRAY=Color.gray,Color.DARK_GRAY=Color.darkGray,Color.RED=Color.red,Color.PINK=Color.pink,Color.ORANGE=Color.orange,Color.YELLOW=Color.yellow,Color.GREEN=Color.green,Color.MAGENTA=Color.magenta,Color.CYAN=Color.cyan,Color.BLUE=Color.blue;const CSVTool={parseCSV:function(t,e){arguments.length<2&&(e=","),t=t.replace(/\r\n?|\n/g,"\n");const n=e.charCodeAt(0),i=[],s=t.length;let o="",r=0,h=0,a=!1,l=!1;for(let e=0;e<s;e++){let u=t.charCodeAt(e);if(34===u&&0===o.length)for(e++;e<s;e++)if(34===(u=t.charCodeAt(e))){if(e+1===s-1)break;if(34!==t.charCodeAt(e+1))break;e++,o+='"'}else o+=t.charAt(e);else{switch(u){case n:a=!0;break;case 13:case 10:l=!0}a?(a=!1,void 0===i[r]&&(i[r]=[]),i[r][h]=o,o="",h+=1):l?(l=!1,""===o&&0===h||(void 0===i[r]&&(i[r]=[]),i[r][h]=o,o="",r+=1,h=0)):o+=t.charAt(e)}e===s-1&&0!==h&&(i[r][h]=o)}return i},makeCSV:function(t,e,n){arguments.length<2&&(e=","),arguments.length<3&&(n="\r\n");let i="";const s=/["\r\n,\t]/;if(void 0!==t)for(let o=0;o<t.length;o++){if(void 0!==t[o])for(let n=0;n<t[o].length;n++){let r=t[o][n];s.test(r)&&(r='"'+(r=r.replace(/"/g,'""'))+'"'),i+=r,n!==t[o].length-1&&(i+=e)}i+=n}return i}};class File$1{constructor(t){if(this.isHTML="undefined"!=typeof window,this.isNode=!1,1!==arguments.length)throw"IllegalArgumentException";if("string"==typeof t||t instanceof String)this.pathname=t.replace(/\\/g,"/");else{if(!(t instanceof File$1))throw"IllegalArgumentException";this.pathname=t.getAbsolutePath()}}delete_(){throw"IllegalMethod"}exists(){throw"IllegalMethod"}copy(){throw"IllegalMethod"}move(){throw"IllegalMethod"}toString(){return this.getAbsolutePath()}getName(){if(this.isHTML){if(this.isDirectory())return"";const t=this.pathname.split("/");return t[t.length-1]}if(this.isNode)throw"IllegalMethod"}getParent(){const t=this.getAbsolutePath().match(/.*[\/\\]/)[0];return t.substring(0,t.length-1)}getParentFile(){return new File$1(this.getParent())}getExtensionName(){if(this.isHTML){const t=this.getName().split(".");return t[t.length-1]}if(this.isNode)throw"IllegalMethod"}isAbsolute(){if(this.isHTML)return this.getAbsolutePath()===this.pathname;if(this.isNode)throw"IllegalMethod"}isDirectory(){if(this.isHTML)return/\/$/.test(this.pathname);if(this.isNode)throw"IllegalMethod"}isFile(){if(this.isHTML)return/[^\/]$/.test(this.pathname);if(this.isNode)throw"IllegalMethod"}isHidden(){if(this.isNode)throw"IllegalMethod"}lastModified(){if(this.isNode)throw"IllegalMethod"}setLastModified(){if(this.isNode)throw"IllegalMethod"}length(){if(this.isNode)throw"IllegalMethod"}getFiles(){if(this.isNode)throw"IllegalMethod"}getSubFolders(){if(this.isNode)throw"IllegalMethod"}getNormalizedPathName(){if(""===this.pathname)return".\\";let t=this.pathname.replace(/\//g,"\\");return"\\"!==t.slice(-1)&&(t+="\\"),t}getAllFiles(){if(this.isNode)throw"IllegalMethod"}list(){if(this.isNode)throw"IllegalMethod"}getAbsolutePath(){if(this.isHTML){let t=null;if(/^http/.test(this.pathname))t=this.pathname;else{let e=window.location.toString();/\/$/.test(e)||(e=e.match(/.*\//)[0]),t=e+this.pathname}const e=t.match(/^http[^\/]+\/\/[^\/]+\//)[0],n=t.substr(e.length);let i=e;const s=n.split("/");let o;for(o=0;o<s.length;o++)""!==s[o]&&"."!==s[o]&&(".."!==s[o]?(i+=s[o],o!==s.length-1&&(i+="/")):i=i.substring(0,i.length-1).match(/.*\//)[0]);return i}if(this.isNode)throw"IllegalMethod"}mkdir(){if(this.isNode)throw"IllegalMethod"}mkdirs(){if(this.isNode)throw"IllegalMethod"}renameTo(){if(this.isNode)throw"IllegalMethod"}run(){if(this.isNode)throw"IllegalMethod"}writeLine(){if(this.isNode)throw"IllegalMethod"}download(t){if(this.isHTML){const e=this.getExtensionName().toLocaleString(),n=this;if("gif"===e||"jpg"===e||"png"===e||"bmp"===e||"svg"===e||"jpeg"===e){const e=new Image;e.onload=function(){n.dataImage=e,t(n)},e.src=this.pathname}else{const e=File$1.createXMLHttpRequest();if(null===e)return null;const i=function(){if(4===e.readyState){if(200!==e.status)return console.log("error downloadText "+n.pathname),null;n.dataText=e.responseText,t(n)}};e.onreadystatechange=i,e.open("GET",this.pathname,!0),e.send(null)}}else if(this.isNode)throw"IllegalMethod"}getImage(){if(this.isHTML)return this.dataImage}getText(){if(this.isHTML)return this.dataText;if(this.isNode)throw"IllegalMethod"}setText(){if(this.isNode)throw"IllegalMethod"}getCSV(t,e,n){if(this.isHTML)return CSVTool.parseCSV(this.dataText,t,n);if(this.isNode)throw"IllegalMethod"}setCSV(){if(this.isNode)throw"IllegalMethod"}getByte(){if(this.isNode)throw"IllegalMethod"}setByte(){if(this.isNode)throw"IllegalMethod"}static createTempFile(){if("undefined"!=typeof window)throw"not createTempFile"}static getCurrentDirectory(){if("undefined"!=typeof window){const t=new File$1("./");return t.getParent()}}static setCurrentDirectory(){if("undefined"!=typeof window)throw"not setCurrentDirectory"}static searchFile(){if("undefined"!=typeof window)throw"not searchFile"}static downloadFileList(t,e,n){let i,s=0;for(i=0;i<t.length;i++)t[i].download(function(i){return function(){s++,n&&n.length&&n[i]&&n[i](t[i]),s===t.length&&e&&e(t)}}(i))}static createXMLHttpRequest(){return new XMLHttpRequest}static getCSVTool(){return CSVTool}}class HashMap{constructor(){if(this.map=[],this.size_=0,1===arguments.length){for(const t in arguments[0].map)this.map[t]=arguments[0].map[t];this.size_=arguments[0].size_}}each(t){let e=!0;for(const n in this.map){const i=this.map[n];if(!1===t.call(i,n,i)){e=!1;break}}return e}toString(){let t="",e=0;for(const n in this.map)t+=n+"=>"+this.map[n],++e!==this.size_&&(t+="\n");return t}containsKey(t){return void 0!==this.map[t]}containsValue(t){for(const e in this.map)if(this.map[e]===t)return!0;return!1}isEmpty(){return 0===this.size_}clear(){this.map=[],this.size_=0}clone(){const t=new HashMap;for(const e in this.map)t.map[e]=this.map[e];return t.size_=this.size_,t}size(){return this.size_}get(t){return this.map[t]}put(t,e){if(!1===this.containsKey(t))return this.map[t]=e,this.size_=this.size_+1,null;{const n=this.map[t];return this.map[t]=e,n}}putAll(t){for(const e in t.map)void 0===this.map[e]&&(this.map[e]=t.map[e],this.size_=this.size_+1)}remove(t){if(!1===this.containsKey(t))return null;{const e=this.map[t];return delete this.map[t],this.size_=this.size_-1,e}}}class Text$1{static isHighSurrogateAt(t,e){const n=t.charCodeAt(e);return 55296<=n&&n<=56319}static isLowSurrogateAt(t,e){const n=t.charCodeAt(e);return 56320<=n&&n<=57343}static isSurrogatePairAt(t,e){const n=t.charCodeAt(e);return 55296<=n&&n<=57343}static codePointAt(t,e){if(Text$1.isHighSurrogateAt(t,e)){const n=t.charCodeAt(e),i=t.charCodeAt(e+1);return 65536+(n-55296<<10|i-56320)}return t.charCodeAt(e)}static codePointBefore(t,e){return Text$1.isLowSurrogateAt(t,e-1)?t.codePointAt(e-2):t.charCodeAt(e-1)}static codePointCount(t,e,n){arguments.length<2&&(e=0),arguments.length<3&&(n=t.length);let i=0;for(;e<n;e++)i++,Text$1.isSurrogatePairAt(t,e)&&e++;return i}static offsetByCodePoints(t,e,n){let i=0;if(0===n)return e;if(n>0){for(;e<t.length;e++)if(i++,Text$1.isHighSurrogateAt(t,e)&&e++,i===n)return e+1}else for(n=-n;e>=0;e--)if(i++,Text$1.isLowSurrogateAt(t,e-1)&&e--,i===n)return e-1;return!1}static fromCodePoint(){let t=[];t=arguments[0].length?arguments[0]:arguments;const e=[];for(let n=0;n<t.length;n++){const i=t[n];if(65536<=i){const t=55296+(i-65536>>10),n=56320+(1023&i);e[e.length]=String.fromCharCode(t),e[e.length]=String.fromCharCode(n)}else e[e.length]=String.fromCharCode(i)}return e.join("")}static toUTF32Array(t){const e=[];for(let n=0;n<t.length;n=Text$1.offsetByCodePoints(t,n,1))e.push(Text$1.codePointAt(t,n));return e}static fromUTF32Array(t){return Text$1.fromCodePoint(t)}static toUTF16Array(t){const e=[];for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}static fromUTF16Array(t){const e=[];for(let n=0;n<t.length;n++)e[n]=String.fromCharCode(t[n]);return e.join("")}static toUTF8Array(t){const e=Text$1.toUTF32Array(t),n=[];for(let t=0;t<e.length;t++){let i=e[t];if(i<=127)n.push(i);else{const t=[];let e=0;e=i<2048?2:i<65536?3:4;for(let n=0;n<e;n++){let s=63&i;if(n===e-1){s|=2===e?192:3===e?224:240,t.push(s);break}t.push(128|s),i>>=6}for(let e=t.length-1;e>=0;e--)n.push(t[e])}}return n}static fromUTF8Array(t){const e=[];let n=0,i=0;for(let s=0;s<t.length;s++){const o=t[s];o<128&&e.push(o),0===n?o<224?(n=1,i=31&o):o<240?(n=2,i=15&o):(n=3,i=7&o):(i<<=6,i|=63&o,0===--n&&e.push(i))}return Text$1.fromCodePoint(e)}static toHiragana(t){const e=function(t){return String.fromCharCode(t.charCodeAt(0)-96)};return t.replace(/[\u30A1-\u30F6]/g,e)}static toKatakana(t){const e=function(t){return String.fromCharCode(t.charCodeAt(0)+96)};return t.replace(/[\u3041-\u3096]/g,e)}static toHalfWidthSpace(t){return t.replace(/\u3000/g,String.fromCharCode(32))}static toFullWidthSpace(t){return t.replace(/\u0020/g,String.fromCharCode(12288))}static toHalfWidthAsciiCode(t){let e=t;const n=function(t){return t=t.charCodeAt(0),String.fromCharCode(t-65248)};return(e=(e=(e=e.replace(/\u3000/g," ")).replace(/[\u2018-\u201B]/g,"'")).replace(/[\u201C-\u201F]/g,'"')).replace(/[\uFF01-\uFF5E]/g,n)}static toFullWidthAsciiCode(t){let e=t;const n=function(t){return t=t.charCodeAt(0),String.fromCharCode(t+65248)};return(e=(e=(e=e.replace(/\u0020/g,"　")).replace(/\u0022/g,"”")).replace(/\u0027/g,"’")).replace(/[\u0020-\u007E]/g,n)}static toHalfWidthAlphabet(t){const e=function(t){return String.fromCharCode(t.charCodeAt(0)-65248)};return t.replace(/[\uFF21-\uFF3A\uFF41-\uFF5A]/g,e)}static toFullWidthAlphabet(t){const e=function(t){return String.fromCharCode(t.charCodeAt(0)+65248)};return t.replace(/[A-Za-z]/g,e)}static toHalfWidthNumber(t){const e=function(t){return String.fromCharCode(t.charCodeAt(0)-65248)};return t.replace(/[\uFF10-\uFF19]/g,e)}static toFullWidthNumber(t){const e=function(t){return String.fromCharCode(t.charCodeAt(0)+65248)};return t.replace(/[0-9]/g,e)}static toHalfWidthKana(t){const e={12289:"､",12290:"｡",12300:"｢",12301:"｣",12443:"ﾞ",12444:"ﾟ",12449:"ｧ",12450:"ｱ",12451:"ｨ",12452:"ｲ",12453:"ｩ",12454:"ｳ",12455:"ｪ",12456:"ｴ",12457:"ｫ",12458:"ｵ",12459:"ｶ",12460:"ｶﾞ",12461:"ｷ",12462:"ｷﾞ",12463:"ｸ",12464:"ｸﾞ",12465:"ｹ",12466:"ｹﾞ",12467:"ｺ",12468:"ｺﾞ",12469:"ｻ",12470:"ｻﾞ",12471:"ｼ",12472:"ｼﾞ",12473:"ｽ",12474:"ｽﾞ",12475:"ｾ",12476:"ｾﾞ",12477:"ｿ",12478:"ｿﾞ",12479:"ﾀ",12480:"ﾀﾞ",12481:"ﾁ",12482:"ﾁﾞ",12483:"ｯ",12484:"ﾂ",12485:"ﾂﾞ",12486:"ﾃ",12487:"ﾃﾞ",12488:"ﾄ",12489:"ﾄﾞ",12490:"ﾅ",12491:"ﾆ",12492:"ﾇ",12493:"ﾈ",12494:"ﾉ",12495:"ﾊ",12496:"ﾊﾞ",12497:"ﾊﾟ",12498:"ﾋ",12499:"ﾋﾞ",12500:"ﾋﾟ",12501:"ﾌ",12502:"ﾌﾞ",12503:"ﾌﾟ",12504:"ﾍ",12505:"ﾍﾞ",12506:"ﾍﾟ",12507:"ﾎ",12508:"ﾎﾞ",12509:"ﾎﾟ",12510:"ﾏ",12511:"ﾐ",12512:"ﾑ",12513:"ﾒ",12514:"ﾓ",12515:"ｬ",12516:"ﾔ",12517:"ｭ",12518:"ﾕ",12519:"ｮ",12520:"ﾖ",12521:"ﾗ",12522:"ﾘ",12523:"ﾙ",12524:"ﾚ",12525:"ﾛ",12526:"ﾜ",12527:"ﾜ",12528:"ｲ",12529:"ｴ",12530:"ｦ",12531:"ﾝ",12532:"ｳﾞ",12533:"ｶ",12534:"ｹ",12535:"ﾜﾞ",12536:"ｲﾞ",12537:"ｴﾞ",12538:"ｦﾞ",12539:"･",12540:"ｰ"},n=function(t){return 1===t.length?e[t.charCodeAt(0)]:e[t.charCodeAt(0)]+e[t.charCodeAt(1)]};return t.replace(/[\u3001\u3002\u300C\u300D\u309B\u309C\u30A1-\u30FC][\u309B\u309C]?/g,n)}static toFullWidthKana(t){const e={65377:12290,65378:12300,65379:12301,65380:12289,65381:12539,65382:12530,65383:12449,65384:12451,65385:12453,65386:12455,65387:12457,65388:12515,65389:12517,65390:12519,65391:12483,65392:12540,65393:12450,65394:12452,65395:12454,65396:12456,65397:12458,65398:12459,65399:12461,65400:12463,65401:12465,65402:12467,65403:12469,65404:12471,65405:12473,65406:12475,65407:12477,65408:12479,65409:12481,65410:12484,65411:12486,65412:12488,65413:12490,65414:12491,65415:12492,65416:12493,65417:12494,65418:12495,65419:12498,65420:12501,65421:12504,65422:12507,65423:12510,65424:12511,65425:12512,65426:12513,65427:12514,65428:12516,65429:12518,65430:12520,65431:12521,65432:12522,65433:12523,65434:12524,65435:12525,65436:12527,65437:12531,65438:12443,65439:12444},n=function(t){if(1===t.length)return String.fromCharCode(e[t.charCodeAt(0)]);{const n=t.charCodeAt(1),i=t.charCodeAt(0);if(65438===n){if(65395===i)return String.fromCharCode(12436);if(65398<=i&&i<=65412||65418<=i&&i<=65422)return String.fromCharCode(e[i]+1)}else if(65439===n&&65418<=i&&i<=65422)return String.fromCharCode(e[i]+2);return String.fromCharCode(e[i])+String.fromCharCode(e[n])}};return t.replace(/[\uFF61-\uFF9F][\uFF9E\uFF9F]?/g,n)}static toHalfWidth(t){return Text$1.toHalfWidthKana(Text$1.toHalfWidthAsciiCode(t))}static toFullWidth(t){return Text$1.toFullWidthKana(Text$1.toFullWidthAsciiCode(t))}static removeComment(t){let e=!1,n=!1,i=!1,s=!1,o=!1,r=!1;const h=[];for(let a=0;a<t.length;a++){const l=t.charAt(a);if(e)n?n=!1:"\\"===l?n=!0:'"'===l&&(e=!1),h[h.length]=l;else if(o)r&&(r=!1,"/"===l&&(o=!1)),"*"===l?r=!0:"\n"===l&&(h[h.length]=l);else if(s)"\n"===l&&(s=!1,h[h.length]=l);else{if(i){if(i=!1,"/"===l){s=!0,h[h.length-1]="";continue}if("*"===l){o=!0,h[h.length-1]="";continue}}'"'===l&&(e=!0),"/"===l&&(i=!0),h[h.length]=l}}return h.join("")}static format(){let t=1;const e=arguments,n=function(t){if(t>=0)return t;{let e=~(t=-t)>>16&65535;const n=65535&~t;return(e*=65536)+n+1}},i=function(i){let s;const o=(s=(i=i.substring(1,i.length)).match(/.$/))[0];if("%"===o)return"%";null!==(s=i.match(/^[0-9]+\$/))&&(s=s[0],i=i.substring(s.length,i.length),s=s.substring(0,s.length-1),t=parseInt(s,10));let r=e[t];t+=1;let h=!1,a=!1,l=!1,u="";null!==(s=i.match(/^[-+ #0]+/))&&(s=s[0],i=i.substring(s.length,i.length),-1!==s.indexOf("#")&&(h=!0),-1!==s.indexOf("-")&&(a=!0),-1!==s.indexOf(" ")&&(u=" "),-1!==s.indexOf("+")&&(u="+"),-1!==s.indexOf("0")&&(l=!0));let c=0;null!==(s=i.match(/^([0-9]+|\*)/))&&(s=s[0],i=i.substring(s.length,i.length),-1!==s.indexOf("*")?(c=r,r=e[t],t+=1):c=parseInt(s,10));let m=!1,g=0;null!==(s=i.match(/^(\.((-?[0-9]+)|\*)|\.)/))&&(s=s[0],i=i.substring(s.length,i.length),m=!0,-1!==s.indexOf("*")?(g=r,r=e[t],t+=1):1===s.length?g=0:(s=s.substring(1,s.length),g=parseInt(s,10))),null!==(s=i.match(/^hh|h|ll|l|L|z|j|t/))&&(i=i.substring(s.length,i.length));let f="",d=!1;switch(o.toLowerCase()){case"d":case"i":case"u":case"b":case"o":case"x":d=!0;case"e":case"f":case"g":{let t,e="",i=0;switch(d?(isNaN(r)&&(r=parseInt(r,10)),"d"===o||"i"===o?(r<0&&(u="-",r=-r),r=Math.floor(r)):r=r>=0?Math.floor(r):Math.ceil(r)):(isNaN(r)&&(r=parseFloat(r)),r<0&&(u="-",r=-r),m||(g=6)),o.toLowerCase()){case"d":case"i":f+=r.toString(10);break;case"u":f+=n(r).toString(10);break;case"b":f+=n(r).toString(2),h&&(e="0b");break;case"o":f+=n(r).toString(8),h&&(e="0");break;case"x":case"X":f+=n(r).toString(16),h&&(e="0x");break;case"e":f+=r.toExponential(g);break;case"f":f+=r.toFixed(g);break;case"g":0===g&&(g=1),f+=r.toPrecision(g),h||-1===f.indexOf(".")||(f=(f=f.replace(/\.?0+$/,"")).replace(/\.?0+e/,"e"))}if(d){if(m){t=g-f.length;for(let e=0;e<t;e++)f="0"+f}}else h&&-1===f.indexOf(".")&&(-1!==f.indexOf("e")?f=f.replace("e",".e"):f+=".");if(-1!==f.indexOf("e")){const t=function(t){const e=t.length;return 3===t.length?t.substring(0,e-1)+"00"+t.substring(e-1,e):t.substring(0,e-2)+"0"+t.substring(e-2,e)};f=f.replace(/e[+-][0-9]{1,2}$/,t)}if(i=f.length+e.length+u.length,t=c-i,a)for(let e=0;e<t;e++)f+=" ";if(l)for(let e=0;e<t;e++)f="0"+f;if(f=e+f,f=u+f,!l&&!a)for(let e=0;e<t;e++)f=" "+f;o.toUpperCase()===o&&(f=f.toUpperCase());break}case"c":isNaN(r)||(r=String.fromCharCode(r));case"s":{isNaN(r)||(r=r.toString(10)),f=r,m&&f.length>g&&(f=f.substring(0,g));const t=f.length,e=c-t;if(a)for(let t=0;t<e;t++)f+=" ";else{const t=l?"0":" ";for(let n=0;n<e;n++)f=t+f}break}case"%":f="%";break;case"p":case"n":f="(変換できません)"}return f};return e[0].replace(/%[^diubBoxXeEfFgGaAcspn%]*[diubBoxXeEfFgGaAcspn%]/g,i)}}class IDSwitch{constructor(){this._initIDSwitch()}_initIDSwitch(){this.istyped=!1,this.ispressed=!1,this.isreleased=!1,this.pressed_time=0}clone(){const t=new IDSwitch;return t.istyped=this.istyped,t.ispressed=this.ispressed,t.isreleased=this.isreleased,t.pressed_time=this.pressed_time,t}keyPressed(){this.ispressed||(this.istyped=!0),this.ispressed=!0,this.pressed_time++}keyReleased(){this.ispressed=!1,this.isreleased=!0,this.pressed_time=0}focusLost(){this.keyReleased()}pickInput(t){if(!(t instanceof IDSwitch))throw"IllegalArgumentException";t.ispressed=this.ispressed,t.istyped=this.istyped,t.isreleased=this.isreleased,t.pressed_time=this.pressed_time,this.isreleased=!1,this.istyped=!1}}class IDPosition{constructor(t,e){this._initIDPosition(t,e)}_initIDPosition(t,e){if(t instanceof IDPosition){const e=t;this.set(e)}else void 0===t?(this.x=0,this.y=0):2===arguments.length?this.set(t,e):(this.x=0,this.y=0)}clone(){return new IDPosition(this)}set(t,e){if(t instanceof IDPosition){const e=t;this.x=e.x,this.y=e.y}else this.x=t,this.y=e}add(t,e){if(t instanceof IDPosition){const e=t;this.x+=e.x,this.y+=e.y}else this.x+=t,this.y+=e}sub(t,e){if(t instanceof IDPosition){const e=t;this.x-=e.x,this.y-=e.y}else this.x-=t,this.y-=e}static norm(t,e){const n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}}class IDDraggableSwitch{constructor(t){this._initIDDraggableSwitch(t)}_initIDDraggableSwitch(t){this.mask=t,this.switch=new IDSwitch,this.client=new IDPosition,this.deltaBase=new IDPosition,this.dragged=new IDPosition}clone(){const t=new IDDraggableSwitch;return t.mask=this.mask,t.switch=this.switch.clone(),t.client=this.client.clone(),t.deltaBase=this.deltaBase.clone(),t.dragged=this.dragged.clone(),t}correctionForDOM(t){let e=t.target;return e||(e=t.currentTarget),void 0===e?new IDPosition(t.clientX,t.clientY):new IDPosition(t.clientX/e.clientWidth*e.width,t.clientY/e.clientHeight*e.height)}setPosition(t){const e=this.correctionForDOM(t);this.client.set(e),this.deltaBase.set(e),this.dragged._initIDPosition()}mousePressed(t){const e=this.correctionForDOM(t);t.button===this.mask&&(this.switch.ispressed||this.dragged._initIDPosition(),this.switch.keyPressed(),this.client.set(e),this.deltaBase.set(e))}mouseReleased(t){t.button===this.mask&&this.switch.ispressed&&this.switch.keyReleased()}mouseMoved(t){const e=this.correctionForDOM(t);if(this.switch.ispressed){const t=new IDPosition(e);t.sub(this.deltaBase),this.dragged.add(t)}this.client.set(e.x,e.y),this.deltaBase.set(e.x,e.y)}focusLost(){this.switch.focusLost()}pickInput(t){if(!(t instanceof IDDraggableSwitch))throw"IllegalArgumentException";this.switch.pickInput(t.switch),t.client.set(this.client),t.dragged.set(this.dragged),this.dragged._initIDPosition()}}class IDMouse{constructor(){this._initIDMouse()}_initIDMouse(){this.left=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON1_MASK),this.center=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON2_MASK),this.right=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON3_MASK),this.position=new IDPosition,this.wheelrotation=0}clone(){const t=new IDMouse;return t.left=this.left.clone(),t.center=this.center.clone(),t.right=this.right.clone(),t.position=this.position.clone(),t.wheelrotation=this.wheelrotation,t}mousePressed(t){this.left.mousePressed(t),this.center.mousePressed(t),this.right.mousePressed(t)}mouseReleased(t){this.left.mouseReleased(t),this.center.mouseReleased(t),this.right.mouseReleased(t)}mouseMoved(t){this.left.mouseMoved(t),this.center.mouseMoved(t),this.right.mouseMoved(t),this.position.x=this.left.client.x,this.position.y=this.left.client.y}mouseWheelMoved(t){0!==t.wheelDelta&&(this.wheelrotation+=t.deltaY>0?-1:1)}focusLost(){this.left.focusLost(),this.center.focusLost(),this.right.focusLost()}pickInput(t){if(!(t instanceof IDMouse))throw"IllegalArgumentException";this.left.pickInput(t.left),this.center.pickInput(t.center),this.right.pickInput(t.right),t.position.set(this.position),t.wheelrotation=this.wheelrotation,this.wheelrotation=0}setListenerOnElement(t){const e=this,n=function(t){e.mousePressed(t)},i=function(t){e.mouseReleased(t)},s=function(t){e.mouseMoved(t)},o=function(){e.focusLost()},r=function(t){e.mouseWheelMoved(t),t.preventDefault()},h=function(t){t.preventDefault()};t.style.cursor="crosshair",t.style.mozUserSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.webkitTouchCallout="none",t.style.webkitTapHighlightColor="rgba(0,0,0,0)",t.addEventListener("mousedown",n,!1),t.addEventListener("mouseup",i,!1),t.addEventListener("mousemove",s,!1),t.addEventListener("mouseout",o,!1),t.addEventListener("wheel",r,!1),t.addEventListener("contextmenu",h,!1)}}IDMouse.MOUSE_EVENTS={BUTTON1_MASK:0,BUTTON2_MASK:1,BUTTON3_MASK:2};class IDTouch extends IDMouse{constructor(){super(),this._initIDTouch()}_initIDTouch(){this.touchcount_to_mask={1:IDMouse.MOUSE_EVENTS.BUTTON1_MASK,2:IDMouse.MOUSE_EVENTS.BUTTON3_MASK,3:IDMouse.MOUSE_EVENTS.BUTTON2_MASK};const t=this;this._mousePressed=function(e){t.mousePressed(e)},this._mouseReleased=function(e){t.mouseReleased(e)},this._mouseMoved=function(e){t.mouseMoved(e)},this.isdoubletouch=!1}_initPosition(t){this.left.setPosition(t),this.right.setPosition(t),this.center.setPosition(t)}_MultiTouchToMouse(t){let e=0,n=0;for(let i=0;i<t.touches.length;i++)e+=t.touches[i].clientX,n+=t.touches[i].clientY;const i={};if(t.touches.length>0){i.clientX=e/t.touches.length,i.clientY=n/t.touches.length,i.button=this.touchcount_to_mask[t.touches.length];const s=t.touches[0];i.target=s.target?s.target:s.currentTarget}else i.clientX=0,i.clientY=0,i.button=0;return i.touchcount=t.touches.length,i}_MoveMultiTouch(t){if(2===t.touches.length){const e=t.touches[0],n=t.touches[1];if(!1===this.isdoubletouch)this.isdoubletouch=!0,this.doubleposition=[],this.doubleposition[0]=new IDPosition(e.clientX,e.clientY),this.doubleposition[1]=new IDPosition(n.clientX,n.clientY);else{const t=new IDPosition(e.clientX,e.clientY),i=new IDPosition(n.clientX,n.clientY),s=IDPosition.norm(this.doubleposition[0],this.doubleposition[1])-IDPosition.norm(t,i);this.doubleposition[0]=t,this.doubleposition[1]=i;const o=Math.abs(s)<10?.01*Math.abs(s):.5;this.wheelrotation+=(s>0?-1:1)*o}}else this.isdoubletouch}_actFuncMask(t,e,n,i){for(const s in IDMouse.MOUSE_EVENTS)t.button=IDMouse.MOUSE_EVENTS[s],IDMouse.MOUSE_EVENTS[s]===i?e(t):n(t)}touchStart(t){const e=this._MultiTouchToMouse(t);this._initPosition(e),this._actFuncMask(e,this._mousePressed,this._mouseReleased,e.button)}touchEnd(t){const e=this._MultiTouchToMouse(t);this._actFuncMask(e,this._mouseReleased,this._mouseReleased,e.button)}touchMove(t){this._MoveMultiTouch(t);const e=this._MultiTouchToMouse(t);this._actFuncMask(e,this._mouseMoved,this._mouseMoved,e.button)}setListenerOnElement(t){super.setListenerOnElement(t);const e=this,n=function(t){e.touchStart(t)},i=function(t){e.touchEnd(t)},s=function(t){e.touchMove(t),t.preventDefault()};t.addEventListener("touchstart",n,!1),t.addEventListener("touchend",i,!1),t.addEventListener("touchmove",s,!1),t.addEventListener("touchcancel",i,!1)}}const IDTools={noScroll:function(){const t=function(){document.body.style.height="100%",document.body.style.overflow="hidden",document.documentElement.height="100%",document.documentElement.overflow="hidden"};window.addEventListener("load",t,!1)}},Device={DraggableSwitch:IDDraggableSwitch,Mouse:IDMouse,Position:IDPosition,Switch:IDSwitch,Touch:IDTouch,Tools:IDTools},BlendFunctions={ipLerp:function(t,e,n){const i=e.subColor(t);return t.addColor(i.mul(n))},brendNone:function(t,e,n){return e},brendAlpha:function(t,e,n){const i=t.getBlendAlpha(),s=e.getBlendAlpha()*n;return(t=BlendFunctions.ipLerp(t,e,s)).setBlendAlpha(Math.max(i,s))},brendAdd:function(t,e,n){const i=t.getBlendAlpha(),s=e.getBlendAlpha()*n;return(t=t.addColor(e.mul(s))).setBlendAlpha(Math.max(i,s))},brendSub:function(t,e,n){const i=t.getBlendAlpha(),s=e.getBlendAlpha()*n;return(t=t.subColor(e.mul(s))).setBlendAlpha(i)},brendRevSub:function(t,e,n){const i=e.getBlendAlpha(),s=t.getBlendAlpha()*n;return(e=e.subColor(t.mul(s))).setBlendAlpha(i)},brendMul:function(t,e,n){const i=t.getBlendAlpha(),s=e.getBlendAlpha()*n;return(t=t.mulColor(e.mul(s).div(255))).setBlendAlpha(i)}};class ImgBlend{constructor(t){this.blendfunc=BlendFunctions.brendNone,1===arguments.length&&this.setBlendMode(t)}clone(){return new ImgBlend(this.blendmode)}setBlendMode(t){this.blendmode=t,t===ImgBlend.MODE.NONE?this.blendfunc=BlendFunctions.brendNone:t===ImgBlend.MODE.ALPHA?this.blendfunc=BlendFunctions.brendAlpha:t===ImgBlend.MODE.ADD?this.blendfunc=BlendFunctions.brendAdd:t===ImgBlend.MODE.SUB?this.blendfunc=BlendFunctions.brendSub:t===ImgBlend.MODE.REVSUB?this.blendfunc=BlendFunctions.brendRevSub:t===ImgBlend.MODE.MUL&&(this.blendfunc=BlendFunctions.brendMul)}blend(t,e,n){return this.blendfunc(t,e,n)}}ImgBlend.MODE={NONE:"NONE",ALPHA:"ALPHA",ADD:"ADD",SUB:"SUB",REVSUB:"REVSUB",MUL:"MUL"};class ImgColor{constructor(){}getColor(){return null}clone(){return null}zero(){return null}one(){return null}add(){return null}sub(){return null}mul(){return null}div(){return null}exp(){return null}log(){return null}pow(){return null}baselog(){return null}table(){return null}random(){return null}luminance(){return null}addColor(){return null}subColor(){return null}mulColor(){return null}divColor(){return null}maxColor(){return null}minColor(){return null}norm(){return null}normFast(){return null}normColor(t,e){return this.subColor(t).norm(e)}normColorFast(t,e){return this.subColor(t).normFast(e)}getBlendAlpha(){return null}setBlendAlpha(){return null}exchangeColorAlpha(){return null}equals(){return!1}searchColor(t,e){let n=0,i=2147483647,s=null,o=2147483646,r=null;for(let h=0;h<t.length;h++)(n=this.normColorFast(t[h],e))<o&&(n<i?(o=i,r=s,i=n,s=t[h]):(o=n,r=t[h]));return{c1:{color:s,norm:i},c2:{color:r,norm:o}}}}ImgColor.NORM_MODE={MANHATTEN:0,EUGRID:1};class ImgWrapInside{constructor(t,e){2===arguments.length?this.setSize(t,e):this.setSize(0,0)}clone(){return new ImgWrapInside(this.width,this.height)}setSize(t,e){this.width=t,this.height=e}getPixelPosition(t,e){return t=~~Math.floor(t),e=~~Math.floor(e),t>=0&&e>=0&&t<this.width&&e<this.height?[t,e]:null}}class ImgWrapClamp extends ImgWrapInside{constructor(t,e){super(t,e)}clone(){return new ImgWrapClamp(this.width,this.height)}getPixelPosition(t,e){return t=~~Math.floor(t),e=~~Math.floor(e),t>=0&&e>=0&&t<this.width&&e<this.height?[t,e]:(t=~~Math.floor(Math.min(Math.max(0,t),this.width-1)),e=~~Math.floor(Math.min(Math.max(0,e),this.height-1)),[t,e])}}class ImgWrapRepeat extends ImgWrapInside{constructor(t,e){super(t,e)}clone(){return new ImgWrapRepeat(this.width,this.height)}getPixelPosition(t,e){if(t=~~Math.floor(t),e=~~Math.floor(e),t>=0&&e>=0&&t<this.width&&e<this.height)return[t,e];const n=Math.floor(t/this.width),i=Math.floor(e/this.height);return t-=Math.floor(this.width*n),e-=Math.floor(this.height*i),t<0&&(t+=this.width),e<0&&(e+=this.height),[t,e]}}class ImgWrap{constructor(t,e,n){this.width=1,this.height=1,arguments.length>=2&&(this.width=e,this.height=n),3==arguments.length?this.setImgWrapMode(t):this.setImgWrapMode(ImgWrap.MODE.INSIDE)}clone(){return new ImgWrap(this.wrapmode,this.width,this.height)}setImgWrapMode(t){this.wrapmode=t,t===ImgWrap.MODE.INSIDE?this.wrap=new ImgWrapInside(this.width,this.height):t===ImgWrap.MODE.CLAMP?this.wrap=new ImgWrapClamp(this.width,this.height):t===ImgWrap.MODE.REPEAT&&(this.wrap=new ImgWrapRepeat(this.width,this.height))}setSize(t,e){this.width=t,this.height=e,this.wrap&&this.wrap.setSize(t,e)}getPixelPosition(t,e){return this.wrap.getPixelPosition(t,e)}}ImgWrap.MODE={INSIDE:"INSIDE",CLAMP:"CLAMP",REPEAT:"REPEAT"};const InterpolationFunctions={ipLerp:function(t,e,n){const i=e.subColor(t);return t.addColor(i.mul(n))},ipCosine:function(t,e,n){return InterpolationFunctions.ipLerp(t,e,.5*(1-Math.cos(Math.PI*n)))},ipHermite2p3:function(t,e,n){return InterpolationFunctions.ipLerp(t,e,n*n*(3-2*n))},ipHermite2p5:function(t,e,n){return InterpolationFunctions.ipLerp(t,e,n*n*n*(6*n*n-15*n+10))},ipHermite4p:function(t,e,n,i,s){const o=i.subColor(n).subColor(t.subColor(e)),r=t.subColor(e).subColor(o),h=n.subColor(t),a=e;return o.mul(s*s*s).addColor(r.mul(s*s)).addColor(h.mul(s)).addColor(a)},funcInBicubic:function(t,e){return t<=1?1-(e+3)*t*t+(e+2)*t*t*t:-4*e+8*e*t-5*e*t*t+e*t*t*t},ipBicubic:function(t,e,n,i,s,o){const r=InterpolationFunctions.funcInBicubic(s+1,o),h=InterpolationFunctions.funcInBicubic(s,o),a=InterpolationFunctions.funcInBicubic(1-s,o),l=InterpolationFunctions.funcInBicubic(2-s,o);return t.mul(r).addColor(e.mul(h)).addColor(n.mul(a)).addColor(i.mul(l)).mul(1/(r+h+a+l))},ipBicubicSoft:function(t,e,n,i,s){return InterpolationFunctions.ipBicubic(t,e,n,i,s,-.5)},ipBicubicNormal:function(t,e,n,i,s){return InterpolationFunctions.ipBicubic(t,e,n,i,s,-1)},ipBicubicSharp:function(t,e,n,i,s){return InterpolationFunctions.ipBicubic(t,e,n,i,s,-1.2)},ipBicubic2D:function(t,e,n,i){let s,o,r,h,a=t[0][0].zero(),l=0;for(o=0;o<4;o++)for(r=InterpolationFunctions.funcInBicubic(Math.abs(-n+o-1),i),s=0;s<4;s++)h=InterpolationFunctions.funcInBicubic(Math.abs(-e+s-1),i),l+=h*=r,a=a.addColor(t[o][s].mul(h));return a=a.mul(1/l)},ipBicubic2DSoft:function(t,e,n){return InterpolationFunctions.ipBicubic2D(t,e,n,-.5)},ipBicubic2DNormal:function(t,e,n){return InterpolationFunctions.ipBicubic2D(t,e,n,-1)},ipBicubic2DSharp:function(t,e,n){return InterpolationFunctions.ipBicubic2D(t,e,n,-1.2)}};class ImgInterpolation{constructor(t){0===arguments.length&&(t=ImgInterpolation.MODE.NEAREST_NEIGHBOR),this.setInterpolationMode(t)}clone(){return new ImgInterpolation(this.ipmode)}setInterpolationMode(t){this.ipmode=t,t===ImgInterpolation.MODE.NEAREST_NEIGHBOR?(this.ipfunc=InterpolationFunctions.ipLerp,this.ipn=1):t===ImgInterpolation.MODE.BILINEAR?(this.ipfunc=InterpolationFunctions.ipLerp,this.ipn=2):t===ImgInterpolation.MODE.COSINE?(this.ipfunc=InterpolationFunctions.ipCosine,this.ipn=2):t===ImgInterpolation.MODE.HERMITE4_3?(this.ipfunc=InterpolationFunctions.ipHermite2p3,this.ipn=2):t===ImgInterpolation.MODE.HERMITE4_5?(this.ipfunc=InterpolationFunctions.ipHermite2p5,this.ipn=2):t===ImgInterpolation.MODE.HERMITE16?(this.ipfunc=InterpolationFunctions.ipHermite4p,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC?(this.ipfunc=InterpolationFunctions.ipBicubic2DNormal,this.ipn=16):t===ImgInterpolation.MODE.BICUBIC_SOFT?(this.ipfunc=InterpolationFunctions.ipBicubicSoft,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC_NORMAL?(this.ipfunc=InterpolationFunctions.ipBicubicNormal,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC_SHARP&&(this.ipfunc=InterpolationFunctions.ipBicubicSharp,this.ipn=4)}getColor(t,e,n){const i=Math.floor(e),s=Math.floor(n);if(1===this.ipn||i===e&&s===n)return t.getPixel(i,s);if(2===this.ipn){const o=e-i,r=n-s;let h,a;h=t.getPixel(i,s),a=t.getPixel(i+1,s);const l=this.ipfunc(h,a,o);h=t.getPixel(i,s+1),a=t.getPixel(i+1,s+1);const u=this.ipfunc(h,a,o);return this.ipfunc(l,u,r)}if(4===this.ipn){const o=e-i,r=n-s;let h,a,l,u;h=t.getPixel(i-1,s-1),a=t.getPixel(i,s-1),l=t.getPixel(i+1,s-1),u=t.getPixel(i+2,s-1);const c=this.ipfunc(h,a,l,u,o);h=t.getPixel(i-1,s),a=t.getPixel(i,s),l=t.getPixel(i+1,s),u=t.getPixel(i+2,s);const m=this.ipfunc(h,a,l,u,o);h=t.getPixel(i-1,s+1),a=t.getPixel(i,s+1),l=t.getPixel(i+1,s+1),u=t.getPixel(i+2,s+1);const g=this.ipfunc(h,a,l,u,o);h=t.getPixel(i-1,s+2),a=t.getPixel(i,s+2),l=t.getPixel(i+1,s+2),u=t.getPixel(i+2,s+2);const f=this.ipfunc(h,a,l,u,o);return this.ipfunc(c,m,g,f,r)}if(16===this.ipn){const o=e-i,r=n-s;let h,a;const l=[];for(a=-1;a<3;a++){const e=[];for(h=-1;h<3;h++)e[e.length]=t.getPixel(i+h,s+a);l[l.length]=e}return this.ipfunc(l,o,r)}return null}}ImgInterpolation.MODE={NEAREST_NEIGHBOR:"NEAREST_NEIGHBOR",BILINEAR:"BILINEAR",COSINE:"COSINE",HERMITE4_3:"HERMITE4_3",HERMITE4_5:"HERMITE4_5",HERMITE16:"HERMITE16",BICUBIC:"BICUBIC",BICUBIC_SOFT:"BICUBIC_SOFT",BICUBIC_NORMAL:"BICUBIC_NORMAL",BICUBIC_SHARP:"BICUBIC_SHARP"};class ImgFIRMatrix{constructor(t){this.height=t.length,this.width=t[0].length,this.matrix=[];let e;for(e=0;e<t.length;e++)this.matrix[e]=t[e].slice()}clone(){return new ImgFIRMatrix(this.matrix)}rotateEdge(t){const e=this.clone(),n=[],i=[];let s,o;for(s=0;s<this.width-1;s++)n.push(e.matrix[0][s]);for(s=0;s<this.height-1;s++)n.push(e.matrix[s][this.width-1]);for(s=this.width-1;s>0;s--)n.push(e.matrix[this.height-1][s]);for(s=this.height-1;s>0;s--)n.push(e.matrix[s][0]);for(s=0;s<n.length;s++)i[s]=n[((s+t)%n.length+n.length)%n.length];for(e.matrix[0]=i.slice(0,this.width),s=0;s<this.height;s++)e.matrix[s][this.width-1]=i[this.width+s];for(e.matrix[this.height-1]=i.slice(this.width+this.height-2,this.width+this.height-2+this.width).reverse(),s=this.height-1,o=0;s>0;s--,o++)e.matrix[s][0]=i[this.width+this.height+this.width-3+o];return e}mul(t){const e=this.clone();let n,i;for(i=0;i<e.height;i++)for(n=0;n<e.width;n++)e.matrix[i][n]*=t;return e}sum(){let t,e,n=0;for(e=0;e<this.height;e++)for(t=0;t<this.width;t++)n+=this.matrix[e][t];return n}normalize(){return this.clone().mul(1/this.sum())}addCenter(t){const e=this.clone();return e.matrix[e.height>>1][e.width>>1]+=t,e}static makeLaplacianFilter(){return new ImgFIRMatrix([[0,-1,0],[-1,4,-1],[0,-1,0]])}static makeSharpenFilter(t){return ImgFIRMatrix.makeLaplacianFilter().mul(t).addCenter(1)}static makeBlur(t,e){const n=[],i=1/(t*e);let s,o;for(o=0;o<e;o++)for(n[o]=[],s=0;s<t;s++)n[o][s]=i;return new ImgFIRMatrix(n)}static makeGaussianFilter(t,e,n){void 0===n&&(n=1);const i=[];let s,o,r;const h=[],a=Math.max(t,e);let l=-Math.floor(a/2);for(s=0;s<a;s++,l++)h[s]=Math.exp(-l*l/(n*n*2));for(r=0;r<e;r++)for(i[r]=[],o=0;o<t;o++)i[r][o]=h[o]*h[r];return new ImgFIRMatrix(i).normalize()}static makeCircle(t){const e=[],n=.5*t,i=t>>1;let s,o;for(o=0;o<t;o++)for(e[o]=[],s=0;s<t;s++)Math.sqrt((i-s)*(i-s)+(i-o)*(i-o))<n?e[o][s]=1:e[o][s]=0;return new ImgFIRMatrix(e).normalize()}}class ImgData{constructor(){if(this.width=1,this.height=1,this.globalAlpha=1,this.data=null,this.blend=new ImgBlend(ImgBlend.MODE.NONE),this.wrap=new ImgWrap(ImgWrap.MODE.INSIDE,this.width,this.height),this.ip=new ImgInterpolation(ImgInterpolation.MODE.NEAREST_NEIGHBOR),1===arguments.length){const t=arguments[0];this.putImageData(t)}else if(2===arguments.length){const t=arguments[0],e=arguments[1];this.setSize(t,e)}}putImageData(t){}setSize(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.wrap.setSize(t,e))}_copyData(t){t.blend=this.blend.clone(),t.wrap=this.wrap.clone(),t.ip=this.ip.clone(),t.setSize(this.width,this.height),t.data.set(this.data),t.globalAlpha=this.globalAlpha}clone(){const t=new ImgData;return this._copyData(t),t}setWrapMode(t){this.wrap.setImgWrapMode(t)}getWrapMode(){return this.wrap.wrapmode}setInterpolationMode(t){this.ip.setInterpolationMode(t)}getInterpolationMode(){return this.ip.ipmode}setBlendType(t){this.blend.setBlendMode(t)}getBlendType(){return this.blend.blendmode}clear(){this.data&&this.data.fill(0)}getPixelInside(t,e){return null}setPixelInside(t,e,n){}getPixel(t,e){const n=this.wrap.getPixelPosition(t,e);return n?this.getPixelInside(n[0],n[1]):this.getPixelInside(0,0).zero()}setPixel(t,e,n){const i=this.wrap.getPixelPosition(t,e);if(i)if(this._blendtype===ImgData.MODE_BLEND.NONE)this.setPixelInside(i[0],i[1],n);else{const t=this.getPixelInside(i[0],i[1]),e=this.blend.blend(t,n,this.globalAlpha);this.setPixelInside(i[0],i[1],e)}}getColor(t,e){return this.ip.getColor(this,t,e)}getColorUV(t,e){return this.getColor(t*this.width,e*this.height)}setColor(t,e,n){this.setPixel(Math.floor(t),Math.floor(e),n)}drawImgData(t,e,n,i,s,o,r,h,a){if(!(t instanceof ImgData))throw"IllegalArgumentException";if(3===arguments.length)o=e,r=n,h=t.width,a=t.height,e=0,n=0,i=t.width,s=t.height;else if(5===arguments.length)o=e,r=n,h=i,a=s,e=0,n=0,i=t.width,s=t.height;else if(9!==arguments.length)throw"IllegalArgumentException";const l=i/h,u=s/a;let c,m,g,f;for(m=n,f=r;f<r+a;f++){for(c=e,g=o;g<o+h;g++){const e=t.getColor(c,m);e&&this.setColor(g,f,e),c+=l}m+=u}}forEach(t){let e=0,n=0;for(;n<this.height;n++)for(e=0;e<this.width;e++)t(this.getPixelInside(e,n),e,n,this)}convolution(t){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";let e,n,i,s,o,r;const h=-(t.width>>1),a=-(t.height>>1),l=t.matrix,u=this.getPixelInside(0,0).zero(),c=this.clone();for(n=0;n<this.height;n++)for(e=0;e<this.width;e++){let m=u;for(s=n+a,r=0;r<t.height;r++,s++)for(i=e+h,o=0;o<t.width;o++,i++){const t=c.getPixel(i,s);t&&(m=m.addColor(t.mul(l[r][o])))}this.setPixelInside(e,n,m)}}convolutionBilateral(t,e){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";void 0===e&&(e=.8);let n,i,s,o,r,h;const a=-(t.width>>1),l=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),m=this.clone(),g=.01*-(1-e)-.001,f=[];for(n=0;n<768;n++)f[n]=Math.exp(n*n*g);for(i=0;i<this.height;i++)for(n=0;n<this.width;n++){const e=m.getPixel(n,i),g=e.getBlendAlpha();let d=0,p=c;const S=[];for(o=i+l,h=0;h<t.height;h++,o++)for(s=n+a,S[h]=[],r=0;r<t.width;r++,s++){const t=m.getPixel(s,o);if(t){const n=f[Math.floor(t.normColor(e,ImgColor.NORM_MODE.EUGRID))]*u[h][r];p=p.addColor(t.mul(n)),d+=n}}p=p.div(d).setBlendAlpha(g),this.setPixelInside(n,i,p)}}convolutionExp(t,e){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";void 0===e&&(e=1.2);let n,i,s,o,r,h;const a=-(t.width>>1),l=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),m=this.clone(),g=[];for(n=0;n<256;n++)g[n]=Math.pow(e,n);for(i=0;i<this.height;i++)for(n=0;n<this.width;n++){let f=c;for(o=i+l,h=0;h<t.height;h++,o++)for(s=n+a,r=0;r<t.width;r++,s++){const t=m.getPixel(s,o);t&&(f=f.addColor(t.table(g).mul(u[h][r])))}this.setPixelInside(n,i,f.baselog(e))}}convolutionUnSharp(t,e){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";let n,i,s,o,r,h;const a=-(t.width>>1),l=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),m=this.clone();for(i=0;i<this.height;i++)for(n=0;n<this.width;n++){let g=c;for(o=i+l,h=0;h<t.height;h++,o++)for(s=n+a,r=0;r<t.width;r++,s++){const t=m.getPixel(s,o);t&&(g=g.addColor(t.mul(u[h][r])))}const f=m.getPixel(n,i),d=f.subColor(g).mul(e);this.setPixelInside(n,i,f.addColor(d))}}filterSharp(t){const e=ImgFIRMatrix.makeSharpenFilter(t);this.convolution(e)}filterBlur(t){let e;e=ImgFIRMatrix.makeBlur(t,1),this.convolution(e),e=ImgFIRMatrix.makeBlur(1,t),this.convolution(e)}filterGaussian(t){let e;e=ImgFIRMatrix.makeGaussianFilter(t,1),this.convolution(e),e=ImgFIRMatrix.makeGaussianFilter(1,t),this.convolution(e)}filterUnSharp(t,e){const n=ImgFIRMatrix.makeGaussianFilter(t,t);this.convolutionUnSharp(n,e)}filterBilateral(t,e){const n=ImgFIRMatrix.makeGaussianFilter(t,t);this.convolutionBilateral(n,e)}filterSoftLens(t,e){const n=ImgFIRMatrix.makeCircle(t);this.convolutionExp(n,e)}}ImgData.MODE_WRAP=ImgWrap.MODE,ImgData.MODE_IP=ImgInterpolation.MODE,ImgData.MODE_BLEND=ImgBlend.MODE;class ImgVector{constructor(t,e,n){this.x=t,this.y=e,this.z=n}cross(t){return new ImgVector(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}getDirection(t){return new ImgVector(t.x-this.x,t.y-this.y,t.z-this.z)}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z;return t=Math.sqrt(1/t),new ImgVector(this.x*t,this.y*t,this.z*t)}getNormalMapColor(){return new ImgColorRGBA([Math.round(127.5*(1+this.x)),Math.round(127.5*(1-this.y)),Math.round(127.5*(1+this.z)),255])}}class ImgColorRGBA extends ImgColor{constructor(t){super(),this.rgba=[t[0],t[1],t[2],t[3]]}getColor(){return this.rgba}clone(){return new ImgColorRGBA(this.rgba)}zero(){return new ImgColorRGBA([0,0,0,0])}one(){return new ImgColorRGBA([1,1,1,1])}add(t){return new ImgColorRGBA([this.rgba[0]+t,this.rgba[1]+t,this.rgba[2]+t,this.rgba[3]+t])}sub(t){return new ImgColorRGBA([this.rgba[0]-t,this.rgba[1]-t,this.rgba[2]-t,this.rgba[3]-t])}mul(t){return new ImgColorRGBA([this.rgba[0]*t,this.rgba[1]*t,this.rgba[2]*t,this.rgba[3]*t])}div(t){return new ImgColorRGBA([this.rgba[0]/t,this.rgba[1]/t,this.rgba[2]/t,this.rgba[3]/t])}exp(){return new ImgColorRGBA([Math.exp(this.rgba[0]),Math.exp(this.rgba[1]),Math.exp(this.rgba[2]),Math.exp(this.rgba[3])])}log(){return new ImgColorRGBA([Math.log(this.rgba[0]),Math.log(this.rgba[1]),Math.log(this.rgba[2]),Math.log(this.rgba[3])])}pow(t){return new ImgColorRGBA([Math.pow(t,this.rgba[0]),Math.pow(t,this.rgba[1]),Math.pow(t,this.rgba[2]),Math.pow(t,this.rgba[3])])}baselog(t){const e=1/Math.log(t);return new ImgColorRGBA([Math.log(this.rgba[0])*e,Math.log(this.rgba[1])*e,Math.log(this.rgba[2])*e,Math.log(this.rgba[3])*e])}table(t){return new ImgColorRGBA([t[Math.round(this.rgba[0])],t[Math.round(this.rgba[1])],t[Math.round(this.rgba[2])],t[Math.round(this.rgba[3])]])}random(){return new ImgColorRGBA([Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())])}luminance(){return.2126*this.rgba[0]+.7152*this.rgba[1]+.0722*this.rgba[2]}addColor(t){return new ImgColorRGBA([this.rgba[0]+t.rgba[0],this.rgba[1]+t.rgba[1],this.rgba[2]+t.rgba[2],this.rgba[3]+t.rgba[3]])}subColor(t){return new ImgColorRGBA([this.rgba[0]-t.rgba[0],this.rgba[1]-t.rgba[1],this.rgba[2]-t.rgba[2],this.rgba[3]-t.rgba[3]])}mulColor(t){return new ImgColorRGBA([this.rgba[0]*t.rgba[0],this.rgba[1]*t.rgba[1],this.rgba[2]*t.rgba[2],this.rgba[3]*t.rgba[3]])}divColor(t){return new ImgColorRGBA([this.rgba[0]/t.rgba[0],this.rgba[1]/t.rgba[1],this.rgba[2]/t.rgba[2],this.rgba[3]/t.rgba[3]])}maxColor(t){return new ImgColorRGBA([Math.max(t.rgba[0],this.rgba[0]),Math.max(t.rgba[1],this.rgba[1]),Math.max(t.rgba[2],this.rgba[2]),Math.max(t.rgba[3],this.rgba[3])])}minColor(t){return new ImgColorRGBA([Math.min(t.rgba[0],this.rgba[0]),Math.min(t.rgba[1],this.rgba[1]),Math.min(t.rgba[2],this.rgba[2]),Math.min(t.rgba[3],this.rgba[3])])}norm(t){return t===ImgColor.NORM_MODE.MANHATTEN?(Math.abs(this.rgba[0])+Math.abs(this.rgba[1])+Math.abs(this.rgba[2]))/3:t===ImgColor.NORM_MODE.EUGRID?Math.sqrt(this.rgba[0]*this.rgba[0]+this.rgba[1]*this.rgba[1]+this.rgba[2]*this.rgba[2])/3:void 0}normFast(t){return t===ImgColor.NORM_MODE.MANHATTEN?Math.abs(this.rgba[0])+Math.abs(this.rgba[1])+Math.abs(this.rgba[2]):t===ImgColor.NORM_MODE.EUGRID?this.rgba[0]*this.rgba[0]+this.rgba[1]*this.rgba[1]+this.rgba[2]*this.rgba[2]:void 0}getBlendAlpha(){return this.rgba[3]/255}setBlendAlpha(t){const e=this.clone();return e.rgba[3]=255*t,e}exchangeColorAlpha(t){return new ImgColorRGBA([this.rgba[0],this.rgba[1],this.rgba[2],t.rgba[3]])}getRRGGBB(){return this.rgba[0]<<16|this.rgba[1]<<8|255&this.rgba[2]}getRed(){return this.rgba[0]}getGreen(){return this.rgba[1]}getBlue(){return this.rgba[2]}equals(t){return this.rgba[0]===t.rgba[0]&&this.rgba[1]===t.rgba[1]&&this.rgba[2]===t.rgba[2]&&this.rgba[3]===t.rgba[3]}toString(){return"color("+this.rgba[0]+","+this.rgba[1]+","+this.rgba[2]+","+this.rgba[3]+")"}mulMatrix(t){const e=new ImgColorRGBA;return e.rgba[0]=this.rgba[0]*t[0][0]+this.rgba[1]*t[0][1]+this.rgba[2]*t[0][2]+this.rgba[3]*t[0][3],e.rgba[1]=this.rgba[0]*t[1][0]+this.rgba[1]*t[1][1]+this.rgba[2]*t[1][2]+this.rgba[3]*t[1][3],e.rgba[2]=this.rgba[0]*t[2][0]+this.rgba[1]*t[2][1]+this.rgba[2]*t[2][2]+this.rgba[3]*t[2][3],e.rgba[3]=this.rgba[0]*t[3][0]+this.rgba[1]*t[3][1]+this.rgba[2]*t[3][2]+this.rgba[3]*t[3][3],e}getNormalVector(){return new ImgVector(this.rgba[0]/128-1,-this.rgba[1]/128+1,this.rgba[2]/128-1)}}class ImgColorY extends ImgColor{constructor(t){super(),this.y=t}getColor(){return this.y}clone(){return new ImgColorY(this.y)}zero(){return new ImgColorY(0)}one(){return new ImgColorY(1)}add(t){return new ImgColorY(this.y+t)}sub(t){return new ImgColorY(this.y-t)}mul(t){return new ImgColorY(this.y*t)}div(t){return new ImgColorY(this.y/t)}exp(){return new ImgColorY(Math.exp(this.y))}log(){return new ImgColorY(Math.log(this.y))}pow(t){return new ImgColorY(Math.pow(t,this.y))}baselog(t){return new ImgColorY(Math.log(this.y)/Math.log(t))}table(t){return new ImgColorY(t[Math.floor(this.y)])}random(){return new ImgColorY(256*Math.random())}luminance(){return this.y}addColor(t){return new ImgColorY(this.y+t.y)}subColor(t){return new ImgColorY(this.y-t.y)}mulColor(t){return new ImgColorY(this.y*t.y)}divColor(t){return new ImgColorY(this.y/t.y)}maxColor(t){return new ImgColorY(Math.max(t.y,this.y))}minColor(t){return new ImgColorY(Math.min(t.y,this.y))}norm(){return Math.abs(this.y)}normFast(){return Math.abs(this.y)}getBlendAlpha(){return 1}setBlendAlpha(){return this}exchangeColorAlpha(){return this}equals(t){return this.y===t.y}toString(){return"color("+this.y+")"}}class ImgDataY extends ImgData{constructor(){1===arguments.length?super(arguments[0]):2===arguments.length?super(arguments[0],arguments[1]):super()}clone(){const t=new ImgDataY(this.width,this.height);return this._copyData(t),t}setSize(t,e){super.setSize(t,e),this.data=new Float32Array(this.width*this.height)}getPixelInside(t,e){const n=e*this.width+t;return new ImgColorY(this.data[n])}setPixelInside(t,e,n){const i=e*this.width+t;this.data[i]=n.getColor()}putImageData(t,e){if(t instanceof ImageData||t instanceof ImgDataRGBA){this.setSize(t.width,t.height),void 0===e&&(e=0);let n=0;for(let i=0;i<this.data.length;i++)this.data[i]=t.data[n+e],n+=4}else{if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.setSize(t.width,t.height),this.data.set(t.data)}}putImageDataR(t){this.putImageData(t,0)}putImageDataG(t){this.putImageData(t,1)}putImageDataB(t){this.putImageData(t,2)}putImageDataA(t){this.putImageData(t,3)}getImageData(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height;const e=t.getContext("2d").getImageData(0,0,t.width,t.height);let n=0,i=0;for(;i<this.data.length;i++){const t=Math.floor(this.data[i]);e.data[n+0]=t,e.data[n+1]=t,e.data[n+2]=t,e.data[n+3]=255,n+=4}return e}getNormalMap(){if(this.getWrapMode()===ImgData.MODE_WRAP.INSIDE)throw"not inside";const t=new ImgDataRGBA(this.width,this.height);let e,n;for(n=0;n<this.height;n++)for(e=0;e<this.width;e++){const i=new ImgVector(e-1,n,this.getPixel(e-1,n).getColor()),s=new ImgVector(e+1,n,this.getPixel(e+1,n).getColor()),o=i.getDirection(s),r=new ImgVector(e,n-1,this.getPixel(e,n-1).getColor()),h=new ImgVector(e,n+1,this.getPixel(e,n+1).getColor()),a=r.getDirection(h),l=o.cross(a).normalize();t.setPixelInside(e,n,l.getNormalMapColor())}return t}filterEnvironmentMapping(t){}}class ImgDataRGBA extends ImgData{constructor(){1===arguments.length?super(arguments[0]):2===arguments.length?super(arguments[0],arguments[1]):super()}clone(){const t=new ImgDataRGBA(this.width,this.height);return this._copyData(t),t}setSize(t,e){super.setSize(t,e),this.data=new Uint8ClampedArray(this.width*this.height*4)}getPixelInside(t,e){const n=4*(e*this.width+t);return new ImgColorRGBA([this.data[n],this.data[n+1],this.data[n+2],this.data[n+3]])}setPixelInside(t,e,n){const i=4*(e*this.width+t);this.data[i]=n.getColor()[0],this.data[i+1]=n.getColor()[1],this.data[i+2]=n.getColor()[2],this.data[i+3]=n.getColor()[3]}putDataY(t,e){if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.setSize(t.width,t.height),void 0===e&&(e=0);let n=0,i=0;for(;i<t.data.length;i++)this.data[n+e]=Math.floor(t.data[i]),n+=4}putDataYToR(t){this.putDataS(t,0)}putDataYToG(t){this.putDataS(t,1)}putDataYToB(t){this.putDataS(t,2)}putDataYToA(t){this.putDataS(t,3)}putImageData(t){if(t instanceof ImageData||t instanceof ImgDataRGBA)this.setSize(t.width,t.height),this.data.set(t.data);else{if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.putImageData(t.getImageData())}}getImageData(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height;const e=t.getContext("2d").getImageData(0,0,t.width,t.height);return e.data.set(this.data),e}grayscale(){this.forEach(function(t,e,n,i){const s=~~t.luminance(),o=new ImgColorRGBA([s,s,s,t.rgba[3]]);i.setPixelInside(e,n,o)})}getColorCount(){const t=new Uint8ClampedArray(2097152);let e=0;return this.forEach(function(n){const i=n.getRRGGBB(),s=i>>3,o=i%7;0==(t[s]>>o&1)&&(e++,t[s]=255&(t[s]^1<<o))}),e}getPalletMedianCut(t){if(this.getColorCount()<=t)return null;let e,n,i,s;const o=new Uint32Array(2097152);let r=0;const h=function(t){return t.getRed()>>1<<14|t.getGreen()>>1<<7|t.getBlue()>>1},a=[],l=[[],[],[]],u=[[],[],[]];for(a[0]=this.width*this.height,e=0;e<3;e++)u[e][r]=0,l[e][r]=127;this.forEach(function(t){o[h(t)]++});let c,m,g,f,d,p,S;for(r++,S=1;r<t;){let t=0,h=0;for(e=0;e<S;e++){const n=(c=l[0][e]-u[0][e])*(m=l[1][e]-u[1][e])*(g=l[2][e]-u[2][e]);t<n&&(t=n,f=c,d=m,p=g,h=e)}let I=d,M=1;if(I<f&&(I=f,M=0),I<p&&(I=p,M=2),0===I)break;{const t=u[M][h]+(I>>1);for(t===l[M][h]?(u[M][S]=t,l[M][S]=l[M][h],l[M][h]=t-1):(u[M][S]=t+1,l[M][S]=l[M][h],l[M][h]=t),e=0;e<3;e++)e!==M&&(u[e][S]=u[e][h],l[e][S]=l[e][h])}for(a[S]=0,n=u[0][S];n<=l[0][S];n++)for(i=u[1][S];i<=l[1][S];i++)for(s=u[2][S];s<=l[2][S];s++)a[S]+=o[n<<14|i<<7|s];if(a[h]-=a[S],0===a[h])for(a[h]=a[S],e=0;e<3;e++)u[e][h]=u[e][S],l[e][h]=l[e][S];else 0===a[S]||(S++,r++)}const I=[];for(e=0;e<r;e++){let t=0,r=0,h=0;for(n=u[0][e];n<=l[0][e];n++)for(i=u[1][e];i<=l[1][e];i++)for(s=u[2][e];s<=l[2][e];s++){const e=o[n<<14|i<<7|s];t+=e*(n<<1),r+=e*(i<<1),h+=e*(s<<1)}n=Math.round(t/a[e]),i=Math.round(r/a[e]),s=Math.round(h/a[e]),n=n<0?0:n>255?255:n,i=i<0?0:i>255?255:i,s=s<0?0:s>255?255:s,I[e]=new ImgColorRGBA([n,i,s,255])}return I}getPallet(){const t=[],e=new Uint32Array(256);let n=0,i=0;return this.forEach(function(s){if(!(n>255)){const o=s.getRRGGBB();for(i=0;i<n;i++)if(e[i]===o)return;e[n]=o,t[n]=s,n++}}),t}getPalletGrayscale(t){const e=t<2?2:t>256?256:t,n=[],i=255/(e-1);let s,o=0;for(s=0;s<e;s++){let t=Math.round(o);t=t<0?0:t>255?255:t,n[s]=new ImgColorRGBA([t,t,t,255]),o+=i}return n}quantizationSimple(t){this.forEach(function(e,n,i,s){const o=e.searchColor(t,ImgColor.NORM_MODE.EUGRID);s.setPixelInside(n,i,o.c1.color.exchangeColorAlpha(e))})}quantizationOrdered(t,e,n){this.forEach(function(i,s,o,r){const h=i.searchColor(t,n),a=h.c1.color,l=h.c1.norm,u=h.c2.color,c=h.c2.norm;let m=l+c;m=0===m?1:m;const g=e.pattern[o%e.height][s%e.width];let f=null;f=a.luminance>u.luminance?g<=Math.floor(c*e.maxnumber/m)?a.exchangeColorAlpha(i):u.exchangeColorAlpha(i):g>=Math.floor(l*e.maxnumber/m)?a.exchangeColorAlpha(i):u.exchangeColorAlpha(i),r.setPixelInside(s,o,f)})}quantizationDiffusion(t,e){const n=this.width*this.height,i=new Int16Array(n),s=new Int16Array(n),o=new Int16Array(n);let r=0;this.forEach(function(t,e,n,h){r=n*h.width+e,i[r]=t.getRed(),s[r]=t.getGreen(),o[r]=t.getBlue()});const h=this.width-e.width+e.center;let a,l,u=0;for(l=0;l<e.height;l++)for(a=0;a<e.width;a++)u+=e.pattern[l][a];const c=[];for(l=0;l<e.height;l++)for(c[l]=[],a=0;a<e.width;a++)c[l][a]=e.pattern[l][a]/u;this.forEach(function(n,u,m,g){r=m*g.width+u;const f=new ImgColorRGBA([i[r],s[r],o[r],255]);let d=f.searchColor(t,ImgColor.NORM_MODE.EUGRID);if(d=d.c1.color,g.setPixelInside(u,m,d.exchangeColorAlpha(n)),!(u>h)){const t=f.subColor(d);for(l=0;l<e.height;l++)for(a=0===l?e.center:0;a<e.width;a++){const n=u+a-e.center,r=m+l;if(!(n<0||r>=g.height)){const e=r*g.width+n;i[e]+=t.getRed()*c[l][a],s[e]+=t.getGreen()*c[l][a],o[e]+=t.getBlue()*c[l][a]}}}})}filterQuantizationSimple(t){if(this.getColorCount()>t){const e=this.getPalletMedianCut(t);this.quantizationSimple(e)}}filterQuantizationOrdered(t,e){if(void 0===e&&(e=ImgColor.NORM_MODE.EUGRID),this.getColorCount()>t){const n=this.getPalletMedianCut(t);this.quantizationOrdered(n,ImgDataRGBA.quantization.orderPattern.patternBayer,e)}}filterQuantizationDiffusion(t,e){if(void 0===e&&(e=ImgDataRGBA.quantization.diffusionPattern.patternFloydSteinberg),this.getColorCount()>t){const n=this.getPalletMedianCut(t);this.quantizationDiffusion(n,e)}}}ImgDataRGBA.quantization={diffusionPattern:{patternFloydSteinberg:{width:3,height:2,center:1,pattern:[[0,0,7],[3,5,1]]},patternJarvisJudiceNinke:{width:5,height:3,center:2,pattern:[[0,0,0,7,5],[3,5,7,5,3],[1,3,5,3,1]]}},orderPattern:{patternBayer:{width:4,height:4,maxnumber:16,pattern:[[0,8,2,10],[12,4,14,6],[3,11,1,9],[15,7,13,5]]}}};const ImageProcessing={ImgDataRGBA:ImgDataRGBA,ImgColorRGBA:ImgColorRGBA,ImgDataY:ImgDataY,ImgColorY:ImgColorY,MODE_WRAP:ImgData.MODE_WRAP,MODE_IP:ImgData.MODE_IP,MODE_BLEND:ImgData.MODE_BLEND};class SBase{constructor(t,e){this.id="SComponent_"+(SBase._counter++).toString(16),this.wallid="SComponent_"+(SBase._counter++).toString(16),this.isshow=!1,this._element=null,this._wall=null,this.elementtype=t,this.unit=SBase.UNIT_TYPE.EM;const n=this,i={over:function(){SBase.node_tool.addClass(n.getElement(),SBase.CLASS_NAME.MOUSEOVER)},out:function(){SBase.node_tool.removeClass(n.getElement(),SBase.CLASS_NAME.MOUSEOVER),SBase.node_tool.removeClass(n.getElement(),SBase.CLASS_NAME.MOUSEDOWN)},down:function(){SBase.node_tool.addClass(n.getElement(),SBase.CLASS_NAME.MOUSEDOWN)},up:function(){SBase.node_tool.removeClass(n.getElement(),SBase.CLASS_NAME.MOUSEDOWN)}};this.tool={attachMouseEvent:function(t){t.addEventListener("touchstart",i.over,!1),t.addEventListener("touchend",i.up,!1),t.addEventListener("mouseover",i.over,!1),t.addEventListener("mouseout",i.out,!1),t.addEventListener("mousedown",i.down,!1),t.addEventListener("mouseup",i.up,!1)},removeNodeForId:function(t){const e=document.getElementById(t);return SBase.node_tool.removeNode(e),e},AputB:function(t,e,n){if(!(t&&e&&e instanceof SBase))throw"IllegalArgumentException";if(t===e)throw"it referenced me";if(n!==SBase.PUT_TYPE.IN&&n!==SBase.PUT_TYPE.RIGHT&&n!==SBase.PUT_TYPE.NEWLINE)throw"IllegalArgumentException";let i=null;if("string"==typeof t||t instanceof String)i=document.getElementById(t);else if(t instanceof SBase)if(n===SBase.PUT_TYPE.IN){if(!t.isContainer())throw"not Container";i=t.getContainerElement()}else i=t.getElement();if(null===i)throw"Not Found "+t;const s=function(t,e){e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)};if(e.removeMe(),n===SBase.PUT_TYPE.IN)e.onAdded(),null!==i.lastChild&&(e.getWall(SBase.PUT_TYPE.NEWLINE).style.display="block",i.appendChild(e.getWall())),e.getElement().style.display="inline-block",i.appendChild(e.getElement());else{if(null===i.parentNode)throw"not found element on the html";e.onAdded(),s(e.getWall(n),i),s(e.getElement(),e.getWall(n)),n===SBase.PUT_TYPE.RIGHT?(i.style.display="inline-block",e.getWall(n).style.display="inline-block",e.getElement().style.display="inline-block"):n===SBase.PUT_TYPE.NEWLINE&&(i.style.display="inline-block",e.getWall(n).style.display="block",e.getElement().style.display="inline-block")}}},this.setText(e)}getWidth(){let t=this.getElement().style.width;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getHeight(){let t=this.getElement().style.height;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getSize(){return{width:this.getWidth(),height:this.getHeight()}}setWidth(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.getElement().style.width=t.toString()+this.unit}setHeight(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.getElement().style.height=t.toString()+this.unit}setSize(t,e){this.setWidth(t),this.setHeight(e)}removeMe(){this.tool.removeNodeForId(this.id),this.tool.removeNodeForId(this.space_id)}onAdded(){}getWall(t){if(this._wall)return this._wall;const e=document.createElement("span");return e.id=this.wallid,t===SBase.PUT_TYPE.RIGHT?e.className=SBase.CLASS_NAME.SPACE:t===SBase.PUT_TYPE.NEWLINE&&(e.className=SBase.CLASS_NAME.NEWLINE),e.style.display="inline-block",this._wall=e,e}isContainer(){return null!==this.getContainerElement()}getContainerElement(){return null}getElement(){if(this._element)return this._element;const t=document.createElement(this.elementtype);return t.id=this.id,t.className=SBase.CLASS_NAME.COMPONENT,t.style.display="inline-block",this._element=t,this.tool.attachMouseEvent(t),t}put(t,e){this.tool.AputB(this,t,e)}putMe(t,e){this.tool.AputB(t,this,e)}isVisible(){return null===this.getElement().style.visibility||"hidden"!==this.getElement().style.visibility}setVisible(t){t?(this.getElement().style.visibility="visible",this.getWall().style.visibility="visible"):(this.getElement().style.visibility="hidden",this.getWall().style.visibility="hidden")}getTextNode(){const t=this.getElement().childNodes;let e=null,n=0;for(n=0;n<t.length;n++)if(t[n]instanceof Text){e=t[n];break}return e}getElementNode(){const t=this.getElement().children;let e=null,n=0;for(n=0;n<t.length;n++)if(!(t[n]instanceof Text)){e=t[n];break}return e}getEditableNodeForValue(){return null}getEditableNodeForNodeValue(){if(this.getEditableNodeForValue())return null;let t=this.getTextNode();if(null===t){const e=this.getElement();t=document.createTextNode(""),e.appendChild(t)}return t}setText(t){if(t){let e=null;return(e=this.getEditableNodeForValue())?void(e.value=t):(e=this.getEditableNodeForNodeValue(),e?void(e.nodeValue=t):void 0)}}getText(){let t=null,e=null;return(e=this.getEditableNodeForValue())&&(t=e.value),(e=this.getEditableNodeForNodeValue())&&(t=e.nodeValue.trim()),null===t?"":t}getEnabledElement(){return null}setEnabled(t){t?SBase.node_tool.removeClass(this.getElement(),SBase.CLASS_NAME.DISABLED):SBase.node_tool.addClass(this.getElement(),SBase.CLASS_NAME.DISABLED);const e=this.getEnabledElement();null!==e&&SBase.node_tool.setBooleanAttribute(e,"disabled",t)}isEnabled(){return!SBase.node_tool.isSetClass(this.getElement(),SBase.CLASS_NAME.DISABLED)}getId(){return this.id}getUnit(){return this.unit}setUnit(t){this.unit=t}addClass(t){return SBase.node_tool.addClass(this.getElement(),t)}toString(){return this._elementtype+"("+this.id+")"}}SBase.PUT_TYPE={IN:0,RIGHT:1,NEWLINE:2},SBase.UNIT_TYPE={PX:"px",EM:"em",PERCENT:"%"},SBase.LABEL_POSITION={LEFT:0,RIGHT:1},SBase.CLASS_NAME={MOUSEOVER:"SCOMPONENT_MouseOver",MOUSEDOWN:"SCOMPONENT_MouseDown",DISABLED:"SCOMPONENT_Disabled",COMPONENT:"SCOMPONENT_Component",NEWLINE:"SCOMPONENT_Newline",CLOSE:"SCOMPONENT_Close",OPEN:"SCOMPONENT_Open",SPACE:"SCOMPONENT_Space",CONTENTSBOX:"SCOMPONENT_ContentsBox",PANEL:"SCOMPONENT_Panel",PANEL_LEGEND:"SCOMPONENT_PanelLegend",SLIDEPANEL:"SCOMPONENT_SlidePanel",SLIDEPANEL_LEGEND:"SCOMPONENT_SlidePanelLegend",SLIDEPANEL_SLIDE:"SCOMPONENT_SlidePanelSlide",GROUPBOX:"SCOMPONENT_GroupBox",GROUPBOX_LEGEND:"SCOMPONENT_GroupBoxLegend",IMAGEPANEL:"SCOMPONENT_ImagePanel",LABEL:"SCOMPONENT_Label",SELECT:"SCOMPONENT_Select",COMBOBOX:"SCOMPONENT_ComboBox",CHECKBOX:"SCOMPONENT_CheckBox",CHECKBOX_IMAGE:"SCOMPONENT_CheckBoxImage",BUTTON:"SCOMPONENT_Button",FILELOAD:"SCOMPONENT_FileLoad",FILESAVE:"SCOMPONENT_FileSave",CANVAS:"SCOMPONENT_Canvas",PROGRESSBAR:"SCOMPONENT_ProgressBar",SLIDER:"SCOMPONENT_Slider",COLORPICKER:"SCOMPONENT_ColorPicker"},SBase._counter=0,SBase.node_tool={setBooleanAttribute:function(t,e,n){if("string"!=typeof e&&!(e instanceof String)||"boolean"!=typeof n)throw"IllegalArgumentException";const i=t.getAttribute(e);n||null!==i?n&&null!==i&&t.removeAttribute(e):t.setAttribute(e,e)},isBooleanAttribute:function(t,e){if("string"!=typeof e&&!(e instanceof String))throw"IllegalArgumentException";return null===t.getAttribute(e)},removeNode:function(t){return t&&t.parentNode&&t.parentNode.removeChild(t),t},removeChildNodes:function(t){let e=t.lastChild;for(;e;)t.removeChild(e),e=t.lastChild},isSetClass:function(t,e){const n=t.className;return null!==n&&new RegExp("(^"+e+"$)|( +"+e+")","g").test(n)},addClass:function(t,e){const n=t.className;if(null===n)return void(t.className=e);new RegExp("(^"+e+"$)|( +"+e+")","g").test(n)||(t.className=n+" "+e)},removeClass:function(t,e){const n=t.className;if(null!==n){const i=new RegExp("(^"+e+"$)|( +"+e+")","g");i.test(n)&&(t.className=n.replace(i,""))}}};class SButton extends SBase{constructor(t){super("input",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.getElement().type="button"}getEditableNodeForValue(){return this.getElement()}getEnabledElement(){return this.getElement()}addListener(t){this.getElement().addEventListener("click",t,!1)}}class SCanvas extends SBase{constructor(){super("canvas"),this.addClass(SBase.CLASS_NAME.CANVAS),this.canvas=super.getElement(),this.glmode=!1,this.setPixelSize(300,150)}getPixelSize(){return{width:this.canvas.width,height:this.canvas.height}}getCanvas(){return this.canvas}setPixelSize(t,e){if(2!==arguments.length||"number"!=typeof t||"number"!=typeof e||t<0||e<0)throw"IllegalArgumentException";t=~~Math.floor(t),e=~~Math.floor(e),this.canvas.width=t,this.canvas.height=e}getContext(){return void 0===this.context&&(this.context=this.canvas.getContext("2d"),null===this.context&&(this.glmode=!0,this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),this.context=this.gl)),this.context}clear(){this.glmode?this.getContext().clear(this.gl.COLOR_BUFFER_BIT):this.getContext().clearRect(0,0,this.canvas.width,this.canvas.height)}getImageData(){if(!this.glmode)return this.getContext().getImageData(0,0,this.canvas.width,this.canvas.height)}putImageData(t){this.glmode||this.getContext().putImageData(t,0,0)}_putImage(t,e,n){const i=this.canvas;let s=0,o=0,r=i.width,h=i.height;SCanvas.drawtype.ORIGINAL===n?(r=t.width,h=t.height):SCanvas.drawtype.STRETCH===n?(r=i.width,h=i.height):SCanvas.drawtype.FILL_ASPECT_RATIO===n?(r=i.width,h=i.height):(r=t.width,h=t.height,SCanvas.drawtype.ASPECT_RATIO===n&&(r>i.width&&(r=i.width,h=Math.floor(h*(r/t.width))),h>i.height&&(r=Math.floor(r*(i.height/h)),h=i.height)),SCanvas.drawtype.LETTER_BOX===n&&(r=i.width,(h=Math.floor(h*(r/t.width)))>i.height&&(r=Math.floor(r*(i.height/h)),h=i.height),s=Math.floor((i.width-r)/2),o=Math.floor((i.height-h)/2),e=!1)),e&&(this.setUnit(SBase.UNIT_TYPE.PX),this.setSize(r,h),this.setPixelSize(r,h)),this.clear(),t instanceof Image?this.context.drawImage(t,0,0,t.width,t.height,s,o,r,h):t instanceof ImageData&&this.context.putImageData(t,0,0,s,o,r,h)}putImage(t,e,n,i){if(e||(e=null),void 0===n&&(n=SCanvas.drawtype.LETTER_BOX),void 0===i&&(i=!1),t instanceof Image||t instanceof ImageData)this._putImage(t,i,n),"function"==typeof e&&e();else if("string"==typeof t){const s=this,o=new Image;o.onload=function(){s.putImage(o,i,n,e)},o.src=t}else if(t instanceof SCanvas)this.putImage(t.getElement(),i,n,e);else if(t instanceof Element&&"CANVAS"===t.tagName)this.putImage(t.toDataURL(),i,n,e);else{if(!(t instanceof Blob||t instanceof File))throw"IllegalArgumentException";{const s=this,o=new FileReader;o.onload=function(){s.putImage(o.result,i,n,e)},o.readAsDataURL(t)}}}toDataURL(t){return t||(t="image/png"),this.canvas.toDataURL(t)}}SCanvas.drawtype={ORIGINAL:0,ASPECT_RATIO:1,STRETCH:2,LETTER_BOX:3};class SCheckBox extends SBase{constructor(t){super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.CHECKBOX);const e=document.createElement("input");e.type="checkbox",e.id=this.getId()+"_checkbox",e.className=SBase.CLASS_NAME.CHECKBOX_IMAGE,this.checkbox=e,this.textnode=document.createTextNode(t||"");const n=this.getElement();n.appendChild(this.checkbox),n.appendChild(this.textnode)}getEnabledElement(){return this.checkbox}getTextNode(){return this.textnode}getElementNode(){return this.checkbox}setLabelPosition(t){const e=this.getElement(),n=this.getTextNode(),i=this.getElementNode();this.node_tool.removeChildNodes(e),t===SBase.LABEL_POSITION.LEFT?(e.appendChild(n),e.appendChild(i)):(e.appendChild(i),e.appendChild(n))}setCheckBoxImageSize(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.checkbox.style.height=t.toString()+this.unit,this.checkbox.style.width=t.toString()+this.unit}addListener(t){this.checkbox.addEventListener("change",t,!1)}setChecked(t){this.checkbox.checked=t}isChecked(){return this.checkbox.checked}}class SColorPicker extends SBase{constructor(){super("div"),this.addClass(SBase.CLASS_NAME.COLORPICKER);const t=this.getElement(),e=this,n={H:{div:document.createElement("div"),split:6,value:0,input:null,gauge:null,color_data:[],color_node:[],is_press:!1},S:{div:document.createElement("div"),split:1,value:.5,input:null,gauge:null,color_data:[],color_node:[],is_press:!1},L:{div:document.createElement("div"),split:2,value:.5,input:null,gauge:null,color_data:[],color_node:[],is_press:!1}};for(let t=0;t<=n.H.split;t++){const e=1/n.H.split*t;n.H.color_data.push(Color.newColorNormalizedHSL([e,1,.5]).getCSSHex())}const i=function(t){return function(i){if(i.length&&(i=i[0]),n[t].is_press){let s=i.target;s=s||i.currentTarget,n[t].value=i.offsetX/s.clientWidth,e.redraw()}}},s=function(t,e){return function(s){s.length&&(s=s[0]);let o=s.target;o=o||s.currentTarget,n[t].is_press=e,e&&i(t)(s)}},o=function(t){return function(i){let s=i.target;s=s||i.currentTarget,n[t].value=s.value/100,e.redraw()}},r=function(t,e){const o=document.createElement("div"),r=document.createElement("div"),h=document.createElement("div");t.style.position="relative",o.style.position="absolute",r.style.position="absolute",h.style.position="absolute",o.style.margin="0px",o.style.padding="0px",r.style.margin="0px",r.style.padding="0px",h.style.margin="0px",h.style.padding="0px",o.addEventListener("mousedown",s(e,!0),!1),o.addEventListener("mouseup",s(e,!1),!1),o.addEventListener("mouseout",s(e,!1),!1),o.addEventListener("mousemove",i(e),!1),o.addEventListener("touchstart",s(e,!0),!1),o.addEventListener("touchend",s(e,!1),!1),o.addEventListener("touchcancel",s(e,!1),!1),o.dataset.name=e,o.style.width="100%",o.style.height="100%",o.style.bottom="0px",r.style.width="33%",r.style.height="100%",r.style.bottom="0px",r.style.borderStyle="ridge",r.style.borderWidth="0px 2px 0px 0px",n[e].gauge=r;const a=n[e].split;h.style.width="100%",h.style.height="100%",h.style.overflow="hidden";for(let t=0;t<a;t++){const t=document.createElement("div");t.style.display="inline-block",t.style.margin="0px",t.style.padding="0px",t.style.height="100%",t.style.width=100/a+"%",t.style.background="linear-gradient(to right, #000, #FFF)",n[e].color_node.push(t),h.appendChild(t)}t.appendChild(h),t.appendChild(r),t.appendChild(o)};for(const t in n)!function(t){const e=document.createElement("span"),i=document.createElement("div"),s=document.createElement("input");e.style.display="inline-block",i.style.display="inline-block",s.style.display="inline-block",e.style.verticalAlign="top",i.style.verticalAlign="top",s.style.verticalAlign="top",e.style.height="100%",i.style.height="100%",s.style.height="100%",e.style.margin="0px",e.style.padding="0px",e.style.textAlign="center",i.style.margin="0px 0.5em 0px 0.5em",i.style.padding="0px",i.style.borderStyle="solid",i.style.borderWidth="1px",s.addEventListener("input",o(t),!1),s.type="number",s.style.margin="0px",s.style.padding="0px",s.style.borderStyle="none",s.min=0,s.max=100,s.step=1,n[t].input=s,e.style.width="1.5em",i.style.width="calc(100% - 6.0em)",s.style.width="3.5em",r(i,t);const h=n[t].div;h.style.height="1.2em",h.style.margin="0.5em 0px 0.5em 0px",e.appendChild(document.createTextNode(t)),h.appendChild(e),h.appendChild(i),h.appendChild(s)}(t);this.hls=n,this.listener=[],this.redraw(),t.appendChild(this.hls.H.div),t.appendChild(this.hls.S.div),t.appendChild(this.hls.L.div)}setColor(t){if(!(t instanceof Color))throw"ArithmeticException";const e=this.hls,n=t.getNormalizedHSL();e.H.value=n.h,e.S.value=n.s,e.L.value=n.l,this.redraw()}getColor(){const t=this.hls,e=t.H.value,n=t.S.value,i=t.L.value;return Color.newColorNormalizedHSL([e,n,i])}redraw(){const t=this.hls,e=t.H.value,n=t.S.value,i=t.L.value;t.S.color_data=[Color.newColorNormalizedHSL([e,0,i]).getCSSHex(),Color.newColorNormalizedHSL([e,1,i]).getCSSHex()],t.L.color_data=[Color.newColorNormalizedHSL([e,n,0]).getCSSHex(),Color.newColorNormalizedHSL([e,n,.5]).getCSSHex(),Color.newColorNormalizedHSL([e,n,1]).getCSSHex()];for(const e in t){const n=t[e].color_data,i=t[e].color_node;for(let t=0;t<i.length;t++)i[t].style.background="linear-gradient(to right, "+n[t]+", "+n[t+1]+")";const s=Math.round(100*t[e].value);t[e].gauge.style.width=s+"%",t[e].input.value=s}for(let t=0;t<this.listener.length;t++)this.listener[t]()}addListener(t){this.listener.push(t)}}class SComboBox extends SBase{constructor(t){super("select",t),this.addClass(SBase.CLASS_NAME.SELECT),this.addClass(SBase.CLASS_NAME.COMBOBOX)}getEnabledElement(){return this.getElement()}addListener(t){this.getElement().addEventListener("change",t,!1)}setText(t){if(t){const e=this.getElement();"string"==typeof t&&t instanceof String&&(t=[t]);let n=e.lastChild;for(;n;)e.removeChild(n),n=e.lastChild;let i=0;for(i=0;i<t.length;i++){const n=document.createElement("option");n.text=t[i].toString(),n.value=t[i].toString(),e.appendChild(n)}}}getText(){const t=this.getElement().children;let e=0;const n=[];for(e=0;e<t.length;e++)"OPTION"===t[e].tagName&&(n[n.length]=t[e].text);return n}setSelectedItem(t){const e=this.getElement().children;let n=0,i=0;for(n=0;n<e.length;n++)if("OPTION"===e[n].tagName){if(e[n].value===t.toString()){this.getElement().selectedIndex=i;break}i++}}getSelectedItem(){const t=this.getElement().children,e=this.getElement().selectedIndex;let n=0,i=0;for(n=0;n<t.length;n++)if("OPTION"===t[n].tagName){if(e===i)return t[n].value;i++}return""}}class SFileLoadButton extends SBase{constructor(t){super("label",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.addClass(SBase.CLASS_NAME.FILELOAD);const e=super.getElement(),n=document.createElement("input");e.style.textAlign="center",n.setAttribute("type","file"),n.id=this.getId()+"_file",n.style.display="none",this.file=n,e.appendChild(n)}getEnabledElement(){return this.file}getFileAccept(){const t=this.file.getAttribute("accept");return null===t?"":t}setFileAccept(t){t===SFileLoadButton.FILE_ACCEPT.DEFAULT?null!==this.file.getAttribute("accept")&&this.file.removeAttribute("accept"):this.file.accept=t}addListener(t){this.file.addEventListener("change",function(e){t(e.target.files)},!1)}}SFileLoadButton.FILE_ACCEPT={DEFAULT:"",IMAGE:"image/*",AUDIO:"audio/*",VIDEO:"video/*",TEXT:"text/*",PNG:"image/png",JPEG:"image/jpg",GIF:"image/gif"};class SFileSaveButton extends SBase{constructor(t){super("a",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.addClass(SBase.CLASS_NAME.FILESAVE),this.filename="",this.url="",this.getElement().setAttribute("download",this.filename)}getFileName(){return this.filename}setFileName(t){this.filename=t,this.getElement().setAttribute("download",this.filenam)}setURL(t){this.getElement().href=t,this.url=t}setEnabled(t){this.isEnabled()!==t&&(t?this.getElement().href=this.url:this.getElement().removeAttribute("href")),super.setEnabled(t)}}class SGroupBox extends SBase{constructor(t){super("fieldset"),this.addClass(SBase.CLASS_NAME.GROUPBOX),this.legend=document.createElement("legend"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.GROUPBOX_LEGEND),this.legend.id=this.getId()+"_legend",this.legend.textContent=t,this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const e=this.getElement();e.appendChild(this.legend),e.appendChild(this.body)}getEnabledElement(){return this.getElement()}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SImagePanel extends SBase{constructor(){super("div"),this.addClass(SBase.CLASS_NAME.IMAGEPANEL);const t=document.createElement("img");t.id=this.id+"_img",this.image=t,this.getElement().appendChild(this.image)}clear(){this.node_tool.removeChildNodes(this.getElement())}toDataURL(){return this.image.src}putImageData(t){this.putImage(t)}putImage(t,e){if(e||(e=null),"string"==typeof t)this.image.onload=function(){"function"==typeof e&&e()},this.image.src=t;else if(t instanceof ImageData){const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const i=n.getContext("2d");i.putImageData(t,0,0),this.putImage(n,e)}else if(t instanceof Image)this.image.src=t.src;else if(t instanceof SCanvas)this.putImage(t.getElement(),e);else if(t instanceof Element&&"CANVAS"===t.tagName)try{this.putImage(t.toDataURL("image/png"),e)}catch(n){try{this.putImage(t.toDataURL("image/jpeg"),e)}catch(t){}}else{if(!(t instanceof Blob||t instanceof File))throw"IllegalArgumentException";{const n=this,i=new FileReader;i.onload=function(){n.putImage(i.result,e)},i.readAsDataURL(t)}}}}class SLabel extends SBase{constructor(t){super("div",t),this.addClass(SBase.CLASS_NAME.LABEL)}getContainerElement(){return this.getElement()}}class SPanel extends SBase{constructor(t){super("div",null),this.addClass(SBase.CLASS_NAME.PANEL);const e=this.getElement();this.legend=document.createElement("span"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.PANEL_LEGEND),this.legend.id=this.getId()+"_legend",this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const n=this;this.paneltool={setText:function(t){t?(n.legend.textContent=t,n.legend.style.display="block"):n.legend.style.display="none"}},this.paneltool.setText(t),e.appendChild(this.legend),e.appendChild(this.body)}setText(t){this.paneltool&&this.paneltool.setText(t)}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SProgressBar extends SBase{constructor(t,e){if(super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.PROGRESSBAR),this.min=0,this.max=0,this.value=t,this.is_indeterminate=!1,0===arguments.length)this.min=0,this.max=1;else{if(2!==arguments.length)throw"IllegalArgumentException";this.min=t,this.max=e}this.progress=document.createElement("progress"),this.getElement().appendChild(this.progress),this.progress.id=this.getId()+"_progress",this.progress.className=SBase.CLASS_NAME.PROGRESSBAR,this.progress.value=0,this.progress.max=1}setMaximum(t){this.max=t}setMinimum(t){this.min=t}getMaximum(){return this.max}getMinimum(){return this.min}setValue(t){this.value=t,this.progress.value=this.getPercentComplete()}getValue(){return this.value}setIndeterminate(t){this.is_indeterminate=t,this.is_indeterminate?this.progress.removeAttribute("value"):this.setValue(this.value)}isIndeterminate(){return this.is_indeterminate}getPercentComplete(){const t=this.max-this.min;return(this.value-this.min)/t}}class SSlidePanel extends SBase{constructor(t){super("div"),this.addClass(SBase.CLASS_NAME.SLIDEPANEL),this.textnode=document.createTextNode(t||""),this.legend=document.createElement("span"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.SLIDEPANEL_LEGEND),this.legend.id=this.getId()+"_legend",this.legend.appendChild(this.textnode),this.slide=document.createElement("div"),SBase.node_tool.addClass(this.slide,SBase.CLASS_NAME.SLIDEPANEL_SLIDE),this.slide.id=this.getId()+"_slide",this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const e=this,n=function(){e.setOpen(!e.isOpen())};this.legend.addEventListener("click",n),this.setOpen(!1),this.slide.appendChild(this.body);const i=super.getElement();i.appendChild(this.legend),i.appendChild(this.slide)}setOpen(t){this.is_open=t,this.is_open?(this.slide.style.maxHeight=this.body.scrollHeight+"px",SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.OPEN),SBase.node_tool.removeClass(this.legend,SBase.CLASS_NAME.CLOSE)):(this.slide.style.maxHeight=null,SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.CLOSE),SBase.node_tool.removeClass(this.legend,SBase.CLASS_NAME.OPEN))}isOpen(){return this.is_open}getTextNode(){return this.textnode}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SSlider extends SBase{constructor(t,e){if(super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.SLIDER),0===arguments.length)t=0,e=1;else if(2!==arguments.length)throw"IllegalArgumentException";this.slider=document.createElement("input"),this.slider.id=this.getId()+"_slider",this.slider.type="range",this.slider.className=SBase.CLASS_NAME.SLIDER,this.slider.value=t,this.slider.min=t,this.slider.max=e,this.slider.step=(e-t)/100,this.datalist=document.createElement("datalist"),this.datalist.id=this.getId()+"_datalist",this.slider.setAttribute("list",this.datalist.id),this.getElement().appendChild(this.slider),this.getElement().appendChild(this.datalist)}getEnabledElement(){return this.slider}setMaximum(t){this.slider.max=t}setMinimum(t){this.slider.min=t}getMaximum(){return parseFloat(this.slider.max)}getMinimum(){return parseFloat(this.slider.min)}setValue(t){this.slider.value=t}getValue(){return parseFloat(this.slider.value)}setMinorTickSpacing(t){this.slider.step=t}getMinorTickSpacing(){return parseFloat(this.slider.step)}setMajorTickSpacing(t){this.majortick=t,this.removeMajorTickSpacing();let e;const n=this.getMinimum(),i=this.getMaximum();for(e=n;e<=i;e+=t){const t=document.createElement("option");t.value=e.toString(),this.datalist.appendChild(t)}}getMajorTickSpacing(){return this.majortick}removeMajorTickSpacing(){const t=this.datalist;let e=t.lastChild;for(;e;)t.removeChild(e),e=t.lastChild}addListener(t){let e=!1;const n=this,i=function(){e=!0},s=function(){e&&("disabled"!==n.slider.disabled&&t(),e=!1)};this.slider.addEventListener("touchstart",i,!1),this.slider.addEventListener("touchend",s,!1),this.slider.addEventListener("mousedown",i,!1),this.slider.addEventListener("mouseup",s,!1)}getWidth(){let t=this.slider.width;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getHeight(){let t=this.slider.height;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}setWidth(t){if("number"!=typeof t)throw"IllegalArgumentException not number";super.setWidth(t),this.slider.style.width=t.toString()+this.unit}setHeight(t){if("number"!=typeof t)throw"IllegalArgumentException not number";super.setHeight(t),this.slider.style.height=t.toString()+this.unit}}const SComponent={Button:SButton,Canvas:SCanvas,CheckBox:SCheckBox,ColorPicker:SColorPicker,ComboBox:SComboBox,FileLoadButton:SFileLoadButton,FileSaveButton:SFileSaveButton,GroupBox:SGroupBox,ImagePanel:SImagePanel,Label:SLabel,Panel:SPanel,ProgressBar:SProgressBar,SlidePanel:SSlidePanel,Slider:SSlider,PUT_TYPE:SBase.PUT_TYPE,UNIT_TYPE:SBase.UNIT_TYPE,LABEL_POSITION:SBase.LABEL_POSITION,FILE_ACCEPT:SFileLoadButton.FILE_ACCEPT};class Random{constructor(){this.x=[];for(let t=0;t<521;t++)this.x[t]=0;if(arguments.length>=1)this.setSeed(arguments[0]);else{const t=(new Date).getTime()+Random.seedUniquifier&4294967295;Random.seedUniquifier=Random.seedUniquifier+1&4294967295,this.setSeed(t)}}static _unsigned32(t){return t<0?2147483648+(2147483647&t):t}_multiplication32(t,e){let n=(65535&t)*(65535&e),i=Random._unsigned32(n);return n=(65535&t)*(e>>>16),i=Random._unsigned32(i+((65535&n)<<16)),n=(t>>>16)*(65535&e),4294967295&(i=Random._unsigned32(i+((65535&n)<<16)))}_rnd521(){const t=this.x;for(let e=0;e<32;e++)t[e]^=t[e+489];for(let e=32;e<521;e++)t[e]^=t[e-32]}setSeed(t){let e=0;const n=this.x;for(let i=0;i<=16;i++){for(let n=0;n<32;n++)e=(e>>>1)+((t=this._multiplication32(t,1566083941)+1)<0?2147483648:0);n[i]=e}for(let t=16;t<521;t++)e=16===t?t:t-17,n[t]=n[e]<<23&4294967295^n[t-16]>>>9^n[t-1];for(let t=0;t<4;t++)this._rnd521();this.xi=0,this.haveNextNextGaussian=!1,this.nextNextGaussian=0}genrand_int32(){521===this.xi&&(this._rnd521(),this.xi=0);const t=Random._unsigned32(this.x[this.xi]);return this.xi=this.xi+1,t}next(t){return 0===t?0:32===t?this.genrand_int32():t<32?this.genrand_int32()>>>32-t:63===t?2147483648*this.next(32)+this.next(32):64===t?4294967296*this.next(32)+this.next(32):t<64?this.genrand_int32()*(1<<t-32)+(this.genrand_int32()>>>64-t):void 0}nextBytes(t){for(let e=0;e<t.length;e++)t[e]=this.next(8)}nextInt(){if(1===arguments.length){let t,e;const n=arguments[0];do{e=(t=Random._unsigned32(this.genrand_int32()))%n}while(t-e+n>4294967296);return e}return 4294967295&this.next(32)}nextLong(){return this.next(64)}nextBoolean(){return 0!==this.next(1)}nextFloat(){return this.next(24)/16777216}nextDouble(){return(134217728*this.next(26)+this.next(27))/9007199254740992}nextGaussian(){if(this.haveNextNextGaussian)return this.haveNextNextGaussian=!1,this.nextNextGaussian;const t=Math.sqrt(-2*Math.log(this.nextDouble())),e=2*Math.PI*this.nextDouble(),n=t*Math.sin(e);return this.nextNextGaussian=t*Math.cos(e),this.haveNextNextGaussian=!0,n}}Random.seedUniquifier=2271560481;class BigInteger{constructor(){if(this.element=[],this.sign=0,2===arguments.length&&void 0!==Random&&arguments[1]instanceof Random){this.sign=1;const t=arguments[0],e=arguments[1],n=1+(t-1>>4);let i;if(0===t)return;for(let t=0,s=0;t<n;t++)0===s?(i=e.nextInt(),this.element[t]=65535&i,s=1):(this.element[t]=i>>>16&65535,s=0);t%16!=0&&(this.element[this.element.length-1]&=(1<<t%16)-1),this._memory_reduction()}else if(3===arguments.length){if(void 0===Random)return;for(;;){const t=new BigInteger(arguments[0],arguments[2]);if(t.isProbablePrime(arguments[1])){this.element=t.element,this.sign=t.sign;break}}}else if(arguments.length>=1){this.sign=1;const t=arguments[0];if(t instanceof BigInteger){for(let t=0;t<arguments[0].element.length;t++)this.element[t]=arguments[0].element[t];this.sign=arguments[0].sign}else if("number"==typeof t||t instanceof Number){let t=arguments[0];t<0&&(this.sign=-1,t=-t),this.element=this._number_to_binary_number(t)}else if("string"==typeof t||t instanceof String){let t=arguments[0].replace(/\s/g,"").toLowerCase(),e=t.match(/^[-+]+/);null!==e&&(e=e[0],t=t.substring(e.length,t.length),-1!==e.indexOf("-")&&(this.sign=-1)),2===arguments.length?this.element=this._string_to_binary_number(t,arguments[1]):/^0x/.test(t)?this.element=this._string_to_binary_number(t.substring(2,t.length),16):/^0b/.test(t)?this.element=this._string_to_binary_number(t.substring(2,t.length),2):/^0/.test(t)?this.element=this._string_to_binary_number(t.substring(1,t.length),8):this.element=this._string_to_binary_number(t,10),1===this.element.length&&0===this.element[0]&&(this.element=[])}}}equals(t){if(t instanceof BigInteger||(t=new BigInteger(t)),this.signum()!==t.signum())return!1;if(this.element.length!==t.element.length)return!1;for(let e=0;e<t.element.length;e++)if(this.element[e]!==t.element[e])return!1;return!0}toString(t){0===arguments.length&&(t=10);const e=Math.floor(Math.log(1073741823)/Math.log(t)),n=Math.round(Math.pow(t,e));let i,s=[];for(i=0;i<e;i++)s[i]="0";s=s.join("");const o=this._binary_number_to_string(this.element,n),r=[];let h="";for(this.signum()<0&&(r[r.length]="-"),i=o.length-1;i>=0;i--)h=o[i].toString(t),i<o.length-1&&(r[r.length]=s.substring(0,e-h.length)),r[r.length]=h;return r.join("")}getShort(t){return t<0||this.element.length<=t?0:this.element[t]}byteValue(){let t=this.getShort(0);return(t&=255)>0&&this.sign<0&&(t=-t),t}shortValue(){let t=this.getShort(0);return(t&=65535)>0&&this.sign<0&&(t=-t),t}intValue(){let t=this.getShort(0)+(this.getShort(1)<<16);return(t&=4294967295)>0&&this.sign<0&&(t=-t),t}longValue(){let t=0;for(let e=3;e>=0;e--)t*=65536,t+=this.getShort(e);return this.sign<0&&(t=-t),t}floatValue(){return parseFloat(this.toString())}doubleValue(){return parseFloat(this.toString())}clone(){const t=new BigInteger;return t.element=this.element.slice(0),t.sign=this.sign,t}getLowestSetBit(){for(let t=0;t<this.element.length;t++)if(0!==this.element[t]){const e=this.element[t];for(let n=0;n<16;n++)if(0!=(e>>>n&1))return 16*t+n}return-1}bitLength(){for(let t=this.element.length-1;t>=0;t--)if(0!==this.element[t]){const e=this.element[t];for(let n=15;n>=0;n--)if(0!=(e>>>n&1))return 16*t+n+1}return 0}bitCount(){let t;const e=(t=this.sign>=0?this:this.add(new BigInteger(1))).bitLength();let n=0,i=0;for(let s=0;n<e;s++){const o=t.element[s];for(let t=0;t<16&&n<e;t++,n++)0!=(o>>>t&1)&&(i+=1)}return i}getTwosComplement(t){const e=this.clone();if(e.sign>=0)return e;{e.sign=1,0===arguments.length&&(t=e.bitLength());const n=e.element;for(let t=0;t<n.length;t++)n[t]^=65535;return t%16!=0&&(n[n.length-1]&=(1<<t%16)-1),e._add(new BigInteger(1)),e}}_and(t){t instanceof BigInteger||(t=new BigInteger(t));let e=this,n=t;const i=e.signum(),s=n.signum(),o=Math.max(e.bitLength(),n.bitLength());e=e.getTwosComplement(o).element,n=n.getTwosComplement(o).element;const r=Math.max(e.length,n.length);this.element=[];for(let t=0;t<r;t++){const i=t>=e.length?0:e[t],s=t>=n.length?0:n[t];this.element[t]=i&s}return 0===this.bitLength()&&(this.element=[],this.sign=0),1===i||1===s?this.sign=1:-1===this.sign&&(this.element=this.getTwosComplement(o).element),this}and(t){return this.clone()._and(t)}_or(t){t instanceof BigInteger||(t=new BigInteger(t));let e=this,n=t;const i=e.signum(),s=n.signum(),o=Math.max(e.bitLength(),n.bitLength());e=e.getTwosComplement(o).element,n=n.getTwosComplement(o).element;const r=Math.max(e.length,n.length);this.element=[];for(let t=0;t<r;t++){const i=t>=e.length?0:e[t],s=t>=n.length?0:n[t];this.element[t]=i|s}return this.sign=-1===i||-1===s?-1:Math.max(i,s),-1===this.sign&&(this.element=this.getTwosComplement(o).element),this}or(t){return this.clone()._or(t)}_xor(t){t instanceof BigInteger||(t=new BigInteger(t));let e=this,n=t;const i=e.signum(),s=n.signum(),o=Math.max(e.bitLength(),n.bitLength());e=e.getTwosComplement(o).element,n=n.getTwosComplement(o).element;const r=Math.max(e.length,n.length);this.element=[];for(let t=0;t<r;t++){const i=t>=e.length?0:e[t],s=t>=n.length?0:n[t];this.element[t]=i^s}return this.sign=0!==i&&i!==s?-1:1,-1===this.sign&&(this.element=this.getTwosComplement(o).element),this}xor(t){return this.clone()._xor(t)}_not(){return this._add(new BigInteger(1))._negate()}not(){return this.clone()._not()}_andNot(t){return t instanceof BigInteger||(t=new BigInteger(t)),this._and(t.not())}andNot(t){return this.clone()._andNot(t)}_number_to_binary_number(t){if(t>4294967295)return this._string_to_binary_number(t.toFixed(),10);const e=[];for(;0!==t;)e[e.length]=1&t,t>>>=1;t=[];for(let n=0;n<e.length;n++)t[n>>>4]|=e[n]<<(15&n);return t}_string_to_binary_number(t,e){const n=Math.floor(Math.log(1073741823)/Math.log(e)),i=Math.round(Math.pow(e,n));let s=[];const o=[],r=Math.ceil(t.length/n);let h=t.length;for(let i=0;i<r;i++)h-=n,s[i]=h>=0?parseInt(t.substring(h,h+n),e):parseInt(t.substring(0,h+n),e);for(e=i;0!==s.length;){let t=0;for(let n=s.length-1;n>=0;n--){const i=s[n]+t*e;s[n]=i>>>1,t=1&i}o[o.length]=t,0===s[s.length-1]&&s.pop()}s=[];for(let t=0;t<o.length;t++)s[t>>>4]|=o[t]<<(15&t);return s}_binary_number_to_string(t,e){const n=function(t,n,i){const s=t.length;let o=0;for(let r=0;r<s;r++)i[r]=t[r]+(n.length>=r+1?n[r]:0)+o,i[r]>=e?(o=1,i[r]-=e):o=0;1===o&&(i[s]=1)},i=[0],s=[1];for(let e=0;e<t.length;e++)for(let o=0;o<16;o++)t[e]>>>o&1&&n(s,i,i),n(s,s,s);return i}_memory_allocation(t){const e=this.element.length<<4;if(e<t){const n=1+((t-e-1&4294967280)>>>4);for(let t=0;t<n;t++)this.element[this.element.length]=0}}_memory_reduction(){for(let t=this.element.length-1;t>=0;t--)if(0!==this.element[t])return void(t<this.element.length-1&&this.element.splice(t+1,this.element.length-t-1));this.sign=0,this.element=[]}gcd(t){t instanceof BigInteger||(t=new BigInteger(t));let e,n=this,i=t;for(;0!==i.signum();)e=n.remainder(i),n=i,i=e;return n}extgcd(t){t instanceof BigInteger||(t=new BigInteger(t));const e=new BigInteger(1),n=new BigInteger(0);let i,s,o,r,h=this,a=t,l=e,u=n,c=n,m=e;for(;0!==a.signum();){const t=h.divideAndRemainder(a);s=t[0],i=t[1],o=l.subtract(s.multiply(u)),r=c.subtract(s.multiply(m)),l=u,u=o,c=m,m=r,h=a,a=i}return[l,c,h]}_abs(){return this.sign*=this.sign,this}abs(){return this.clone()._abs()}_negate(){return this.sign*=-1,this}negate(){return this.clone()._negate()}signum(){return 0===this.element.length?0:this.sign}compareToAbs(t){if(t instanceof BigInteger||(t=new BigInteger(t)),this.element.length<t.element.length)return-1;if(this.element.length>t.element.length)return 1;for(let e=this.element.length-1;e>=0;e--)if(this.element[e]!==t.element[e]){const n=this.element[e]-t.element[e];return 0===n?0:n>0?1:-1}return 0}compareTo(t){return t instanceof BigInteger||(t=new BigInteger(t)),this.signum()!==t.signum()?this.sign>t.sign?1:-1:0===this.signum()?0:this.compareToAbs(t)*this.sign}max(t){return this.compareTo(t)>=0?this.clone():t.clone()}min(t){return this.compareTo(t)>=0?t.clone():this.clone()}_shift(t){if(0===t)return this;const e=this.element;if(1===t){let t=e.length-1;for(0!=(32768&e[t])&&(e[e.length]=1);t>=0;t--)e[t]<<=1,e[t]&=65535,t>0&&0!=(32768&e[t-1])&&(e[t]+=1)}else if(-1===t){for(let t=0;t<e.length;t++)e[t]>>>=1,t<e.length-1&&0!=(1&e[t+1])&&(e[t]|=32768);0===e[e.length-1]&&e.pop()}else{if(t>=16){const n=t>>>4;for(let t=e.length-1;t>=0;t--)e[t+n]=e[t];for(let t=n-1;t>=0;t--)e[t]=0;t&=15}else if(t<=-16){const n=-t>>>4;e.splice(0,n),t+=n<<4}if(0!==t)if(0<t){let n=0;for(let i=0;i<e.length;i++)e[i]=(e[i]<<t)+n,e[i]>65535?(n=e[i]>>>16,e[i]&=65535):n=0;0!==n&&(e[e.length]=n)}else{t=-t;for(let n=0;n<e.length;n++)n!==e.length-1?(e[n]+=e[n+1]<<16,e[n]>>>=t,e[n]&=65535):e[n]>>>=t;0===e[e.length-1]&&e.pop()}}return this}shift(t){return this.clone()._shift(t)}shiftLeft(t){return this.shift(t)}shiftRight(t){return this.shift(-t)}_add(t){t instanceof BigInteger||(t=new BigInteger(t));const e=this,n=t;let i=e.element,s=n.element;if(e.sign===n.sign){this._memory_allocation(s.length<<4);let t=0;for(let e=0;e<i.length;e++)i[e]+=(s.length>=e+1?s[e]:0)+t,i[e]>65535?(t=1,i[e]&=65535):t=0;0!==t&&(i[i.length]=t)}else{const t=e.compareToAbs(n);if(0===t)return this.element=[],this.sign=1,this;if(-1===t){this.sign=n.sign;const t=i;i=s.slice(0),s=t}let o=0;for(let t=0;t<i.length;t++)i[t]-=(s.length>=t+1?s[t]:0)+o,i[t]<0?(i[t]+=65536,o=1):o=0;this.element=i,this._memory_reduction()}return this}add(t){return this.clone()._add(t)}_subtract(t){t instanceof BigInteger||(t=new BigInteger(t));const e=t.sign,n=this._add(t._negate());return t.sign=e,n}subtract(t){return this.clone()._subtract(t)}_multiply(t){const e=this.multiply(t);return this.element=e.element,this.sign=e.sign,this}multiply(t){t instanceof BigInteger||(t=new BigInteger(t));const e=new BigInteger,n=new BigInteger,i=t,s=this.element,o=i.element,r=e.element;for(let t=0;t<s.length;t++){n.element=[];const i=n.element;let h=0;for(let e=0;e<o.length;e++)i[e]=s[t]*o[e]+h,i[e]>65535?(h=i[e]>>>16,i[e]&=65535):h=0;0!==h&&(i[i.length]=h);for(let e=i.length-1;e>=0;e--)i[e+t]=i[e];for(let e=t-1;e>=0;e--)i[e]=0;h=0,e._memory_allocation(i.length<<4);for(let e=t;e<r.length;e++)r[e]+=(i.length>=e+1?i[e]:0)+h,r[e]>65535?(h=1,r[e]&=65535):h=0;0!==h&&(r[r.length]=h)}return e.sign=this.sign*t.sign,e}_divideAndRemainder(t){t instanceof BigInteger||(t=new BigInteger(t));const e=[];if(0===t.signum())return e[0]=1/0,e[1]=NaN,e;const n=this.compareToAbs(t);if(n<0)return e[0]=new BigInteger(0),e[1]=this.clone(),e;if(0===n)return e[0]=new BigInteger(1),e[0].sign=this.sign*t.sign,e[1]=new BigInteger(0),e;const i=new BigInteger(1),s=this.bitLength()-t.bitLength(),o=this.clone()._abs(),r=t.shift(s)._abs(),h=new BigInteger;for(let t=0;t<=s&&(o.compareToAbs(r)>=0&&(o._subtract(r),h._add(i)),t!==s);t++)r._shift(-1),h._shift(1);return e[0]=h,e[0].sign=this.sign*t.sign,e[1]=o,e[1].sign=this.sign,e}divideAndRemainder(t){return this.clone()._divideAndRemainder(t)}_divide(t){return this._divideAndRemainder(t)[0]}divide(t){return this.clone()._divide(t)}_remainder(t){return this._divideAndRemainder(t)[1]}remainder(t){return this.clone()._remainder(t)}_mod(t){if(t instanceof BigInteger||(t=new BigInteger(t)),t.signum()<0)return null;const e=this._divideAndRemainder(t);return e[1]instanceof BigInteger?e[1].signum()>=0?e[1]:e[1]._add(t):null}mod(t){return this.clone()._mod(t)}_setBit(t){return this._memory_allocation(t+1),this.element[t>>>4]|=1<<(15&t),this}setBit(t){return this.clone()._setBit(t)}_flipBit(t){return this._memory_allocation(t+1),this.element[t>>>4]^=1<<(15&t),this}flipBit(t){return this.clone()._flipBit(t)}clearBit(t){const e=this.clone();return e.element[t>>>4]&=~(1<<(15&t)),e._memory_reduction(),e}testBit(t){return this.element[t>>>4]>>>(15&t)&1}pow(t){let e,n;for(e=new BigInteger(this),n=new BigInteger(1);0!==t;)0!=(1&t)&&(n=n.multiply(e)),e=e.multiply(e),t>>>=1;return n}modPow(t,e){e=new BigInteger(e);let n=new BigInteger(this),i=new BigInteger(1);const s=new BigInteger(t);for(;0!==s.element.length;)0!=(1&s.element[0])&&(i=i.multiply(n).mod(e)),n=n.multiply(n).mod(e),s._shift(-1);return i}modInverse(t){t=new BigInteger(t);const e=this.extgcd(t),n=new BigInteger(1);return 0!==e[2].compareTo(n)?null:e[0]._add(t)._mod(t)}isProbablePrime(t){const e=this.element;if(0===e.length||1===e.length&&e[0]<=2)return!0;if(0==(1&e[0])||t<=0)return!1;if(void 0===Random)return!1;t>>=1;const n=new BigInteger(0),i=new BigInteger(1),s=this,o=s.bitLength(),r=s.subtract(i),h=r.getLowestSetBit(),a=r.shift(-h),l=new Random;let u,c;for(let e=0;e<t;e++){do{u=new BigInteger(o,l)}while(0===u.compareTo(n)||-1!==u.compareTo(s));if(0!==(u=u.modPow(a,s)).compareTo(i)){c=!0;for(let t=0;t<=h;t++){if(0===u.compareTo(r)){c=!1;break}t<h&&(u=u.multiply(u)._mod(s))}if(c)return!1}}return!0}nextProbablePrime(){if(void 0===Random)return new BigInteger(0);const t=this.clone(),e=new BigInteger(1);for(;;)if(t._add(e),t.isProbablePrime(100))break;return t}static valueOf(t){return new BigInteger(t)}static probablePrime(t,e){return new BigInteger(t,100,e)}}BigInteger.ONE=new BigInteger(1),BigInteger.TEN=new BigInteger(10),BigInteger.ZERO=new BigInteger(0);class BigDecimal{constructor(){this.integer=0,this._scale=0;let t=0,e=0,n=null;if(arguments.length>=1&&(t=arguments[0]),arguments.length>=2&&(e=arguments[1]),arguments.length>=3&&(n=arguments[2]),e instanceof MathContext&&(n=e),t instanceof BigDecimal)this.integer=t.integer.clone(),this._scale=t._scale,this.int_string=t.int_string;else if(t instanceof BigInteger)this.integer=t.clone(),this._scale=e;else if("number"==typeof t)if(t===Math.floor(t))this.integer=new BigInteger(t),this._scale=0;else{for(this._scale=0;;)if(t*=10,this._scale=this._scale+1,t===Math.floor(t))break;this.integer=new BigInteger(t)}else if("string"==typeof t){this._scale=0;let e,n=t.replace(/\s/g,"").toLowerCase(),i="";null!==(e=n.match(/^[-+]+/))&&(e=e[0],n=n.substring(e.length,n.length),-1!==e.indexOf("-")&&(i+="-")),null!==(e=n.match(/^[0-9]+/))&&(e=e[0],n=n.substring(e.length,n.length),i+=e),null!==(e=n.match(/^\.[0-9]+/))&&(e=e[0],n=n.substring(e.length,n.length),e=e.substring(1,e.length),this._scale=this._scale+e.length,i+=e),null!==(e=n.match(/^e(\+|-)?[0-9]+/))&&(e=e[0].substring(1,e[0].length),this._scale=this._scale-parseInt(e,10)),this.integer=new BigInteger(i,10)}if(n instanceof MathContext){const t=this.round(n);this.integer=t.integer,this._scale=t._scale}}_getUnsignedIntegerString(){return void 0===this.int_string&&(this.int_string=this.integer.toString(10).replace(/^-/,"")),this.int_string}clone(){return new BigDecimal(this)}scale(){return this._scale}signum(){return this.integer.signum()}precision(){return this._getUnsignedIntegerString().length}unscaledValue(){return new BigInteger(this.integer)}toScientificNotation(t){const e=this._getUnsignedIntegerString();let n=this.scale();const i=[];let s,o;if(-1===this.signum()&&(i[i.length]="-"),(n=-t-n)>=0)for(i[i.length]=e,s=0;s<n;s++)i[i.length]="0";else if(0<(o=this.precision()+n))i[i.length]=e.substring(0,o),i[i.length]=".",i[i.length]=e.substring(o,e.length);else{for(o=-o,i[i.length]="0.",s=0;s<o;s++)i[i.length]="0";i[i.length]=e}return i[i.length]="E",t>=0&&(i[i.length]="+"),i[i.length]=t,i.join("")}toString(){const t=-this.scale()+(this.precision()-1);return this.scale()>=0&&t>=-6?this.toPlainString():this.toScientificNotation(t)}toEngineeringString(){const t=-this.scale()+(this.precision()-1);return this.scale()>=0&&t>=-6?this.toPlainString():this.toScientificNotation(3*Math.floor(t/3))}toPlainString(){return 0===this.scale()?this.signum()<0?"-"+this._getUnsignedIntegerString():this._getUnsignedIntegerString():this.toScientificNotation(0).match(/^[^E]*/)[0]}ulp(){return new BigDecimal(BigInteger.ONE,this.scale())}setScale(t,e){if(this.scale()===t)return this.clone();e=1===arguments.length?RoundingMode.UNNECESSARY:RoundingMode.getRoundingMode(e);let n=this._getUnsignedIntegerString();const i=this.signum(),s=i>=0?"":"-",o=t-this.scale();if(0<=o){let e;for(e=0;e<o;e++)n+="0";return new BigDecimal(new BigInteger(s+n),t)}const r=n.length+o,h=r+1;if(r<=0){const n=(i+e.getAddNumber(i))/10;return new BigDecimal(new BigInteger(n),t)}{const i=n.match(/0+$/),h=null!==i?i[0].length:0;if(h+o>=0||e===RoundingMode.DOWN)return new BigDecimal(new BigInteger(s+n.substring(0,r)),t)}{const o=(n=n.substring(0,h)).length>1?2:1,r=parseInt(n.substring(n.length-o,n.length))*i,a=new BigInteger(s+n),l=new BigInteger(e.getAddNumber(r));return n=a.add(l).toString(),new BigDecimal(new BigInteger(n.substring(0,n.length-1)),t)}}round(t){if(!(t instanceof MathContext))throw"not MathContext";const e=t.getPrecision(),n=e-this.precision();if(0===n||0===e)return this.clone();const i=this.setScale(this.scale()+n,t.getRoundingMode());if(n>0)return i;if(i.precision()===t.getPrecision())return i;const s=i.integer.signum()>=0?"":"-",o=i._getUnsignedIntegerString(),r=s+o.substring(0,o.length-1);return new BigDecimal(new BigInteger(r),i.scale()-1)}abs(t){const e=this.clone();if(e.integer=e.integer.abs(),1===arguments.length)return e;if(!(t instanceof MathContext))throw"not MathContext";return e.round(t)}plus(t){const e=this.clone();if(1===arguments.length)return e;if(!(t instanceof MathContext))throw"not MathContext";return e.round(t)}negate(t){const e=this.clone();if(e.integer=e.integer.negate(),1===arguments.length)return e;if(!(t instanceof MathContext))throw"not MathContext";return e.round(t)}compareTo(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";const e=this,n=t;{const t=e.signum(),i=n.signum();if(0===t&&t===i)return 0;if(0===t)return-i;if(0===i)return t}if(e._scale===n._scale)return e.integer.compareTo(n.integer);if(e._scale>n._scale){const t=n.setScale(e._scale);return e.integer.compareTo(t.integer)}{const t=e.setScale(n._scale);return t.integer.compareTo(n.integer)}}equals(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";return this._scale===t._scale&&this.integer.equals(t.integer)}min(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";return this.compareTo(t)<=0?this.clone():t.clone()}max(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";return this.compareTo(t)>=0?this.clone():t.clone()}movePointLeft(t){let e=this.scaleByPowerOfTen(-t);return e=e.setScale(Math.max(this.scale()+t,0))}movePointRight(t){let e=this.scaleByPowerOfTen(t);return e=e.setScale(Math.max(this.scale()-t,0))}scaleByPowerOfTen(t){const e=this.clone();return e._scale=this.scale()-t,e}stripTrailingZeros(){const t=this.signum()>=0?"":"-",e=this.integer.toString(10).replace(/^-/,""),n=e.match(/0+$/);let i=null!==n?n[0].length:0;i===e.length&&(i=e.length-1);const s=this.scale()-i;return new BigDecimal(new BigInteger(t+e.substring(0,e.length-i)),s)}add(t,e){if(1===arguments.length&&(e=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(e instanceof MathContext))throw"not MathContext";const n=this,i=t,s=Math.max(n._scale,i._scale);if(n._scale===i._scale)return new BigDecimal(n.integer.add(i.integer),s,e);if(n._scale>i._scale){const t=i.setScale(n._scale);return new BigDecimal(n.integer.add(t.integer),s,e)}{const t=n.setScale(i._scale);return new BigDecimal(t.integer.add(i.integer),s,e)}}subtract(t,e){if(1===arguments.length&&(e=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(e instanceof MathContext))throw"not MathContext";const n=this,i=t,s=Math.max(n._scale,i._scale);if(n._scale===i._scale)return new BigDecimal(n.integer.subtract(i.integer),s,e);if(n._scale>i._scale){const t=i.setScale(n._scale);return new BigDecimal(n.integer.subtract(t.integer),s,e)}{const t=n.setScale(i._scale);return new BigDecimal(t.integer.subtract(i.integer),s,e)}}multiply(t,e){if(1===arguments.length&&(e=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(e instanceof MathContext))throw"not MathContext";const n=this,i=t,s=n.integer.multiply(i.integer),o=n._scale+i._scale;return new BigDecimal(s,o,e)}divideToIntegralValue(t,e){if(1===arguments.length&&(e=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(e instanceof MathContext))throw"not MathContext";const n=function(t){let e,n="1";for(e=0;e<t;e++)n+="0";return new BigInteger(n)};if(0===t.compareTo(BigDecimal.ZERO))throw"ArithmeticException";const i=this,s=t;let o=i.integer,r=s.integer;const h=i._scale-s._scale;i._scale>s._scale?r=r.multiply(n(h)):i._scale<s._scale&&(o=o.multiply(n(-h)));const a=o.divide(r),l=a.signum();if(0!==l){const t=a.toString(10).replace(/^-/,"");if(0!==e.getPrecision()&&t.length>e.getPrecision())throw"ArithmeticException";if(t.length<=-h){const e=t.match(/0+$/),n=null!==e?e[0].length:0,i=l>=0?"":"-";return new BigDecimal(new BigInteger(i+t.substring(0,t.length-n)),-n)}}let u=new BigDecimal(a);return u=u.setScale(h,RoundingMode.UP),u=u.round(e)}divideAndRemainder(t,e){if(1===arguments.length&&(e=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(e instanceof MathContext))throw"not MathContext";const n=this.divideToIntegralValue(t,e);return[n,this.subtract(n.multiply(t,e),e)]}divide(t,e,n){if(!(t instanceof BigDecimal))throw"not BigDecimal";const i=this,s=t;let o,r=null,h=MathContext.UNLIMITED,a=0,l=!1;if(1===arguments.length)a=i.scale()-s.scale(),l=!0;else if(2===arguments.length)o=e,a=i.scale(),l=!0,r=o instanceof MathContext?(h=o).getRoundingMode():RoundingMode.getRoundingMode(arguments[0]);else{if(3!==arguments.length)throw"The argument is over.";if(!("number"==typeof e||e instanceof Number))throw"scale is not Integer";a=e,r=(o=n)instanceof MathContext?(h=o).getRoundingMode():RoundingMode.getRoundingMode(arguments[0])}if(0===s.compareTo(BigDecimal.ZERO))throw"ArithmeticException";let u,c=i;const m=[];let g,f,d,p;p=BigDecimal.ZERO;const S=h.getPrecision(),I=0!==S?S+8:262143;for(u=0;u<I&&(g=c.divideAndRemainder(s,MathContext.UNLIMITED),f=g[0],d=g[1],p=p.add(f.scaleByPowerOfTen(-u),MathContext.UNLIMITED),0!==d.compareTo(BigDecimal.ZERO));u++){if(0===S){if(m[d._getUnsignedIntegerString()])throw"ArithmeticException "+p+"["+d._getUnsignedIntegerString()+"]";m[d._getUnsignedIntegerString()]=!0}c=d.scaleByPowerOfTen(1)}if(l)try{p=p.setScale(a,r)}catch(t){}else p=p.setScale(a,r);return p=p.round(h)}toBigInteger(){const t=this.toPlainString().replace(/\.\d*$/,"");return new BigInteger(t.toPlainString())}toBigIntegerExact(){const t=this.setScale(0,RoundingMode.UNNECESSARY);return new BigInteger(t.toPlainString())}longValue(){let t=this.toBigInteger();return t=t.longValue()}longValueExact(){let t=this.toBigIntegerExact();return t=t.longValue()}intValue(){let t=this.toBigInteger();return 4294967295&(t=t.intValue())}intValueExact(){let t=this.toBigIntegerExact();if((t=t.longValue())<-2147483648||2147483647<t)throw"ArithmeticException";return t}floatValue(){const t=this.precision();return MathContext.DECIMAL32.getPrecision()<t?this.signum()>=0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:parseFloat(t.toEngineeringString())}doubleValue(){const t=this.precision();return MathContext.DECIMAL64.getPrecision()<t?this.signum()>=0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:parseFloat(t.toEngineeringString())}pow(t,e){if(Math.abs(t)>999999999)throw"ArithmeticException";if(1===arguments.length&&(e=MathContext.UNLIMITED),!(e instanceof MathContext))throw"not MathContext";if(0===e.getPrecision()&&t<0)throw"ArithmeticException";if(e.getPrecision()>0&&t>e.getPrecision())throw"ArithmeticException";let n,i;for(n=this.clone(),i=BigDecimal.ONE;0!==t;)0!=(1&t)&&(i=i.multiply(n,MathContext.UNLIMITED)),n=n.multiply(n,MathContext.UNLIMITED),t>>>=1;return i.round(e)}static valueOf(t,e){if(1===arguments.length)return new BigDecimal(t);if(2===arguments.length){if("number"==typeof t&&t===Math.floor(t))return new BigDecimal(new BigInteger(t),e);throw"IllegalArgumentException"}throw"IllegalArgumentException"}}const RoundingMode={UP:{toString:function(){return"UP"},getAddNumber:function(t){return t%=10,0===t?0:t>0?10-t:-(10+t)}},DOWN:{toString:function(){return"DOWN"},getAddNumber:function(t){return-(t%=10)}},CEILING:{toString:function(){return"CEILING"},getAddNumber:function(t){return t%=10,0===t?0:t>0?10-t:-t}},FLOOR:{toString:function(){return"FLOOR"},getAddNumber:function(t){return t%=10,0===t?0:t>0?-t:-(10+t)}},HALF_UP:{toString:function(){return"HALF_UP"},getAddNumber:function(t){const e=(t%=10)>=0?1:-1;return Math.abs(t)<5?-1*t:e*(10-Math.abs(t))}},HALF_DOWN:{toString:function(){return"HALF_DOWN"},getAddNumber:function(t){const e=(t%=10)>=0?1:-1;return Math.abs(t)<6?-1*t:e*(10-Math.abs(t))}},HALF_EVEN:{toString:function(){return"HALF_EVEN"},getAddNumber:function(t){let e,n;(t%=100)<0?(e=-1,n=1&Math.ceil(t/10)):(e=1,n=1&Math.floor(t/10));let i;return i=1===n?5:6,t%=10,Math.abs(t)<i?-1*t:e*(10-Math.abs(t))}},UNNECESSARY:{toString:function(){return"UNNECESSARY"},getAddNumber:function(t){if(0===(t%=10))return 0;throw"ArithmeticException"}},valueOf:function(t){if(null===t)throw"NullPointerException";const e=RoundingMode.values;for(let n=0;n<e.length;n++)if(e[n].toString()===t)return e[n];throw"IllegalArgumentException"},getRoundingMode:function(t){let e;switch(t){case RoundingMode.CEILING:case RoundingMode.DOWN:case RoundingMode.FLOOR:case RoundingMode.HALF_DOWN:case RoundingMode.HALF_EVEN:case RoundingMode.HALF_UP:case RoundingMode.UNNECESSARY:case RoundingMode.UP:e=t;break;default:"number"==typeof t||t instanceof Number?e=RoundingMode.values[t]:("string"==typeof t||t instanceof String)&&(e=RoundingMode.valueOf(t))}if(!e)throw"Not RoundingMode";return e}};RoundingMode.values={0:RoundingMode.CEILING,1:RoundingMode.DOWN,2:RoundingMode.FLOOR,3:RoundingMode.HALF_DOWN,4:RoundingMode.HALF_EVEN,5:RoundingMode.HALF_UP,6:RoundingMode.UNNECESSARY,7:RoundingMode.UP};class MathContext{constructor(){this.precision=0,this.roundingMode=RoundingMode.HALF_UP;let t,e=0,n=0;if(arguments.length>=1&&(e=arguments[0]),arguments.length>=2&&(n=arguments[1]),"string"==typeof e||e instanceof String?(null!==(t=e.match(/precision=\d+/))&&(t=t[0].substring("precision=".length,t[0].length),this.precision=parseInt(t,10)),null!==(t=e.match(/roundingMode=\w+/))&&(t=t[0].substring("roundingMode=".length,t[0].length),this.roundingMode=RoundingMode.valueOf(t))):1===arguments.length?this.precision=e:2===arguments.length&&(this.precision=e,this.roundingMode=n),this.precision<0)throw"IllegalArgumentException"}getPrecision(){return this.precision}getRoundingMode(){return this.roundingMode}equals(t){return t instanceof MathContext&&t.toString()===this.toString()}toString(){return"precision="+this.precision+" roundingMode="+this.roundingMode.toString()}}MathContext.UNLIMITED=new MathContext(0,RoundingMode.HALF_UP),MathContext.DECIMAL32=new MathContext(7,RoundingMode.HALF_EVEN),MathContext.DECIMAL64=new MathContext(16,RoundingMode.HALF_EVEN),MathContext.DECIMAL128=new MathContext(34,RoundingMode.HALF_EVEN),BigDecimal.RoundingMode=RoundingMode,BigDecimal.MathContext=MathContext,BigDecimal.ZERO=new BigDecimal(0),BigDecimal.ONE=new BigDecimal(1),BigDecimal.TEN=new BigDecimal(10),BigDecimal.ROUND_CEILING=RoundingMode.CEILING,BigDecimal.ROUND_DOWN=RoundingMode.DOWN,BigDecimal.ROUND_FLOOR=RoundingMode.FLOOR,BigDecimal.ROUND_HALF_DOWN=RoundingMode.HALF_DOWN,BigDecimal.ROUND_HALF_EVEN=RoundingMode.HALF_EVEN,BigDecimal.ROUND_HALF_UP=RoundingMode.HALF_UP,BigDecimal.ROUND_UNNECESSARY=RoundingMode.UNNECESSARY,BigDecimal.ROUND_UP=RoundingMode.UP;const S3Math={EPSILON:2.220446049250313e-8,clamp:function(t,e,n){return t<e?e:t>n?n:t},step:function(t,e){return t>e?1:0},mix:function(t,e,n){return t+(e-t)*n},smoothstep:function(t,e,n){return t+(e-t)*(n*n*(3-2*n))},equals:function(t,e){return Math.abs(t-e)<S3Math.EPSILON},mod:function(t,e){return t-e*parseInt(t/e)},sign:function(t){return t>=0?1:-1},fract:function(t){return t-Math.floor(t)},rsqrt:function(t){return Math.sqrt(1/t)},radius:function(t){return t/360*(2*Math.PI)},degrees:function(t){return t/(2*Math.PI)*360}};class S3Matrix{constructor(t,e,n,i,s,o,r,h,a,l,u,c,m,g,f,d){if(0===arguments.length)this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m20=0,this.m21=0,this.m22=0,this.m23=0,this.m30=0,this.m31=0,this.m32=0,this.m33=0;else if(9===arguments.length)this.m00=t,this.m01=e,this.m02=n,this.m03=0,this.m10=i,this.m11=s,this.m12=o,this.m13=0,this.m20=r,this.m21=h,this.m22=a,this.m23=0,this.m30=0,this.m31=0,this.m32=0,this.m33=1;else{if(16!==arguments.length)throw"IllegalArgumentException";this.m00=t,this.m01=e,this.m02=n,this.m03=i,this.m10=s,this.m11=o,this.m12=r,this.m13=h,this.m20=a,this.m21=l,this.m22=u,this.m23=c,this.m30=m,this.m31=g,this.m32=f,this.m33=d}}equals(t){return S3Math.equals(this.m00,t.m00)&&S3Math.equals(this.m01,t.m01)&&S3Math.equals(this.m02,t.m02)&&S3Math.equals(this.m03,t.m03)&&S3Math.equals(this.m10,t.m10)&&S3Math.equals(this.m11,t.m11)&&S3Math.equals(this.m12,t.m12)&&S3Math.equals(this.m13,t.m13)&&S3Math.equals(this.m20,t.m20)&&S3Math.equals(this.m21,t.m21)&&S3Math.equals(this.m22,t.m22)&&S3Math.equals(this.m23,t.m23)&&S3Math.equals(this.m30,t.m30)&&S3Math.equals(this.m31,t.m31)&&S3Math.equals(this.m32,t.m32)&&S3Math.equals(this.m33,t.m33)}clone(){return new S3Matrix(this.m00,this.m01,this.m02,this.m03,this.m10,this.m11,this.m12,this.m13,this.m20,this.m21,this.m22,this.m23,this.m30,this.m31,this.m32,this.m33)}transposed(){return new S3Matrix(this.m00,this.m10,this.m20,this.m30,this.m01,this.m11,this.m21,this.m31,this.m02,this.m12,this.m22,this.m32,this.m03,this.m13,this.m23,this.m33)}isNaN(){return isNaN(this.m00)||isNaN(this.m01)||isNaN(this.m02)||isNaN(this.m03)||isNaN(this.m10)||isNaN(this.m11)||isNaN(this.m12)||isNaN(this.m13)||isNaN(this.m20)||isNaN(this.m21)||isNaN(this.m22)||isNaN(this.m23)||isNaN(this.m30)||isNaN(this.m31)||isNaN(this.m32)||isNaN(this.m33)}isFinite(){return isFinite(this.m00)&&isFinite(this.m01)&&isFinite(this.m02)&&isFinite(this.m03)||isFinite(this.m10)&&isFinite(this.m11)&&isFinite(this.m12)&&isFinite(this.m13)||isFinite(this.m20)&&isFinite(this.m21)&&isFinite(this.m22)&&isFinite(this.m23)||isFinite(this.m30)&&isFinite(this.m31)&&isFinite(this.m32)&&isFinite(this.m33)}isRealNumber(){return!this.isNaN()&&this.isFinite()}mul(t){if(t instanceof S3Matrix){const e=this,n=t,i=new S3Matrix;return i.m00=e.m00*n.m00+e.m01*n.m10+e.m02*n.m20+e.m03*n.m30,i.m01=e.m00*n.m01+e.m01*n.m11+e.m02*n.m21+e.m03*n.m31,i.m02=e.m00*n.m02+e.m01*n.m12+e.m02*n.m22+e.m03*n.m32,i.m03=e.m00*n.m03+e.m01*n.m13+e.m02*n.m23+e.m03*n.m33,i.m10=e.m10*n.m00+e.m11*n.m10+e.m12*n.m20+e.m13*n.m30,i.m11=e.m10*n.m01+e.m11*n.m11+e.m12*n.m21+e.m13*n.m31,i.m12=e.m10*n.m02+e.m11*n.m12+e.m12*n.m22+e.m13*n.m32,i.m13=e.m10*n.m03+e.m11*n.m13+e.m12*n.m23+e.m13*n.m33,i.m20=e.m20*n.m00+e.m21*n.m10+e.m22*n.m20+e.m23*n.m30,i.m21=e.m20*n.m01+e.m21*n.m11+e.m22*n.m21+e.m23*n.m31,i.m22=e.m20*n.m02+e.m21*n.m12+e.m22*n.m22+e.m23*n.m32,i.m23=e.m20*n.m03+e.m21*n.m13+e.m22*n.m23+e.m23*n.m33,i.m30=e.m30*n.m00+e.m31*n.m10+e.m32*n.m20+e.m33*n.m30,i.m31=e.m30*n.m01+e.m31*n.m11+e.m32*n.m21+e.m33*n.m31,i.m32=e.m30*n.m02+e.m31*n.m12+e.m32*n.m22+e.m33*n.m32,i.m33=e.m30*n.m03+e.m31*n.m13+e.m32*n.m23+e.m33*n.m33,i}if(t instanceof S3Vector){const e=this,n=t;return new S3Vector(e.m00*n.x+e.m01*n.y+e.m02*n.z+e.m03*n.w,e.m10*n.x+e.m11*n.y+e.m12*n.z+e.m13*n.w,e.m20*n.x+e.m21*n.y+e.m22*n.z+e.m23*n.w,e.m30*n.x+e.m31*n.y+e.m32*n.z+e.m33*n.w)}throw"IllegalArgumentException"}det3(){const t=this;let e;return e=t.m00*t.m11*t.m22,e+=t.m10*t.m21*t.m02,e+=t.m20*t.m01*t.m12,e-=t.m00*t.m21*t.m12,e-=t.m20*t.m11*t.m02,e-=t.m10*t.m01*t.m22}inverse3(){const t=this,e=t.det3();if(0===e)return null;const n=1/e,i=t.clone();return i.m00=(t.m11*t.m22-t.m12*t.m21)*n,i.m01=(t.m02*t.m21-t.m01*t.m22)*n,i.m02=(t.m01*t.m12-t.m02*t.m11)*n,i.m10=(t.m12*t.m20-t.m10*t.m22)*n,i.m11=(t.m00*t.m22-t.m02*t.m20)*n,i.m12=(t.m02*t.m10-t.m00*t.m12)*n,i.m20=(t.m10*t.m21-t.m11*t.m20)*n,i.m21=(t.m01*t.m20-t.m00*t.m21)*n,i.m22=(t.m00*t.m11-t.m01*t.m10)*n,i}det4(){const t=this;let e;return e=t.m00*t.m11*t.m22*t.m33,e+=t.m00*t.m12*t.m23*t.m31,e+=t.m00*t.m13*t.m21*t.m32,e+=t.m01*t.m10*t.m23*t.m32,e+=t.m01*t.m12*t.m20*t.m33,e+=t.m01*t.m13*t.m22*t.m30,e+=t.m02*t.m10*t.m21*t.m33,e+=t.m02*t.m11*t.m23*t.m30,e+=t.m02*t.m13*t.m20*t.m31,e+=t.m03*t.m10*t.m22*t.m31,e+=t.m03*t.m11*t.m20*t.m32,e+=t.m03*t.m12*t.m21*t.m30,e-=t.m00*t.m11*t.m23*t.m32,e-=t.m00*t.m12*t.m21*t.m33,e-=t.m00*t.m13*t.m22*t.m31,e-=t.m01*t.m10*t.m22*t.m33,e-=t.m01*t.m12*t.m23*t.m30,e-=t.m01*t.m13*t.m20*t.m32,e-=t.m02*t.m10*t.m23*t.m31,e-=t.m02*t.m11*t.m20*t.m33,e-=t.m02*t.m13*t.m21*t.m30,e-=t.m03*t.m10*t.m21*t.m32,e-=t.m03*t.m11*t.m22*t.m30,e-=t.m03*t.m12*t.m20*t.m31}inverse4(){const t=this,e=t.det4();if(0===e)return null;const n=1/e,i=new S3Matrix;return i.m00=(t.m11*t.m22*t.m33+t.m12*t.m23*t.m31+t.m13*t.m21*t.m32-t.m11*t.m23*t.m32-t.m12*t.m21*t.m33-t.m13*t.m22*t.m31)*n,i.m01=(t.m01*t.m23*t.m32+t.m02*t.m21*t.m33+t.m03*t.m22*t.m31-t.m01*t.m22*t.m33-t.m02*t.m23*t.m31-t.m03*t.m21*t.m32)*n,i.m02=(t.m01*t.m12*t.m33+t.m02*t.m13*t.m31+t.m03*t.m11*t.m32-t.m01*t.m13*t.m32-t.m02*t.m11*t.m33-t.m03*t.m12*t.m31)*n,i.m03=(t.m01*t.m13*t.m22+t.m02*t.m11*t.m23+t.m03*t.m12*t.m21-t.m01*t.m12*t.m23-t.m02*t.m13*t.m21-t.m03*t.m11*t.m22)*n,i.m10=(t.m10*t.m23*t.m32+t.m12*t.m20*t.m33+t.m13*t.m22*t.m30-t.m10*t.m22*t.m33-t.m12*t.m23*t.m30-t.m13*t.m20*t.m32)*n,i.m11=(t.m00*t.m22*t.m33+t.m02*t.m23*t.m30+t.m03*t.m20*t.m32-t.m00*t.m23*t.m32-t.m02*t.m20*t.m33-t.m03*t.m22*t.m30)*n,i.m12=(t.m00*t.m13*t.m32+t.m02*t.m10*t.m33+t.m03*t.m12*t.m30-t.m00*t.m12*t.m33-t.m02*t.m13*t.m30-t.m03*t.m10*t.m32)*n,i.m13=(t.m00*t.m12*t.m23+t.m02*t.m13*t.m20+t.m03*t.m10*t.m22-t.m00*t.m13*t.m22-t.m02*t.m10*t.m23-t.m03*t.m12*t.m20)*n,i.m20=(t.m10*t.m21*t.m33+t.m11*t.m23*t.m30+t.m13*t.m20*t.m31-t.m10*t.m23*t.m31-t.m11*t.m20*t.m33-t.m13*t.m21*t.m30)*n,i.m21=(t.m00*t.m23*t.m31+t.m01*t.m20*t.m33+t.m03*t.m21*t.m30-t.m00*t.m21*t.m33-t.m01*t.m23*t.m30-t.m03*t.m20*t.m31)*n,i.m22=(t.m00*t.m11*t.m33+t.m01*t.m13*t.m30+t.m03*t.m10*t.m31-t.m00*t.m13*t.m31-t.m01*t.m10*t.m33-t.m03*t.m11*t.m30)*n,i.m23=(t.m00*t.m13*t.m21+t.m01*t.m10*t.m23+t.m03*t.m11*t.m20-t.m00*t.m11*t.m23-t.m01*t.m13*t.m20-t.m03*t.m10*t.m21)*n,i.m30=(t.m10*t.m22*t.m31+t.m11*t.m20*t.m32+t.m12*t.m21*t.m30-t.m10*t.m21*t.m32-t.m11*t.m22*t.m30-t.m12*t.m20*t.m31)*n,i.m31=(t.m00*t.m21*t.m32+t.m01*t.m22*t.m30+t.m02*t.m20*t.m31-t.m00*t.m22*t.m31-t.m01*t.m20*t.m32-t.m02*t.m21*t.m30)*n,i.m32=(t.m00*t.m12*t.m31+t.m01*t.m10*t.m32+t.m02*t.m11*t.m30-t.m00*t.m11*t.m32-t.m01*t.m12*t.m30-t.m02*t.m10*t.m31)*n,i.m33=(t.m00*t.m11*t.m22+t.m01*t.m12*t.m20+t.m02*t.m10*t.m21-t.m00*t.m12*t.m21-t.m01*t.m10*t.m22-t.m02*t.m11*t.m20)*n,i}toString(){return"[["+this.m00+" "+this.m01+" "+this.m02+" "+this.m03+"]\n ["+this.m10+" "+this.m11+" "+this.m12+" "+this.m13+"]\n ["+this.m20+" "+this.m21+" "+this.m22+" "+this.m23+"]\n ["+this.m30+" "+this.m31+" "+this.m32+" "+this.m33+"]]"}toInstanceArray(t,e){return new t(1===e?[this.m00]:4===e?[this.m00,this.m10,this.m01,this.m11]:9===e?[this.m00,this.m10,this.m20,this.m01,this.m11,this.m21,this.m02,this.m12,this.m22]:[this.m00,this.m10,this.m20,this.m30,this.m01,this.m11,this.m21,this.m31,this.m02,this.m12,this.m22,this.m32,this.m03,this.m13,this.m23,this.m33])}}class S3Vector{constructor(t,e,n,i){this.x=t,this.y=e,this.z=void 0===n?0:n,this.w=void 0===i?1:i}clone(){return new S3Vector(this.x,this.y,this.z,this.w)}negate(){return new S3Vector(-this.x,-this.y,-this.z,this.w)}cross(t){return new S3Vector(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x,1)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}add(t){return new S3Vector(this.x+t.x,this.y+t.y,this.z+t.z,1)}sub(t){return new S3Vector(this.x-t.x,this.y-t.y,this.z-t.z,1)}mul(t){if(t instanceof S3Vector)return new S3Vector(this.x*t.x,this.y*t.y,this.z*t.z,1);if(t instanceof S3Matrix){const e=this,n=t;return new S3Vector(e.x*n.m00+e.y*n.m10+e.z*n.m20+e.w*n.m30,e.x*n.m01+e.y*n.m11+e.z*n.m21+e.w*n.m31,e.x*n.m02+e.y*n.m12+e.z*n.m22+e.w*n.m32,e.x*n.m03+e.y*n.m13+e.z*n.m23+e.w*n.m33)}if("number"==typeof t)return new S3Vector(this.x*t,this.y*t,this.z*t,1);throw"IllegalArgumentException"}setX(t){return new S3Vector(t,this.y,this.z,this.w)}setY(t){return new S3Vector(this.x,t,this.z,this.w)}setZ(t){return new S3Vector(this.x,this.y,t,this.w)}setW(t){return new S3Vector(this.x,this.y,this.z,t)}max(t){return new S3Vector(Math.max(this.x,t.x),Math.max(this.y,t.y),Math.max(this.z,t.z),Math.max(this.w,t.w))}min(t){return new S3Vector(Math.min(this.x,t.x),Math.min(this.y,t.y),Math.min(this.z,t.z),Math.min(this.w,t.w))}equals(t){return S3Math.equals(this.x,t.x)&&S3Math.equals(this.y,t.y)&&S3Math.equals(this.z,t.z)&&S3Math.equals(this.w,t.w)}mix(t,e){return new S3Vector(S3Math.mix(this.x,t.x,e),S3Math.mix(this.y,t.y,e),S3Math.mix(this.z,t.z,e),S3Math.mix(this.w,t.w,e))}norm(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normFast(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){let t=this.normFast();if(0===t)throw"divide error";return t=Math.sqrt(1/t),new S3Vector(this.x*t,this.y*t,this.z*t,1)}toString(t){return 1===t?"["+this.x+"]T":2===t?"["+this.x+","+this.y+"]T":3===t?"["+this.x+","+this.y+","+this.z+"]T":"["+this.x+","+this.y+","+this.z+","+this.w+"]T"}toHash(t){let e=321*parseFloat(this.x.toExponential(3).substring(0,5))&4294967295;return t>=2&&(e=12345*e+1e4*parseFloat(this.y.toExponential(4).substring(0,6))&4294967295),t>=3&&(e=12345*e+1e4*parseFloat(this.z.toExponential(4).substring(0,6))&4294967295),t>=4&&(e=12345*e+1e4*parseFloat(this.w.toExponential(4).substring(0,6))&4294967295),e}toInstanceArray(t,e){return new t(1===e?[this.x]:2===e?[this.x,this.y]:3===e?[this.x,this.y,this.z]:[this.x,this.y,this.z,this.w])}pushed(t,e){1===e?t.push(this.x):2===e?(t.push(this.x),t.push(this.y)):3===e?(t.push(this.x),t.push(this.y),t.push(this.z)):(t.push(this.x),t.push(this.y),t.push(this.z),t.push(this.w))}getDirection(t){return t.sub(this)}getDirectionNormalized(t){return t.sub(this).normalize()}getDistance(t){return this.getDirection(t).norm()}isNaN(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.z)||isNaN(this.w)}isFinite(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)&&isFinite(this.w)}isRealNumber(){return!this.isNaN()&&this.isFinite()}static getNormalVector(t,e,n,i,s,o){let r;for(;;){const h=t.getDirection(e),a=t.getDirection(n);try{r=h.cross(a).normalize()}catch(t){r=new S3Vector(.3333,.3333,.3333);break}if(null===i|null===s|null===o)break;const l=i.getDirection(s),u=i.getDirection(o);let c;try{c=1/l.cross(u).z;const t=new S3Vector,e=new S3Vector;return t.x=c*(u.y*h.x-l.y*a.x),t.y=c*(u.y*h.y-l.y*a.y),t.z=c*(u.y*h.z-l.y*a.z),e.x=c*(-u.x*h.x+l.x*a.x),e.y=c*(-u.x*h.y+l.x*a.y),e.z=c*(-u.x*h.z+l.x*a.z),{normal:r,tangent:t.normalize(),binormal:e.normalize()}}catch(t){break}}return{normal:r,tangent:null,binormal:null}}static isClockwise(t,e,n){const i=t.getDirection(e).setZ(0),s=t.getDirection(n).setZ(0),o=i.cross(s).z;return 0===o?null:o>0}}S3Vector.ZERO=new S3Vector(0,0,0);class S3Camera{constructor(t){this.sys=t,this.init()}dispose(){this.sys=null,this.fovY=0,this.eye=null,this.center=null,this.near=0,this.far=0}init(){this.fovY=45,this.eye=new S3Vector(0,0,0),this.center=new S3Vector(0,0,1),this.near=1,this.far=1e3}clone(){const t=new S3Camera(this.sys);return t.fovY=this.fovY,t.eye=this.eye,t.center=this.center,t.near=this.near,t.far=this.far,t}getVPSMatrix(t){const e=S3System.calcAspect(t.width,t.height);return{LookAt:this.sys.getMatrixLookAt(this.eye,this.center),aspect:e,PerspectiveFov:this.sys.getMatrixPerspectiveFov(this.fovY,e,this.near,this.far),Viewport:this.sys.getMatrixViewport(0,0,t.width,t.height)}}setDrawRange(t,e){this.near=t,this.far=e}setFovY(t){this.fovY=t}setEye(t){this.eye=t.clone()}setCenter(t){this.center=t.clone()}getDirection(){return this.eye.getDirectionNormalized(this.center)}getDistance(){return this.center.getDistance(this.eye)}setDistance(t){const e=this.center.getDirectionNormalized(this.eye);this.eye=this.center.add(e.mul(t))}getRotateY(){const t=this.center.getDirection(this.eye);return S3Math.degrees(Math.atan2(t.x,t.z))}setRotateY(t){const e=S3Math.radius(t),n=this.center.getDirection(this.eye).setY(0).norm(),i=Math.cos(e),s=Math.sin(e);this.eye=new S3Vector(this.center.x+n*s,this.eye.y,this.center.z+n*i)}addRotateY(t){this.setRotateY(this.getRotateY()+t)}getRotateX(){const t=this.center.getDirection(this.eye);return S3Math.degrees(Math.atan2(t.z,t.y))}setRotateX(t){const e=S3Math.radius(t),n=this.center.getDirection(this.eye).setX(0).norm(),i=Math.cos(e),s=Math.sin(e);this.eye=new S3Vector(this.eye.x,this.center.y+n*i,this.center.z+n*s)}addRotateX(t){this.setRotateX(this.getRotateX()+t)}translateAbsolute(t){this.eye=this.eye.add(t),this.center=this.center.add(t)}translateRelative(t){let e,n,i;const s=new S3Vector(0,1,0);i=this.eye.getDirectionNormalized(this.center),this.sys.dimensionmode===S3System.DIMENSION_MODE.RIGHT_HAND&&(i=i.negate()),e=s.cross(i).normalize(),n=i.cross(e),e=e.mul(t.x),n=n.mul(t.y),i=i.mul(t.z),this.translateAbsolute(e.add(n).add(i))}toString(){return"camera[\neye   :"+this.eye+",\ncenter:"+this.center+",\nfovY  :"+this.fovY+"]"}}class S3Light{constructor(){this.init()}init(){this.mode=S3Light.MODE.DIRECTIONAL_LIGHT,this.power=1,this.range=1e3,this.position=new S3Vector(0,0,0),this.direction=new S3Vector(0,0,-1),this.color=new S3Vector(1,1,1)}clone(t){t||(t=S3Light);const e=new t;return e.mode=this.mode,e.power=this.power,e.range=this.range,e.position=this.position,e.direction=this.direction,e.color=this.color,e}setMode(t){this.mode=t}setPower(t){this.power=t}setRange(t){this.range=t}setPosition(t){this.position=t}setDirection(t){this.direction=t}setColor(t){this.color=t}}S3Light.MODE={NONE:0,AMBIENT_LIGHT:1,DIRECTIONAL_LIGHT:2,POINT_LIGHT:3};class S3Material{constructor(t,e){this.sys=t,this.name="s3default",void 0!==e&&(this.name=e),this.color=new S3Vector(1,1,1,1),this.diffuse=.8,this.emission=new S3Vector(0,0,0),this.specular=new S3Vector(0,0,0),this.power=5,this.ambient=new S3Vector(.6,.6,.6),this.reflect=0,this.textureColor=this.sys.createTexture(),this.textureNormal=this.sys.createTexture()}dispose(){}setName(t){this.name=t}setColor(t){this.color=this.sys._toVector3(t)}setDiffuse(t){this.diffuse=this.sys._toValue(t)}setEmission(t){this.emission=this.sys._toVector3(t)}setSpecular(t){this.specular=this.sys._toVector3(t)}setPower(t){this.power=this.sys._toValue(t)}setAmbient(t){this.ambient=this.sys._toVector3(t)}setReflect(t){this.reflect=this.sys._toValue(t)}setTextureColor(t){null!==this.textureColor&&this.textureColor.dispose(),this.textureColor=this.sys.createTexture(),this.textureColor.setImage(t)}setTextureNormal(t){null!==this.textureNormal&&this.textureNormal.dispose(),this.textureNormal=this.sys.createTexture(),this.textureNormal.setImage(t)}}class S3Vertex{constructor(t){this.position=t}clone(t){return t||(t=S3Vertex),new t(this.position)}}class S3TriangleIndex{constructor(t,e,n,i,s,o){this._init(t,e,n,i,s,o)}_init(t,e,n,i,s,o){if(this.index=null,this.uv=null,this.materialIndex=null,!(i instanceof Array&&i.length>0))throw"IllegalArgumentException";this.index=[i[t],i[e],i[n]],void 0!==o&&o instanceof Array&&o.length>0&&o[0]instanceof S3Vector?this.uv=[o[t],o[e],o[n]]:this.uv=[null,null,null],s=(s=s||0)>=0?s:0,this.materialIndex=s}clone(t){return t||(t=S3TriangleIndex),new t(0,1,2,this.index,this.materialIndex,this.uv)}inverseTriangle(t){return t||(t=S3TriangleIndex),new t(2,1,0,this.index,this.materialIndex,this.uv)}}class S3Mesh{constructor(t){this.sys=t,this._init()}_init(){this.src={},this.src.vertex=[],this.src.triangleindex=[],this.src.material=[],this.is_complete=!1}isComplete(){return this.is_complete}clone(t){t||(t=S3Mesh);const e=new t(this.sys);return e.addVertex(this.getVertexArray()),e.addTriangleIndex(this.getTriangleIndexArray()),e.addMaterial(this.getMaterialArray()),e}setComplete(t){this.is_complete=t}setInverseTriangle(t){this.setComplete(!1),this.is_inverse=t}getVertexArray(){return this.src.vertex}getTriangleIndexArray(){return this.src.triangleindex}getMaterialArray(){return this.src.material}addVertex(t){this.setComplete(!1);const e=this.getVertexArray();if(void 0===t);else if(t instanceof S3Vertex)e[e.length]=t;else for(let n=0;n<t.length;n++)e[e.length]=t[n]}addTriangleIndex(t){this.setComplete(!1);const e=this.getTriangleIndexArray();if(void 0===t);else if(t instanceof S3TriangleIndex)e[e.length]=this.is_inverse?t.inverseTriangle():t;else for(let n=0;n<t.length;n++)e[e.length]=this.is_inverse?t[n].inverseTriangle():t[n]}addMaterial(t){this.setComplete(!1);const e=this.getMaterialArray();if(void 0===t);else if(t instanceof S3Material)e[e.length]=t;else for(let n=0;n<t.length;n++)e[e.length]=t[n]}}class S3Angles{constructor(t,e,n){this.setRotateZXY(t,e,n)}static _toPeriodicAngle(t){return t>S3Angles.PI?t-S3Angles.PI2*parseInt((t+S3Angles.PI)/S3Angles.PI2):t<-S3Angles.PI?t+S3Angles.PI2*parseInt((-t+S3Angles.PI)/S3Angles.PI2):t}clone(){return new S3Angles(this.roll,this.pitch,this.yaw)}setRotateZXY(t,e,n){this.roll=S3Angles._toPeriodicAngle(isNaN(t)?0:t),this.pitch=S3Angles._toPeriodicAngle(isNaN(e)?0:e),this.yaw=S3Angles._toPeriodicAngle(isNaN(n)?0:n)}addRotateX(t){return new S3Angles(this.roll,this.pitch+t,this.yaw)}addRotateY(t){return new S3Angles(this.roll,this.pitch,this.yaw+t)}addRotateZ(t){return new S3Angles(this.roll+t,this.pitch,this.yaw)}setRotateX(t){return new S3Angles(this.roll,t,this.yaw)}setRotateY(t){return new S3Angles(this.roll,this.pitch,t)}setRotateZ(t){return new S3Angles(t,this.pitch,this.yaw)}toString(){return"angles["+this.roll+","+this.pitch+","+this.yaw+"]"}}S3Angles.PI=180,S3Angles.PIOVER2=S3Angles.PI/2,S3Angles.PILOCK=S3Angles.PIOVER2-1e-4,S3Angles.PI2=2*S3Angles.PI;class S3Model{constructor(){this._init()}_init(){this.angles=new S3Angles,this.scale=new S3Vector(1,1,1),this.position=new S3Vector(0,0,0),this.mesh=new S3Mesh}setMesh(t){this.mesh=t}getMesh(){return this.mesh}setScale(t,e,n){1===arguments.length?"number"==typeof t?this.scale=new S3Vector(t,t,t):t instanceof S3Vector&&(this.scale=t):this.scale=new S3Vector(t,e,n)}getScale(){return this.scale}setPosition(t,e,n){1===arguments.length&&t instanceof S3Vector?this.position=t:this.position=new S3Vector(t,e,n)}getPosition(){return this.position}getAngle(){return this.angles}setAngle(t){this.angles=t}addRotateX(t){this.angles=this.angles.addRotateX(t)}addRotateY(t){this.angles=this.angles.addRotateY(t)}addRotateZ(t){this.angles=this.angles.addRotateZ(t)}setRotateX(t){this.angles=this.angles.setRotateX(t)}setRotateY(t){this.angles=this.angles.setRotateY(t)}setRotateZ(t){this.angles=this.angles.addRotateZ(t)}}class S3Scene{constructor(){this._init()}_init(){this.camera=new S3Camera,this.model=[],this.light=[]}empty(){this.model=[],this.light=[]}setCamera(t){this.camera=t.clone()}addModel(t){this.model[this.model.length]=t}addLight(t){this.light[this.light.length]=t}getCamera(){return this.camera}getModels(){return this.model}getLights(){return this.light}}class S3Texture{constructor(t,e){this.sys=t,this._init(),void 0!==e&&this.setImage(e)}_init(){this.url=null,this.image=null,this.is_loadimage=!1,this.is_dispose=!1}dispose(){this.is_dispose||(this.is_dispose=!0)}setImage(t){if(null!==t&&!this.is_dispose){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){const e=t.width,n=t.height,i=function(t){const e=Math.log(t)/Math.log(2);return e-Math.floor(e)<1e-10?t:1<<Math.ceil(e)},s=i(e),o=i(n);if(e!==s||n!==o){const i=document.createElement("canvas");i.width=s,i.height=o,i.getContext("2d").drawImage(t,0,0,e,n,0,0,s,o),t=i}}if(t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)return null===this.url&&(this.url=this.sys._createID()),this.image=t,void(this.is_loadimage=!0);if("string"==typeof t||t instanceof String){this.url=t;const e=this;return void this.sys._download(this.url,function(t){e.setImage(t)})}console.log("not setImage"),console.log(t)}}}class S3System{constructor(){this._init()}_init(){this.setSystemMode(S3System.SYSTEM_MODE.OPEN_GL),this.setBackgroundColor(new S3Vector(1,1,1,1))}_createID(){void 0===this._CREATE_ID1&&(this._CREATE_ID1=0,this._CREATE_ID2=0,this._CREATE_ID3=0,this._CREATE_ID4=0);const t=this._CREATE_ID4.toString(16)+":"+this._CREATE_ID3.toString(16)+":"+this._CREATE_ID2.toString(16)+":"+this._CREATE_ID1.toString(16);if(4294967296===++this._CREATE_ID1&&(this._CREATE_ID1=0,4294967296===++this._CREATE_ID2&&(this._CREATE_ID2=0,4294967296===++this._CREATE_ID3&&(this._CREATE_ID3=0,4294967296===++this._CREATE_ID4))))throw this._CREATE_ID4=0,"createID";return t}_download(t,e){const n=t.split(".");let i=!1;if(n.length>1){const t=n[n.length-1].toLocaleString();i="gif"===t||"jpg"===t||"png"===t||"bmp"===t||"svg"===t||"jpeg"===t}if(i){const n=new Image;return n.onload=function(){e(n,"")},void(n.src=t)}const s=new XMLHttpRequest,o=function(){if(4===s.readyState){if(200!==s.status)return console.log("error download ["+t+"]"),null;e(s.responseText,"")}};s.onreadystatechange=o,s.open("GET",t,!0),s.send(null)}_toVector3(t){if(t instanceof S3Vector)return t;if(isNaN(t)){if(t instanceof Array)return new S3Vector(t[0],t[1],t[2]);throw"IllegalArgumentException"}return new S3Vector(t,t,t)}_toValue(t){if(isNaN(t))throw"IllegalArgumentException";return t}setBackgroundColor(t){this.backgroundColor=t}getBackgroundColor(){return this.backgroundColor}setSystemMode(t){this.systemmode=t,this.systemmode===S3System.SYSTEM_MODE.OPEN_GL?(this.depthmode=S3System.DEPTH_MODE.OPEN_GL,this.dimensionmode=S3System.DIMENSION_MODE.RIGHT_HAND,this.vectormode=S3System.VECTOR_MODE.VECTOR4x1,this.frontface=S3System.FRONT_FACE.COUNTER_CLOCKWISE,this.cullmode=S3System.CULL_MODE.BACK):(this.depthmode=S3System.DEPTH_MODE.DIRECT_X,this.dimensionmode=S3System.DIMENSION_MODE.LEFT_HAND,this.vectormode=S3System.VECTOR_MODE.VECTOR1x4,this.frontface=S3System.FRONT_FACE.CLOCKWISE,this.cullmode=S3System.CULL_MODE.BACK)}setDepthMode(t){this.depthmode=t}setDimensionMode(t){this.dimensionmode=t}setVectorMode(t){this.vectormode=t}setFrontMode(t){this.frontface=t}setCullMode(t){this.cullmode=t}setCanvas(t){const e=this,n=t.getContext("2d");this.canvas=t,this.context2d={context:n,drawLine:function(t,e){n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.stroke()},drawLinePolygon:function(t,e,i){n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.lineTo(i.x,i.y),n.closePath(),n.stroke()},setLineWidth:function(t){n.lineWidth=t},setLineColor:function(t){n.strokeStyle=t},clear:function(){const t=e.getBackgroundColor();n.clearRect(0,0,e.canvas.width,e.canvas.height),n.fillStyle="rgba("+255*t.x+","+255*t.y+","+255*t.z+","+t.w+")",n.fillRect(0,0,e.canvas.width,e.canvas.height)}}}testCull(t,e,n){if(this.cullmode===S3System.CULL_MODE.NONE)return!1;if(this.cullmode===S3System.CULL_MODE.FRONT_AND_BACK)return!0;const i=S3Vector.isClockwise(t,e,n);return null===i||(i?this.frontface===S3System.FRONT_FACE.CLOCKWISE?this.cullmode===S3System.CULL_MODE.BACK:this.cullmode===S3System.CULL_MODE.FRONT:this.frontface===S3System.FRONT_FACE.CLOCKWISE?this.cullmode!==S3System.CULL_MODE.BACK:this.cullmode!==S3System.CULL_MODE.FRONT)}getMatrixViewport(t,e,n,i,s,o){void 0===s&&(s=0),void 0===o&&(o=1);const r=new S3Matrix;return r.m00=n/2,r.m01=0,r.m02=0,r.m03=0,r.m10=0,r.m11=-i/2,r.m12=0,r.m13=0,r.m20=0,r.m21=0,r.m22=1,r.m23=1,r.m30=t+n/2,r.m31=e+i/2,r.m32=0,r.m33=1,this.depthmode===S3System.DEPTH_MODE.DIRECT_X?(r.m22=s-o,r.m32=s):this.depthmode===S3System.DEPTH_MODE.OPEN_GL&&(r.m22=(s-o)/2,r.m32=(s+o)/2),this.vectormode===S3System.VECTOR_MODE.VECTOR4x1?r.transposed():r}static calcFovY(t){return 2*Math.atan(1/t)}static calcAspect(t,e){return t/e}getMatrixPerspectiveFov(t,e,n,i){const s=S3Math.radius(t),o=1/Math.tan(s/2),r=o/e,h=new S3Matrix;h.m00=r,h.m01=0,h.m02=0,h.m03=0,h.m10=0,h.m11=o,h.m12=0,h.m13=0,h.m20=0,h.m21=0,h.m22=1,h.m23=1,h.m30=0,h.m31=0,h.m32=0,h.m33=0;const a=i-n;if(n>i)throw"Near > Far error";if(0===a)throw"divide error";return this.depthmode===S3System.DEPTH_MODE.DIRECT_X?(h.m22=i/a,h.m32=-i*n/a):this.depthmode===S3System.DEPTH_MODE.OPEN_GL&&(h.m22=(i+n)/a,h.m32=-2*i*n/a),this.dimensionmode===S3System.DIMENSION_MODE.RIGHT_HAND&&(h.m22=-h.m22,h.m23=-h.m23),this.vectormode===S3System.VECTOR_MODE.VECTOR4x1?h.transposed():h}getMatrixLookAt(t,e,n){void 0===n&&(n=new S3Vector(0,1,0));let i=t.getDirectionNormalized(e);this.dimensionmode===S3System.DIMENSION_MODE.RIGHT_HAND&&(i=i.negate());const s=n.cross(i).normalize(),o=i.cross(s),r=new S3Matrix;return r.m00=s.x,r.m01=o.x,r.m02=i.x,r.m03=0,r.m10=s.y,r.m11=o.y,r.m12=i.y,r.m13=0,r.m20=s.z,r.m21=o.z,r.m22=i.z,r.m23=0,r.m30=-s.dot(t),r.m31=-o.dot(t),r.m32=-i.dot(t),r.m33=1,this.vectormode===S3System.VECTOR_MODE.VECTOR4x1?r.transposed():r}getMatrixIdentity(){const t=new S3Matrix;return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m10=0,t.m11=1,t.m12=0,t.m13=0,t.m20=0,t.m21=0,t.m22=1,t.m23=0,t.m30=0,t.m31=0,t.m32=0,t.m33=1,t}getMatrixTranslate(t,e,n){const i=new S3Matrix;return i.m00=1,i.m01=0,i.m02=0,i.m03=0,i.m10=0,i.m11=1,i.m12=0,i.m13=0,i.m20=0,i.m21=0,i.m22=1,i.m23=0,i.m30=t,i.m31=e,i.m32=n,i.m33=1,this.vectormode===S3System.VECTOR_MODE.VECTOR4x1?i.transposed():i}getMatrixScale(t,e,n){const i=new S3Matrix;return i.m00=t,i.m01=0,i.m02=0,i.m03=0,i.m10=0,i.m11=e,i.m12=0,i.m13=0,i.m20=0,i.m21=0,i.m22=n,i.m23=0,i.m30=0,i.m31=0,i.m32=0,i.m33=1,this.vectormode===S3System.VECTOR_MODE.VECTOR4x1?i.transposed():i}getMatrixRotateX(t){const e=S3Math.radius(t),n=Math.cos(e),i=Math.sin(e),s=new S3Matrix;return s.m00=1,s.m01=0,s.m02=0,s.m03=0,s.m10=0,s.m11=n,s.m12=i,s.m13=0,s.m20=0,s.m21=-i,s.m22=n,s.m23=0,s.m30=0,s.m31=0,s.m32=0,s.m33=1,this.vectormode===S3System.VECTOR_MODE.VECTOR4x1?s.transposed():s}getMatrixRotateY(t){const e=S3Math.radius(t),n=Math.cos(e),i=Math.sin(e),s=new S3Matrix;return s.m00=n,s.m01=0,s.m02=-i,s.m03=0,s.m10=0,s.m11=1,s.m12=0,s.m13=0,s.m20=i,s.m21=0,s.m22=n,s.m23=0,s.m30=0,s.m31=0,s.m32=0,s.m33=1,this.vectormode===S3System.VECTOR_MODE.VECTOR4x1?s.transposed():s}getMatrixRotateZ(t){const e=S3Math.radius(t),n=Math.cos(e),i=Math.sin(e),s=new S3Matrix;return s.m00=n,s.m01=i,s.m02=0,s.m03=0,s.m10=-i,s.m11=n,s.m12=0,s.m13=0,s.m20=0,s.m21=0,s.m22=1,s.m23=0,s.m30=0,s.m31=0,s.m32=0,s.m33=1,this.vectormode===S3System.VECTOR_MODE.VECTOR4x1?s.transposed():s}mulMatrix(t,e){if(e instanceof S3Matrix)return this.vectormode===S3System.VECTOR_MODE.VECTOR4x1?e.mul(t):t.mul(e);if(e instanceof S3Vector)return this.vectormode===S3System.VECTOR_MODE.VECTOR4x1?t.mul(e):e.mul(t);throw"IllegalArgumentException"}getMatrixRotateZXY(t,e,n){const i=this.getMatrixRotateZ(t),s=this.getMatrixRotateX(e),o=this.getMatrixRotateY(n);return this.mulMatrix(this.mulMatrix(i,s),o)}getMatrixWorldTransform(t){const e=this.getMatrixRotateZXY(t.angles.roll,t.angles.pitch,t.angles.yaw),n=this.getMatrixScale(t.scale.x,t.scale.y,t.scale.z),i=this.getMatrixTranslate(t.position.x,t.position.y,t.position.z);return this.mulMatrix(this.mulMatrix(n,e),i)}clear(){this.context2d.clear()}_calcVertexTransformation(t,e,n){const i=[];for(let s=0;s<t.length;s++){let o=t[s].position;const r=(o=this.mulMatrix(e,o)).w;o=o.mul(1/r),o=this.mulMatrix(n,o),i[s]=new S3Vertex(o)}return i}drawAxis(t){const e=t.getCamera().getVPSMatrix(this.canvas),n=[];n[0]=new S3Vector(0,0,0),n[1]=new S3Vector(10,0,0),n[2]=new S3Vector(0,10,0),n[3]=new S3Vector(0,0,10);const i=[],s=this.mulMatrix(e.LookAt,e.PerspectiveFov);for(let t=0;t<n.length;t++){let o=n[t];o=(o=this.mulMatrix(s,o)).mul(1/o.w),o=this.mulMatrix(e.Viewport,o),i[t]=o}this.context2d.setLineWidth(3),this.context2d.setLineColor("rgb(255, 0, 0)"),this.context2d.drawLine(i[0],i[1]),this.context2d.setLineColor("rgb(0, 255, 0)"),this.context2d.drawLine(i[0],i[2]),this.context2d.setLineColor("rgb(0, 0, 255)"),this.context2d.drawLine(i[0],i[3])}_drawPolygon(t,e){for(let n=0;n<e.length;n++){const i=e[n];this.testCull(t[i.index[0]].position,t[i.index[1]].position,t[i.index[2]].position)||this.context2d.drawLinePolygon(t[i.index[0]].position,t[i.index[1]].position,t[i.index[2]].position)}}drawScene(t){const e=t.getCamera().getVPSMatrix(this.canvas);this.context2d.setLineWidth(1),this.context2d.setLineColor("rgb(0, 0, 0)");const n=t.getModels();for(let t=0;t<n.length;t++){const i=n[t],s=i.getMesh();if(!1!==s.isComplete()){const t=this.getMatrixWorldTransform(i),n=this.mulMatrix(this.mulMatrix(t,e.LookAt),e.PerspectiveFov),o=this._calcVertexTransformation(s.src.vertex,n,e.Viewport);this._drawPolygon(o,s.src.triangleindex)}}}_disposeObject(){}createVertex(t){return new S3Vertex(t)}createTriangleIndex(t,e,n,i,s,o){return new S3TriangleIndex(t,e,n,i,s,o)}createTexture(t){return new S3Texture(this,t)}createScene(){return new S3Scene}createModel(){return new S3Model}createMesh(){return new S3Mesh(this)}createMaterial(t){return new S3Material(this,t)}createLight(){return new S3Light}createCamera(){return new S3Camera(this)}}S3System.SYSTEM_MODE={OPEN_GL:0,DIRECT_X:1},S3System.DEPTH_MODE={OPEN_GL:0,DIRECT_X:1},S3System.DIMENSION_MODE={RIGHT_HAND:0,LEFT_HAND:1},S3System.VECTOR_MODE={VECTOR4x1:0,VECTOR1x4:1},S3System.FRONT_FACE={COUNTER_CLOCKWISE:0,CLOCKWISE:1},S3System.CULL_MODE={NONE:0,FRONT:1,BACK:2,FRONT_AND_BACK:3};class S3GLShader{constructor(t,e){this._init(t,e)}_init(t,e){this.sys=t,this.code=null,this.shader=null,this.sharder_type=-1,this.is_error=!1;const n=this,i=function(t){n.code=t};-1===e.indexOf("\n")?this.sys._download(e,i):this.code=e}isError(){return this.is_error}getCode(){return this.code}getShader(){const t=this.sys.getGL();if(null===t||this.is_error||null===this.code)return null;if(null!==this.shader)return this.shader;let e=this.code,n=0;n=-1!==(e=(e=e.replace(/\/\/.*/g,"")).replace(/\/\*([^*]|\*[^\/])*\*\//g,"")).indexOf("gl_FragColor")?t.FRAGMENT_SHADER:t.VERTEX_SHADER;const i=this.sys.glfunc.createShader(n,e);return i.is_error?(this.is_error=!0,null):(this.shader=i.shader,this.sharder_type=n,this.shader)}getShaderType(){return-1!==this.sharder_type?this.sharder_type:null!==this.getShader()?this.sharder_type:null}dispose(){return null===this.sys.getGL()?null:null===this.shader||(this.sys.glfunc.deleteShader(this.shader),this.shader=null,this.sharder_type=-1,!0)}}class S3GLArray{constructor(t,e,n){if(t instanceof n.instance)this.data=t;else if(t instanceof S3Vector||t instanceof S3Matrix)this.data=t.toInstanceArray(n.instance,e);else if(t instanceof Array)this.data=new n.instance(t);else{if(isNaN(t))throw"IllegalArgumentException";this.data=new n.instance([t])}this.dimension=e,this.datatype=n;let i="";i=t instanceof S3Vector?"S3Vector":t instanceof S3Matrix?"S3Matrix":"Number",this.glsltype=S3GLArray.gltypetable[n.name][i][e]}}S3GLArray.datatype={Float32Array:{instance:Float32Array,name:"Float32Array"},Int32Array:{instance:Int32Array,name:"Int32Array"}},S3GLArray.gltypetable={Float32Array:{Number:{1:"float",2:"vec2",3:"vec3",4:"vec4"},S3Vector:{2:"vec2",3:"vec3",4:"vec4"},S3Matrix:{4:"mat2",9:"mat3",16:"mat4"}},Int32Array:{Number:{1:"int",2:"ivec2",3:"ivec3",4:"ivec4"},S3Vector:{2:"ivec2",3:"ivec3",4:"ivec4"}}};class S3GLProgram{constructor(t,e){this._init(t,e)}_init(t,e){this.id=e,this.sys=t,this.vertex=null,this.fragment=null,this.isDLVertex=!1,this.isDLFragment=!1,this.program=null,this.is_linked=!1,this.is_error=!1,this.enable_vertex_number={};const n={};n.attribute={},n.uniform={},n.modifiers=[],n.datatype=[],this.variable=n;const i=this;this.activeTextureId=0;const s={uniform1iv:function(e,n){t.getGL()&&t.getGL().uniform1iv(e,n)},uniform2iv:function(e,n){t.getGL()&&t.getGL().uniform2iv(e,n)},uniform3iv:function(e,n){t.getGL()&&t.getGL().uniform3iv(e,n)},uniform4iv:function(e,n){t.getGL()&&t.getGL().uniform4iv(e,n)},uniform1fv:function(e,n){t.getGL()&&t.getGL().uniform1fv(e,n)},uniform2fv:function(e,n){t.getGL()&&t.getGL().uniform2fv(e,n)},uniform3fv:function(e,n){t.getGL()&&t.getGL().uniform3fv(e,n)},uniform4fv:function(e,n){t.getGL()&&t.getGL().uniform4fv(e,n)},uniformMatrix2fv:function(e,n){t.getGL()&&t.getGL().uniformMatrix2fv(e,!1,n)},uniformMatrix3fv:function(e,n){t.getGL()&&t.getGL().uniformMatrix3fv(e,!1,n)},uniformMatrix4fv:function(e,n){t.getGL()&&t.getGL().uniformMatrix4fv(e,!1,n)},uniformSampler2D:function(e,n){const s=t.getGL();s&&(s.activeTexture(s.TEXTURE0+i.activeTextureId),s.bindTexture(s.TEXTURE_2D,n),s.uniform1i(e,i.activeTextureId),i.activeTextureId++)}},o={int:{glsltype:"int",instance:Int32Array,size:1,btype:"INT",bind:s.uniform1iv},float:{glsltype:"float",instance:Float32Array,size:1,btype:"FLOAT",bind:s.uniform1fv},bool:{glsltype:"bool",instance:Int32Array,size:1,btype:"INT",bind:s.uniform1iv},mat2:{glsltype:"mat2",instance:Float32Array,size:4,btype:"FLOAT",bind:s.uniformMatrix2fv},mat3:{glsltype:"mat3",instance:Float32Array,size:9,btype:"FLOAT",bind:s.uniformMatrix3fv},mat4:{glsltype:"mat4",instance:Float32Array,size:16,btype:"FLOAT",bind:s.uniformMatrix4fv},vec2:{glsltype:"vec2",instance:Float32Array,size:2,btype:"FLOAT",bind:s.uniform2fv},vec3:{glsltype:"vec3",instance:Float32Array,size:3,btype:"FLOAT",bind:s.uniform3fv},vec4:{glsltype:"vec4",instance:Float32Array,size:4,btype:"FLOAT",bind:s.uniform4fv},ivec2:{glsltype:"ivec2",instance:Int32Array,size:2,btype:"INT",bind:s.uniform2iv},ivec3:{glsltype:"ivec3",instance:Int32Array,size:3,btype:"INT",bind:s.uniform3iv},ivec4:{glsltype:"ivec4",instance:Int32Array,size:4,btype:"INT",bind:s.uniform4iv},bvec2:{glsltype:"bvec2",instance:Int32Array,size:2,btype:"INT",bind:s.uniform2iv},bvec3:{glsltype:"bvec3",instance:Int32Array,size:3,btype:"INT",bind:s.uniform3iv},bvec4:{glsltype:"bvec4",instance:Int32Array,size:4,btype:"INT",bind:s.uniform4iv},sampler2D:{glsltype:"sampler2D",instance:Image,size:1,btype:"TEXTURE",bind:s.uniformSampler2D},samplerCube:{glsltype:"samplerCube",instance:Image,size:1,btype:"TEXTURE",bind:null}};this.analysisShader=function(t,e){const n=(t=(t=t.replace(/\/\/.*/g,"")).replace(/\/\*([^*]|\*[^\/])*\*\//g,"")).split("\n");for(let t=0;t<n.length;t++){const i=n[t].match(/(attribute|uniform)\s+(\w+)\s+(\w+)\s*(\[\s*\w+\s*\])?;/);if(null!==i){const t=i[1],n=i[2],s=i[3],r=i[4],h=void 0!==r,a=o[n];e[s]={};for(const t in a)e[s][t]=a[t];e[s].name=s,e[s].modifiers=t,e[s].is_array=h,e[s].location=[]}}}}resetActiveTextureId(){this.activeTextureId=0}isLinked(){return this.is_linked}dispose(){return null!==this.sys.getGL()&&(this.is_linked&&(this.disuseProgram(),this.sys.glfunc.deleteProgram(this.program,this.vertex.getShader(),this.fragment.getShader()),this.program=null,this.is_linked=!1),null!==this.vertex&&(this.vertex.dispose(),this.vertex=null),null!==this.fragment&&(this.fragment.dispose(),this.fragment=null),this._init(this.sys,this.id),!0)}setVertexShader(t){return!this.isLinked()&&(null!==this.vertex&&(this.vertex.dispose(),this.vertex=null),this.vertex=new S3GLShader(this.sys,t),this.is_error=!1,!0)}setFragmentShader(t){return!this.isLinked()&&(null!==this.fragment&&(this.fragment.dispose(),this.fragment=null),this.fragment=new S3GLShader(this.sys,t),this.is_error=!1,!0)}useProgram(){if(!this.isLinked())return!1;const t=this.getProgram();return t&&this.sys.getGL()&&this.sys.getGL().useProgram(t),!0}disuseProgram(){if(!this.isLinked())return!1;const t=this.sys.getGL();if(t){for(const e in this.enable_vertex_number)t.disableVertexAttribArray(e);this.enable_vertex_number={}}return!0}getProgram(){const t=this.sys.getGL();if(null===t||this.is_error)return null;if(this.isDLVertex||this.isDLFragment)return null;if(this.isLinked())return this.program;if(null===this.vertex)return console.log("do not set VERTEX_SHADER"),this.is_error=!0,null;if(null===this.fragment)return console.log("do not set FRAGMENT_SHADER"),this.is_error=!0,null;const e=this.vertex.isError(),n=this.fragment.isError();if(e||n)return console.log("shader compile error"),this.is_error=!0,null;const i=this.vertex.getShader(),s=this.fragment.getShader();if(null===i||null===s)return null;if(this.vertex.getShaderType()!==t.VERTEX_SHADER)return console.log("VERTEX_SHADER is not VERTEX_SHADER"),this.is_error=!0,null;if(this.fragment.getShaderType()!==t.FRAGMENT_SHADER)return console.log("FRAGMENT_SHADER is not FRAGMENT_SHADER"),this.is_error=!0,null;const o=this.sys.glfunc.createProgram(i,s);return o.is_error?(this.is_error=!0,null):(this.is_linked=!0,this.program=o.program,this.analysisShader(this.vertex.getCode(),this.variable),this.analysisShader(this.fragment.getCode(),this.variable),this.program)}bindData(t,e){if(!this.isLinked())return!1;const n=this.sys.getGL(),i=this.getProgram(),s=this.variable[t];if(void 0===s)return!1;if(0===s.location.length)if("attribute"===s.modifiers)s.location[0]=n.getAttribLocation(i,t);else if(s.is_array)for(let o=0;o<e.length;o++)s.location[o]=n.getUniformLocation(i,t+"["+o+"]");else s.location[0]=n.getUniformLocation(i,t);if(-1===s.location[0])return!1;const o=function(t){if(t instanceof WebGLBuffer&&"attribute"===s.modifiers)return t;if(t instanceof WebGLTexture&&"sampler2D"===s.glsltype)return t;if(t instanceof s.instance)return t;if(t instanceof S3GLArray&&s.glsltype===t.glsltype)return t.data;if(t instanceof S3Matrix&&("mat2"===s.glsltype||"mat3"===s.glsltype||"mat4"===s.glsltype))return t.toInstanceArray(s.instance,s.size);if(t instanceof S3Vector&&("vec2"===s.glsltype||"vec3"===s.glsltype||"vec4"===s.glsltype||"ivec2"===s.glsltype||"ivec3"===s.glsltype||"ivec4"===s.glsltype||"bvec2"===s.glsltype||"bvec3"===s.glsltype||"bvec4"===s.glsltype))return t.toInstanceArray(s.instance,s.size);if(("number"==typeof t||t instanceof Number)&&("int"===s.glsltype||"float"===s.glsltype||"bool"===s.glsltype))return new s.instance([t]);throw console.log(t),"not toArraydata"};if(s.is_array)for(let t=0;t<e.length;t++)-1!==s.location[t]&&null!==e[t]&&(e[t]=o(e[t]));else e=o(e);if("attribute"===s.modifiers)n.bindBuffer(n.ARRAY_BUFFER,e),this.enable_vertex_number[s.location[0]]||(n.enableVertexAttribArray(s.location[0]),this.enable_vertex_number[s.location[0]]=!0),n.vertexAttribPointer(s.location[0],s.size,"FLOAT"===s.btype?n.FLOAT:n.SHORT,!1,0,0);else if(s.is_array)for(let t=0;t<e.length;t++)-1!==s.location[t]&&null!==e[t]&&s.bind(s.location[t],e[t]);else s.bind(s.location[0],e);return!0}bindMesh(t){if(!this.isLinked())return 0;const e=this.sys.getGL();if(null===e)return 0;const n=t.getGLData();if(null===n)return 0;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.ibo.data);const i=n.ibo.array_length;for(const t in this.variable)"uniform"!==this.variable[t].modifiers&&void 0!==n.vbo[t]&&this.bindData(t,n.vbo[t].data);return i}}class S3GLLight extends S3Light{constructor(){super()}clone(){return super.clone(S3GLLight)}getGLHash(){return""+this.mode+this.power+this.range+this.position.toString(3)+this.direction.toString(3)+this.color.toString(3)}getGLData(){const t=this.color.mul(this.power);let e=new S3Vector;return this.mode===S3Light.MODE.DIRECTIONAL_LIGHT?e=this.direction:this.mode===S3Light.MODE.POINT_LIGHT&&(e=this.position),{lightsData1:new S3GLArray([this.mode,this.range,e.x,e.y],4,S3GLArray.datatype.Float32Array),lightsData2:new S3GLArray([e.z,t.x,t.y,t.z],4,S3GLArray.datatype.Float32Array)}}}class S3GLMaterial extends S3Material{constructor(t,e){super(t,e)}getGLHash(){return this.name}getGLData(){let t=this.textureColor.getGLData(),e=this.textureNormal.getGLData();const n=[null===t?0:1,null===e?0:1];return t=null===t?this.sys._getDummyTexture():t,e=null===e?this.sys._getDummyTexture():e,{materialsColorAndDiffuse:new S3GLArray([this.color.x,this.color.y,this.color.z,this.diffuse],4,S3GLArray.datatype.Float32Array),materialsSpecularAndPower:new S3GLArray([this.specular.x,this.specular.y,this.specular.z,this.power],4,S3GLArray.datatype.Float32Array),materialsEmission:new S3GLArray(this.emission,3,S3GLArray.datatype.Float32Array),materialsAmbientAndReflect:new S3GLArray([this.ambient.x,this.ambient.y,this.ambient.z,this.reflect],4,S3GLArray.datatype.Float32Array),materialsTextureExist:new S3GLArray(n,2,S3GLArray.datatype.Float32Array),materialsTextureColor:t,materialsTextureNormal:e}}}class S3GLTexture extends S3Texture{constructor(t,e){super(t,e),this.gldata=null}_init(){super._init(),this.gldata=null}dispose(){this.is_dispose||(this.is_dispose=!0,null!==this.gldata&&(this.sys._disposeObject(this),this.gldata=null))}getGLData(){return this.is_dispose?null:null!==this.gldata?this.gldata:this.is_loadimage?(this.gldata=this.sys.glfunc.createTexture(this.url,this.image),this.gldata):null}}class S3GLMesh extends S3Mesh{constructor(t){super(t)}_init(){super._init(),this.gldata={},this.is_compile_gl=!1}clone(){return super.clone(S3GLMesh)}isCompileGL(){return this.is_compile_gl}setCompileGL(t){this.is_compile_gl=t}createTriangleIndexData(){const t=this.getVertexArray(),e=this.getTriangleIndexArray(),n=[],i={normal:null,tangent:null,binormal:null};for(let s=0;s<e.length;s++){const o=e[s],r=o.index,h=o.uv;n[s]=o.createGLTriangleIndexData();const a=n[s];let l=null;l=this.sys.dimensionmode===S3System.DIMENSION_MODE.RIGHT_HAND?S3Vector.getNormalVector(t[r[0]].position,t[r[1]].position,t[r[2]].position,h[0],h[1],h[2]):S3Vector.getNormalVector(t[r[2]].position,t[r[1]].position,t[r[0]].position,h[2],h[1],h[0]);for(const t in i)a.face[t]=l[t]}const s=[],o=[];for(let t=0;t<e.length;t++){const r=e[t],h=r.materialIndex,a=n[t];void 0===s[h]&&(s[h]=[],o[h]=[]);const l=s[h],u=o[h];for(let t=0;t<3;t++){const e=r.index[t];void 0===l[e]&&(l[e]={normal:new S3Vector(0,0,0),tangent:new S3Vector(0,0,0),binormal:new S3Vector(0,0,0)},u[e]={normal:[],tangent:[],binormal:[]});const n=l[e],s=u[e];for(const t in i)if(null!==a.face[t]){const e=a.face[t].toHash(3);if(s[t][e])continue;n[t]=n[t].add(a.face[t]),s[t][e]=!0}}}for(const t in s){const e=s[t];for(const t in e){const n=e[t];for(const t in i)n[t].normFast()>1e-6&&(n[t]=n[t].normalize())}}const r={};r.normal=Math.cos(50/360*(2*Math.PI)),r.tangent=Math.cos(50/360*(2*Math.PI)),r.binormal=Math.cos(50/360*(2*Math.PI));for(let t=0;t<e.length;t++){const o=e[t],h=o.materialIndex,a=n[t],l=s[h];for(let t=0;t<3;t++){const e=o.index[t],n=l[e];for(const e in i){let i;if(a.face[e]){const t=a.face[e].dot(n[e]);i=t<r[e]?a.face:n}else i=n;a.vertex[e][t]=i[e]}}}return n}_getGLArrayData(){const t=this.getVertexArray(),e=this.createTriangleIndexData(),n=[];let i=0;const s=[],o={};for(let r=0;r<e.length;r++){const h=e[r],a=[];for(let e=0;e<3;e++){const s=h.getGLHash(e,t),r=n[s];if(a[e]=void 0!==r?r:i,void 0===r){const r=h.getGLData(e,t);n[s]=i;for(const t in r)void 0===o[t]&&(o[t]=[]),o[t].push(r[t]);i++}}s[r]=new Int16Array(a)}let r=0;const h={};h.array_length=3*e.length,h.array=new Int16Array(h.array_length),r=0;for(let t=0;t<e.length;t++)for(let e=0;e<3;e++)h.array[r++]=s[t][e];const a={};for(const t in o){const e=o[t],n=e[0].dimension,s={};s.name=t,s.dimension=e[0].dimension,s.datatype=e[0].datatype,s.array_length=n*i,s.array=new s.datatype.instance(s.array_length),r=0;for(let t=0;t<i;t++)for(let i=0;i<n;i++)s.array[r++]=e[t].data[i];a[t]=s}const l={};return l.ibo=h,l.vbo=a,l}disposeGLData(){if(this.isCompileGL()){const t=this.getGLData();if(null!==t){if(void 0!==t.ibo&&(void 0!==t.ibo.data&&this.sys.glfunc.deleteBuffer(t.ibo.data),delete t.ibo),void 0!==t.vbo){for(const e in t.vbo)void 0!==t.vbo[e].data&&this.sys.glfunc.deleteBuffer(t.vbo[e].data);delete t.vbo}{const t=this.getMaterialArray();for(let e=0;e<t.length;e++){const n=t[e];for(const t in n){const e=n[t];e instanceof S3GLTexture&&e.dispose()}}}}delete this.gldata,this.gldata={},this.setCompileGL(!1)}}getGLData(){if(this.isCompileGL())return this.gldata;if(!1===this.isComplete())return null;if(!this.sys.isSetGL())return null;const t=this._getGLArrayData();t.ibo.data=this.sys.glfunc.createBufferIBO(t.ibo.array);for(const e in t.vbo)t.vbo[e].data=this.sys.glfunc.createBufferVBO(t.vbo[e].array);return this.gldata=t,this.setCompileGL(!0),this.gldata}}class S3GLModel extends S3Model{constructor(){super()}getUniforms(){const t={};{const e=this.getMesh().getMaterialArray(),n=Math.min(e.length,4);for(let i=0;i<n;i++){const n=e[i].getGLData();for(const e in n)t[e]||(t[e]=[]),t[e].push(n[e])}}const e=[];return e.uniforms=t,e}}class S3GLScene extends S3Scene{constructor(){super()}getUniforms(){const t={};t.eyeWorldDirection=this.getCamera().getDirection();{const e=this.getLights(),n=Math.min(e.length,4);t.lightsLength=new S3GLArray(n,1,S3GLArray.datatype.Int32Array);for(let i=0;i<n;i++){const n=e[i].getGLData();for(const e in n)t[e]||(t[e]=[]),t[e].push(n[e])}}const e=[];return e.uniforms=t,e}}class S3GLTriangleIndexData{constructor(t){this.index=t.index,this.materialIndex=t.materialIndex,this.uv=t.uv,this._isEnabledTexture=null!==t.uv[0],this.face={},this.vertex={},this.face.normal=null,this.face.tangent=null,this.face.binormal=null,this.vertex.normal=[null,null,null],this.vertex.tangent=[null,null,null],this.vertex.binormal=[null,null,null]}getGLHash(t,e){const n=this._isEnabledTexture?this.uv[t].toString(2)+this.face.binormal.toString(2)+this.face.tangent.toString(2):"";return e[this.index[t]].getGLHash()+this.materialIndex+n+this.vertex.normal[t].toString(3)}getGLData(t,e){const n={},i=e[this.index[t]].getGLData();for(const t in i)n[t]=i[t];const s=this._isEnabledTexture?this.uv[t]:new S3Vector(0,0);return n.vertexTextureCoord=new S3GLArray(s,2,S3GLArray.datatype.Float32Array),n.vertexMaterialFloat=new S3GLArray(this.materialIndex,1,S3GLArray.datatype.Float32Array),n.vertexNormal=new S3GLArray(this.vertex.normal[t],3,S3GLArray.datatype.Float32Array),n.vertexBinormal=new S3GLArray(this.vertex.binormal[t],3,S3GLArray.datatype.Float32Array),n.vertexTangent=new S3GLArray(this.vertex.tangent[t],3,S3GLArray.datatype.Float32Array),n}}class S3GLTriangleIndex extends S3TriangleIndex{constructor(t,e,n,i,s,o){super(t,e,n,i,s,o)}clone(){return super.clone(S3GLTriangleIndex)}inverseTriangle(){return super.inverseTriangle(S3GLTriangleIndex)}createGLTriangleIndexData(){return new S3GLTriangleIndexData(this)}}class S3GLVertex extends S3Vertex{constructor(t){super(t)}clone(){return super.clone(S3GLVertex)}getGLHash(){return this.position.toString(3)}getGLData(){return{vertexPosition:new S3GLArray(this.position,3,S3GLArray.datatype.Float32Array)}}}class S3GLSystem extends S3System{constructor(){super(),this.program=null,this.gl=null,this.is_set=!1,this.program_list=[],this.program_listId=0;const t=this,e={};this.glfunc={createBufferVBO:function(e){const n=t.getGL();if(null===n)return null;const i=n.createBuffer();return n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),i},createBufferIBO:function(e){const n=t.getGL();if(null===n)return null;const i=n.createBuffer();return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),i},deleteBuffer:function(e){const n=t.getGL();null!==n&&n.deleteBuffer(e)},createTexture:function(n,i){if(!(i instanceof ImageData||i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement))throw"createBufferTexture";const s=t.getGL();if(null===s)return null;let o=null;if(!e[n]){o=s.createTexture(),s.bindTexture(s.TEXTURE_2D,o),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,i),s.generateMipmap(s.TEXTURE_2D),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,null);const t={};t.texture=o,t.count=0,e[n]=t}return o=e[n].texture,e[n].count++,o},deleteTexture:function(n){const i=t.getGL();null!==i&&e[n]&&0===--e[n].count&&(i.deleteBuffer(e[n].texture),delete e[n])},createProgram:function(e,n){const i=t.getGL();if(null===i)return null;let s=i.createProgram(),o=!1;return i.attachShader(s,e),i.attachShader(s,n),i.linkProgram(s),i.getProgramParameter(s,i.LINK_STATUS)||(console.log("link error "+i.getProgramInfoLog(s)),i.detachShader(s,e),i.detachShader(s,n),i.deleteProgram(s),s=null,o=!0),{program:s,is_error:o}},deleteProgram:function(e,n,i){const s=t.getGL();if(null===s)return null;s.detachShader(e,n),s.detachShader(e,i),s.deleteProgram(e)},createShader:function(e,n){const i=t.getGL();if(null===i)return null;let s=i.createShader(e),o=!1;return i.shaderSource(s,n),i.compileShader(s),i.getShaderParameter(s,i.COMPILE_STATUS)||(console.log("compile error "+i.getShaderInfoLog(s)),i.deleteShader(s),s=null,o=!0),{shader:s,is_error:o}},deleteShader:function(e){const n=t.getGL();if(null===n)return null;n.deleteShader(e)}}}getGL(){return this.gl}isSetGL(){return null!==this.gl}setCanvas(t){const e=t.getContext("webgl")||t.getContext("experimental-webgl");this.canvas=t,this.gl=e}createProgram(){const t=new S3GLProgram(this,this.program_listId);return this.program_list[this.program_listId]=t,this.program_listId++,t}disposeProgram(){for(const t in this.program_list)this.program_list[t].dispose(),delete this.program_list[t]}setProgram(t){if(null===t)return!1;if(!(t instanceof S3GLProgram))throw"not S3GLProgram";return null===this.program&&(this.program=t),null!==t.getProgram()&&(!(this.program!==t||!this.is_set)||(null!==this.program&&this.program.disuseProgram(),this.program=t,this.program.useProgram(),void(this.is_set=!0)))}clear(){if(null===this.gl)return!1;const t=this.getBackgroundColor();return this.gl.clearColor(t.x,t.y,t.z,t.w),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),!0}drawElements(t){this.is_set&&(this.gl.drawElements(this.gl.TRIANGLES,t,this.gl.UNSIGNED_SHORT,0),this.gl.flush())}deleteBuffer(t){if(null===this.gl)return null;this.gl.deleteBuffer(t)}_getDummyTexture(){if(void 0===this._textureDummyData){const t=document.createElement("canvas");t.width=1,t.height=1;const e=t.getContext("2d"),n=e.getImageData(0,0,t.width,t.height);this._textureDummyId=this._createID(),this._textureDummyData=this.glfunc.createTexture(this._textureDummyId,n)}return this._textureDummyData}_setDepthMode(){if(null===this.gl)return null;const t=this.gl;t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)}_setCullMode(){if(null===this.gl)return null;const t=this.gl;if(this.cullmode===S3System.CULL_MODE.NONE)return void t.disable(t.CULL_FACE);t.enable(t.CULL_FACE),this.frontface===S3System.FRONT_FACE.CLOCKWISE?t.frontFace(t.CW):t.frontFace(t.CCW),this.cullmode===S3System.CULL_MODE.FRONT_AND_BACK?t.cullFace(t.FRONT_AND_BACK):this.cullmode===S3System.CULL_MODE.BACK?t.cullFace(t.BACK):this.cullmode===S3System.CULL_MODE.FRONT&&t.cullFace(t.FRONT)}_bindStart(){this.program.resetActiveTextureId()}_bindEnd(){}_bind(t,e){if(this.is_set){const n=this.program;let i=0;if(2===arguments.length&&("string"==typeof t||t instanceof String))n.bindData(t,e);else if(1===arguments.length&&t instanceof S3GLModel){const e=t.getMesh();e instanceof S3GLMesh&&(i=n.bindMesh(e))}else if(1===arguments.length&&t.uniforms){const e=t.uniforms;for(const t in e)n.bindData(t,e[t])}return i}}drawScene(t){if(this.setProgram(this.program),this.is_set){this._setDepthMode(),this._setCullMode(),this._bindStart(),this._bind(t.getUniforms());const e=t.getCamera().getVPSMatrix(this.canvas),n=t.getModels();for(let t=0;t<n.length;t++){const i=n[t],s=i.getMesh();if(!1!==s.isComplete()){this._bind(i.getUniforms());const t=this.getMatrixWorldTransform(i),n=this.mulMatrix(t,e.LookAt),s=this.mulMatrix(n,e.PerspectiveFov);this._bind("matrixWorldToLocal4",t.inverse4()),this._bind("matrixLocalToWorld4",t),this._bind("matrixLocalToWorld3",t),this._bind("matrixLocalToPerspective4",s);const o=this._bind(i);o&&this.drawElements(o)}}this._bindEnd()}}_disposeObject(t){t instanceof S3GLTexture&&this.glfunc.deleteTexture(this.url)}createVertex(t){return new S3GLVertex(t)}createTriangleIndex(t,e,n,i,s,o){return new S3GLTriangleIndex(t,e,n,i,s,o)}createTexture(t){return new S3GLTexture(this,t)}createScene(){return new S3GLScene}createModel(){return new S3GLModel}createMesh(){return new S3GLMesh(this)}createMaterial(t){return new S3GLMaterial(this,t)}createLight(){return new S3GLLight}createCamera(){return new S3Camera(this)}}const DefaultMaterial={name:"s3default",color:new S3Vector(1,1,1,1),diffuse:.8,emission:new S3Vector(0,0,0),specular:new S3Vector(0,0,0),power:5,ambient:new S3Vector(.6,.6,.6),reflect:0,textureColor:null,textureNormal:null},S3MeshLoaderJSON={name:"JSON",input:function(sys,mesh,json){let meshdata;meshdata="string"==typeof json||json instanceof String?eval(json):json;let material=0;for(const t in meshdata.Indexes){mesh.addMaterial(sys.createMaterial(t));const e=meshdata.Indexes[t];for(let t=0;t<e.length;t++){const n=e[t];for(let t=0;t<n.length-2;t++){const e=t%2==0?sys.createTriangleIndex(t,t+1,t+2,n,material):sys.createTriangleIndex(t-1,t+1,t+2,n,material);mesh.addTriangleIndex(e)}}material++}for(let t=0;t<meshdata.Vertices.length;t++){const e=new S3Vector(meshdata.Vertices[t][0],meshdata.Vertices[t][1],meshdata.Vertices[t][2]),n=sys.createVertex(e);mesh.addVertex(n)}return!0},output:function(t){const e=t.getVertexArray(),n=t.getTriangleIndexArray(),i=t.getMaterialArray(),s=[],o=0!==i.length?i.length:1,r=DefaultMaterial;for(let t=0;t<o;t++)s[t]={material:i[t]?i[t]:r,list:[]};for(let t=0;t<n.length;t++){const e=n[t];s[e.materialIndex].list.push(e.index)}const h=[];h.push("{"),h.push("\tIndexes:{");for(let t=0;t<s.length;t++){const e=s[t];h.push("\t\t"+e.material.name+":[");for(let t=0;t<e.list.length;t++){const n=e.list[t];h.push("\t\t\t["+n[0]+" "+n[1]+" "+n[2]+"]"+(t===e.list.length-1?"":","))}h.push("\t\t]"+(t===s.length-1?"":","))}h.push("\t},"),h.push("\tVertices:[");for(let t=0;t<e.length;t++){const n=e[t].position;h.push("\t\t["+n.x+" "+n.y+" "+n.z+"]"+(n===e.length-1?"":","))}return h.push("\t]"),h.push("}"),h.join("\n")}};class File$2{constructor(t){this.pathname=t.replace(/\\/g,"/")}getAbsolutePath(){if(/$http/.test(this.pathname))return this.pathname;let t=window.location.toString();/\/$/.test(t)||(t=t.match(/.*\//)[0]);const e=this.pathname.split("/");for(let n=0;n<e.length;n++)""!==e[n]&&"."!==e[n]&&(".."!==e[n]?(t+=e[n],n!==e.length-1&&(t+="/")):t=t.substring(0,t.length-1).match(/.*\//)[0]);return t}getParent(){const t=this.getAbsolutePath().match(/.*\//)[0];return t.substring(0,t.length-1)}}const S3MeshLoaderMQO={name:"MQO",input:function(t,e,n,i){let s="./";i&&(s=new File$2(i).getParent()+"/");const o=n.split("\n"),r=[];let h="none";const a=function(t){const e=t.split(" "),n=[];for(let t=0;t<e.length;t++)n[t]=parseFloat(e[t]);return n},l=function(t,e){const n=t.split(" "+e+"(");return 1===n.length?[]:n[1].split(")")[0]},u=function(t,e){const n=l(t,e);return 0===n.length?[]:a(n)},c=function(t,e){const n=l(t,e);if(0===n.length)return null;const i=n.split('"');return 3!==i.length?null:i[1]};for(let n=0;n<o.length;n++){const i=o[n].replace(/^\s+|\s+$/g,""),l=i.split(" ")[0];if(-1===i.indexOf("{"))if(-1===i.indexOf("}")){if("Thumbnail"!==h&&"none"!==h)if("Material"===h){const n=l.replace(/"/g,""),o=t.createMaterial();o.setName(n);let r;0!==(r=u(i,"col")).length&&o.setColor(new S3Vector(r[0],r[1],r[2],r[3])),0!==(r=u(i,"dif")).length&&o.setDiffuse(r[0]),0!==(r=u(i,"amb")).length&&o.setAmbient(new S3Vector(r[0],r[0],r[0])),0!==(r=u(i,"amb_col")).length&&o.setAmbient(new S3Vector(r[0],r[1],r[2])),0!==(r=u(i,"emi")).length&&o.setEmission(new S3Vector(r[0],r[0],r[0])),0!==(r=u(i,"emi_col")).length&&o.setEmission(new S3Vector(r[0],r[1],r[2])),0!==(r=u(i,"spc")).length&&o.setSpecular(new S3Vector(r[0],r[0],r[0])),0!==(r=u(i,"spc_col")).length&&o.setSpecular(new S3Vector(r[0],r[1],r[2])),0!==(r=u(i,"power")).length&&o.setPower(r[0]),0!==(r=u(i,"reflect")).length&&o.setReflect(r[0]),(r=c(i,"tex"))&&o.setTextureColor(s+r),(r=c(i,"bump"))&&o.setTextureNormal(s+r),e.addMaterial(o)}else if("vertex"===h){const n=a(i),s=new S3Vector(n[0],n[1],n[2]),o=t.createVertex(s);e.addVertex(o)}else if("face"===h){const n=parseInt(l),s=u(i,"V"),o=u(i,"UV"),r=[];let h=u(i,"M");if(h=0===h.length?0:h[0],0!==o.length)for(let t=0;t<n;t++)r[t]=new S3Vector(o[2*t],o[2*t+1],0);for(let i=0;i<n-2;i++){const n=i%2==0?t.createTriangleIndex(i,i+1,i+2,s,h,r):t.createTriangleIndex(i-1,i+1,i+2,s,h,r);e.addTriangleIndex(n)}}}else h=r.pop();else r.push(h),h=l}return!0},output:function(t){const e=[],n=t.getVertexArray(),i=t.getTriangleIndexArray(),s=t.getMaterialArray();e.push("Material "+s.length+" {");for(let t=0;t<s.length;t++){const n=s[t];e.push('\t"'+n.name+'" col(1.000 1.000 1.000 1.000) dif(0.800) amb(0.600) emi(0.000) spc(0.000) power(5.00)')}e.push("}"),e.push('Object "obj1" {'),e.push("\tvertex "+n.length+" {");for(let t=0;t<n.length;t++){const i=n[t].position;e.push("\t\t"+i.x+" "+i.y+" "+i.z)}e.push("}"),e.push("\tface "+i.length+" {");for(let t=0;t<i.length;t++){const n=i[t];let s="\t\t3";s+=" V("+n.index[0]+" "+n.index[1]+" "+n.index[2]+")",s+=" M("+n.materialIndex+")",void 0!==n.uv&&null!==n.uv[0]&&(s+=" UV("+n.uv[0]+" "+n.uv[1]+" "+n.uv[2]+")"),e.push(s)}return e.push("\t}"),e.push("}"),e.join("\n")}},S3MeshLoaderOBJ={name:"OBJ",input:function(t,e,n,i){const s=n.split("\n"),o=[],r=[];for(let t=0;t<s.length;t++){const e=function(t){return t.replace(/^\s+|\s+$/g,"")}(s[t].split("#")[0]);if(0!==e.length){const t=e.split(" ");if("v"===t[0]){const e=new S3Vector(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));o.push(e)}else if("vt"===t[1]){new S3Vector(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]))}else if("vn"===t[2]){new S3Vector(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]))}else if("f"===t[0]){const e=t.length-3;for(let n=0;n<e;n++){const e=[];e[0]=t[1+n],e[1]=t[1+n+1],e[2]=t[1+n+2];const i=[],s=[],o=[];for(let t=0;t<3;t++){const n=e[t].split("/");1===n.length?i[t]=parseInt(n[0],10)-1:2===n.length?(i[t]=parseInt(n[0],10)-1,s[t]=parseInt(n[1],10)-1):3===n.length&&(0!==n[1].length?(i[t]=parseInt(n[0],10)-1,s[t]=parseInt(n[1],10)-1,o[t]=parseInt(n[2],10)-1):(i[t]=parseInt(n[0],10)-1,s[t]=null,o[t]=parseInt(n[2],10)-1))}r.push(i)}}}}const h=t.createMaterial();e.addMaterial(h);for(let n=0;n<o.length;n++){const i=t.createVertex(o[n]);e.addVertex(i)}for(let n=0;n<r.length;n++){const i=t.createTriangleIndex(0,1,2,r[n],0);e.addTriangleIndex(i)}return!0}},S3MeshLoader={inputData:function(t,e,n){const i=t.createMesh(),s=function(e,n,s){i._init();const o=S3MeshLoader._DATA_INPUT_FUNCTION[n](t,i,e,s);i.setComplete(o)};if(("string"==typeof e||e instanceof String)&&-1===e.indexOf("\n")){const i=function(t){s(t,n,e)};t._download(e,i)}else s(e,n,"");return i},outputData:function(t,e){return S3MeshLoader._DATA_OUTPUT_FUNCTION[e](t)}};S3MeshLoader.TYPE={JSON:S3MeshLoaderJSON.name,MQO:S3MeshLoaderMQO.name,OBJ:S3MeshLoaderOBJ.name},S3MeshLoader._DATA_INPUT_FUNCTION={},S3MeshLoader._DATA_OUTPUT_FUNCTION={},S3MeshLoader._DATA_OUTPUT_FUNCTION[S3MeshLoaderJSON.name]=S3MeshLoaderJSON.output,S3MeshLoader._DATA_INPUT_FUNCTION[S3MeshLoaderJSON.name]=S3MeshLoaderJSON.input,S3MeshLoader._DATA_OUTPUT_FUNCTION[S3MeshLoaderMQO.name]=S3MeshLoaderMQO.output,S3MeshLoader._DATA_INPUT_FUNCTION[S3MeshLoaderMQO.name]=S3MeshLoaderMQO.input,S3MeshLoader._DATA_INPUT_FUNCTION[S3MeshLoaderOBJ.name]=S3MeshLoaderOBJ.input;class CameraController{constructor(){this.mouse=new Device.Touch,this.moveDistance=4,this.moveRotate=.5,this.moveTranslateRelative=.1}setCanvas(t){this.mouse.setListenerOnElement(t)}setCamera(t){this.camera=t.clone()}getCamera(){const t=new Device.Touch;this.mouse.pickInput(t),this.camera.translateRelative(new S3Vector(-t.left.dragged.x*this.moveTranslateRelative,t.left.dragged.y*this.moveTranslateRelative,0)),this.camera.addRotateY(t.right.dragged.x*this.moveRotate),this.camera.addRotateX(-t.right.dragged.y*this.moveRotate);{let e=this.camera.getDistance();const n=t.wheelrotation;e-=n*this.moveDistance*Math.log(e),this.camera.setDistance(e)}return this.camera}}const S3={System:S3System,GLSystem:S3GLSystem,Math:S3Math,Angles:S3Angles,Vector:S3Vector,Matrix:S3Matrix,SYSTEM_MODE:S3System.SYSTEM_MODE,DEPTH_MODE:S3System.DEPTH_MODE,DIMENSION_MODE:S3System.DIMENSION_MODE,VECTOR_MODE:S3System.VECTOR_MODE,FRONT_FACE:S3System.FRONT_FACE,CULL_MODE:S3System.CULL_MODE,LIGHT_MODE:S3Light.MODE,MESH_TYPE:S3MeshLoader.TYPE,MeshLoader:S3MeshLoader,CameraController:CameraController},Senko={_toString:function(t){let e;return"string"==typeof t||t instanceof String?e=0===t.length?" ":t:void 0===t?e=typeof t:null===t?e=t:"function"==typeof t.toString&&(e=t.toString()),e},println:function(t){const e=console,n=Senko._printbuffer+Senko._toString(t);Senko._printbuffer="",e.log(n)},print:function(t){Senko._printbuffer+=Senko._toString(t)},printf:function(){const t=[];for(let e=0;e<arguments.length;e++)t[e]=arguments[e];Senko.print(Text$1.format.apply(this,t))}};Senko._printbuffer="",Senko.ArrayList=ArrayList,Senko.Color=Color,Senko.File=File$1,Senko.HashMap=HashMap,Senko.Text=Text$1,Senko.Device=Device,Senko.ImageProcessing=ImageProcessing,Senko.SComponent=SComponent,Senko.BigDecimal=BigDecimal,Senko.BigInteger=BigInteger,Senko.Random=Random,Senko.S3=S3;export default Senko;
