/*!
 * SenkoJS
 * https://github.com/natade-jp/SenkoJS
 * Copyright 2013-2019 natade
 *
 * The MIT license.
 * https://opensource.org/licenses/MIT
 */
class ArrayList{constructor(){if(this.element=[],1===arguments.length)for(let t=0;t<arguments[0].element.length;t++)this.element[t]=arguments[0].element[t]}each(t){let n=!0;for(let e=0;e<this.element.length;e++){const i=this.element[e];if(!1===t.call(i,e,i)){n=!1;break}}return n}toString(){return this.join(", ")}isEmpty(){return 0===this.element.length}contains(t){return this.element.contains(t)}size(){return this.element.length}clear(){this.element.length=0}join(t){return 0===arguments.length&&(t=","),this.element.join(t)}clone(){const t=new ArrayList;for(let n=0;n<this.element.length;n++)t.element[n]=this.element[n];return t}indexOf(t){for(let n=0;n<this.element.length;n++)if(this.element[n]===t)return n;return-1}lastIndexOf(t){for(let n=this.element.length-1;-1!==n;n--)if(this.element[n]===t)return n;return-1}get(t){return this.element[t]}add(){if(1===arguments.length){const t=arguments[0];this.element.push(t)}else if(2===arguments.length){const t=arguments[0],n=arguments[1];this.element.splice(t,0,n)}}addAll(){if(1===arguments.length){const t=arguments[0];let n=this.element.length;for(let e=0;e<t.length;e++)this.element[n++]=t.element[e]}else if(2===arguments.length){let t=arguments[0],n=arguments[1].element;n===this.element&&(n=this.element.slice(0));let e=this.element.length-t,i=this.element.length+n.length-1,o=this.element.length-1;for(let t=0;t<e;t++)this.element[i--]=this.element[o--];e=n.length;for(let i=0;i<e;i++)this.element[t++]=n[i]}}set(t,n){this.element[t]=n}remove(t){this.element.splice(t,1)}removeRange(t,n){this.element.splice(t,n-t)}sort(t){let n;n=0===arguments.length?ArrayList.COMPARE.DEFAULT:t;const e=[],i=function(t,n,o,r){if(n<o){const s=Math.floor((n+o)/2);i(t,n,s,r),i(t,s+1,o,r);let h,l,a,u=0;for(h=n;h<=s;h++)e[u++]=t[h];for(h=s+1,l=0,a=n;h<=o&&l<u;)r(t[h],e[l])>=0?t[a++]=e[l++]:t[a++]=t[h++];for(;l<u;)t[a++]=e[l++]}return!0};i(this.element,0,this.element.length-1,n)}}ArrayList.COMPARE={},ArrayList.COMPARE.DEFAULT=function(t,n){return t===n?0:typeof t==typeof n?t<n?-1:1:typeof t<typeof n?-1:1};class Color{constructor(){this.r=0,this.g=0,this.b=0,this.a=1}limit(){const t=new Color;return t.r=Color._limit(this.r),t.g=Color._limit(this.g),t.b=Color._limit(this.b),t.a=Color._limit(this.a),t}bake(){const t=new Color;return t.r=this.r*this.a,t.g=this.g*this.a,t.b=this.b*this.a,t.a=1,t.limit()}addColorMixture(t){if(!(t instanceof Color))throw"IllegalArgumentException";return Color.newColorNormalizedRGB(this.r+t.r*t.a,this.g+t.g*t.a,this.b+t.b*t.a,this.a)}subColorMixture(t){if(!(t instanceof Color))throw"IllegalArgumentException";const n=Math.min(this.r,t.r),e=Math.min(this.g,t.g),i=Math.min(this.b,t.b);return Color.newColorNormalizedRGB(Color._mix(this.r,n,t.a),Color._mix(this.g,e,t.a),Color._mix(this.b,i,t.a),this.a)}mul(t){if(t instanceof Color)return Color.newColorNormalizedRGB(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a);if("number"==typeof t||t instanceof Number)return Color.newColorNormalizedRGB(this.r*t,this.g*t,this.b*t,this.a);throw"IllegalArgumentException"}clone(){const t=new Color;return t.r=this.r,t.g=this.g,t.b=this.b,t.a=this.a,t}toString(){return"Color["+this.getCSSHex()+", "+this.getCSS255()+", "+this.getCSSPercent()+"]"}static _mix(t,n,e){return t+(n-t)*e}static _limit(t){return Math.max(Math.min(t,1),0)}static _flact(t){return t-Math.floor(t)}static _hex(t){return t=Math.round(255*t).toString(16),1===t.length?"0"+t:t}_setRGB(t,n,e,i){return this.r=t,this.g=n,this.b=e,i&&(this.a=i),this}_setHSV(t,n,e,i){let o,r;return this.r=e,this.g=e,this.b=e,i&&(this.a=i),n>0&&(r=(t*=6)-(o=~~Math.floor(t)),0===o?(this.g*=1-n*(1-r),this.b*=1-n):1===o?(this.r*=1-n*r,this.b*=1-n):2===o?(this.r*=1-n,this.b*=1-n*(1-r)):3===o?(this.r*=1-n,this.g*=1-n*r):4===o?(this.r*=1-n*(1-r),this.g*=1-n):5===o&&(this.g*=1-n,this.b*=1-n*r)),this}_setHSL(t,n,e,i){if(i&&(this.a=i),0===n)return this.r=0,this.g=0,this.b=0,this;let o;const r=2*e-(o=e<.5?e*(1+n):e*(1-n)+n),s=o-r;t*=6;const h=~~Math.floor(t),l=t-h;return 0===h?(this.r=o,this.g=o-s*(1-l),this.b=r):1===h?(this.r=r+s*(1-l),this.g=o,this.b=r):2===h?(this.r=r,this.g=o,this.b=o-s*(1-l)):3===h?(this.r=r,this.g=r+s*(1-l),this.b=o):4===h?(this.r=o-s*(1-l),this.g=r,this.b=o):5===h&&(this.r=o,this.g=r,this.b=r+s*(1-l)),this}_getRGB(){return{r:this.r,g:this.g,b:this.b,a:this.a}}_getHSV(){const t=Math.max(this.r,this.g,this.b),n=Math.min(this.r,this.g,this.b),e=t-n;let i=0,o=t-n;const r=t;return 0!==t&&(o/=t),0===e?[i,o,r]:(t===this.r?(i=(this.g-this.b)/e)<0&&(i+=6):i=t===this.g?2+(this.b-this.r)/e:4+(this.r-this.g)/e,i/=6,{h:i,s:o,v:r,a:this.a})}_getHSL(){const t=Math.max(this.r,this.g,this.b),n=Math.min(this.r,this.g,this.b),e=.5*(t+n),i=t-n;if(0===i)return[0,e,0];let o;o=e<.5?i/(t+n):i/(2-t-n);let r;return t===this.r?(r=(this.g-this.b)/i)<0&&(r+=6):r=t===this.g?2+(this.b-this.r)/i:4+(this.r-this.g)/i,r/=6,{h:r,s:o,l:e,a:this.a}}getNormalizedRGB(){return this._getRGB()}getRGB(){return{r:Math.round(255*this.r),g:Math.round(255*this.g),b:Math.round(255*this.b),a:Math.round(255*this.a)}}getRRGGBB(){return Math.round(255*Color._limit(this.r))<<16|Math.round(255*Color._limit(this.g))<<8|Math.round(255*Color._limit(this.b))}getAARRGGBB(){return Math.round(255*Color._limit(this.a))<<24|Math.round(255*Color._limit(this.r))<<16|Math.round(255*Color._limit(this.g))<<8|Math.round(255*Color._limit(this.b))}getNormalizedHSV(){return this._getHSV()}getHSV(){const t=this.getNormalizedHSV();return t.h=Math.round(360*t.h),t.s=Math.round(255*t.s),t.v=Math.round(255*t.v),t.a=Math.round(255*t.a),t}getNormalizedHSL(){return this._getHSL()}getHSL(){const t=this.getNormalizedHSL();return t.h=Math.round(360*t.h),t.s=Math.round(255*t.s),t.l=Math.round(255*t.l),t.a=Math.round(255*t.a),t}getRed(){return Math.round(255*this.r)}getGreen(){return Math.round(255*this.g)}getBlue(){return Math.round(255*this.b)}getAlpha(){return Math.round(255*this.b)}brighter(){return this.mul(1/.7).limit()}darker(){return this.mul(.7).limit()}getCSSHex(){return 1===this.a?"#"+Color._hex(Color._limit(this.r))+Color._hex(Color._limit(this.g))+Color._hex(Color._limit(this.b)):"#"+Color._hex(Color._limit(this.a))+Color._hex(Color._limit(this.r))+Color._hex(Color._limit(this.g))+Color._hex(Color._limit(this.b))}getCSS255(){return 1===this.a?"rgb("+Math.round(255*Color._limit(this.r))+","+Math.round(255*Color._limit(this.g))+","+Math.round(255*Color._limit(this.b))+")":"rgba("+Math.round(255*Color._limit(this.r))+","+Math.round(255*Color._limit(this.g))+","+Math.round(255*Color._limit(this.b))+","+this.a+")"}getCSSPercent(){return 1===this.a?"rgb("+Math.round(100*Color._limit(this.r))+"%,"+Math.round(100*Color._limit(this.g))+"%,"+Math.round(100*Color._limit(this.b))+"%)":"rgba("+Math.round(100*Color._limit(this.r))+"%,"+Math.round(100*Color._limit(this.g))+"%,"+Math.round(100*Color._limit(this.b))+"%,"+Math.round(100*Color._limit(this.a))+"%)"}setAlpha(t){const n=this.clone();return n.a=t,n}static newColorNormalizedRGB(){let t=0,n=0,e=0,i=1;1===arguments.length?(arguments[0].r&&(t=arguments[0].r),arguments[0].g&&(n=arguments[0].g),arguments[0].b&&(e=arguments[0].b),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],n=arguments[0][1],e=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],n=arguments[1],e=arguments[2]),arguments.length>=4&&(i=arguments[3]));const o=new Color;return o._setRGB(t,n,e,i),o}static newColorRGB(){let t=0,n=0,e=0,i=255;arguments.length>=3?(t=arguments[0],n=arguments[1],e=arguments[2],arguments.length>=4&&(i=arguments[3])):arguments.length>=1&&("number"==typeof arguments[0]?(t=arguments[0]>>16&255,n=arguments[0]>>8&255,e=255&arguments[0],arguments[1]&&(i=arguments[0]>>24&255)):void 0===arguments[0].length?(arguments[0].r&&(t=arguments[0].r),arguments[0].g&&(n=arguments[0].g),arguments[0].b&&(e=arguments[0].b),arguments[0].a&&(i=arguments[0].a)):arguments[0].length>=3&&(t=arguments[0][0],n=arguments[0][1],e=arguments[0][2],arguments[0].length>=4&&(i=arguments[0][3])));const o=new Color;return o._setRGB(t/255,n/255,e/255,i/255),o}static newColorNormalizedHSV(){let t=0,n=0,e=0,i=1;1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(n=arguments[0].s),arguments[0].v&&(e=arguments[0].v),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],n=arguments[0][1],e=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],n=arguments[1],e=arguments[2]),arguments.length>=4&&(i=arguments[3])),n=Color._limit(n),e=Color._limit(e);const o=new Color;return o._setHSV(Color._flact(t),n,e,i),o}static newColorHSV(){let t=0,n=0,e=0,i=255;return 1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(n=arguments[0].s),arguments[0].v&&(e=arguments[0].v),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],n=arguments[0][1],e=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],n=arguments[1],e=arguments[2]),arguments.length>=4&&(i=arguments[3])),Color.newColorNormalizedHSV(t/360,n/255,e/255,i/255)}static newColorNormalizedHSL(){let t=0,n=0,e=0,i=1;1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(n=arguments[0].s),arguments[0].l&&(e=arguments[0].l),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],n=arguments[0][1],e=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],n=arguments[1],e=arguments[2]),arguments.length>=4&&(i=arguments[3])),n=Color._limit(n),e=Color._limit(e);const o=new Color;return o._setHSL(Color._flact(t),n,e,i),o}static newColorHSL(){let t=0,n=0,e=0,i=255;return 1===arguments.length?(arguments[0].h&&(t=arguments[0].h),arguments[0].s&&(n=arguments[0].s),arguments[0].l&&(e=arguments[0].l),arguments[0].a&&(i=arguments[0].a),arguments[0].length>=3&&(t=arguments[0][0],n=arguments[0][1],e=arguments[0][2]),arguments[0].length>=4&&(i=arguments[0][3])):(arguments.length>=3&&(t=arguments[0],n=arguments[1],e=arguments[2]),arguments.length>=4&&(i=arguments[3])),Color.newColorNormalizedHSL(t/360,n/255,e/255,i/255)}}Color.white=Color.newColorRGB(16777215),Color.lightGray=Color.newColorRGB(13882323),Color.gray=Color.newColorRGB(8421504),Color.darkGray=Color.newColorRGB(11119017),Color.black=Color.newColorRGB(0),Color.red=Color.newColorRGB(16711680),Color.pink=Color.newColorRGB(16761035),Color.orange=Color.newColorRGB(16753920),Color.yellow=Color.newColorRGB(16776960),Color.green=Color.newColorRGB(32768),Color.magenta=Color.newColorRGB(16711935),Color.cyan=Color.newColorRGB(65535),Color.blue=Color.newColorRGB(255),Color.WHITE=Color.white,Color.LIGHT_GRAY=Color.lightGray,Color.GRAY=Color.gray,Color.DARK_GRAY=Color.darkGray,Color.RED=Color.red,Color.PINK=Color.pink,Color.ORANGE=Color.orange,Color.YELLOW=Color.yellow,Color.GREEN=Color.green,Color.MAGENTA=Color.magenta,Color.CYAN=Color.cyan,Color.BLUE=Color.blue;const CSVTool={parseCSV:function(t,n){arguments.length<2&&(n=","),t=t.replace(/\r\n?|\n/g,"\n");const e=n.charCodeAt(0),i=[],o=t.length;let r="",s=0,h=0,l=!1,a=!1;for(let n=0;n<o;n++){let u=t.charCodeAt(n);if(34===u&&0===r.length)for(n++;n<o;n++)if(34===(u=t.charCodeAt(n))){if(n+1===o-1)break;if(34!==t.charCodeAt(n+1))break;n++,r+='"'}else r+=t.charAt(n);else{switch(u){case e:l=!0;break;case 13:case 10:a=!0}l?(l=!1,void 0===i[s]&&(i[s]=[]),i[s][h]=r,r="",h+=1):a?(a=!1,""===r&&0===h||(void 0===i[s]&&(i[s]=[]),i[s][h]=r,r="",s+=1,h=0)):r+=t.charAt(n)}n===o-1&&0!==h&&(i[s][h]=r)}return i},makeCSV:function(t,n,e){arguments.length<2&&(n=","),arguments.length<3&&(e="\r\n");let i="";const o=/["\r\n,\t]/;if(void 0!==t)for(let r=0;r<t.length;r++){if(void 0!==t[r])for(let e=0;e<t[r].length;e++){let s=t[r][e];o.test(s)&&(s='"'+(s=s.replace(/"/g,'""'))+'"'),i+=s,e!==t[r].length-1&&(i+=n)}i+=e}return i}};class File$1{constructor(t){if(this.isHTML="undefined"!=typeof window,this.isNode=!1,1!==arguments.length)throw"IllegalArgumentException";if("string"==typeof t||t instanceof String)this.pathname=t.replace(/\\/g,"/");else{if(!(t instanceof File$1))throw"IllegalArgumentException";this.pathname=t.getAbsolutePath()}}delete_(){throw"IllegalMethod"}exists(){throw"IllegalMethod"}copy(){throw"IllegalMethod"}move(){throw"IllegalMethod"}toString(){return this.getAbsolutePath()}getName(){if(this.isHTML){if(this.isDirectory())return"";const t=this.pathname.split("/");return t[t.length-1]}if(this.isNode)throw"IllegalMethod"}getParent(){const t=this.getAbsolutePath().match(/.*[\/\\]/)[0];return t.substring(0,t.length-1)}getParentFile(){return new File$1(this.getParent())}getExtensionName(){if(this.isHTML){const t=this.getName().split(".");return t[t.length-1]}if(this.isNode)throw"IllegalMethod"}isAbsolute(){if(this.isHTML)return this.getAbsolutePath()===this.pathname;if(this.isNode)throw"IllegalMethod"}isDirectory(){if(this.isHTML)return/\/$/.test(this.pathname);if(this.isNode)throw"IllegalMethod"}isFile(){if(this.isHTML)return/[^\/]$/.test(this.pathname);if(this.isNode)throw"IllegalMethod"}isHidden(){if(this.isNode)throw"IllegalMethod"}lastModified(){if(this.isNode)throw"IllegalMethod"}setLastModified(){if(this.isNode)throw"IllegalMethod"}length(){if(this.isNode)throw"IllegalMethod"}getFiles(){if(this.isNode)throw"IllegalMethod"}getSubFolders(){if(this.isNode)throw"IllegalMethod"}getNormalizedPathName(){if(""===this.pathname)return".\\";let t=this.pathname.replace(/\//g,"\\");return"\\"!==t.slice(-1)&&(t+="\\"),t}getAllFiles(){if(this.isNode)throw"IllegalMethod"}list(){if(this.isNode)throw"IllegalMethod"}getAbsolutePath(){if(this.isHTML){let t=null;if(/^http/.test(this.pathname))t=this.pathname;else{let n=window.location.toString();/\/$/.test(n)||(n=n.match(/.*\//)[0]),t=n+this.pathname}const n=t.match(/^http[^\/]+\/\/[^\/]+\//)[0],e=t.substr(n.length);let i=n;const o=e.split("/");let r;for(r=0;r<o.length;r++)""!==o[r]&&"."!==o[r]&&(".."!==o[r]?(i+=o[r],r!==o.length-1&&(i+="/")):i=i.substring(0,i.length-1).match(/.*\//)[0]);return i}if(this.isNode)throw"IllegalMethod"}mkdir(){if(this.isNode)throw"IllegalMethod"}mkdirs(){if(this.isNode)throw"IllegalMethod"}renameTo(){if(this.isNode)throw"IllegalMethod"}run(){if(this.isNode)throw"IllegalMethod"}writeLine(){if(this.isNode)throw"IllegalMethod"}download(t){if(this.isHTML){const n=this.getExtensionName().toLocaleString(),e=this;if("gif"===n||"jpg"===n||"png"===n||"bmp"===n||"svg"===n||"jpeg"===n){const n=new Image;n.onload=function(){e.dataImage=n,t(e)},n.src=this.pathname}else{const n=File$1.createXMLHttpRequest();if(null===n)return null;const i=function(){if(4===n.readyState){if(200!==n.status)return console.log("error downloadText "+e.pathname),null;e.dataText=n.responseText,t(e)}};n.onreadystatechange=i,n.open("GET",this.pathname,!0),n.send(null)}}else if(this.isNode)throw"IllegalMethod"}getImage(){if(this.isHTML)return this.dataImage}getText(){if(this.isHTML)return this.dataText;if(this.isNode)throw"IllegalMethod"}setText(){if(this.isNode)throw"IllegalMethod"}getCSV(t,n,e){if(this.isHTML)return CSVTool.parseCSV(this.dataText,t,e);if(this.isNode)throw"IllegalMethod"}setCSV(){if(this.isNode)throw"IllegalMethod"}getByte(){if(this.isNode)throw"IllegalMethod"}setByte(){if(this.isNode)throw"IllegalMethod"}static createTempFile(){if("undefined"!=typeof window)throw"not createTempFile"}static getCurrentDirectory(){if("undefined"!=typeof window){const t=new File$1("./");return t.getParent()}}static setCurrentDirectory(){if("undefined"!=typeof window)throw"not setCurrentDirectory"}static searchFile(){if("undefined"!=typeof window)throw"not searchFile"}static downloadFileList(t,n,e){let i,o=0;for(i=0;i<t.length;i++)t[i].download(function(i){return function(){o++,e&&e.length&&e[i]&&e[i](t[i]),o===t.length&&n&&n(t)}}(i))}static createXMLHttpRequest(){return new XMLHttpRequest}static getCSVTool(){return CSVTool}}class HashMap{constructor(){if(this.map=[],this.size_=0,1===arguments.length){for(const t in arguments[0].map)this.map[t]=arguments[0].map[t];this.size_=arguments[0].size_}}each(t){let n=!0;for(const e in this.map){const i=this.map[e];if(!1===t.call(i,e,i)){n=!1;break}}return n}toString(){let t="",n=0;for(const e in this.map)t+=e+"=>"+this.map[e],++n!==this.size_&&(t+="\n");return t}containsKey(t){return void 0!==this.map[t]}containsValue(t){for(const n in this.map)if(this.map[n]===t)return!0;return!1}isEmpty(){return 0===this.size_}clear(){this.map=[],this.size_=0}clone(){const t=new HashMap;for(const n in this.map)t.map[n]=this.map[n];return t.size_=this.size_,t}size(){return this.size_}get(t){return this.map[t]}put(t,n){if(!1===this.containsKey(t))return this.map[t]=n,this.size_=this.size_+1,null;{const e=this.map[t];return this.map[t]=n,e}}putAll(t){for(const n in t.map)void 0===this.map[n]&&(this.map[n]=t.map[n],this.size_=this.size_+1)}remove(t){if(!1===this.containsKey(t))return null;{const n=this.map[t];return delete this.map[t],this.size_=this.size_-1,n}}}class Format{static format(){let t=1;const n=arguments,e=function(t){if(t>=0)return t;{let n=~(t=-t)>>16&65535;const e=65535&~t;return(n*=65536)+e+1}},i=function(i){let o;const r=(o=(i=i.substring(1,i.length)).match(/.$/))[0];if("%"===r)return"%";null!==(o=i.match(/^[0-9]+\$/))&&(o=o[0],i=i.substring(o.length,i.length),o=o.substring(0,o.length-1),t=parseInt(o,10));let s=n[t];t+=1;let h=!1,l=!1,a=!1,u="";null!==(o=i.match(/^[-+ #0]+/))&&(o=o[0],i=i.substring(o.length,i.length),-1!==o.indexOf("#")&&(h=!0),-1!==o.indexOf("-")&&(l=!0),-1!==o.indexOf(" ")&&(u=" "),-1!==o.indexOf("+")&&(u="+"),-1!==o.indexOf("0")&&(a=!0));let c=0;null!==(o=i.match(/^([0-9]+|\*)/))&&(o=o[0],i=i.substring(o.length,i.length),-1!==o.indexOf("*")?(c=s,s=n[t],t+=1):c=parseInt(o,10));let g=!1,f=0;null!==(o=i.match(/^(\.((-?[0-9]+)|\*)|\.)/))&&(o=o[0],i=i.substring(o.length,i.length),g=!0,-1!==o.indexOf("*")?(f=s,s=n[t],t+=1):1===o.length?f=0:(o=o.substring(1,o.length),f=parseInt(o,10))),null!==(o=i.match(/^hh|h|ll|l|L|z|j|t/))&&(i=i.substring(o.length,i.length));let m="",d=!1;switch(r.toLowerCase()){case"d":case"i":case"u":case"b":case"o":case"x":d=!0;case"e":case"f":case"g":{let t,n="",i=0;switch(d?(isNaN(s)&&(s=parseInt(s,10)),"d"===r||"i"===r?(s<0&&(u="-",s=-s),s=Math.floor(s)):s=s>=0?Math.floor(s):Math.ceil(s)):(isNaN(s)&&(s=parseFloat(s)),s<0&&(u="-",s=-s),g||(f=6)),r.toLowerCase()){case"d":case"i":m+=s.toString(10);break;case"u":m+=e(s).toString(10);break;case"b":m+=e(s).toString(2),h&&(n="0b");break;case"o":m+=e(s).toString(8),h&&(n="0");break;case"x":case"X":m+=e(s).toString(16),h&&(n="0x");break;case"e":m+=s.toExponential(f);break;case"f":m+=s.toFixed(f);break;case"g":0===f&&(f=1),m+=s.toPrecision(f),h||-1===m.indexOf(".")||(m=(m=m.replace(/\.?0+$/,"")).replace(/\.?0+e/,"e"))}if(d){if(g){t=f-m.length;for(let n=0;n<t;n++)m="0"+m}}else h&&-1===m.indexOf(".")&&(-1!==m.indexOf("e")?m=m.replace("e",".e"):m+=".");if(-1!==m.indexOf("e")){const t=function(t){const n=t.length;return 3===t.length?t.substring(0,n-1)+"00"+t.substring(n-1,n):t.substring(0,n-2)+"0"+t.substring(n-2,n)};m=m.replace(/e[+-][0-9]{1,2}$/,t)}if(i=m.length+n.length+u.length,t=c-i,l)for(let n=0;n<t;n++)m+=" ";if(a)for(let n=0;n<t;n++)m="0"+m;if(m=n+m,m=u+m,!a&&!l)for(let n=0;n<t;n++)m=" "+m;r.toUpperCase()===r&&(m=m.toUpperCase());break}case"c":isNaN(s)||(s=String.fromCharCode(s));case"s":{isNaN(s)||(s=s.toString(10)),m=s,g&&m.length>f&&(m=m.substring(0,f));const t=m.length,n=c-t;if(l)for(let t=0;t<n;t++)m+=" ";else{const t=a?"0":" ";for(let e=0;e<n;e++)m=t+m}break}case"%":m="%";break;case"p":case"n":m="(変換できません)"}return m};return n[0].replace(/%[^diubBoxXeEfFgGaAcspn%]*[diubBoxXeEfFgGaAcspn%]/g,i)}}const format=Format.format,toStringFromObj=function(t){return"string"==typeof t||t instanceof String?0===t.length?" ":t:void 0===t?typeof t:null===t?"null":"function"==typeof t.toString?t.toString():t instanceof Object?"Object":"null"};class CUIConsole{constructor(){this.output=CUIConsole._getOutput()}static _getOutput(){const t=function(){return"undefined"!=typeof WSH?null:"undefined"!=typeof console?console:"undefined"!=typeof window&&void 0!==window.console?window.console:null};let n=null;if(function(){return"undefined"!=typeof WSH}())n=/cscript\.exe$/i.test(WSH.FullName)?function(t){/\n$/.test(t)?WSH.StdOut.Write(t):WSH.StdOut.Write(t+"\n")}:WScript.Echo;else if(function(){return null!==t()}()){const e=t();n=e.log}else"undefined"!=typeof alert&&(n=alert);return n}getOutput(){return this.output}}class HtmlConsole{constructor(){this.root=null,this.element=null,this.isshow=!1,this.loglength=250,this.linelength=0}_getElement(){if(null!==this.element)return this.element;const t=document.createElement("div");return t.style.backgroundColor="black",t.style.color="white",t.style.display="block",t.style.margin="0px",t.style.padding="5px",t.style.fontFamily="Consolas, Courier New, Courier, Monaco, monospace",t.style.whiteSpace="pre",this.element=t,this.element}_initHTML(){if(null===this.root){let t;if(t=document.getElementById("senko_console")){let n=t.lastChild;for(;n;)t.removeChild(n),n=t.lastChild}else t=document.body;t.style.backgroundColor="black",t.style.margin="0px",t.style.padding="0px",t.style.overflowY="scroll",t.appendChild(this._getElement()),this.root=t}}isShow(){return this.isshow}setShow(t){if("boolean"!=typeof t)throw"not boolean";this._initHTML();const n=this._getElement();this.isshow!==t&&(this.isshow=t,n&&(n.style.display=this.isshow?"block":"none"))}_autoScroll(){if(null!==this.element&&null!==this.root){const t=this.root.clientHeight,n=this.element.clientHeight;n-t-1*t<=this.root.scrollTop&&(this.root.scrollTop=n)}}_addNewLine(){this._initHTML();const t=this._getElement(),n=document.createElement("p");n.innerText="> ",n.style.margin="0.2em 0px 0.2em 0px",n.style.padding="0px",t.appendChild(n),this.linelength++,this._cleaningLog()}_appendText(t){this._initHTML();const n=this._getElement().lastElementChild;n.innerText=n.innerText+t}_cleaningLog(){if(null!==this.element)for(;this.linelength>this.loglength;)this.element.removeChild(this.element.firstElementChild),this.linelength--}setLogLength(t){this.loglength=t}println(t){this._initHTML();const n=this._getElement();n&&(n.lastElementChild||this._addNewLine(),this._appendText(t),this._addNewLine()),this._autoScroll()}}const cui=(new CUIConsole).getOutput();let gui_obj=null,gui=null;(console||window&&window.console)&&(gui_obj=new HtmlConsole,gui=function(t){gui_obj.println(t)});let show_gui=!1,printbuffer="";class Log{static setGUI(){gui&&(show_gui=!0)}static setCUI(){show_gui=!1}static println(t){const n=printbuffer+toStringFromObj(t);printbuffer="",show_gui?gui(n):cui(n)}static print(t){printbuffer+=toStringFromObj(t)}static printf(){const t=[];for(let n=0;n<arguments.length;n++)t.push(arguments[n]);Log.print(format.apply(this,t))}}class Random{constructor(){this.x=[];for(let t=0;t<521;t++)this.x[t]=0;if(arguments.length>=1)this.setSeed(arguments[0]);else{const t=(new Date).getTime()+Random.seedUniquifier&4294967295;Random.seedUniquifier=Random.seedUniquifier+1&4294967295,this.setSeed(t)}}static _unsigned32(t){return t<0?2147483648+(2147483647&t):t}_multiplication32(t,n){let e=(65535&t)*(65535&n),i=Random._unsigned32(e);return e=(65535&t)*(n>>>16),i=Random._unsigned32(i+((65535&e)<<16)),e=(t>>>16)*(65535&n),4294967295&(i=Random._unsigned32(i+((65535&e)<<16)))}_rnd521(){const t=this.x;for(let n=0;n<32;n++)t[n]^=t[n+489];for(let n=32;n<521;n++)t[n]^=t[n-32]}setSeed(t){let n=0;const e=this.x;for(let i=0;i<=16;i++){for(let e=0;e<32;e++)n=(n>>>1)+((t=this._multiplication32(t,1566083941)+1)<0?2147483648:0);e[i]=n}for(let t=16;t<521;t++)n=16===t?t:t-17,e[t]=e[n]<<23&4294967295^e[t-16]>>>9^e[t-1];for(let t=0;t<4;t++)this._rnd521();this.xi=0,this.haveNextNextGaussian=!1,this.nextNextGaussian=0}genrand_int32(){521===this.xi&&(this._rnd521(),this.xi=0);const t=Random._unsigned32(this.x[this.xi]);return this.xi=this.xi+1,t}next(t){return 0===t?0:32===t?this.genrand_int32():t<32?this.genrand_int32()>>>32-t:63===t?2147483648*this.next(32)+this.next(32):64===t?4294967296*this.next(32)+this.next(32):t<64?this.genrand_int32()*(1<<t-32)+(this.genrand_int32()>>>64-t):void 0}nextBytes(t){for(let n=0;n<t.length;n++)t[n]=this.next(8)}nextInt(){if(1===arguments.length){let t,n;const e=arguments[0];do{n=(t=Random._unsigned32(this.genrand_int32()))%e}while(t-n+e>4294967296);return n}return 4294967295&this.next(32)}nextLong(){return this.next(64)}nextBoolean(){return 0!==this.next(1)}nextFloat(){return this.next(24)/16777216}nextDouble(){return(134217728*this.next(26)+this.next(27))/9007199254740992}nextGaussian(){if(this.haveNextNextGaussian)return this.haveNextNextGaussian=!1,this.nextNextGaussian;const t=Math.sqrt(-2*Math.log(this.nextDouble())),n=2*Math.PI*this.nextDouble(),e=t*Math.sin(n);return this.nextNextGaussian=t*Math.cos(n),this.haveNextNextGaussian=!0,e}}Random.seedUniquifier=2271560481;class BigInteger{constructor(){if(this.element=[],this.sign=0,2===arguments.length&&void 0!==Random&&arguments[1]instanceof Random){this.sign=1;const t=arguments[0],n=arguments[1],e=1+(t-1>>4);let i;if(0===t)return;for(let t=0,o=0;t<e;t++)0===o?(i=n.nextInt(),this.element[t]=65535&i,o=1):(this.element[t]=i>>>16&65535,o=0);t%16!=0&&(this.element[this.element.length-1]&=(1<<t%16)-1),this._memory_reduction()}else if(3===arguments.length){if(void 0===Random)return;for(;;){const t=new BigInteger(arguments[0],arguments[2]);if(t.isProbablePrime(arguments[1])){this.element=t.element,this.sign=t.sign;break}}}else if(arguments.length>=1){this.sign=1;const t=arguments[0];if(t instanceof BigInteger){for(let t=0;t<arguments[0].element.length;t++)this.element[t]=arguments[0].element[t];this.sign=arguments[0].sign}else if("number"==typeof t||t instanceof Number){let t=arguments[0];t<0&&(this.sign=-1,t=-t),this.element=this._number_to_binary_number(t)}else if("string"==typeof t||t instanceof String){let t=arguments[0].replace(/\s/g,"").toLowerCase(),n=t.match(/^[-+]+/);null!==n&&(n=n[0],t=t.substring(n.length,t.length),-1!==n.indexOf("-")&&(this.sign=-1)),2===arguments.length?this.element=this._string_to_binary_number(t,arguments[1]):/^0x/.test(t)?this.element=this._string_to_binary_number(t.substring(2,t.length),16):/^0b/.test(t)?this.element=this._string_to_binary_number(t.substring(2,t.length),2):/^0/.test(t)?this.element=this._string_to_binary_number(t.substring(1,t.length),8):this.element=this._string_to_binary_number(t,10),1===this.element.length&&0===this.element[0]&&(this.element=[])}}}equals(t){if(t instanceof BigInteger||(t=new BigInteger(t)),this.signum()!==t.signum())return!1;if(this.element.length!==t.element.length)return!1;for(let n=0;n<t.element.length;n++)if(this.element[n]!==t.element[n])return!1;return!0}toString(t){0===arguments.length&&(t=10);const n=Math.floor(Math.log(1073741823)/Math.log(t)),e=Math.round(Math.pow(t,n));let i,o=[];for(i=0;i<n;i++)o[i]="0";o=o.join("");const r=this._binary_number_to_string(this.element,e),s=[];let h="";for(this.signum()<0&&(s[s.length]="-"),i=r.length-1;i>=0;i--)h=r[i].toString(t),i<r.length-1&&(s[s.length]=o.substring(0,n-h.length)),s[s.length]=h;return s.join("")}getShort(t){return t<0||this.element.length<=t?0:this.element[t]}byteValue(){let t=this.getShort(0);return(t&=255)>0&&this.sign<0&&(t=-t),t}shortValue(){let t=this.getShort(0);return(t&=65535)>0&&this.sign<0&&(t=-t),t}intValue(){let t=this.getShort(0)+(this.getShort(1)<<16);return(t&=4294967295)>0&&this.sign<0&&(t=-t),t}longValue(){let t=0;for(let n=3;n>=0;n--)t*=65536,t+=this.getShort(n);return this.sign<0&&(t=-t),t}floatValue(){return parseFloat(this.toString())}doubleValue(){return parseFloat(this.toString())}clone(){const t=new BigInteger;return t.element=this.element.slice(0),t.sign=this.sign,t}getLowestSetBit(){for(let t=0;t<this.element.length;t++)if(0!==this.element[t]){const n=this.element[t];for(let e=0;e<16;e++)if(0!=(n>>>e&1))return 16*t+e}return-1}bitLength(){for(let t=this.element.length-1;t>=0;t--)if(0!==this.element[t]){const n=this.element[t];for(let e=15;e>=0;e--)if(0!=(n>>>e&1))return 16*t+e+1}return 0}bitCount(){let t;const n=(t=this.sign>=0?this:this.add(new BigInteger(1))).bitLength();let e=0,i=0;for(let o=0;e<n;o++){const r=t.element[o];for(let t=0;t<16&&e<n;t++,e++)0!=(r>>>t&1)&&(i+=1)}return i}getTwosComplement(t){const n=this.clone();if(n.sign>=0)return n;{n.sign=1,0===arguments.length&&(t=n.bitLength());const e=n.element;for(let t=0;t<e.length;t++)e[t]^=65535;return t%16!=0&&(e[e.length-1]&=(1<<t%16)-1),n._add(new BigInteger(1)),n}}_and(t){t instanceof BigInteger||(t=new BigInteger(t));let n=this,e=t;const i=n.signum(),o=e.signum(),r=Math.max(n.bitLength(),e.bitLength());n=n.getTwosComplement(r).element,e=e.getTwosComplement(r).element;const s=Math.max(n.length,e.length);this.element=[];for(let t=0;t<s;t++){const i=t>=n.length?0:n[t],o=t>=e.length?0:e[t];this.element[t]=i&o}return 0===this.bitLength()&&(this.element=[],this.sign=0),1===i||1===o?this.sign=1:-1===this.sign&&(this.element=this.getTwosComplement(r).element),this}and(t){return this.clone()._and(t)}_or(t){t instanceof BigInteger||(t=new BigInteger(t));let n=this,e=t;const i=n.signum(),o=e.signum(),r=Math.max(n.bitLength(),e.bitLength());n=n.getTwosComplement(r).element,e=e.getTwosComplement(r).element;const s=Math.max(n.length,e.length);this.element=[];for(let t=0;t<s;t++){const i=t>=n.length?0:n[t],o=t>=e.length?0:e[t];this.element[t]=i|o}return this.sign=-1===i||-1===o?-1:Math.max(i,o),-1===this.sign&&(this.element=this.getTwosComplement(r).element),this}or(t){return this.clone()._or(t)}_xor(t){t instanceof BigInteger||(t=new BigInteger(t));let n=this,e=t;const i=n.signum(),o=e.signum(),r=Math.max(n.bitLength(),e.bitLength());n=n.getTwosComplement(r).element,e=e.getTwosComplement(r).element;const s=Math.max(n.length,e.length);this.element=[];for(let t=0;t<s;t++){const i=t>=n.length?0:n[t],o=t>=e.length?0:e[t];this.element[t]=i^o}return this.sign=0!==i&&i!==o?-1:1,-1===this.sign&&(this.element=this.getTwosComplement(r).element),this}xor(t){return this.clone()._xor(t)}_not(){return this._add(new BigInteger(1))._negate()}not(){return this.clone()._not()}_andNot(t){return t instanceof BigInteger||(t=new BigInteger(t)),this._and(t.not())}andNot(t){return this.clone()._andNot(t)}_number_to_binary_number(t){if(t>4294967295)return this._string_to_binary_number(t.toFixed(),10);const n=[];for(;0!==t;)n[n.length]=1&t,t>>>=1;t=[];for(let e=0;e<n.length;e++)t[e>>>4]|=n[e]<<(15&e);return t}_string_to_binary_number(t,n){const e=Math.floor(Math.log(1073741823)/Math.log(n)),i=Math.round(Math.pow(n,e));let o=[];const r=[],s=Math.ceil(t.length/e);let h=t.length;for(let i=0;i<s;i++)h-=e,o[i]=h>=0?parseInt(t.substring(h,h+e),n):parseInt(t.substring(0,h+e),n);for(n=i;0!==o.length;){let t=0;for(let e=o.length-1;e>=0;e--){const i=o[e]+t*n;o[e]=i>>>1,t=1&i}r[r.length]=t,0===o[o.length-1]&&o.pop()}o=[];for(let t=0;t<r.length;t++)o[t>>>4]|=r[t]<<(15&t);return o}_binary_number_to_string(t,n){const e=function(t,e,i){const o=t.length;let r=0;for(let s=0;s<o;s++)i[s]=t[s]+(e.length>=s+1?e[s]:0)+r,i[s]>=n?(r=1,i[s]-=n):r=0;1===r&&(i[o]=1)},i=[0],o=[1];for(let n=0;n<t.length;n++)for(let r=0;r<16;r++)t[n]>>>r&1&&e(o,i,i),e(o,o,o);return i}_memory_allocation(t){const n=this.element.length<<4;if(n<t){const e=1+((t-n-1&4294967280)>>>4);for(let t=0;t<e;t++)this.element[this.element.length]=0}}_memory_reduction(){for(let t=this.element.length-1;t>=0;t--)if(0!==this.element[t])return void(t<this.element.length-1&&this.element.splice(t+1,this.element.length-t-1));this.sign=0,this.element=[]}gcd(t){t instanceof BigInteger||(t=new BigInteger(t));let n,e=this,i=t;for(;0!==i.signum();)n=e.remainder(i),e=i,i=n;return e}extgcd(t){t instanceof BigInteger||(t=new BigInteger(t));const n=new BigInteger(1),e=new BigInteger(0);let i,o,r,s,h=this,l=t,a=n,u=e,c=e,g=n;for(;0!==l.signum();){const t=h.divideAndRemainder(l);o=t[0],i=t[1],r=a.subtract(o.multiply(u)),s=c.subtract(o.multiply(g)),a=u,u=r,c=g,g=s,h=l,l=i}return[a,c,h]}_abs(){return this.sign*=this.sign,this}abs(){return this.clone()._abs()}_negate(){return this.sign*=-1,this}negate(){return this.clone()._negate()}signum(){return 0===this.element.length?0:this.sign}compareToAbs(t){if(t instanceof BigInteger||(t=new BigInteger(t)),this.element.length<t.element.length)return-1;if(this.element.length>t.element.length)return 1;for(let n=this.element.length-1;n>=0;n--)if(this.element[n]!==t.element[n]){const e=this.element[n]-t.element[n];return 0===e?0:e>0?1:-1}return 0}compareTo(t){return t instanceof BigInteger||(t=new BigInteger(t)),this.signum()!==t.signum()?this.sign>t.sign?1:-1:0===this.signum()?0:this.compareToAbs(t)*this.sign}max(t){return this.compareTo(t)>=0?this.clone():t.clone()}min(t){return this.compareTo(t)>=0?t.clone():this.clone()}_shift(t){if(0===t)return this;const n=this.element;if(1===t){let t=n.length-1;for(0!=(32768&n[t])&&(n[n.length]=1);t>=0;t--)n[t]<<=1,n[t]&=65535,t>0&&0!=(32768&n[t-1])&&(n[t]+=1)}else if(-1===t){for(let t=0;t<n.length;t++)n[t]>>>=1,t<n.length-1&&0!=(1&n[t+1])&&(n[t]|=32768);0===n[n.length-1]&&n.pop()}else{if(t>=16){const e=t>>>4;for(let t=n.length-1;t>=0;t--)n[t+e]=n[t];for(let t=e-1;t>=0;t--)n[t]=0;t&=15}else if(t<=-16){const e=-t>>>4;n.splice(0,e),t+=e<<4}if(0!==t)if(0<t){let e=0;for(let i=0;i<n.length;i++)n[i]=(n[i]<<t)+e,n[i]>65535?(e=n[i]>>>16,n[i]&=65535):e=0;0!==e&&(n[n.length]=e)}else{t=-t;for(let e=0;e<n.length;e++)e!==n.length-1?(n[e]+=n[e+1]<<16,n[e]>>>=t,n[e]&=65535):n[e]>>>=t;0===n[n.length-1]&&n.pop()}}return this}shift(t){return this.clone()._shift(t)}shiftLeft(t){return this.shift(t)}shiftRight(t){return this.shift(-t)}_add(t){t instanceof BigInteger||(t=new BigInteger(t));const n=this,e=t;let i=n.element,o=e.element;if(n.sign===e.sign){this._memory_allocation(o.length<<4);let t=0;for(let n=0;n<i.length;n++)i[n]+=(o.length>=n+1?o[n]:0)+t,i[n]>65535?(t=1,i[n]&=65535):t=0;0!==t&&(i[i.length]=t)}else{const t=n.compareToAbs(e);if(0===t)return this.element=[],this.sign=1,this;if(-1===t){this.sign=e.sign;const t=i;i=o.slice(0),o=t}let r=0;for(let t=0;t<i.length;t++)i[t]-=(o.length>=t+1?o[t]:0)+r,i[t]<0?(i[t]+=65536,r=1):r=0;this.element=i,this._memory_reduction()}return this}add(t){return this.clone()._add(t)}_subtract(t){t instanceof BigInteger||(t=new BigInteger(t));const n=t.sign,e=this._add(t._negate());return t.sign=n,e}subtract(t){return this.clone()._subtract(t)}_multiply(t){const n=this.multiply(t);return this.element=n.element,this.sign=n.sign,this}multiply(t){t instanceof BigInteger||(t=new BigInteger(t));const n=new BigInteger,e=new BigInteger,i=t,o=this.element,r=i.element,s=n.element;for(let t=0;t<o.length;t++){e.element=[];const i=e.element;let h=0;for(let n=0;n<r.length;n++)i[n]=o[t]*r[n]+h,i[n]>65535?(h=i[n]>>>16,i[n]&=65535):h=0;0!==h&&(i[i.length]=h);for(let n=i.length-1;n>=0;n--)i[n+t]=i[n];for(let n=t-1;n>=0;n--)i[n]=0;h=0,n._memory_allocation(i.length<<4);for(let n=t;n<s.length;n++)s[n]+=(i.length>=n+1?i[n]:0)+h,s[n]>65535?(h=1,s[n]&=65535):h=0;0!==h&&(s[s.length]=h)}return n.sign=this.sign*t.sign,n}_divideAndRemainder(t){t instanceof BigInteger||(t=new BigInteger(t));const n=[];if(0===t.signum())return n[0]=1/0,n[1]=NaN,n;const e=this.compareToAbs(t);if(e<0)return n[0]=new BigInteger(0),n[1]=this.clone(),n;if(0===e)return n[0]=new BigInteger(1),n[0].sign=this.sign*t.sign,n[1]=new BigInteger(0),n;const i=new BigInteger(1),o=this.bitLength()-t.bitLength(),r=this.clone()._abs(),s=t.shift(o)._abs(),h=new BigInteger;for(let t=0;t<=o&&(r.compareToAbs(s)>=0&&(r._subtract(s),h._add(i)),t!==o);t++)s._shift(-1),h._shift(1);return n[0]=h,n[0].sign=this.sign*t.sign,n[1]=r,n[1].sign=this.sign,n}divideAndRemainder(t){return this.clone()._divideAndRemainder(t)}_divide(t){return this._divideAndRemainder(t)[0]}divide(t){return this.clone()._divide(t)}_remainder(t){return this._divideAndRemainder(t)[1]}remainder(t){return this.clone()._remainder(t)}_mod(t){if(t instanceof BigInteger||(t=new BigInteger(t)),t.signum()<0)return null;const n=this._divideAndRemainder(t);return n[1]instanceof BigInteger?n[1].signum()>=0?n[1]:n[1]._add(t):null}mod(t){return this.clone()._mod(t)}_setBit(t){return this._memory_allocation(t+1),this.element[t>>>4]|=1<<(15&t),this}setBit(t){return this.clone()._setBit(t)}_flipBit(t){return this._memory_allocation(t+1),this.element[t>>>4]^=1<<(15&t),this}flipBit(t){return this.clone()._flipBit(t)}clearBit(t){const n=this.clone();return n.element[t>>>4]&=~(1<<(15&t)),n._memory_reduction(),n}testBit(t){return this.element[t>>>4]>>>(15&t)&1}pow(t){let n,e;for(n=new BigInteger(this),e=new BigInteger(1);0!==t;)0!=(1&t)&&(e=e.multiply(n)),n=n.multiply(n),t>>>=1;return e}modPow(t,n){n=new BigInteger(n);let e=new BigInteger(this),i=new BigInteger(1);const o=new BigInteger(t);for(;0!==o.element.length;)0!=(1&o.element[0])&&(i=i.multiply(e).mod(n)),e=e.multiply(e).mod(n),o._shift(-1);return i}modInverse(t){t=new BigInteger(t);const n=this.extgcd(t),e=new BigInteger(1);return 0!==n[2].compareTo(e)?null:n[0]._add(t)._mod(t)}isProbablePrime(t){const n=this.element;if(0===n.length||1===n.length&&n[0]<=2)return!0;if(0==(1&n[0])||t<=0)return!1;if(void 0===Random)return!1;t>>=1;const e=new BigInteger(0),i=new BigInteger(1),o=this,r=o.bitLength(),s=o.subtract(i),h=s.getLowestSetBit(),l=s.shift(-h),a=new Random;let u,c;for(let n=0;n<t;n++){do{u=new BigInteger(r,a)}while(0===u.compareTo(e)||-1!==u.compareTo(o));if(0!==(u=u.modPow(l,o)).compareTo(i)){c=!0;for(let t=0;t<=h;t++){if(0===u.compareTo(s)){c=!1;break}t<h&&(u=u.multiply(u)._mod(o))}if(c)return!1}}return!0}nextProbablePrime(){if(void 0===Random)return new BigInteger(0);const t=this.clone(),n=new BigInteger(1);for(;;)if(t._add(n),t.isProbablePrime(100))break;return t}static valueOf(t){return new BigInteger(t)}static probablePrime(t,n){return new BigInteger(t,100,n)}}BigInteger.ONE=new BigInteger(1),BigInteger.TEN=new BigInteger(10),BigInteger.ZERO=new BigInteger(0);class BigDecimal{constructor(){this.integer=0,this._scale=0;let t=0,n=0,e=null;if(arguments.length>=1&&(t=arguments[0]),arguments.length>=2&&(n=arguments[1]),arguments.length>=3&&(e=arguments[2]),n instanceof MathContext&&(e=n),t instanceof BigDecimal)this.integer=t.integer.clone(),this._scale=t._scale,this.int_string=t.int_string;else if(t instanceof BigInteger)this.integer=t.clone(),this._scale=n;else if("number"==typeof t)if(t===Math.floor(t))this.integer=new BigInteger(t),this._scale=0;else{for(this._scale=0;;)if(t*=10,this._scale=this._scale+1,t===Math.floor(t))break;this.integer=new BigInteger(t)}else if("string"==typeof t){this._scale=0;let n,e=t.replace(/\s/g,"").toLowerCase(),i="";null!==(n=e.match(/^[+-]+/))&&(n=n[0],e=e.substr(n.length),-1!==n.indexOf("-")&&(i+="-")),null!==(n=e.match(/^[0-9]+/))&&(n=n[0],e=e.substr(n.length),i+=n),null!==(n=e.match(/^\.[0-9]+/))&&(n=n[0],e=e.substr(n.length),n=n.substr(1),this._scale=this._scale+n.length,i+=n),null!==(n=e.match(/^e[+-]?[0-9]+/))&&(n=n[0].substr(1),this._scale=this._scale-parseInt(n,10)),this.integer=new BigInteger(i,10)}if(e instanceof MathContext){const t=this.round(e);this.integer=t.integer,this._scale=t._scale}}_getUnsignedIntegerString(){return void 0===this.int_string&&(this.int_string=this.integer.toString(10).replace(/^-/,"")),this.int_string}clone(){return new BigDecimal(this)}scale(){return this._scale}signum(){return this.integer.signum()}precision(){return this._getUnsignedIntegerString().length}unscaledValue(){return new BigInteger(this.integer)}toScientificNotation(t){const n=this._getUnsignedIntegerString();let e=this.scale();const i=[];let o,r;if(-1===this.signum()&&(i[i.length]="-"),(e=-t-e)>=0)for(i[i.length]=n,o=0;o<e;o++)i[i.length]="0";else if(0<(r=this.precision()+e))i[i.length]=n.substring(0,r),i[i.length]=".",i[i.length]=n.substring(r,n.length);else{for(r=-r,i[i.length]="0.",o=0;o<r;o++)i[i.length]="0";i[i.length]=n}return i[i.length]="E",t>=0&&(i[i.length]="+"),i[i.length]=t,i.join("")}toString(){const t=-this.scale()+(this.precision()-1);return this.scale()>=0&&t>=-6?this.toPlainString():this.toScientificNotation(t)}toEngineeringString(){const t=-this.scale()+(this.precision()-1);return this.scale()>=0&&t>=-6?this.toPlainString():this.toScientificNotation(3*Math.floor(t/3))}toPlainString(){return 0===this.scale()?this.signum()<0?"-"+this._getUnsignedIntegerString():this._getUnsignedIntegerString():this.toScientificNotation(0).match(/^[^E]*/)[0]}ulp(){return new BigDecimal(BigInteger.ONE,this.scale())}setScale(t,n){if(this.scale()===t)return this.clone();n=1===arguments.length?RoundingMode.UNNECESSARY:RoundingMode.getRoundingMode(n);let e=this._getUnsignedIntegerString();const i=this.signum(),o=i>=0?"":"-",r=t-this.scale();if(0<=r){let n;for(n=0;n<r;n++)e+="0";return new BigDecimal(new BigInteger(o+e),t)}const s=e.length+r,h=s+1;if(s<=0){const e=(i+n.getAddNumber(i))/10;return new BigDecimal(new BigInteger(e),t)}{const i=e.match(/0+$/),h=null!==i?i[0].length:0;if(h+r>=0||n===RoundingMode.DOWN)return new BigDecimal(new BigInteger(o+e.substring(0,s)),t)}{const r=(e=e.substring(0,h)).length>1?2:1,s=parseInt(e.substring(e.length-r,e.length))*i,l=new BigInteger(o+e),a=new BigInteger(n.getAddNumber(s));return e=l.add(a).toString(),new BigDecimal(new BigInteger(e.substring(0,e.length-1)),t)}}round(t){if(!(t instanceof MathContext))throw"not MathContext";const n=t.getPrecision(),e=n-this.precision();if(0===e||0===n)return this.clone();const i=this.setScale(this.scale()+e,t.getRoundingMode());if(e>0)return i;if(i.precision()===t.getPrecision())return i;const o=i.integer.signum()>=0?"":"-",r=i._getUnsignedIntegerString(),s=o+r.substring(0,r.length-1);return new BigDecimal(new BigInteger(s),i.scale()-1)}abs(t){const n=this.clone();if(n.integer=n.integer.abs(),1===arguments.length)return n;if(!(t instanceof MathContext))throw"not MathContext";return n.round(t)}plus(t){const n=this.clone();if(1===arguments.length)return n;if(!(t instanceof MathContext))throw"not MathContext";return n.round(t)}negate(t){const n=this.clone();if(n.integer=n.integer.negate(),1===arguments.length)return n;if(!(t instanceof MathContext))throw"not MathContext";return n.round(t)}compareTo(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";const n=this,e=t;{const t=n.signum(),i=e.signum();if(0===t&&t===i)return 0;if(0===t)return-i;if(0===i)return t}if(n._scale===e._scale)return n.integer.compareTo(e.integer);if(n._scale>e._scale){const t=e.setScale(n._scale);return n.integer.compareTo(t.integer)}{const t=n.setScale(e._scale);return t.integer.compareTo(e.integer)}}equals(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";return this._scale===t._scale&&this.integer.equals(t.integer)}min(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";return this.compareTo(t)<=0?this.clone():t.clone()}max(t){if(!(t instanceof BigDecimal))throw"not BigDecimal";return this.compareTo(t)>=0?this.clone():t.clone()}movePointLeft(t){let n=this.scaleByPowerOfTen(-t);return n=n.setScale(Math.max(this.scale()+t,0))}movePointRight(t){let n=this.scaleByPowerOfTen(t);return n=n.setScale(Math.max(this.scale()-t,0))}scaleByPowerOfTen(t){const n=this.clone();return n._scale=this.scale()-t,n}stripTrailingZeros(){const t=this.signum()>=0?"":"-",n=this.integer.toString(10).replace(/^-/,""),e=n.match(/0+$/);let i=null!==e?e[0].length:0;i===n.length&&(i=n.length-1);const o=this.scale()-i;return new BigDecimal(new BigInteger(t+n.substring(0,n.length-i)),o)}add(t,n){if(1===arguments.length&&(n=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(n instanceof MathContext))throw"not MathContext";const e=this,i=t,o=Math.max(e._scale,i._scale);if(e._scale===i._scale)return new BigDecimal(e.integer.add(i.integer),o,n);if(e._scale>i._scale){const t=i.setScale(e._scale);return new BigDecimal(e.integer.add(t.integer),o,n)}{const t=e.setScale(i._scale);return new BigDecimal(t.integer.add(i.integer),o,n)}}subtract(t,n){if(1===arguments.length&&(n=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(n instanceof MathContext))throw"not MathContext";const e=this,i=t,o=Math.max(e._scale,i._scale);if(e._scale===i._scale)return new BigDecimal(e.integer.subtract(i.integer),o,n);if(e._scale>i._scale){const t=i.setScale(e._scale);return new BigDecimal(e.integer.subtract(t.integer),o,n)}{const t=e.setScale(i._scale);return new BigDecimal(t.integer.subtract(i.integer),o,n)}}multiply(t,n){if(1===arguments.length&&(n=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(n instanceof MathContext))throw"not MathContext";const e=this,i=t,o=e.integer.multiply(i.integer),r=e._scale+i._scale;return new BigDecimal(o,r,n)}divideToIntegralValue(t,n){if(1===arguments.length&&(n=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(n instanceof MathContext))throw"not MathContext";const e=function(t){let n,e="1";for(n=0;n<t;n++)e+="0";return new BigInteger(e)};if(0===t.compareTo(BigDecimal.ZERO))throw"ArithmeticException";const i=this,o=t;let r=i.integer,s=o.integer;const h=i._scale-o._scale;i._scale>o._scale?s=s.multiply(e(h)):i._scale<o._scale&&(r=r.multiply(e(-h)));const l=r.divide(s),a=l.signum();if(0!==a){const t=l.toString(10).replace(/^-/,"");if(0!==n.getPrecision()&&t.length>n.getPrecision())throw"ArithmeticException";if(t.length<=-h){const n=t.match(/0+$/),e=null!==n?n[0].length:0,i=a>=0?"":"-";return new BigDecimal(new BigInteger(i+t.substring(0,t.length-e)),-e)}}let u=new BigDecimal(l);return u=u.setScale(h,RoundingMode.UP),u=u.round(n)}divideAndRemainder(t,n){if(1===arguments.length&&(n=MathContext.UNLIMITED),!(t instanceof BigDecimal))throw"not BigDecimal";if(!(n instanceof MathContext))throw"not MathContext";const e=this.divideToIntegralValue(t,n);return[e,this.subtract(e.multiply(t,n),n)]}divide(t,n,e){if(!(t instanceof BigDecimal))throw"not BigDecimal";const i=this,o=t;let r,s=null,h=MathContext.UNLIMITED,l=0,a=!1;if(1===arguments.length)l=i.scale()-o.scale(),a=!0;else if(2===arguments.length)r=n,l=i.scale(),a=!0,s=r instanceof MathContext?(h=r).getRoundingMode():RoundingMode.getRoundingMode(arguments[0]);else{if(3!==arguments.length)throw"The argument is over.";if(!("number"==typeof n||n instanceof Number))throw"scale is not Integer";l=n,s=(r=e)instanceof MathContext?(h=r).getRoundingMode():RoundingMode.getRoundingMode(arguments[0])}if(0===o.compareTo(BigDecimal.ZERO))throw"ArithmeticException";let u,c=i;const g=[];let f,m,d,_;_=BigDecimal.ZERO;const p=h.getPrecision(),C=0!==p?p+8:262143;for(u=0;u<C&&(f=c.divideAndRemainder(o,MathContext.UNLIMITED),m=f[0],d=f[1],_=_.add(m.scaleByPowerOfTen(-u),MathContext.UNLIMITED),0!==d.compareTo(BigDecimal.ZERO));u++){if(0===p){if(g[d._getUnsignedIntegerString()])throw"ArithmeticException "+_+"["+d._getUnsignedIntegerString()+"]";g[d._getUnsignedIntegerString()]=!0}c=d.scaleByPowerOfTen(1)}if(a)try{_=_.setScale(l,s)}catch(t){}else _=_.setScale(l,s);return _=_.round(h)}toBigInteger(){const t=this.toPlainString().replace(/\.\d*$/,"");return new BigInteger(t.toPlainString())}toBigIntegerExact(){const t=this.setScale(0,RoundingMode.UNNECESSARY);return new BigInteger(t.toPlainString())}longValue(){let t=this.toBigInteger();return t=t.longValue()}longValueExact(){let t=this.toBigIntegerExact();return t=t.longValue()}intValue(){let t=this.toBigInteger();return 4294967295&(t=t.intValue())}intValueExact(){let t=this.toBigIntegerExact();if((t=t.longValue())<-2147483648||2147483647<t)throw"ArithmeticException";return t}floatValue(){const t=this.precision();return MathContext.DECIMAL32.getPrecision()<t?this.signum()>=0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:parseFloat(t.toEngineeringString())}doubleValue(){const t=this.precision();return MathContext.DECIMAL64.getPrecision()<t?this.signum()>=0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:parseFloat(t.toEngineeringString())}pow(t,n){if(Math.abs(t)>999999999)throw"ArithmeticException";if(1===arguments.length&&(n=MathContext.UNLIMITED),!(n instanceof MathContext))throw"not MathContext";if(0===n.getPrecision()&&t<0)throw"ArithmeticException";if(n.getPrecision()>0&&t>n.getPrecision())throw"ArithmeticException";let e,i;for(e=this.clone(),i=BigDecimal.ONE;0!==t;)0!=(1&t)&&(i=i.multiply(e,MathContext.UNLIMITED)),e=e.multiply(e,MathContext.UNLIMITED),t>>>=1;return i.round(n)}static valueOf(t,n){if(1===arguments.length)return new BigDecimal(t);if(2===arguments.length){if("number"==typeof t&&t===Math.floor(t))return new BigDecimal(new BigInteger(t),n);throw"IllegalArgumentException"}throw"IllegalArgumentException"}}const RoundingMode={UP:{toString:function(){return"UP"},getAddNumber:function(t){return t%=10,0===t?0:t>0?10-t:-(10+t)}},DOWN:{toString:function(){return"DOWN"},getAddNumber:function(t){return-(t%=10)}},CEILING:{toString:function(){return"CEILING"},getAddNumber:function(t){return t%=10,0===t?0:t>0?10-t:-t}},FLOOR:{toString:function(){return"FLOOR"},getAddNumber:function(t){return t%=10,0===t?0:t>0?-t:-(10+t)}},HALF_UP:{toString:function(){return"HALF_UP"},getAddNumber:function(t){const n=(t%=10)>=0?1:-1;return Math.abs(t)<5?-1*t:n*(10-Math.abs(t))}},HALF_DOWN:{toString:function(){return"HALF_DOWN"},getAddNumber:function(t){const n=(t%=10)>=0?1:-1;return Math.abs(t)<6?-1*t:n*(10-Math.abs(t))}},HALF_EVEN:{toString:function(){return"HALF_EVEN"},getAddNumber:function(t){let n,e;(t%=100)<0?(n=-1,e=1&Math.ceil(t/10)):(n=1,e=1&Math.floor(t/10));let i;return i=1===e?5:6,t%=10,Math.abs(t)<i?-1*t:n*(10-Math.abs(t))}},UNNECESSARY:{toString:function(){return"UNNECESSARY"},getAddNumber:function(t){if(0===(t%=10))return 0;throw"ArithmeticException"}},valueOf:function(t){if(null===t)throw"NullPointerException";const n=RoundingMode.values;for(let e=0;e<n.length;e++)if(n[e].toString()===t)return n[e];throw"IllegalArgumentException"},getRoundingMode:function(t){let n;switch(t){case RoundingMode.CEILING:case RoundingMode.DOWN:case RoundingMode.FLOOR:case RoundingMode.HALF_DOWN:case RoundingMode.HALF_EVEN:case RoundingMode.HALF_UP:case RoundingMode.UNNECESSARY:case RoundingMode.UP:n=t;break;default:"number"==typeof t||t instanceof Number?n=RoundingMode.values[t]:("string"==typeof t||t instanceof String)&&(n=RoundingMode.valueOf(t))}if(!n)throw"Not RoundingMode";return n}};RoundingMode.values={0:RoundingMode.CEILING,1:RoundingMode.DOWN,2:RoundingMode.FLOOR,3:RoundingMode.HALF_DOWN,4:RoundingMode.HALF_EVEN,5:RoundingMode.HALF_UP,6:RoundingMode.UNNECESSARY,7:RoundingMode.UP};class MathContext{constructor(){this.precision=0,this.roundingMode=RoundingMode.HALF_UP;let t,n=0,e=0;if(arguments.length>=1&&(n=arguments[0]),arguments.length>=2&&(e=arguments[1]),"string"==typeof n||n instanceof String?(null!==(t=n.match(/precision=\d+/))&&(t=t[0].substring("precision=".length,t[0].length),this.precision=parseInt(t,10)),null!==(t=n.match(/roundingMode=\w+/))&&(t=t[0].substring("roundingMode=".length,t[0].length),this.roundingMode=RoundingMode.valueOf(t))):1===arguments.length?this.precision=n:2===arguments.length&&(this.precision=n,this.roundingMode=e),this.precision<0)throw"IllegalArgumentException"}getPrecision(){return this.precision}getRoundingMode(){return this.roundingMode}equals(t){return t instanceof MathContext&&t.toString()===this.toString()}toString(){return"precision="+this.precision+" roundingMode="+this.roundingMode.toString()}}MathContext.UNLIMITED=new MathContext(0,RoundingMode.HALF_UP),MathContext.DECIMAL32=new MathContext(7,RoundingMode.HALF_EVEN),MathContext.DECIMAL64=new MathContext(16,RoundingMode.HALF_EVEN),MathContext.DECIMAL128=new MathContext(34,RoundingMode.HALF_EVEN),BigDecimal.RoundingMode=RoundingMode,BigDecimal.MathContext=MathContext,BigDecimal.ZERO=new BigDecimal(0),BigDecimal.ONE=new BigDecimal(1),BigDecimal.TEN=new BigDecimal(10),BigDecimal.ROUND_CEILING=RoundingMode.CEILING,BigDecimal.ROUND_DOWN=RoundingMode.DOWN,BigDecimal.ROUND_FLOOR=RoundingMode.FLOOR,BigDecimal.ROUND_HALF_DOWN=RoundingMode.HALF_DOWN,BigDecimal.ROUND_HALF_EVEN=RoundingMode.HALF_EVEN,BigDecimal.ROUND_HALF_UP=RoundingMode.HALF_UP,BigDecimal.ROUND_UNNECESSARY=RoundingMode.UNNECESSARY,BigDecimal.ROUND_UP=RoundingMode.UP;const random_class=new Random,ToComplexFromString=function(t,n){const e=t.replace(/\s/g,"").toLowerCase();if(!/[ij]/.test(e))return n._re=parseFloat(e),void(n._im=0);let i,o=0,r=0;(i=e.match(/[+-]?[0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?($|[+-])/))&&(o=parseFloat(i[0])),(i=e.match(/[+-]?([0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?)?[ij]/))&&(i=i[0].substring(0,i[0].length-1),r=/^[-+]$/.test(i)||0===i.length?"-"===i?-1:1:parseFloat(i)),n._re=o,n._im=r};class Complex{constructor(t){if(1!==arguments.length)throw"Many arguments : "+arguments.length;{const n=t;if(n instanceof Complex||n instanceof Object&&n._re&&n._im)this._re=n._re,this._im=n._im;else if("number"==typeof n||n instanceof Number)this._re=n,this._im=0;else if(n instanceof Array&&2===n.length)this._re=n[0],this._im=n[1];else if("string"==typeof n||n instanceof String)ToComplexFromString(n,this);else{if(!(n instanceof Object&&n.toString))throw"Unsupported argument";ToComplexFromString(n.toString(),this)}}}clone(){return this}toString(){const t=function(t){let n=t.toPrecision(6);return-1!==n.indexOf(".")&&(n=(n=n.replace(/\.?0+$/,"")).replace(/\.?0+e/,"e")),n};return this.isReal()?t(this._re):0===this._re?t(this._im)+"i":this._im>=0?t(this._re)+" + "+t(this._im)+"i":t(this._re)+" - "+t(-this._im)+"i"}static createConstComplex(t){return t instanceof Complex?t:new Complex(t)}static rand(){return new Complex(random_class.nextDouble())}static randn(){return new Complex(random_class.nextGaussian())}equals(t,n){const e=Complex.createConstComplex(t),i=n||Number.EPSILON;return Math.abs(this._re-e._re)<i&&Math.abs(this._im-e._im)<i}get real(){return this._re}get imag(){return this._im}get norm(){return 0===this._im?Math.abs(this._re):0===this._re?Math.abs(this._im):Math.sqrt(this._re*this._re+this._im*this._im)}get angle(){return 0===this._im?0:0===this._re?Math.PI*(this._im>=0?.5:-.5):Math.atan2(this._im,this._re)}getDecimalPosition(){let t=0,n=this;for(let e=0;e<20&&!n.isComplexInteger();e++)n=n.mul(Complex.TEN),t++;return t}add(t){const n=new Complex(t);return n._re=this._re+n._re,n._im=this._im+n._im,n}sub(t){const n=new Complex(t);return n._re=this._re-n._re,n._im=this._im-n._im,n}mul(t){const n=new Complex(t);if(0===this._im&&0===n._im)return n._re=this._re*n._re,n;if(0===this._re&&0===n._re)return n._re=-this._im*n._im,n._im=0,n;{const t=this._re*n._re-this._im*n._im,e=this._im*n._re+this._re*n._im;return n._re=t,n._im=e,n}}dot(t){const n=new Complex(t);if(0===this._im&&0===n._im)return n._re=this._re*n._re,n;if(0===this._re&&0===n._re)return n._re=this._im*n._im,n._im=0,n;{const t=this._re*n._re+this._im*n._im,e=-this._im*n._re+this._re*n._im;return n._re=t,n._im=e,n}}div(t){const n=new Complex(t);if(0===this._im&&0===n._im)return n._re=this._re/n._re,n;if(0===this._re&&0===n._re)return n._re=this._im/n._im,n._im=0,n;{const t=this._re*n._re+this._im*n._im,e=this._im*n._re-this._re*n._im,i=1/(n._re*n._re+n._im*n._im);return n._re=t*i,n._im=e*i,n}}mod(t){const n=new Complex(t);if(0!==this._im||0!==n._im)throw"calculation method is undefined.";let e=this._re-n._re*(0|this._re/n._re);return e<0&&(e+=n._re),n._re=e,n}inv(){return 0===this._im?new Complex(1/this._re):0===this._re?new Complex([0,-1/this._im]):Complex.ONE.div(this)}sign(){return 0===this._im?new Complex(0===this._re?0:this._re>0?1:-1):this.div(this.norm)}max(t,n){const e=Complex.createConstComplex(t);return this.compareTo(e,n)<=0?this:e}min(t,n){const e=Complex.createConstComplex(t);return this.compareTo(e,n)>=0?this:e}compareTo(t,n){const e=Complex.createConstComplex(t);return this.equals(e,n)?0:this.real+this.imag<e.real+e.imag?1:-1}isInteger(t){const n=t||Number.EPSILON;return this.isReal()&&Math.abs(this._re-(0|this._re))<n}isComplexInteger(t){const n=t||Number.EPSILON;return Math.abs(this._re-(0|this._re))<n&&Math.abs(this._im-(0|this._im))<n}isZero(t){const n=t||Number.EPSILON;return Math.abs(this._re)<n&&Math.abs(this._im)<n}isOne(t){const n=t||Number.EPSILON;return Math.abs(this._re-1)<n&&Math.abs(this._im)<n}isComplex(t){const n=t||Number.EPSILON;return Math.abs(this._im)>=n}isReal(t){const n=t||Number.EPSILON;return Math.abs(this._im)<n}isNaN(){return Math.isNaN(this._re)||Math.isNaN(this._im)}isPositive(){return 0<this._re}isNegative(){return 0>this._re}isNotNegative(){return 0<=this._re}isInfinite(){return this._re===Number.POSITIVE_INFINITY||this._im===Number.POSITIVE_INFINITY||this._re===Number.NEGATIVE_INFINITY||this._im===Number.NEGATIVE_INFINITY}isFinite(){return!this.isNaN()&&!this.isInfinite()}abs(){return new Complex(this.norm)}conj(){return 0===this._im?this:new Complex([this._re,-this._im])}negate(){return new Complex([-this._re,-this._im])}pow(t){const n=new Complex(t);if(this.isReal()&&n.isReal()&&this.isNotNegative())return n._re=Math.pow(this._re,n._re),n;if(n.isReal()){const t=Math.pow(this.norm,n._re),e=this.angle*n._re;return n._re=t*Math.cos(e),n._im=t*Math.sin(e),n}return n.mul(this.log()).exp()}square(){return new Complex(this._re*this._re+this._im*this._im)}sqrt(){if(this.isReal())return new Complex(this.isNotNegative()?Math.sqrt(this._re):[0,Math.sqrt(this._re)]);const t=Math.sqrt(this.norm),n=.5*this.angle;return new Complex([t*Math.cos(n),t*Math.sin(n)])}log(){return new Complex(this.isReal()&&this.isNotNegative()?Math.log(this._re):[Math.log(this.norm),this.angle])}exp(){if(this.isReal())return new Complex(Math.exp(this._re));const t=Math.exp(this._re);return new Complex([t*Math.cos(this._im),t*Math.sin(this._im)])}sin(){if(this.isReal())return new Complex(Math.sin(this._re));const t=this.mul(Complex.I).exp(),n=this.mul(Complex.I.negate()).exp();return t.sub(n).div([0,2])}cos(){if(this.isReal())return new Complex(Math.cos(this._re));const t=this.mul(Complex.I).exp(),n=this.mul(Complex.I.negate()).exp();return t.add(n).div(2)}tan(){return this.isReal()?new Complex(Math.tan(this._re)):this.sin().div(this.cos())}atan(){return this.isReal()?new Complex(Math.atan(this._re)):Complex.I.div(Complex.TWO).mul(Complex.I.add(this).div(Complex.I.sub(this)).log())}atan2(){if(0===arguments.length)return new Complex(this.angle);const t=this,n=new Complex(...arguments);if(t.isReal()&&n.isReal())return new Complex(Math.atan2(t._re,n._re));throw"calculation method is undefined."}floor(){return new Complex([Math.floor(this._im),Math.floor(this._re)])}ceil(){return new Complex([Math.ceil(this._im),Math.ceil(this._re)])}round(){return new Complex([Math.round(this._im),Math.round(this._re)])}}Complex.I=new Complex([0,1]),Complex.ZERO=new Complex(0),Complex.HALF=new Complex(.5),Complex.ONE=new Complex(1),Complex.MINUS=new Complex(-1),Complex.TWO=new Complex(2),Complex.TEN=new Complex(10);const ConstructorTool={match2:function(t,n){const e=[];let i=t,o=!0;for(let t=0;t<1e3;t++){if(null===(o=i.match(n))){i.length&&e.push([!1,i]);break}o.index>0&&e.push([!1,i.substr(0,o.index)]),e.push([!0,o[0]]),i=i.substr(o.index+o[0].length)}return e},trimBracket:function(t){return/^\[/.test(t)&&/\]$/.test(t)?t.substring(1,t.length-1):null},toMatrixFromStringForArrayJSON:function(t){const n=[];let e=t.match(/\[[^\]]+\]/g);null===e&&(e=[t]);for(let t=0;t<e.length;t++){const i=e[t],o=i.substring(1,i.length-1).split(","),r=[];for(let t=0;t<o.length;t++){const n=o[t];r[t]=new Complex(n)}n[t]=r}return n},InterpolationCalculation:function(t,n,e){const i=e.compareTo(t);if(0===i)return t;if(n.isZero())throw"IllegalArgumentException";if(n.isNegative()&&-1===i)throw"IllegalArgumentException";const o=[];let r=t;o[0]=r;for(let t=1;t<65536&&(r=r.add(n)).compareTo(e)!==i;t++)o[t]=r;return o},toArrayFromString:function(t){if(":"===t.trim())return":";const n=new RegExp("("+/[+-]? *([0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?)?[ij]( *[+] *[- ]?([0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?)?)?/.source+")|("+/[+-]? *[0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?( *[+-] *[- ]?([0-9]+(\.[0-9]+)?(e[+-]?[0-9]+)?)?[ij])?/.source+")","i"),e=ConstructorTool.match2(t,n),i=[];for(let t=0;t<e.length;t++){const n=e[t];if(n[0])if(t<e.length-2&&!e[t+1][0]&&/:/.test(e[t+1][1])){let o,r,s;t<e.length-4&&!e[t+3][0]&&/:/.test(e[t+3][1])?(o=new Complex(n[1]),r=new Complex(e[t+2][1]),s=new Complex(e[t+4][1]),t+=4):(o=new Complex(n[1]),r=Complex.ONE,s=new Complex(e[t+2][1]),t+=2);const h=ConstructorTool.InterpolationCalculation(o,r,s);for(let t=0;t<h.length;t++)i.push(h[t])}else i.push(new Complex(n[1]))}return i},toMatrixFromStringForArrayETC:function(t){const n=[],e=t.split(";");for(let t=0;t<e.length;t++)n[t]=ConstructorTool.toArrayFromString(e[t]);return n},toMatrixFromStringForArray:function(t){return/[[\],]/.test(t)?ConstructorTool.toMatrixFromStringForArrayJSON(t):ConstructorTool.toMatrixFromStringForArrayETC(t)},toMatrixFromString:function(t){const n=t.replace(/^\s*|\s*$/g,""),e=ConstructorTool.trimBracket(n);return e?ConstructorTool.toMatrixFromStringForArray(e):[[new Complex(t)]]},isCorrectMatrixArray:function(t){if(0===t.length)return!1;const n=t[0].length;if(0===n)return!1;for(let e=1;e<t.length;e++)if(t[e].length!==n)return!1;return!0}};class Matrix{constructor(t){let n=null,e=!1;if(1!==arguments.length)throw"Many arguments : "+arguments.length;{const i=t;if(i instanceof Matrix){n=[];for(let t=0;t<i.row_length;t++){n[t]=[];for(let e=0;e<i.column_length;e++)n[t][e]=i.matrix_array[t][e]}}else if(i instanceof Complex)n=[[i]];else if(i instanceof Array){n=[];for(let t=0;t<i.length;t++){const e=i[t];if(e instanceof Array){const i=[];for(let t=0;t<e.length;t++){const n=e[t];if(n instanceof Complex)i[t]=n;else if(n instanceof Matrix){if(!n.isScalar())throw"Matrix in matrix";i[t]=n.scalar}else i[t]=new Complex(n)}n[t]=i}else if(0===t&&(n[0]=[]),e instanceof Complex)n[0][t]=e;else if(e instanceof Matrix){if(!e.isScalar())throw"Matrix in matrix";n[0][t]=e.scalar}else n[0][t]=new Complex(e)}}else"string"==typeof i||i instanceof String?(e=!0,n=ConstructorTool.toMatrixFromString(i)):i instanceof Object&&i.toString?(e=!0,n=ConstructorTool.toMatrixFromString(i.toString())):n=[[new Complex(i)]]}if(e)for(let t=0;t<n.length;t++)":"===n[t]&&n.splice(t--,1);if(!ConstructorTool.isCorrectMatrixArray(n))throw"new Matrix IllegalArgumentException";this.matrix_array=n,this.row_length=this.matrix_array.length,this.column_length=this.matrix_array[0].length,this.string_cash=null}clone(){return new Matrix(this.matrix_array)}toString(){if(this.string_cash)return this.string_cash;const t=Math.pow(10,9);let n=!1,e=!1,i=0;this._each(function(o){o.isReal()||(n=!0),Math.abs(o.real)>=t&&(e=!0),Math.abs(o.imag)>=t&&(e=!0),i=Math.max(i,o.getDecimalPosition())}),i>0&&(i=4);let o=0;const r=[],s=function(t){if(!e)return t.toFixed(i);const n=t.toExponential(4).split("e");let o=n[1];return 2===o.length?o=o.substr(0,1)+"00"+o.substr(1):3===o.length&&(o=o.substr(0,1)+"0"+o.substr(1)),n[0]+"e"+o};this._each(function(t){const e={};let i=t.real;if(e.re_sign=i<0?"-":" ",i=Math.abs(i),e.re_str=s(i),o=Math.max(o,e.re_str.length+1),n){let n=t.imag;e.im_sign=n<0?"-":"+",n=Math.abs(n),e.im_str=s(n),o=Math.max(o,e.im_str.length+1)}r.push(e)});const h=function(t,n){return"                                        ".substr(0,n-t.length)+t},l=[],a=this;return this._each(function(t,e,i){const s=r.shift();let u=h(s.re_sign+s.re_str,o);n&&(u+=" "+s.im_sign+h(s.im_str,o)+"i"),l.push(u),l.push(i<a.column_length-1?" ":"\n")}),this.string_cash=l.join(""),this.string_cash}equals(t,n){const e=this,i=Matrix.createConstMatrix(t);if(e.row_length!==i.row_length||e.column_length!==i.column_length)return!1;if(1===e.row_length||1===e.column_length)return e.scalar.equals(i.scalar);const o=e.matrix_array,r=i.matrix_array;for(let t=0;t<this.row_length;t++)for(let e=0;e<this.column_length;e++)if(!o[t][e].equals(r[t][e],n))return!1;return!0}static createConstMatrix(t){return 1===arguments.length&&t instanceof Matrix?t:new Matrix(t)}_clearCash(){this.string_cash&&delete this.string_cash}_each(t){let n=!1;for(let e=0;e<this.row_length;e++)for(let i=0;i<this.column_length;i++){const o=t(this.matrix_array[e][i],e,i);void 0!==o&&(this.matrix_array[e][i]=o instanceof Complex?o:o instanceof Matrix?o.scalar:new Complex(o),n=!0)}return n&&this._clearCash(),this}static createMatrixDoEachCalculation(t,n,e){if(0===arguments.length||arguments.length>3)throw"IllegalArgumentException";const i=[],o=n,r=e||n;for(let n=0;n<o;n++){i[n]=[];for(let e=0;e<r;e++){const o=t(n,e);void 0!==o&&(i[n][e]=o instanceof Complex?o:o instanceof Matrix?o.scalar:new Complex(o))}}return new Matrix(i)}cloneMatrixDoEachCalculation(t){return this.clone()._each(t)}get scalar(){return this.matrix_array[0][0]}get length(){return this.row_length>this.column_length?this.row_length:this.column_length}get norm1(){const t=this.matrix_array;if(this.isRow()){let n=0;for(let e=0;e<this.column_length;e++)n+=t[0][e].norm;return n}if(this.isColumn()){let n=0;for(let e=0;e<this.row_length;e++)n=t[e][0].norm;return n}let n=0;for(let e=0;e<this.column_length;e++){let i=0;for(let n=0;n<this.row_length;n++)i+=t[n][e].norm;n<i&&(n=i)}return n}get norm2(){const t=this.matrix_array;if(this.isRow()){let n=0;for(let e=0;e<this.column_length;e++)n+=t[0][e].square().real;return Math.sqrt(n)}if(this.isColumn()){let n=0;for(let e=0;e<this.row_length;e++)n=t[e][0].square().real;return Math.sqrt(n)}throw"norm2"}get(t,n){let e=null,i=null;e="string"==typeof t||t instanceof String?new Matrix(t):t,2===arguments.length&&(i="string"==typeof n||n instanceof String?new Matrix(n):n);const o=function(n){let e,i=!1;return"number"==typeof t||t instanceof Number?(e=Math.round(n),i=!0):t instanceof Complex?(e=Math.round(n.real),i=!0):t instanceof Matrix&&t.isScalar()&&(e=Math.round(n.scalar.real),i=!0),{number:e,is_scalar:i}};let r=!0,s=null,h=null;return 1===arguments.length?r&=(s=o(e)).is_scalar:2===arguments.length&&(r&=(s=o(e)).is_scalar,r&=(h=o(i)).is_scalar),r?this.isRow()?this.matrix_array[0][s.number]:this.isColumn()?this.matrix_array[s.number][0]:this.matrix_array[s.number][h.number]:null}static eye(t,n){return Matrix.createMatrixDoEachCalculation(function(t,n){return t===n?Complex.ONE:Complex.ZERO},t,n)}static memset(t,n,e){if(0===arguments.length||arguments.length>3)throw"IllegalArgumentException";if(t instanceof Matrix&&!t.isScalar()){const i=t.matrix_array,o=t.row_length,r=t.column_length;return Matrix.createMatrixDoEachCalculation(function(t,n){return i[t%o][n%r]},n,e)}{let i=0;return i=t instanceof Matrix&&t.isScalar()?t.scalar:Complex.createConstComplex(t),Matrix.createMatrixDoEachCalculation(function(){return i},n,e)}}static zeros(t,n){if(0===arguments.length||arguments.length>2)throw"IllegalArgumentException";return Matrix.memset(Complex.ZERO,t,n)}static ones(t,n){if(0===arguments.length||arguments.length>2)throw"IllegalArgumentException";return Matrix.memset(Complex.ONE,t,n)}static rand(t,n){return Matrix.createMatrixDoEachCalculation(function(){return Complex.rand()},t,n)}static randn(t,n){return Matrix.createMatrixDoEachCalculation(function(){return Complex.randn()},t,n)}isScalar(){return 1===this.row_length&&1==this.column_length}isRow(){return 1===this.row_length}isColumn(){return 1===this.column_length}isVector(){return 1===this.row_length||1===this.column_length}isMatrix(){return 1!==this.row_length&&1!==this.column_length}isSquare(){return this.row_length===this.column_length}isReal(t){let n=!0;return this._each(function(e){n&&e.isComplex(t)&&(n=!1)}),n}isComplex(t){let n=!0;return this._each(function(e){n&&e.isReal(t)&&(n=!1)}),n}isZero(t){let n=!0;const e=t||1e-10;return this._each(function(t){n&&!t.isZero(e)&&(n=!1)}),n}isIdentity(t){if(!this.isDiagonal())return!1;const n=t||1e-10;for(let t=0;t<this.row_length;t++)if(!this.matrix_array[t][t].isOne(n))return!1;return!0}isDiagonal(t){if(!this.isSquare())return!1;let n=!0;const e=t||1e-10;return this._each(function(t,i,o){n&&i!==o&&!t.isZero(e)&&(n=!1)}),n}isTridiagonal(t){if(!this.isSquare())return!1;let n=!0;const e=t||1e-10;return this._each(function(t,i,o){n&&Math.abs(i-o)>1&&!t.isZero(e)&&(n=!1)}),n}isRegular(t){if(!this.isSquare())return!1;const n=t||1e-10;return this.rank(1e-10).equals(this.row_length,n)}isOrthogonal(t){if(!this.isSquare())return!1;const n=t||1e-10;return this.mul(this.transpose()).isIdentity(n)}isUnitary(t){if(!this.isSquare())return!1;const n=t||1e-10;return this.mul(this.ctranspose()).isIdentity(n)}isSymmetric(t){if(!this.isSquare())return!1;const n=t||1e-10;for(let t=0;t<this.row_length;t++)for(let e=t+1;e<this.column_length;e++)if(!this.matrix_array[t][e].equals(this.matrix_array[e][t],n))return!1;return!0}isHermitian(t){if(!this.isSquare())return!1;const n=t||1e-10;for(let t=0;t<this.row_length;t++)for(let e=t;e<this.column_length;e++)if(t===e){if(!this.matrix_array[t][e].isReal(n))return!1}else if(!this.matrix_array[t][e].equals(this.matrix_array[e][t].conj(),n))return!1;return!0}size(){return new Matrix([[this.row_length,this.column_length]])}max(t){if(this.isRow()){let n=this.matrix_array[0][0];for(let e=1;e<this.column_length;e++)n.compareTo(this.matrix_array[0][e],t)>0&&(n=this.matrix_array[0][e]);return new Matrix(n)}{const n=[];n[0]=[];for(let e=0;e<this.column_length;e++){n[0][e]=this.matrix_array[0][e];for(let i=1;i<this.row_length;i++)n[0][e].compareTo(this.matrix_array[i][e],t)>0&&(n[0][e]=this.matrix_array[i][e])}return new Matrix(n)}}min(t){if(this.isRow()){let n=this.matrix_array[0][0];for(let e=1;e<this.column_length;e++)n.compareTo(this.matrix_array[0][e],t)<0&&(n=this.matrix_array[0][e]);return new Matrix(n)}{const n=[];n[0]=[];for(let e=0;e<this.column_length;e++){n[0][e]=this.matrix_array[0][e];for(let i=1;i<this.row_length;i++)n[0][e].compareTo(this.matrix_array[i][e],t)<0&&(n[0][e]=this.matrix_array[i][e])}return new Matrix(n)}}add(t){const n=this,e=Matrix.createConstMatrix(t);if(!(n.row_length%e.row_length!=0&&e.row_length%n.row_length!=0||n.column_length%e.column_length!=0&&e.column_length%n.column_length!=0))throw"Matrix size does not match";const i=n.matrix_array,o=e.matrix_array,r=Math.max(n.row_length,e.row_length),s=Math.max(n.column_length,e.column_length);return Matrix.createMatrixDoEachCalculation(function(t,r){return i[t%n.row_length][r%n.column_length].add(o[t%e.row_length][r%e.column_length])},r,s)}sub(t){const n=this,e=Matrix.createConstMatrix(t);if(!(n.row_length%e.row_length!=0&&e.row_length%n.row_length!=0||n.column_length%e.column_length!=0&&e.column_length%n.column_length!=0))throw"Matrix size does not match";const i=n.matrix_array,o=e.matrix_array,r=Math.max(n.row_length,e.row_length),s=Math.max(n.column_length,e.column_length);return Matrix.createMatrixDoEachCalculation(function(t,r){return i[t%n.row_length][r%n.column_length].sub(o[t%e.row_length][r%e.column_length])},r,s)}mul(t){const n=this,e=Matrix.createConstMatrix(t),i=n.matrix_array,o=e.matrix_array;if(n.isScalar()&&e.isScalar())return new Matrix(i.scalar.mul(o.scalar));const r=[];if(n.isScalar()){for(let t=0;t<e.row_length;t++){r[t]=[];for(let i=0;i<e.column_length;i++)r[t][i]=n.scalar.mul(o[t][i])}return new Matrix(r)}if(e.isScalar()){for(let t=0;t<n.row_length;t++){r[t]=[];for(let o=0;o<n.column_length;o++)r[t][o]=i[t][o].mul(e.scalar)}return new Matrix(r)}if(n.column_length!==e.row_length)throw"Matrix size does not match";for(let t=0;t<n.row_length;t++){r[t]=[];for(let s=0;s<e.column_length;s++){let e=Complex.ZERO;for(let r=0;r<n.column_length;r++)e=e.add(i[t][r].mul(o[r][s]));r[t][s]=e}}return new Matrix(r)}inv(){if(this.isScalar())return new Matrix(Complex.ONE.div(this.scalar));if(!this.isSquare())throw"not square";if(this.isDiagonal()){const t=new Matrix(this);for(let n=0;n<t.row_length;n++)t.matrix_array[n][n]=t.matrix_array[n][n].inv();return t}const t=this.column_length,n=new Matrix(this);n._concat_left(Matrix.eye(t));const e=n.matrix_array,i=n.column_length;for(let o=0;o<t;o++){{const t=n._max_row_number(o,o).index;n._exchange_row(o,t)}{const t=e[o][o].inv();for(let n=o,r=o;r<i;r++)e[n][r]=e[n][r].mul(t)}for(let n=0;n<t;n++)if(n!==o){const t=e[n][o];for(let r=o;r<i;r++)e[n][r]=e[n][r].sub(e[o][r].mul(t))}}const o=[];for(let n=0;n<t;n++){o[n]=[];for(let i=0;i<t;i++)o[n][i]=e[n][t+i]}return new Matrix(o)}div(t){const n=this,e=Matrix.createConstMatrix(t),i=n.matrix_array,o=e.matrix_array;if(n.isScalar()&&e.isScalar())return new Matrix(i.scalar.div(o.scalar));const r=[];if(e.isScalar()){for(let t=0;t<n.row_length;t++){r[t]=[];for(let o=0;o<n.column_length;o++)r[t][o]=i[t][o].div(e.scalar)}return new Matrix(r)}if(e.row_length===e.column_length)return this.mul(e.inv());if(n.column_length!==e.column_length)throw"Matrix size does not match";throw"Unimplemented"}nmul(t){const n=this,e=Matrix.createConstMatrix(t);if(!(n.row_length%e.row_length!=0&&e.row_length%n.row_length!=0||n.column_length%e.column_length!=0&&e.column_length%n.column_length!=0))throw"Matrix size does not match";const i=n.matrix_array,o=e.matrix_array,r=Math.max(n.row_length,e.row_length),s=Math.max(n.column_length,e.column_length);return Matrix.createMatrixDoEachCalculation(function(t,r){return i[t%n.row_length][r%n.column_length].mul(o[t%e.row_length][r%e.column_length])},r,s)}ndiv(t){const n=this,e=Matrix.createConstMatrix(t);if(!(n.row_length%e.row_length!=0&&e.row_length%n.row_length!=0||n.column_length%e.column_length!=0&&e.column_length%n.column_length!=0))throw"Matrix size does not match";const i=n.matrix_array,o=e.matrix_array,r=Math.max(n.row_length,e.row_length),s=Math.max(n.column_length,e.column_length);return Matrix.createMatrixDoEachCalculation(function(t,r){return i[t%n.row_length][r%n.column_length].div(o[t%e.row_length][r%e.column_length])},r,s)}real(){return this.cloneMatrixDoEachCalculation(function(t){return new Complex(t.real)})}imag(){return this.cloneMatrixDoEachCalculation(function(t){return new Complex(t.imag)})}angle(){return this.cloneMatrixDoEachCalculation(function(t){return new Complex(t.angle)})}sign(){return this.cloneMatrixDoEachCalculation(function(t){return new Complex(t.sign())})}testInteger(t){return this.cloneMatrixDoEachCalculation(function(n){return n.isInteger(t)?Complex.ONE:Complex.ZERO})}testComplexInteger(t){return this.cloneMatrixDoEachCalculation(function(n){return n.isComplexInteger(t)?Complex.ONE:Complex.ZERO})}testZero(t){return this.cloneMatrixDoEachCalculation(function(n){return n.isZero(t)?Complex.ONE:Complex.ZERO})}testOne(t){return this.cloneMatrixDoEachCalculation(function(n){return n.isOne(t)?Complex.ONE:Complex.ZERO})}testComplex(t){return this.cloneMatrixDoEachCalculation(function(n){return n.isComplex(t)?Complex.ONE:Complex.ZERO})}testReal(t){return this.cloneMatrixDoEachCalculation(function(n){return n.isReal(t)?Complex.ONE:Complex.ZERO})}testNaN(){return this.cloneMatrixDoEachCalculation(function(t){return t.isNaN()?Complex.ONE:Complex.ZERO})}testPositive(){return this.cloneMatrixDoEachCalculation(function(t){return t.isPositive()?Complex.ONE:Complex.ZERO})}testNegative(){return this.cloneMatrixDoEachCalculation(function(t){return t.isNegative()?Complex.ONE:Complex.ZERO})}testNotNegative(){return this.cloneMatrixDoEachCalculation(function(t){return t.isNotNegative()?Complex.ONE:Complex.ZERO})}testInfinite(){return this.cloneMatrixDoEachCalculation(function(t){return t.isInfinite()?Complex.ONE:Complex.ZERO})}testFinite(){return this.cloneMatrixDoEachCalculation(function(t){return t.isFinite()?Complex.ONE:Complex.ZERO})}abs(){return this.cloneMatrixDoEachCalculation(function(t){return t.abs()})}conj(){return this.cloneMatrixDoEachCalculation(function(t){return t.conj()})}negate(){return this.cloneMatrixDoEachCalculation(function(t){return t.negate()})}sqrt(){return this.cloneMatrixDoEachCalculation(function(t){return t.sqrt()})}pow(t){const n=Matrix.createConstMatrix(t);if(!n.isScalar())throw"not set Scalar";return this.cloneMatrixDoEachCalculation(function(t){return t.pow(n.scalar)})}log(){return this.cloneMatrixDoEachCalculation(function(t){return t.log()})}exp(){return this.cloneMatrixDoEachCalculation(function(t){return t.exp()})}sin(){return this.cloneMatrixDoEachCalculation(function(t){return t.sin()})}cos(){return this.cloneMatrixDoEachCalculation(function(t){return t.cos()})}tan(){return this.cloneMatrixDoEachCalculation(function(t){return t.tan()})}atan(){return this.cloneMatrixDoEachCalculation(function(t){return t.atan()})}atan2(t){const n=Matrix.createConstMatrix(t);if(!n.isScalar)throw"not set Scalar";return this.cloneMatrixDoEachCalculation(function(t){return t.atan2(n.scalar)})}floor(){return this.cloneMatrixDoEachCalculation(function(t){return t.floor()})}ceil(){return this.cloneMatrixDoEachCalculation(function(t){return t.ceil()})}round(){return this.cloneMatrixDoEachCalculation(function(t){return t.round()})}_rot90(t){let n=1;if(1===arguments.length&&(n=(t%4+4)%4),0===n)return this;const e=[];for(let t=0;t<this.row_length;t++){e[t]=[];for(let n=0;n<this.column_length;n++)e[t][n]=this.matrix_array[t][n]}const i=this.matrix_array;if(1===n){i.splice(this.column_length);for(let t=0;t<this.column_length;t++){t<this.row_length?i[t].splice(this.row_length):i[t]=[];for(let n=0;n<this.row_length;n++)i[t][n]=e[this.row_length-n-1][t]}}else if(2===n)for(let t=0;t<this.row_length;t++)for(let n=0;n<this.column_length;n++)i[t][n]=e[this.row_length-t-1][this.column_length-n-1];else if(3===n){i.splice(this.column_length);for(let t=0;t<this.column_length;t++){t<this.row_length?i[t].splice(this.row_length):i[t]=[];for(let n=0;n<this.row_length;n++)i[t][n]=e[n][this.column_length-t-1]}}return this.row_length=i.length,this.column_length=i[0].length,this._clearCash(),this}_resize(t,n){if(t===this.row_length&&n===this.column_length)return this;if(t<=0||n<=0)throw"_resize";const e=Math.max(this.row_length,t),i=Math.max(this.column_length,n),o=this.matrix_array;for(let t=0;t<e;t++){t>=this.row_length&&(o[t]=[]);for(let n=0;n<i;n++)(t>=this.row_length||n>=this.column_length)&&(o[t][n]=Complex.ZERO)}if(this.row_length>t&&o.splice(t),this.column_length>n)for(let t=0;t<o.length;t++)o[t].splice(n);return this.row_length=t,this.column_length=n,this._clearCash(),this}_delete_row(t){if(1===this.row_length||this.row_length<=t)throw"_delete_row";return this.matrix_array.splice(t,1),this.row_length--,this._clearCash(),this}_delete_column(t){if(1===this.column_length||this.column_length<=t)throw"_delete_column";for(let n=0;n<this.row_length;n++)this.matrix_array[n].splice(t,1);return this.column_length--,this._clearCash(),this}_exchange_row(t,n){if(1===this.row_length||this.row_length<=t||this.row_length<=n)throw"_exchange_row";if(t===n)return this;const e=this.matrix_array[t];return this.matrix_array[t]=this.matrix_array[n],this.matrix_array[n]=e,this._clearCash(),this}_exchange_column(t,n){if(1===this.column_length||this.column_length<=t||this.column_length<=n)throw"_exchange_column";if(t===n)return this;for(let e=0;e<this.row_length;e++){const i=this.matrix_array[e][t];this.matrix_array[e][t]=this.matrix_array[e][n],this.matrix_array[e][n]=i}return this._clearCash(),this}_concat_left(t){for(let n=0;n<this.row_length;n++)for(let e=0;e<t.column_length;e++)this.matrix_array[n].push(t.matrix_array[n][e]);return this.column_length+=t.column_length,this._clearCash(),this}_concat_bottom(t){for(let n=0;n<t.row_length;n++)this.matrix_array.push(t.matrix_array[n]);return this.row_length+=t.row_length,this._clearCash(),this}_max_row_number(t,n,e){let i=0,o=0,r=n||0;const s=e||this.row_length;for(;r<s;r++){const n=this.matrix_array[r][t].norm;n>o&&(o=n,i=r)}return{index:i,max:o}}_get_linear_dependence_vector(t){const n=new Matrix(this),e=n.matrix_array,i=t||1e-10,o=[];for(let t=0;t<this.row_length;t++)o[t]=t;for(let t=0;t<n.column_length;t++){let r=0;{let s=0,h=0;for(const n in o){const i=o[n],l=e[i][t].norm;l>s&&(s=l,h=n,r=i)}if(s<=i)continue;if(o.splice(h,1),t===n.column_length-1)break}for(const i in o){const s=o[i],h=e[s][t].div(e[r][t]);for(let i=t;i<n.column_length;i++)e[s][i]=e[s][i].sub(e[r][i].mul(h))}}return o}static _gram_schmidt_orthonormalization(t){const n=t.column_length,e=t.matrix_array,i=Matrix.zeros(n),o=Matrix.zeros(n),r=i.matrix_array,s=o.matrix_array,h=[],l=[];for(let t=0;t<n;t++){for(let i=0;i<n;i++)l[i]=e[i][t];if(t>0){for(let i=0;i<t;i++)for(let o=0;o<n;o++)s[i][t]=s[i][t].add(e[o][t].dot(r[o][i]));for(let e=0;e<t;e++)for(let i=0;i<n;i++)l[i]=l[i].sub(s[e][t].mul(r[i][e]))}for(let e=0;e<n;e++)s[t][t]=s[t][t].add(l[e].mul(l[e]));if(s[t][t]=s[t][t].sqrt(),s[t][t].isZero(1e-10)){h.push(t);for(let e=0;e<n;e++)r[e][t]=Complex.ZERO}else for(let e=0;e<n;e++)r[e][t]=l[e].div(s[t][t])}return{Q:i,R:o,non_orthogonalized:h}}_createOrthogonalVector(t){const n=new Matrix(this),e=n.matrix_array,i=t||1e-10,o=n._get_linear_dependence_vector(i);for(let t=o.length-1;t>=0;t--)e.splice(o[t],1),n.row_length--;const r=this.column_length-e.length;if(r<=0)return null;const s=new Random(0);let h=null;for(let t=0;t<100;t++){const t=n.T(),e=Matrix.createMatrixDoEachCalculation(function(){return new Complex(s.nextGaussian())},t.row_length,r);if(t._concat_left(e),0===(h=Matrix._gram_schmidt_orthonormalization(t)).non_orthogonalized.length)break}if(0!==h.non_orthogonalized.length)return console.log("miss"),null;const l=[],a=h.Q.matrix_array;for(let t=0;t<r;t++){l[t]=[];for(let n=0;n<this.column_length;n++)l[t][n]=a[n][this.column_length-r+t]}return new Matrix(l)}norm(t){if(0===arguments.length)return this.norm2;if(1===t)return this.norm1;if(2===t)return this.norm2;if(t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY){const n=this.matrix_array;let e=t===Number.POSITIVE_INFINITY?0:Number.POSITIVE_INFINITY;for(let i=0;i<this.row_length;i++){let o=0;for(let t=0;t<this.column_length;t++)o+=n[i][t].norm;e=t===Number.POSITIVE_INFINITY?Math.max(e,o):Math.min(e,o)}return e}if(this.isVector()){let n=0;for(let e=0;e<this.length;e++)n=Math.pow(this.get(e).norm,t);return Math.pow(n,1/t)}throw"norm"}dot(t,n){const e=this,i=Matrix.createConstMatrix(t),o=e.matrix_array,r=i.matrix_array,s=n||1;if(e.isScalar()&&i.isScalar())return new Matrix(e.scalar.dot(i.scalar));if(e.isVector()&&i.isVector()){let t=Complex.ZERO;for(let n=0;n<e.length;n++)t=t.add(e.get(n).dot(i.get(n)));return new Matrix(t)}if(e.row_length!==i.row_length||e.column_length!==i.column_length)throw"Matrix size does not match";if(1===s){const t=[];t[0]=[];for(let n=0;n<e.column_length;n++){let i=Complex.ZERO;for(let t=0;t<e.row_length;t++)i=i.add(o[t][n].dot(r[t][n]));t[0][n]=i}return new Matrix(t)}if(2===s){const t=[];for(let n=0;n<e.row_length;n++){let i=Complex.ZERO;for(let t=0;t<e.column_length;t++)i=i.add(o[n][t].dot(r[n][t]));t[n]=[i]}return new Matrix(t)}throw"dim"}rank(t){return Math.abs(this.row_length,this.column_length)-this._get_linear_dependence_vector(t).length}transpose(){const t=[];for(let n=0;n<this.column_length;n++){t[n]=[];for(let e=0;e<this.row_length;e++)t[n][e]=this.matrix_array[e][n]}return new Matrix(t)}ctranspose(){return this.transpose().conj()}T(){return this.ctranspose()}det(){if(!this.isSquare())throw"not square";const t=this.matrix_array,n=function(t){if(2===t.length)return t[0][0].mul(t[1][1]).sub(t[0][1].mul(t[1][0]));let e=Complex.ZERO;for(let i=0;i<t.length;i++){const o=[],r=t[i][0];for(let n=0,e=0;n<t.length;n++)if(i!==n){o[e]=[];for(let i=1,r=0;i<t.length;i++,r++)o[e][r]=t[n][i];e++}e=i%2==0?e.add(r.mul(n(o))):e.sub(r.mul(n(o)))}return e};return new Matrix(n(t))}lup(){const t=Matrix.zeros(this.row_length),n=new Matrix(this),e=Matrix.eye(this.row_length),i=t.matrix_array,o=n.matrix_array;for(let r=0;r<this.column_length;r++){let s;{const i=n._max_row_number(r,r);if(s=i.index,0===i.max)continue;r!==s&&(t._exchange_row(r,s),n._exchange_row(r,s),e._exchange_row(r,s))}for(let t=r+1;t<this.row_length;t++){const n=o[t][r].div(o[r][r]);i[t][r]=n;for(let e=r;e<this.column_length;e++)o[t][e]=o[t][e].sub(o[r][e].mul(n))}}return t._resize(this.row_length,Math.min(this.row_length,this.column_length)),n._resize(Math.min(this.row_length,this.column_length),this.column_length),t._each(function(t,n,e){return n===e?Complex.ONE:t}),{L:t,U:n,P:e}}linsolve(t){if(!this.isSquare())throw"Matrix size does not match";const n=this.column_length,e=Matrix.createConstMatrix(t);if(e.row_length!==this.row_length||e.column_length>1)throw"Matrix size does not match";const i=new Matrix(this);i._concat_left(e);const o=i.matrix_array,r=i.column_length;for(let t=0;t<n-1;t++){{const n=i._max_row_number(t,t).index;i._exchange_row(t,n)}{const n=o[t][t].inv();for(let e=t,i=t;i<r;i++)o[e][i]=o[e][i].mul(n)}for(let e=t+1;e<n;e++){const n=o[e][t];for(let i=t;i<r;i++)o[e][i]=o[e][i].sub(o[t][i].mul(n))}}const s=[];s[n-1]=o[n-1][n].div(o[n-1][n-1]);for(let t=n-2;t>=0;t--){s[t]=o[t][r-1];for(let e=t+1;e<n;e++)s[t]=s[t].sub(o[t][e]*s[e]);s[t]=s[t].div(o[t][t])}const h=[];for(let t=0;t<this.row_length;t++)h[t]=[s[t]];return new Matrix(h)}qr(){const t=new Matrix(this),n=this.row_length,e=this.row_length,i=this.row_length,o=this.column_length,r=Math.max(this.row_length,this.column_length);t._resize(r,r);const s=Matrix._gram_schmidt_orthonormalization(t),h=s.Q,l=s.R,a=s.non_orthogonalized;if(0!==a.length){const t={};for(let n=0;n<a.length;n++)t[a[n]]=1;const n=[];for(let e=0;e<r;e++)if(!t[e]){const t=[];for(let n=0;n<r;n++)t[n]=h.matrix_array[n][e];n.push(t)}const e=new Matrix(n)._createOrthogonalVector();for(let t=0;t<a.length;t++){const n=a[t];for(let i=0;i<r;i++)h.matrix_array[i][n]=e.matrix_array[t][i]}}return h._resize(n,e),l._resize(i,o),{Q:h,R:l}}static createGivensRotation(t,n,e,i){const o=Matrix.eye(t);return o.matrix_array[n][n]=new Complex(Math.cos(i)),o.matrix_array[n][e]=new Complex(Math.sin(i)),o.matrix_array[e][n]=new Complex(-Math.sin(i)),o.matrix_array[e][e]=o.matrix_array[n][n],o}eigForJacobiMethod(){if(this.isScalar())return new Matrix(this.scalar);if(!this.isSquare())throw"not square matrix";if(!this.isSymmetric())throw"not Symmetric";if(this.isComplex())throw"not Real Matrix";const t=this.row_length;let n=Matrix.eye(t);const e=new Matrix(this);let i=e.matrix_array;for(let e=0;e<150;e++){let e=0,o=1,r=i[e][o].norm;for(let n=0;n<t;n++)for(let s=n+1;s<t;s++){const t=i[n][s].norm;r<t&&(r=t,e=n,o=s)}if(r<1e-14)break;const s=i[e][e].add(i[o][o]),h=i[e][e].sub(i[o][o]),l=s.mul(Complex.HALF),a=h.mul(Complex.HALF);let u,c;h.isZero()?(u=new Complex(Math.PI/4),c=new Complex(Math.PI/2)):c=(u=Complex.HALF.mul(Complex.TWO.negate().mul(i[e][o]).div(h).atan())).mul(Complex.TWO);const g=u.cos(),f=u.sin(),m=c.cos(),d=c.sin(),_=[];for(let n=0;n<t;n++){_[n]=[];for(let r=0;r<t;r++){let t;t=n===e&&r===e?l.add(a.mul(m)).sub(i[e][o].mul(d)):n===o&&r===o?l.sub(a.mul(m)).add(i[e][o].mul(d)):n===e&&r===o||n===o&&r===e?Complex.ZERO:n===e?i[e][r].mul(g).sub(i[o][r].mul(f)):r===e?i[e][n].mul(g).sub(i[o][n].mul(f)):n===o?i[e][r].mul(f).add(i[o][r].mul(g)):r===o?i[e][n].mul(f).add(i[o][n].mul(g)):i[n][r],_[n][r]=t}}i=_,n=n.mul(Matrix.createGivensRotation(t,e,o,u))}return e.matrix_array=i,{V:n,D:e}}eig(t){if(this.isScalar())return new Matrix(this.scalar);if(!this.isSquare())throw"not square matrix";let n;if(!this.isSymmetric()||!this.isReal())throw"Unimplemented";if(n=this.eigForJacobiMethod(),!t)return n;if(t.is_sort){const t=function(t,n){const e=n.row_length,i=[];for(let t=0;t<e;t++)i[t]={sigma:n.matrix_array[t][t],index:t};const o=function(t,n){return t.sigma.compareTo(n.sigma)};i.sort(o);const r=Matrix.zeros(e),s=Matrix.zeros(e);for(let t=0;t<e;t++)s.matrix_array[t][t]=i[t].sigma,r.matrix_array[i[t].index][t]=Complex.ONE;return{V:t.mul(r),D:s}};return t(n.V,n.D)}}svd(){if(!this.isSquare())throw"Unimplemented";if(this.isComplex())throw"Unimplemented";const t=this.rank(1e-10).scalar.norm;if(t!==this.column_length)throw"Unimplemented";const n=this.T().mul(this).eig({is_sort:!0}),e=Matrix.zeros(this.row_length,this.column_length);return e._each(function(e,i,o){if(i===o&&i<t)return n.D.get(i,i).sqrt()}),{U:this.mul(n.V).mul(e.inv()).qr().Q,S:e,V:n.V.T()}}}const SMath={Complex:Complex,Matrix:Matrix},MathX={BigDecimal:BigDecimal,BigInteger:BigInteger,Random:Random,SMath:SMath};class IDSwitch{constructor(){this._initIDSwitch()}_initIDSwitch(){this.istyped=!1,this.ispressed=!1,this.isreleased=!1,this.pressed_time=0}clone(){const t=new IDSwitch;return t.istyped=this.istyped,t.ispressed=this.ispressed,t.isreleased=this.isreleased,t.pressed_time=this.pressed_time,t}keyPressed(){this.ispressed||(this.istyped=!0),this.ispressed=!0,this.pressed_time++}keyReleased(){this.ispressed=!1,this.isreleased=!0,this.pressed_time=0}focusLost(){this.keyReleased()}pickInput(t){if(!(t instanceof IDSwitch))throw"IllegalArgumentException";t.ispressed=this.ispressed,t.istyped=this.istyped,t.isreleased=this.isreleased,t.pressed_time=this.pressed_time,this.isreleased=!1,this.istyped=!1}}class IDPosition{constructor(t,n){this._initIDPosition(t,n)}_initIDPosition(t,n){if(t instanceof IDPosition){const n=t;this.set(n)}else void 0===t?(this.x=0,this.y=0):2===arguments.length?this.set(t,n):(this.x=0,this.y=0)}clone(){return new IDPosition(this)}set(t,n){if(t instanceof IDPosition){const n=t;this.x=n.x,this.y=n.y}else this.x=t,this.y=n}add(t,n){if(t instanceof IDPosition){const n=t;this.x+=n.x,this.y+=n.y}else this.x+=t,this.y+=n}sub(t,n){if(t instanceof IDPosition){const n=t;this.x-=n.x,this.y-=n.y}else this.x-=t,this.y-=n}static norm(t,n){const e=t.x-n.x,i=t.y-n.y;return Math.sqrt(e*e+i*i)}}class IDDraggableSwitch{constructor(t){this._initIDDraggableSwitch(t)}_initIDDraggableSwitch(t){this.mask=t,this.switch=new IDSwitch,this.client=new IDPosition,this.deltaBase=new IDPosition,this.dragged=new IDPosition}clone(){const t=new IDDraggableSwitch;return t.mask=this.mask,t.switch=this.switch.clone(),t.client=this.client.clone(),t.deltaBase=this.deltaBase.clone(),t.dragged=this.dragged.clone(),t}correctionForDOM(t){let n=t.target;return n||(n=t.currentTarget),void 0===n?new IDPosition(t.clientX,t.clientY):new IDPosition(t.clientX/n.clientWidth*n.width,t.clientY/n.clientHeight*n.height)}setPosition(t){const n=this.correctionForDOM(t);this.client.set(n),this.deltaBase.set(n),this.dragged._initIDPosition()}mousePressed(t){const n=this.correctionForDOM(t);t.button===this.mask&&(this.switch.ispressed||this.dragged._initIDPosition(),this.switch.keyPressed(),this.client.set(n),this.deltaBase.set(n))}mouseReleased(t){t.button===this.mask&&this.switch.ispressed&&this.switch.keyReleased()}mouseMoved(t){const n=this.correctionForDOM(t);if(this.switch.ispressed){const t=new IDPosition(n);t.sub(this.deltaBase),this.dragged.add(t)}this.client.set(n.x,n.y),this.deltaBase.set(n.x,n.y)}focusLost(){this.switch.focusLost()}pickInput(t){if(!(t instanceof IDDraggableSwitch))throw"IllegalArgumentException";this.switch.pickInput(t.switch),t.client.set(this.client),t.dragged.set(this.dragged),this.dragged._initIDPosition()}}class IDMouse{constructor(){this._initIDMouse()}_initIDMouse(){this.left=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON1_MASK),this.center=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON2_MASK),this.right=new IDDraggableSwitch(IDMouse.MOUSE_EVENTS.BUTTON3_MASK),this.position=new IDPosition,this.wheelrotation=0}clone(){const t=new IDMouse;return t.left=this.left.clone(),t.center=this.center.clone(),t.right=this.right.clone(),t.position=this.position.clone(),t.wheelrotation=this.wheelrotation,t}mousePressed(t){this.left.mousePressed(t),this.center.mousePressed(t),this.right.mousePressed(t)}mouseReleased(t){this.left.mouseReleased(t),this.center.mouseReleased(t),this.right.mouseReleased(t)}mouseMoved(t){this.left.mouseMoved(t),this.center.mouseMoved(t),this.right.mouseMoved(t),this.position.x=this.left.client.x,this.position.y=this.left.client.y}mouseWheelMoved(t){0!==t.wheelDelta&&(this.wheelrotation+=t.deltaY>0?-1:1)}focusLost(){this.left.focusLost(),this.center.focusLost(),this.right.focusLost()}pickInput(t){if(!(t instanceof IDMouse))throw"IllegalArgumentException";this.left.pickInput(t.left),this.center.pickInput(t.center),this.right.pickInput(t.right),t.position.set(this.position),t.wheelrotation=this.wheelrotation,this.wheelrotation=0}setListenerOnElement(t){const n=this,e=function(t){n.mousePressed(t)},i=function(t){n.mouseReleased(t)},o=function(t){n.mouseMoved(t)},r=function(){n.focusLost()},s=function(t){n.mouseWheelMoved(t),t.preventDefault()},h=function(t){t.preventDefault()};t.style.cursor="crosshair",t.style.mozUserSelect="none",t.style.webkitUserSelect="none",t.style.msUserSelect="none",t.style.webkitTouchCallout="none",t.style.webkitTapHighlightColor="rgba(0,0,0,0)",t.addEventListener("mousedown",e,!1),t.addEventListener("mouseup",i,!1),t.addEventListener("mousemove",o,!1),t.addEventListener("mouseout",r,!1),t.addEventListener("wheel",s,!1),t.addEventListener("contextmenu",h,!1)}}IDMouse.MOUSE_EVENTS={BUTTON1_MASK:0,BUTTON2_MASK:1,BUTTON3_MASK:2};class IDTouch extends IDMouse{constructor(){super(),this._initIDTouch()}_initIDTouch(){this.touchcount_to_mask={1:IDMouse.MOUSE_EVENTS.BUTTON1_MASK,2:IDMouse.MOUSE_EVENTS.BUTTON3_MASK,3:IDMouse.MOUSE_EVENTS.BUTTON2_MASK};const t=this;this._mousePressed=function(n){t.mousePressed(n)},this._mouseReleased=function(n){t.mouseReleased(n)},this._mouseMoved=function(n){t.mouseMoved(n)},this.isdoubletouch=!1}_initPosition(t){this.left.setPosition(t),this.right.setPosition(t),this.center.setPosition(t)}_MultiTouchToMouse(t){let n=0,e=0;for(let i=0;i<t.touches.length;i++)n+=t.touches[i].clientX,e+=t.touches[i].clientY;const i={};if(t.touches.length>0){i.clientX=n/t.touches.length,i.clientY=e/t.touches.length,i.button=this.touchcount_to_mask[t.touches.length];const o=t.touches[0];i.target=o.target?o.target:o.currentTarget}else i.clientX=0,i.clientY=0,i.button=0;return i.touchcount=t.touches.length,i}_MoveMultiTouch(t){if(2===t.touches.length){const n=t.touches[0],e=t.touches[1];if(!1===this.isdoubletouch)this.isdoubletouch=!0,this.doubleposition=[],this.doubleposition[0]=new IDPosition(n.clientX,n.clientY),this.doubleposition[1]=new IDPosition(e.clientX,e.clientY);else{const t=new IDPosition(n.clientX,n.clientY),i=new IDPosition(e.clientX,e.clientY),o=IDPosition.norm(this.doubleposition[0],this.doubleposition[1])-IDPosition.norm(t,i);this.doubleposition[0]=t,this.doubleposition[1]=i;const r=Math.abs(o)<10?.01*Math.abs(o):.5;this.wheelrotation+=(o>0?-1:1)*r}}else this.isdoubletouch}_actFuncMask(t,n,e,i){for(const o in IDMouse.MOUSE_EVENTS)t.button=IDMouse.MOUSE_EVENTS[o],IDMouse.MOUSE_EVENTS[o]===i?n(t):e(t)}touchStart(t){const n=this._MultiTouchToMouse(t);this._initPosition(n),this._actFuncMask(n,this._mousePressed,this._mouseReleased,n.button)}touchEnd(t){const n=this._MultiTouchToMouse(t);this._actFuncMask(n,this._mouseReleased,this._mouseReleased,n.button)}touchMove(t){this._MoveMultiTouch(t);const n=this._MultiTouchToMouse(t);this._actFuncMask(n,this._mouseMoved,this._mouseMoved,n.button)}setListenerOnElement(t){super.setListenerOnElement(t);const n=this,e=function(t){n.touchStart(t)},i=function(t){n.touchEnd(t)},o=function(t){n.touchMove(t),t.preventDefault()};t.addEventListener("touchstart",e,!1),t.addEventListener("touchend",i,!1),t.addEventListener("touchmove",o,!1),t.addEventListener("touchcancel",i,!1)}}const IDTools={noScroll:function(){const t=function(){document.body.style.height="100%",document.body.style.overflow="hidden",document.documentElement.height="100%",document.documentElement.overflow="hidden"};window.addEventListener("load",t,!1)}},Device={DraggableSwitch:IDDraggableSwitch,Mouse:IDMouse,Position:IDPosition,Switch:IDSwitch,Touch:IDTouch,Tools:IDTools},BlendFunctions={ipLerp:function(t,n,e){const i=n.subColor(t);return t.addColor(i.mul(e))},brendNone:function(t,n,e){return n},brendAlpha:function(t,n,e){const i=t.getBlendAlpha(),o=n.getBlendAlpha()*e;return(t=BlendFunctions.ipLerp(t,n,o)).setBlendAlpha(Math.max(i,o))},brendAdd:function(t,n,e){const i=t.getBlendAlpha(),o=n.getBlendAlpha()*e;return(t=t.addColor(n.mul(o))).setBlendAlpha(Math.max(i,o))},brendSub:function(t,n,e){const i=t.getBlendAlpha(),o=n.getBlendAlpha()*e;return(t=t.subColor(n.mul(o))).setBlendAlpha(i)},brendRevSub:function(t,n,e){const i=n.getBlendAlpha(),o=t.getBlendAlpha()*e;return(n=n.subColor(t.mul(o))).setBlendAlpha(i)},brendMul:function(t,n,e){const i=t.getBlendAlpha(),o=n.getBlendAlpha()*e;return(t=t.mulColor(n.mul(o).div(255))).setBlendAlpha(i)}};class ImgBlend{constructor(t){this.blendfunc=BlendFunctions.brendNone,1===arguments.length&&this.setBlendMode(t)}clone(){return new ImgBlend(this.blendmode)}setBlendMode(t){this.blendmode=t,t===ImgBlend.MODE.NONE?this.blendfunc=BlendFunctions.brendNone:t===ImgBlend.MODE.ALPHA?this.blendfunc=BlendFunctions.brendAlpha:t===ImgBlend.MODE.ADD?this.blendfunc=BlendFunctions.brendAdd:t===ImgBlend.MODE.SUB?this.blendfunc=BlendFunctions.brendSub:t===ImgBlend.MODE.REVSUB?this.blendfunc=BlendFunctions.brendRevSub:t===ImgBlend.MODE.MUL&&(this.blendfunc=BlendFunctions.brendMul)}blend(t,n,e){return this.blendfunc(t,n,e)}}ImgBlend.MODE={NONE:"NONE",ALPHA:"ALPHA",ADD:"ADD",SUB:"SUB",REVSUB:"REVSUB",MUL:"MUL"};class ImgColor{constructor(){}getColor(){return null}clone(){return null}zero(){return null}one(){return null}add(){return null}sub(){return null}mul(){return null}div(){return null}exp(){return null}log(){return null}pow(){return null}baselog(){return null}table(){return null}random(){return null}luminance(){return null}addColor(){return null}subColor(){return null}mulColor(){return null}divColor(){return null}maxColor(){return null}minColor(){return null}norm(){return null}normFast(){return null}normColor(t,n){return this.subColor(t).norm(n)}normColorFast(t,n){return this.subColor(t).normFast(n)}getBlendAlpha(){return null}setBlendAlpha(){return null}exchangeColorAlpha(){return null}equals(){return!1}searchColor(t,n){let e=0,i=2147483647,o=null,r=2147483646,s=null;for(let h=0;h<t.length;h++)(e=this.normColorFast(t[h],n))<r&&(e<i?(r=i,s=o,i=e,o=t[h]):(r=e,s=t[h]));return{c1:{color:o,norm:i},c2:{color:s,norm:r}}}}ImgColor.NORM_MODE={MANHATTEN:0,EUGRID:1};class ImgWrapInside{constructor(t,n){2===arguments.length?this.setSize(t,n):this.setSize(0,0)}clone(){return new ImgWrapInside(this.width,this.height)}setSize(t,n){this.width=t,this.height=n}getPixelPosition(t,n){return t=~~Math.floor(t),n=~~Math.floor(n),t>=0&&n>=0&&t<this.width&&n<this.height?[t,n]:null}}class ImgWrapClamp extends ImgWrapInside{constructor(t,n){super(t,n)}clone(){return new ImgWrapClamp(this.width,this.height)}getPixelPosition(t,n){return t=~~Math.floor(t),n=~~Math.floor(n),t>=0&&n>=0&&t<this.width&&n<this.height?[t,n]:(t=~~Math.floor(Math.min(Math.max(0,t),this.width-1)),n=~~Math.floor(Math.min(Math.max(0,n),this.height-1)),[t,n])}}class ImgWrapRepeat extends ImgWrapInside{constructor(t,n){super(t,n)}clone(){return new ImgWrapRepeat(this.width,this.height)}getPixelPosition(t,n){if(t=~~Math.floor(t),n=~~Math.floor(n),t>=0&&n>=0&&t<this.width&&n<this.height)return[t,n];const e=Math.floor(t/this.width),i=Math.floor(n/this.height);return t-=Math.floor(this.width*e),n-=Math.floor(this.height*i),t<0&&(t+=this.width),n<0&&(n+=this.height),[t,n]}}class ImgWrap{constructor(t,n,e){this.width=1,this.height=1,arguments.length>=2&&(this.width=n,this.height=e),3==arguments.length?this.setImgWrapMode(t):this.setImgWrapMode(ImgWrap.MODE.INSIDE)}clone(){return new ImgWrap(this.wrapmode,this.width,this.height)}setImgWrapMode(t){this.wrapmode=t,t===ImgWrap.MODE.INSIDE?this.wrap=new ImgWrapInside(this.width,this.height):t===ImgWrap.MODE.CLAMP?this.wrap=new ImgWrapClamp(this.width,this.height):t===ImgWrap.MODE.REPEAT&&(this.wrap=new ImgWrapRepeat(this.width,this.height))}setSize(t,n){this.width=t,this.height=n,this.wrap&&this.wrap.setSize(t,n)}getPixelPosition(t,n){return this.wrap.getPixelPosition(t,n)}}ImgWrap.MODE={INSIDE:"INSIDE",CLAMP:"CLAMP",REPEAT:"REPEAT"};const InterpolationFunctions={ipLerp:function(t,n,e){const i=n.subColor(t);return t.addColor(i.mul(e))},ipCosine:function(t,n,e){return InterpolationFunctions.ipLerp(t,n,.5*(1-Math.cos(Math.PI*e)))},ipHermite2p3:function(t,n,e){return InterpolationFunctions.ipLerp(t,n,e*e*(3-2*e))},ipHermite2p5:function(t,n,e){return InterpolationFunctions.ipLerp(t,n,e*e*e*(6*e*e-15*e+10))},ipHermite4p:function(t,n,e,i,o){const r=i.subColor(e).subColor(t.subColor(n)),s=t.subColor(n).subColor(r),h=e.subColor(t),l=n;return r.mul(o*o*o).addColor(s.mul(o*o)).addColor(h.mul(o)).addColor(l)},funcInBicubic:function(t,n){return t<=1?1-(n+3)*t*t+(n+2)*t*t*t:-4*n+8*n*t-5*n*t*t+n*t*t*t},ipBicubic:function(t,n,e,i,o,r){const s=InterpolationFunctions.funcInBicubic(o+1,r),h=InterpolationFunctions.funcInBicubic(o,r),l=InterpolationFunctions.funcInBicubic(1-o,r),a=InterpolationFunctions.funcInBicubic(2-o,r);return t.mul(s).addColor(n.mul(h)).addColor(e.mul(l)).addColor(i.mul(a)).mul(1/(s+h+l+a))},ipBicubicSoft:function(t,n,e,i,o){return InterpolationFunctions.ipBicubic(t,n,e,i,o,-.5)},ipBicubicNormal:function(t,n,e,i,o){return InterpolationFunctions.ipBicubic(t,n,e,i,o,-1)},ipBicubicSharp:function(t,n,e,i,o){return InterpolationFunctions.ipBicubic(t,n,e,i,o,-1.2)},ipBicubic2D:function(t,n,e,i){let o,r,s,h,l=t[0][0].zero(),a=0;for(r=0;r<4;r++)for(s=InterpolationFunctions.funcInBicubic(Math.abs(-e+r-1),i),o=0;o<4;o++)h=InterpolationFunctions.funcInBicubic(Math.abs(-n+o-1),i),a+=h*=s,l=l.addColor(t[r][o].mul(h));return l=l.mul(1/a)},ipBicubic2DSoft:function(t,n,e){return InterpolationFunctions.ipBicubic2D(t,n,e,-.5)},ipBicubic2DNormal:function(t,n,e){return InterpolationFunctions.ipBicubic2D(t,n,e,-1)},ipBicubic2DSharp:function(t,n,e){return InterpolationFunctions.ipBicubic2D(t,n,e,-1.2)}};class ImgInterpolation{constructor(t){0===arguments.length&&(t=ImgInterpolation.MODE.NEAREST_NEIGHBOR),this.setInterpolationMode(t)}clone(){return new ImgInterpolation(this.ipmode)}setInterpolationMode(t){this.ipmode=t,t===ImgInterpolation.MODE.NEAREST_NEIGHBOR?(this.ipfunc=InterpolationFunctions.ipLerp,this.ipn=1):t===ImgInterpolation.MODE.BILINEAR?(this.ipfunc=InterpolationFunctions.ipLerp,this.ipn=2):t===ImgInterpolation.MODE.COSINE?(this.ipfunc=InterpolationFunctions.ipCosine,this.ipn=2):t===ImgInterpolation.MODE.HERMITE4_3?(this.ipfunc=InterpolationFunctions.ipHermite2p3,this.ipn=2):t===ImgInterpolation.MODE.HERMITE4_5?(this.ipfunc=InterpolationFunctions.ipHermite2p5,this.ipn=2):t===ImgInterpolation.MODE.HERMITE16?(this.ipfunc=InterpolationFunctions.ipHermite4p,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC?(this.ipfunc=InterpolationFunctions.ipBicubic2DNormal,this.ipn=16):t===ImgInterpolation.MODE.BICUBIC_SOFT?(this.ipfunc=InterpolationFunctions.ipBicubicSoft,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC_NORMAL?(this.ipfunc=InterpolationFunctions.ipBicubicNormal,this.ipn=4):t===ImgInterpolation.MODE.BICUBIC_SHARP&&(this.ipfunc=InterpolationFunctions.ipBicubicSharp,this.ipn=4)}getColor(t,n,e){const i=Math.floor(n),o=Math.floor(e);if(1===this.ipn||i===n&&o===e)return t.getPixel(i,o);if(2===this.ipn){const r=n-i,s=e-o;let h,l;h=t.getPixel(i,o),l=t.getPixel(i+1,o);const a=this.ipfunc(h,l,r);h=t.getPixel(i,o+1),l=t.getPixel(i+1,o+1);const u=this.ipfunc(h,l,r);return this.ipfunc(a,u,s)}if(4===this.ipn){const r=n-i,s=e-o;let h,l,a,u;h=t.getPixel(i-1,o-1),l=t.getPixel(i,o-1),a=t.getPixel(i+1,o-1),u=t.getPixel(i+2,o-1);const c=this.ipfunc(h,l,a,u,r);h=t.getPixel(i-1,o),l=t.getPixel(i,o),a=t.getPixel(i+1,o),u=t.getPixel(i+2,o);const g=this.ipfunc(h,l,a,u,r);h=t.getPixel(i-1,o+1),l=t.getPixel(i,o+1),a=t.getPixel(i+1,o+1),u=t.getPixel(i+2,o+1);const f=this.ipfunc(h,l,a,u,r);h=t.getPixel(i-1,o+2),l=t.getPixel(i,o+2),a=t.getPixel(i+1,o+2),u=t.getPixel(i+2,o+2);const m=this.ipfunc(h,l,a,u,r);return this.ipfunc(c,g,f,m,s)}if(16===this.ipn){const r=n-i,s=e-o;let h,l;const a=[];for(l=-1;l<3;l++){const n=[];for(h=-1;h<3;h++)n[n.length]=t.getPixel(i+h,o+l);a[a.length]=n}return this.ipfunc(a,r,s)}return null}}ImgInterpolation.MODE={NEAREST_NEIGHBOR:"NEAREST_NEIGHBOR",BILINEAR:"BILINEAR",COSINE:"COSINE",HERMITE4_3:"HERMITE4_3",HERMITE4_5:"HERMITE4_5",HERMITE16:"HERMITE16",BICUBIC:"BICUBIC",BICUBIC_SOFT:"BICUBIC_SOFT",BICUBIC_NORMAL:"BICUBIC_NORMAL",BICUBIC_SHARP:"BICUBIC_SHARP"};class ImgFIRMatrix{constructor(t){this.height=t.length,this.width=t[0].length,this.matrix=[];let n;for(n=0;n<t.length;n++)this.matrix[n]=t[n].slice()}clone(){return new ImgFIRMatrix(this.matrix)}rotateEdge(t){const n=this.clone(),e=[],i=[];let o,r;for(o=0;o<this.width-1;o++)e.push(n.matrix[0][o]);for(o=0;o<this.height-1;o++)e.push(n.matrix[o][this.width-1]);for(o=this.width-1;o>0;o--)e.push(n.matrix[this.height-1][o]);for(o=this.height-1;o>0;o--)e.push(n.matrix[o][0]);for(o=0;o<e.length;o++)i[o]=e[((o+t)%e.length+e.length)%e.length];for(n.matrix[0]=i.slice(0,this.width),o=0;o<this.height;o++)n.matrix[o][this.width-1]=i[this.width+o];for(n.matrix[this.height-1]=i.slice(this.width+this.height-2,this.width+this.height-2+this.width).reverse(),o=this.height-1,r=0;o>0;o--,r++)n.matrix[o][0]=i[this.width+this.height+this.width-3+r];return n}mul(t){const n=this.clone();let e,i;for(i=0;i<n.height;i++)for(e=0;e<n.width;e++)n.matrix[i][e]*=t;return n}sum(){let t,n,e=0;for(n=0;n<this.height;n++)for(t=0;t<this.width;t++)e+=this.matrix[n][t];return e}normalize(){return this.clone().mul(1/this.sum())}addCenter(t){const n=this.clone();return n.matrix[n.height>>1][n.width>>1]+=t,n}static makeLaplacianFilter(){return new ImgFIRMatrix([[0,-1,0],[-1,4,-1],[0,-1,0]])}static makeSharpenFilter(t){return ImgFIRMatrix.makeLaplacianFilter().mul(t).addCenter(1)}static makeBlur(t,n){const e=[],i=1/(t*n);let o,r;for(r=0;r<n;r++)for(e[r]=[],o=0;o<t;o++)e[r][o]=i;return new ImgFIRMatrix(e)}static makeGaussianFilter(t,n,e){void 0===e&&(e=1);const i=[];let o,r,s;const h=[],l=Math.max(t,n);let a=-Math.floor(l/2);for(o=0;o<l;o++,a++)h[o]=Math.exp(-a*a/(e*e*2));for(s=0;s<n;s++)for(i[s]=[],r=0;r<t;r++)i[s][r]=h[r]*h[s];return new ImgFIRMatrix(i).normalize()}static makeCircle(t){const n=[],e=.5*t,i=t>>1;let o,r;for(r=0;r<t;r++)for(n[r]=[],o=0;o<t;o++)Math.sqrt((i-o)*(i-o)+(i-r)*(i-r))<e?n[r][o]=1:n[r][o]=0;return new ImgFIRMatrix(n).normalize()}}class ImgData{constructor(){if(this.width=1,this.height=1,this.globalAlpha=1,this.data=null,this.blend=new ImgBlend(ImgBlend.MODE.NONE),this.wrap=new ImgWrap(ImgWrap.MODE.INSIDE,this.width,this.height),this.ip=new ImgInterpolation(ImgInterpolation.MODE.NEAREST_NEIGHBOR),1===arguments.length){const t=arguments[0];this.putImageData(t)}else if(2===arguments.length){const t=arguments[0],n=arguments[1];this.setSize(t,n)}}putImageData(t){}setSize(t,n){this.width===t&&this.height===n||(this.width=t,this.height=n,this.wrap.setSize(t,n))}_copyData(t){t.blend=this.blend.clone(),t.wrap=this.wrap.clone(),t.ip=this.ip.clone(),t.setSize(this.width,this.height),t.data.set(this.data),t.globalAlpha=this.globalAlpha}clone(){const t=new ImgData;return this._copyData(t),t}setWrapMode(t){this.wrap.setImgWrapMode(t)}getWrapMode(){return this.wrap.wrapmode}setInterpolationMode(t){this.ip.setInterpolationMode(t)}getInterpolationMode(){return this.ip.ipmode}setBlendType(t){this.blend.setBlendMode(t)}getBlendType(){return this.blend.blendmode}clear(){this.data&&this.data.fill(0)}getPixelInside(t,n){return null}setPixelInside(t,n,e){}getPixel(t,n){const e=this.wrap.getPixelPosition(t,n);return e?this.getPixelInside(e[0],e[1]):this.getPixelInside(0,0).zero()}setPixel(t,n,e){const i=this.wrap.getPixelPosition(t,n);if(i)if(this._blendtype===ImgData.MODE_BLEND.NONE)this.setPixelInside(i[0],i[1],e);else{const t=this.getPixelInside(i[0],i[1]),n=this.blend.blend(t,e,this.globalAlpha);this.setPixelInside(i[0],i[1],n)}}getColor(t,n){return this.ip.getColor(this,t,n)}getColorUV(t,n){return this.getColor(t*this.width,n*this.height)}setColor(t,n,e){this.setPixel(Math.floor(t),Math.floor(n),e)}drawImgData(t,n,e,i,o,r,s,h,l){if(!(t instanceof ImgData))throw"IllegalArgumentException";if(3===arguments.length)r=n,s=e,h=t.width,l=t.height,n=0,e=0,i=t.width,o=t.height;else if(5===arguments.length)r=n,s=e,h=i,l=o,n=0,e=0,i=t.width,o=t.height;else if(9!==arguments.length)throw"IllegalArgumentException";const a=i/h,u=o/l;let c,g,f,m;for(g=e,m=s;m<s+l;m++){for(c=n,f=r;f<r+h;f++){const n=t.getColor(c,g);n&&this.setColor(f,m,n),c+=a}g+=u}}forEach(t){let n=0,e=0;for(;e<this.height;e++)for(n=0;n<this.width;n++)t(this.getPixelInside(n,e),n,e,this)}convolution(t){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";let n,e,i,o,r,s;const h=-(t.width>>1),l=-(t.height>>1),a=t.matrix,u=this.getPixelInside(0,0).zero(),c=this.clone();for(e=0;e<this.height;e++)for(n=0;n<this.width;n++){let g=u;for(o=e+l,s=0;s<t.height;s++,o++)for(i=n+h,r=0;r<t.width;r++,i++){const t=c.getPixel(i,o);t&&(g=g.addColor(t.mul(a[s][r])))}this.setPixelInside(n,e,g)}}convolutionBilateral(t,n){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";void 0===n&&(n=.8);let e,i,o,r,s,h;const l=-(t.width>>1),a=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),g=this.clone(),f=.01*-(1-n)-.001,m=[];for(e=0;e<768;e++)m[e]=Math.exp(e*e*f);for(i=0;i<this.height;i++)for(e=0;e<this.width;e++){const n=g.getPixel(e,i),f=n.getBlendAlpha();let d=0,_=c;const p=[];for(r=i+a,h=0;h<t.height;h++,r++)for(o=e+l,p[h]=[],s=0;s<t.width;s++,o++){const t=g.getPixel(o,r);if(t){const e=m[Math.floor(t.normColor(n,ImgColor.NORM_MODE.EUGRID))]*u[h][s];_=_.addColor(t.mul(e)),d+=e}}_=_.div(d).setBlendAlpha(f),this.setPixelInside(e,i,_)}}convolutionExp(t,n){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";void 0===n&&(n=1.2);let e,i,o,r,s,h;const l=-(t.width>>1),a=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),g=this.clone(),f=[];for(e=0;e<256;e++)f[e]=Math.pow(n,e);for(i=0;i<this.height;i++)for(e=0;e<this.width;e++){let m=c;for(r=i+a,h=0;h<t.height;h++,r++)for(o=e+l,s=0;s<t.width;s++,o++){const t=g.getPixel(o,r);t&&(m=m.addColor(t.table(f).mul(u[h][s])))}this.setPixelInside(e,i,m.baselog(n))}}convolutionUnSharp(t,n){if(!(t instanceof ImgFIRMatrix))throw"IllegalArgumentException";let e,i,o,r,s,h;const l=-(t.width>>1),a=-(t.height>>1),u=t.matrix,c=this.getPixelInside(0,0).zero(),g=this.clone();for(i=0;i<this.height;i++)for(e=0;e<this.width;e++){let f=c;for(r=i+a,h=0;h<t.height;h++,r++)for(o=e+l,s=0;s<t.width;s++,o++){const t=g.getPixel(o,r);t&&(f=f.addColor(t.mul(u[h][s])))}const m=g.getPixel(e,i),d=m.subColor(f).mul(n);this.setPixelInside(e,i,m.addColor(d))}}filterSharp(t){const n=ImgFIRMatrix.makeSharpenFilter(t);this.convolution(n)}filterBlur(t){let n;n=ImgFIRMatrix.makeBlur(t,1),this.convolution(n),n=ImgFIRMatrix.makeBlur(1,t),this.convolution(n)}filterGaussian(t){let n;n=ImgFIRMatrix.makeGaussianFilter(t,1),this.convolution(n),n=ImgFIRMatrix.makeGaussianFilter(1,t),this.convolution(n)}filterUnSharp(t,n){const e=ImgFIRMatrix.makeGaussianFilter(t,t);this.convolutionUnSharp(e,n)}filterBilateral(t,n){const e=ImgFIRMatrix.makeGaussianFilter(t,t);this.convolutionBilateral(e,n)}filterSoftLens(t,n){const e=ImgFIRMatrix.makeCircle(t);this.convolutionExp(e,n)}}ImgData.MODE_WRAP=ImgWrap.MODE,ImgData.MODE_IP=ImgInterpolation.MODE,ImgData.MODE_BLEND=ImgBlend.MODE;class ImgColorRGBA extends ImgColor{constructor(t){super(),this.rgba=[t[0],t[1],t[2],t[3]]}get r(){return this.rgba[0]}get g(){return this.rgba[1]}get b(){return this.rgba[2]}get a(){return this.rgba[3]}getColor(){return this.rgba}clone(){return new ImgColorRGBA(this.rgba)}zero(){return new ImgColorRGBA([0,0,0,0])}one(){return new ImgColorRGBA([1,1,1,1])}add(t){return new ImgColorRGBA([this.r+t,this.g+t,this.b+t,this.a+t])}sub(t){return new ImgColorRGBA([this.r-t,this.g-t,this.b-t,this.a-t])}mul(t){return new ImgColorRGBA([this.r*t,this.g*t,this.b*t,this.a*t])}div(t){return new ImgColorRGBA([this.r/t,this.g/t,this.b/t,this.a/t])}exp(){return new ImgColorRGBA([Math.exp(this.r),Math.exp(this.g),Math.exp(this.b),Math.exp(this.a)])}log(){return new ImgColorRGBA([Math.log(this.r),Math.log(this.g),Math.log(this.b),Math.log(this.a)])}pow(t){return new ImgColorRGBA([Math.pow(t,this.r),Math.pow(t,this.g),Math.pow(t,this.b),Math.pow(t,this.a)])}baselog(t){const n=1/Math.log(t);return new ImgColorRGBA([Math.log(this.r)*n,Math.log(this.g)*n,Math.log(this.b)*n,Math.log(this.a)*n])}table(t){return new ImgColorRGBA([t[Math.round(this.r)],t[Math.round(this.g)],t[Math.round(this.b)],t[Math.round(this.a)]])}random(){return new ImgColorRGBA([Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())])}luminance(){return.2126*this.r+.7152*this.g+.0722*this.b}addColor(t){return new ImgColorRGBA([this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a])}subColor(t){return new ImgColorRGBA([this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a])}mulColor(t){return new ImgColorRGBA([this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a])}divColor(t){return new ImgColorRGBA([this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a])}maxColor(t){return new ImgColorRGBA([Math.max(t.r,this.r),Math.max(t.g,this.g),Math.max(t.b,this.b),Math.max(t.a,this.a)])}minColor(t){return new ImgColorRGBA([Math.min(t.r,this.r),Math.min(t.g,this.g),Math.min(t.b,this.b),Math.min(t.a,this.a)])}norm(t){return t===ImgColor.NORM_MODE.MANHATTEN?(Math.abs(this.r)+Math.abs(this.g)+Math.abs(this.b))/3:t===ImgColor.NORM_MODE.EUGRID?Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b)/3:void 0}normFast(t){return t===ImgColor.NORM_MODE.MANHATTEN?Math.abs(this.r)+Math.abs(this.g)+Math.abs(this.b):t===ImgColor.NORM_MODE.EUGRID?this.r*this.r+this.g*this.g+this.b*this.b:void 0}getBlendAlpha(){return this.a/255}setBlendAlpha(t){const n=this.clone();return n.rgba[3]=255*t,n}exchangeColorAlpha(t){return new ImgColorRGBA([this.r,this.g,this.b,t.a])}getRRGGBB(){return this.r<<16|this.g<<8|255&this.b}getRed(){return this.r}getGreen(){return this.g}getBlue(){return this.b}equals(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}toString(){return"color("+this.r+","+this.g+","+this.b+","+this.a+")"}mulMatrix(t){const n=new ImgColorRGBA;return n.rgba[0]=this.r*t[0][0]+this.g*t[0][1]+this.b*t[0][2]+this.a*t[0][3],n.rgba[1]=this.r*t[1][0]+this.g*t[1][1]+this.b*t[1][2]+this.a*t[1][3],n.rgba[2]=this.r*t[2][0]+this.g*t[2][1]+this.b*t[2][2]+this.a*t[2][3],n.rgba[3]=this.r*t[3][0]+this.g*t[3][1]+this.b*t[3][2]+this.a*t[3][3],n}}class ImgColorY extends ImgColor{constructor(t){super(),this.y=t}getColor(){return this.y}clone(){return new ImgColorY(this.y)}zero(){return new ImgColorY(0)}one(){return new ImgColorY(1)}add(t){return new ImgColorY(this.y+t)}sub(t){return new ImgColorY(this.y-t)}mul(t){return new ImgColorY(this.y*t)}div(t){return new ImgColorY(this.y/t)}exp(){return new ImgColorY(Math.exp(this.y))}log(){return new ImgColorY(Math.log(this.y))}pow(t){return new ImgColorY(Math.pow(t,this.y))}baselog(t){return new ImgColorY(Math.log(this.y)/Math.log(t))}table(t){return new ImgColorY(t[Math.floor(this.y)])}random(){return new ImgColorY(256*Math.random())}luminance(){return this.y}addColor(t){return new ImgColorY(this.y+t.y)}subColor(t){return new ImgColorY(this.y-t.y)}mulColor(t){return new ImgColorY(this.y*t.y)}divColor(t){return new ImgColorY(this.y/t.y)}maxColor(t){return new ImgColorY(Math.max(t.y,this.y))}minColor(t){return new ImgColorY(Math.min(t.y,this.y))}norm(){return Math.abs(this.y)}normFast(){return Math.abs(this.y)}getBlendAlpha(){return 1}setBlendAlpha(){return this}exchangeColorAlpha(){return this}equals(t){return this.y===t.y}toString(){return"color("+this.y+")"}}class ImgVector{constructor(t,n,e){this.x=t,this.y=n,this.z=e}cross(t){return new ImgVector(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}getDirection(t){return new ImgVector(t.x-this.x,t.y-this.y,t.z-this.z)}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z;return t=Math.sqrt(1/t),new ImgVector(this.x*t,this.y*t,this.z*t)}getNormalMapColor(){return new ImgColorRGBA([Math.round(127.5*(1+this.x)),Math.round(127.5*(1-this.y)),Math.round(127.5*(1+this.z)),255])}static createNormalVector(t){if(!(t instanceof ImgColorRGBA))throw"not ImgColorRGBA";return new ImgVector(t.r/128-1,-t.g/128+1,t.b/128-1)}}class ImgDataY extends ImgData{constructor(){1===arguments.length?super(arguments[0]):2===arguments.length?super(arguments[0],arguments[1]):super()}clone(){const t=new ImgDataY(this.width,this.height);return this._copyData(t),t}setSize(t,n){super.setSize(t,n),this.data=new Float32Array(this.width*this.height)}getPixelInside(t,n){const e=n*this.width+t;return new ImgColorY(this.data[e])}setPixelInside(t,n,e){const i=n*this.width+t;this.data[i]=e.getColor()}putImageData(t,n){if(t instanceof ImageData||t instanceof ImgDataRGBA){this.setSize(t.width,t.height),void 0===n&&(n=0);let e=0;for(let i=0;i<this.data.length;i++)this.data[i]=t.data[e+n],e+=4}else{if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.setSize(t.width,t.height),this.data.set(t.data)}}putImageDataR(t){this.putImageData(t,0)}putImageDataG(t){this.putImageData(t,1)}putImageDataB(t){this.putImageData(t,2)}putImageDataA(t){this.putImageData(t,3)}getImageData(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height;const n=t.getContext("2d").getImageData(0,0,t.width,t.height);let e=0,i=0;for(;i<this.data.length;i++){const t=Math.floor(this.data[i]);n.data[e+0]=t,n.data[e+1]=t,n.data[e+2]=t,n.data[e+3]=255,e+=4}return n}getNormalMap(){if(this.getWrapMode()===ImgData.MODE_WRAP.INSIDE)throw"not inside";const t=new ImgDataRGBA(this.width,this.height);let n,e;for(e=0;e<this.height;e++)for(n=0;n<this.width;n++){const i=new ImgVector(n-1,e,this.getPixel(n-1,e).getColor()),o=new ImgVector(n+1,e,this.getPixel(n+1,e).getColor()),r=i.getDirection(o),s=new ImgVector(n,e-1,this.getPixel(n,e-1).getColor()),h=new ImgVector(n,e+1,this.getPixel(n,e+1).getColor()),l=s.getDirection(h),a=r.cross(l).normalize();t.setPixelInside(n,e,a.getNormalMapColor())}return t}filterEnvironmentMapping(t){}}class ImgDataRGBA extends ImgData{constructor(){1===arguments.length?super(arguments[0]):2===arguments.length?super(arguments[0],arguments[1]):super()}clone(){const t=new ImgDataRGBA(this.width,this.height);return this._copyData(t),t}setSize(t,n){super.setSize(t,n),this.data=new Uint8ClampedArray(this.width*this.height*4)}getPixelInside(t,n){const e=4*(n*this.width+t);return new ImgColorRGBA([this.data[e],this.data[e+1],this.data[e+2],this.data[e+3]])}setPixelInside(t,n,e){const i=4*(n*this.width+t);this.data[i]=e.getColor()[0],this.data[i+1]=e.getColor()[1],this.data[i+2]=e.getColor()[2],this.data[i+3]=e.getColor()[3]}putDataY(t,n){if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.setSize(t.width,t.height),void 0===n&&(n=0);let e=0,i=0;for(;i<t.data.length;i++)this.data[e+n]=Math.floor(t.data[i]),e+=4}putDataYToR(t){this.putDataS(t,0)}putDataYToG(t){this.putDataS(t,1)}putDataYToB(t){this.putDataS(t,2)}putDataYToA(t){this.putDataS(t,3)}putImageData(t){if(t instanceof ImageData||t instanceof ImgDataRGBA)this.setSize(t.width,t.height),this.data.set(t.data);else{if(!(t instanceof ImgDataY))throw"IllegalArgumentException";this.putImageData(t.getImageData())}}getImageData(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height;const n=t.getContext("2d").getImageData(0,0,t.width,t.height);return n.data.set(this.data),n}grayscale(){this.forEach(function(t,n,e,i){const o=~~t.luminance(),r=new ImgColorRGBA([o,o,o,t.rgba[3]]);i.setPixelInside(n,e,r)})}getColorCount(){const t=new Uint8ClampedArray(2097152);let n=0;return this.forEach(function(e){const i=e.getRRGGBB(),o=i>>3,r=i%7;0==(t[o]>>r&1)&&(n++,t[o]=255&(t[o]^1<<r))}),n}getPalletMedianCut(t){if(this.getColorCount()<=t)return null;let n,e,i,o;const r=new Uint32Array(2097152);let s=0;const h=function(t){return t.getRed()>>1<<14|t.getGreen()>>1<<7|t.getBlue()>>1},l=[],a=[[],[],[]],u=[[],[],[]];for(l[0]=this.width*this.height,n=0;n<3;n++)u[n][s]=0,a[n][s]=127;this.forEach(function(t){r[h(t)]++});let c,g,f,m,d,_,p;for(s++,p=1;s<t;){let t=0,h=0;for(n=0;n<p;n++){const e=(c=a[0][n]-u[0][n])*(g=a[1][n]-u[1][n])*(f=a[2][n]-u[2][n]);t<e&&(t=e,m=c,d=g,_=f,h=n)}let C=d,x=1;if(C<m&&(C=m,x=0),C<_&&(C=_,x=2),0===C)break;{const t=u[x][h]+(C>>1);for(t===a[x][h]?(u[x][p]=t,a[x][p]=a[x][h],a[x][h]=t-1):(u[x][p]=t+1,a[x][p]=a[x][h],a[x][h]=t),n=0;n<3;n++)n!==x&&(u[n][p]=u[n][h],a[n][p]=a[n][h])}for(l[p]=0,e=u[0][p];e<=a[0][p];e++)for(i=u[1][p];i<=a[1][p];i++)for(o=u[2][p];o<=a[2][p];o++)l[p]+=r[e<<14|i<<7|o];if(l[h]-=l[p],0===l[h])for(l[h]=l[p],n=0;n<3;n++)u[n][h]=u[n][p],a[n][h]=a[n][p];else 0===l[p]||(p++,s++)}const C=[];for(n=0;n<s;n++){let t=0,s=0,h=0;for(e=u[0][n];e<=a[0][n];e++)for(i=u[1][n];i<=a[1][n];i++)for(o=u[2][n];o<=a[2][n];o++){const n=r[e<<14|i<<7|o];t+=n*(e<<1),s+=n*(i<<1),h+=n*(o<<1)}e=Math.round(t/l[n]),i=Math.round(s/l[n]),o=Math.round(h/l[n]),e=e<0?0:e>255?255:e,i=i<0?0:i>255?255:i,o=o<0?0:o>255?255:o,C[n]=new ImgColorRGBA([e,i,o,255])}return C}getPallet(){const t=[],n=new Uint32Array(256);let e=0,i=0;return this.forEach(function(o){if(!(e>255)){const r=o.getRRGGBB();for(i=0;i<e;i++)if(n[i]===r)return;n[e]=r,t[e]=o,e++}}),t}getPalletGrayscale(t){const n=t<2?2:t>256?256:t,e=[],i=255/(n-1);let o,r=0;for(o=0;o<n;o++){let t=Math.round(r);t=t<0?0:t>255?255:t,e[o]=new ImgColorRGBA([t,t,t,255]),r+=i}return e}quantizationSimple(t){this.forEach(function(n,e,i,o){const r=n.searchColor(t,ImgColor.NORM_MODE.EUGRID);o.setPixelInside(e,i,r.c1.color.exchangeColorAlpha(n))})}quantizationOrdered(t,n,e){this.forEach(function(i,o,r,s){const h=i.searchColor(t,e),l=h.c1.color,a=h.c1.norm,u=h.c2.color,c=h.c2.norm;let g=a+c;g=0===g?1:g;const f=n.pattern[r%n.height][o%n.width];let m=null;m=l.luminance>u.luminance?f<=Math.floor(c*n.maxnumber/g)?l.exchangeColorAlpha(i):u.exchangeColorAlpha(i):f>=Math.floor(a*n.maxnumber/g)?l.exchangeColorAlpha(i):u.exchangeColorAlpha(i),s.setPixelInside(o,r,m)})}quantizationDiffusion(t,n){const e=this.width*this.height,i=new Int16Array(e),o=new Int16Array(e),r=new Int16Array(e);let s=0;this.forEach(function(t,n,e,h){s=e*h.width+n,i[s]=t.getRed(),o[s]=t.getGreen(),r[s]=t.getBlue()});const h=this.width-n.width+n.center;let l,a,u=0;for(a=0;a<n.height;a++)for(l=0;l<n.width;l++)u+=n.pattern[a][l];const c=[];for(a=0;a<n.height;a++)for(c[a]=[],l=0;l<n.width;l++)c[a][l]=n.pattern[a][l]/u;this.forEach(function(e,u,g,f){s=g*f.width+u;const m=new ImgColorRGBA([i[s],o[s],r[s],255]);let d=m.searchColor(t,ImgColor.NORM_MODE.EUGRID);if(d=d.c1.color,f.setPixelInside(u,g,d.exchangeColorAlpha(e)),!(u>h)){const t=m.subColor(d);for(a=0;a<n.height;a++)for(l=0===a?n.center:0;l<n.width;l++){const e=u+l-n.center,s=g+a;if(!(e<0||s>=f.height)){const n=s*f.width+e;i[n]+=t.getRed()*c[a][l],o[n]+=t.getGreen()*c[a][l],r[n]+=t.getBlue()*c[a][l]}}}})}filterQuantizationSimple(t){if(this.getColorCount()>t){const n=this.getPalletMedianCut(t);this.quantizationSimple(n)}}filterQuantizationOrdered(t,n){if(void 0===n&&(n=ImgColor.NORM_MODE.EUGRID),this.getColorCount()>t){const e=this.getPalletMedianCut(t);this.quantizationOrdered(e,ImgDataRGBA.quantization.orderPattern.patternBayer,n)}}filterQuantizationDiffusion(t,n){if(void 0===n&&(n=ImgDataRGBA.quantization.diffusionPattern.patternFloydSteinberg),this.getColorCount()>t){const e=this.getPalletMedianCut(t);this.quantizationDiffusion(e,n)}}}ImgDataRGBA.quantization={diffusionPattern:{patternFloydSteinberg:{width:3,height:2,center:1,pattern:[[0,0,7],[3,5,1]]},patternJarvisJudiceNinke:{width:5,height:3,center:2,pattern:[[0,0,0,7,5],[3,5,7,5,3],[1,3,5,3,1]]}},orderPattern:{patternBayer:{width:4,height:4,maxnumber:16,pattern:[[0,8,2,10],[12,4,14,6],[3,11,1,9],[15,7,13,5]]}}};const ImageProcessing={ImgDataRGBA:ImgDataRGBA,ImgColorRGBA:ImgColorRGBA,ImgDataY:ImgDataY,ImgColorY:ImgColorY,MODE_WRAP:ImgData.MODE_WRAP,MODE_IP:ImgData.MODE_IP,MODE_BLEND:ImgData.MODE_BLEND};class SBase{constructor(t,n){this.id="SComponent_"+(SBase._counter++).toString(16),this.wallid="SComponent_"+(SBase._counter++).toString(16),this.isshow=!1,this._element=null,this._wall=null,this.elementtype=t,this.unit=SBase.UNIT_TYPE.EM;const e=this,i={over:function(){SBase.node_tool.addClass(e.getElement(),SBase.CLASS_NAME.MOUSEOVER)},out:function(){SBase.node_tool.removeClass(e.getElement(),SBase.CLASS_NAME.MOUSEOVER),SBase.node_tool.removeClass(e.getElement(),SBase.CLASS_NAME.MOUSEDOWN)},down:function(){SBase.node_tool.addClass(e.getElement(),SBase.CLASS_NAME.MOUSEDOWN)},up:function(){SBase.node_tool.removeClass(e.getElement(),SBase.CLASS_NAME.MOUSEDOWN)}};this.tool={attachMouseEvent:function(t){t.addEventListener("touchstart",i.over,!1),t.addEventListener("touchend",i.up,!1),t.addEventListener("mouseover",i.over,!1),t.addEventListener("mouseout",i.out,!1),t.addEventListener("mousedown",i.down,!1),t.addEventListener("mouseup",i.up,!1)},removeNodeForId:function(t){const n=document.getElementById(t);return SBase.node_tool.removeNode(n),n},AputB:function(t,n,e){if(!(t&&n&&n instanceof SBase))throw"IllegalArgumentException";if(t===n)throw"it referenced me";if(e!==SBase.PUT_TYPE.IN&&e!==SBase.PUT_TYPE.RIGHT&&e!==SBase.PUT_TYPE.NEWLINE)throw"IllegalArgumentException";let i=null;if("string"==typeof t||t instanceof String)i=document.getElementById(t);else if(t instanceof SBase)if(e===SBase.PUT_TYPE.IN){if(!t.isContainer())throw"not Container";i=t.getContainerElement()}else i=t.getElement();if(null===i)throw"Not Found "+t;const o=function(t,n){n.nextSibling?n.parentNode.insertBefore(t,n.nextSibling):n.parentNode.appendChild(t)};if(n.removeMe(),e===SBase.PUT_TYPE.IN)n.onAdded(),null!==i.lastChild&&(n.getWall(SBase.PUT_TYPE.NEWLINE).style.display="block",i.appendChild(n.getWall())),n.getElement().style.display="inline-block",i.appendChild(n.getElement());else{if(null===i.parentNode)throw"not found element on the html";n.onAdded(),o(n.getWall(e),i),o(n.getElement(),n.getWall(e)),e===SBase.PUT_TYPE.RIGHT?(i.style.display="inline-block",n.getWall(e).style.display="inline-block",n.getElement().style.display="inline-block"):e===SBase.PUT_TYPE.NEWLINE&&(i.style.display="inline-block",n.getWall(e).style.display="block",n.getElement().style.display="inline-block")}}},this.setText(n)}getWidth(){let t=this.getElement().style.width;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getHeight(){let t=this.getElement().style.height;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getSize(){return{width:this.getWidth(),height:this.getHeight()}}setWidth(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.getElement().style.width=t.toString()+this.unit}setHeight(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.getElement().style.height=t.toString()+this.unit}setSize(t,n){this.setWidth(t),this.setHeight(n)}removeMe(){this.tool.removeNodeForId(this.id),this.tool.removeNodeForId(this.space_id)}onAdded(){}getWall(t){if(this._wall)return this._wall;const n=document.createElement("span");return n.id=this.wallid,t===SBase.PUT_TYPE.RIGHT?n.className=SBase.CLASS_NAME.SPACE:t===SBase.PUT_TYPE.NEWLINE&&(n.className=SBase.CLASS_NAME.NEWLINE),n.style.display="inline-block",this._wall=n,n}isContainer(){return null!==this.getContainerElement()}getContainerElement(){return null}getElement(){if(this._element)return this._element;const t=document.createElement(this.elementtype);return t.id=this.id,t.className=SBase.CLASS_NAME.COMPONENT,t.style.display="inline-block",this._element=t,this.tool.attachMouseEvent(t),t}put(t,n){this.tool.AputB(this,t,n)}putMe(t,n){this.tool.AputB(t,this,n)}isVisible(){return null===this.getElement().style.visibility||"hidden"!==this.getElement().style.visibility}setVisible(t){t?(this.getElement().style.visibility="visible",this.getWall().style.visibility="visible"):(this.getElement().style.visibility="hidden",this.getWall().style.visibility="hidden")}getTextNode(){const t=this.getElement().childNodes;let n=null,e=0;for(e=0;e<t.length;e++)if(t[e]instanceof Text){n=t[e];break}return n}getElementNode(){const t=this.getElement().children;let n=null,e=0;for(e=0;e<t.length;e++)if(!(t[e]instanceof Text)){n=t[e];break}return n}getEditableNodeForValue(){return null}getEditableNodeForNodeValue(){if(this.getEditableNodeForValue())return null;let t=this.getTextNode();if(null===t){const n=this.getElement();t=document.createTextNode(""),n.appendChild(t)}return t}setText(t){if(t){let n=null;return(n=this.getEditableNodeForValue())?void(n.value=t):(n=this.getEditableNodeForNodeValue(),n?void(n.nodeValue=t):void 0)}}getText(){let t=null,n=null;return(n=this.getEditableNodeForValue())&&(t=n.value),(n=this.getEditableNodeForNodeValue())&&(t=n.nodeValue.trim()),null===t?"":t}getEnabledElement(){return null}setEnabled(t){t?SBase.node_tool.removeClass(this.getElement(),SBase.CLASS_NAME.DISABLED):SBase.node_tool.addClass(this.getElement(),SBase.CLASS_NAME.DISABLED);const n=this.getEnabledElement();null!==n&&SBase.node_tool.setBooleanAttribute(n,"disabled",t)}isEnabled(){return!SBase.node_tool.isSetClass(this.getElement(),SBase.CLASS_NAME.DISABLED)}getId(){return this.id}getUnit(){return this.unit}setUnit(t){this.unit=t}addClass(t){return SBase.node_tool.addClass(this.getElement(),t)}toString(){return this._elementtype+"("+this.id+")"}}SBase.PUT_TYPE={IN:0,RIGHT:1,NEWLINE:2},SBase.UNIT_TYPE={PX:"px",EM:"em",PERCENT:"%"},SBase.LABEL_POSITION={LEFT:0,RIGHT:1},SBase.CLASS_NAME={MOUSEOVER:"SCOMPONENT_MouseOver",MOUSEDOWN:"SCOMPONENT_MouseDown",DISABLED:"SCOMPONENT_Disabled",COMPONENT:"SCOMPONENT_Component",NEWLINE:"SCOMPONENT_Newline",CLOSE:"SCOMPONENT_Close",OPEN:"SCOMPONENT_Open",SPACE:"SCOMPONENT_Space",CONTENTSBOX:"SCOMPONENT_ContentsBox",PANEL:"SCOMPONENT_Panel",PANEL_LEGEND:"SCOMPONENT_PanelLegend",SLIDEPANEL:"SCOMPONENT_SlidePanel",SLIDEPANEL_LEGEND:"SCOMPONENT_SlidePanelLegend",SLIDEPANEL_SLIDE:"SCOMPONENT_SlidePanelSlide",GROUPBOX:"SCOMPONENT_GroupBox",GROUPBOX_LEGEND:"SCOMPONENT_GroupBoxLegend",IMAGEPANEL:"SCOMPONENT_ImagePanel",LABEL:"SCOMPONENT_Label",SELECT:"SCOMPONENT_Select",COMBOBOX:"SCOMPONENT_ComboBox",CHECKBOX:"SCOMPONENT_CheckBox",CHECKBOX_IMAGE:"SCOMPONENT_CheckBoxImage",BUTTON:"SCOMPONENT_Button",FILELOAD:"SCOMPONENT_FileLoad",FILESAVE:"SCOMPONENT_FileSave",CANVAS:"SCOMPONENT_Canvas",PROGRESSBAR:"SCOMPONENT_ProgressBar",SLIDER:"SCOMPONENT_Slider",COLORPICKER:"SCOMPONENT_ColorPicker"},SBase._counter=0,SBase.node_tool={setBooleanAttribute:function(t,n,e){if("string"!=typeof n&&!(n instanceof String)||"boolean"!=typeof e)throw"IllegalArgumentException";const i=t.getAttribute(n);e||null!==i?e&&null!==i&&t.removeAttribute(n):t.setAttribute(n,n)},isBooleanAttribute:function(t,n){if("string"!=typeof n&&!(n instanceof String))throw"IllegalArgumentException";return null===t.getAttribute(n)},removeNode:function(t){return t&&t.parentNode&&t.parentNode.removeChild(t),t},removeChildNodes:function(t){let n=t.lastChild;for(;n;)t.removeChild(n),n=t.lastChild},isSetClass:function(t,n){const e=t.className;return null!==e&&new RegExp("(^"+n+"$)|( +"+n+")","g").test(e)},addClass:function(t,n){const e=t.className;if(null===e)return void(t.className=n);new RegExp("(^"+n+"$)|( +"+n+")","g").test(e)||(t.className=e+" "+n)},removeClass:function(t,n){const e=t.className;if(null!==e){const i=new RegExp("(^"+n+"$)|( +"+n+")","g");i.test(e)&&(t.className=e.replace(i,""))}}};class SButton extends SBase{constructor(t){super("input",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.getElement().type="button"}getEditableNodeForValue(){return this.getElement()}getEnabledElement(){return this.getElement()}addListener(t){this.getElement().addEventListener("click",t,!1)}}class SCanvas extends SBase{constructor(){super("canvas"),this.addClass(SBase.CLASS_NAME.CANVAS),this.canvas=super.getElement(),this.glmode=!1,this.setPixelSize(300,150)}getPixelSize(){return{width:this.canvas.width,height:this.canvas.height}}getCanvas(){return this.canvas}setPixelSize(t,n){if(2!==arguments.length||"number"!=typeof t||"number"!=typeof n||t<0||n<0)throw"IllegalArgumentException";t=~~Math.floor(t),n=~~Math.floor(n),this.canvas.width=t,this.canvas.height=n}getContext(){return void 0===this.context&&(this.context=this.canvas.getContext("2d"),null===this.context&&(this.glmode=!0,this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),this.context=this.gl)),this.context}clear(){this.glmode?this.getContext().clear(this.gl.COLOR_BUFFER_BIT):this.getContext().clearRect(0,0,this.canvas.width,this.canvas.height)}getImageData(){if(!this.glmode)return this.getContext().getImageData(0,0,this.canvas.width,this.canvas.height)}putImageData(t){this.glmode||this.getContext().putImageData(t,0,0)}_putImage(t,n,e){const i=this.canvas;let o=0,r=0,s=i.width,h=i.height;SCanvas.drawtype.ORIGINAL===e?(s=t.width,h=t.height):SCanvas.drawtype.STRETCH===e?(s=i.width,h=i.height):SCanvas.drawtype.FILL_ASPECT_RATIO===e?(s=i.width,h=i.height):(s=t.width,h=t.height,SCanvas.drawtype.ASPECT_RATIO===e&&(s>i.width&&(s=i.width,h=Math.floor(h*(s/t.width))),h>i.height&&(s=Math.floor(s*(i.height/h)),h=i.height)),SCanvas.drawtype.LETTER_BOX===e&&(s=i.width,(h=Math.floor(h*(s/t.width)))>i.height&&(s=Math.floor(s*(i.height/h)),h=i.height),o=Math.floor((i.width-s)/2),r=Math.floor((i.height-h)/2),n=!1)),n&&(this.setUnit(SBase.UNIT_TYPE.PX),this.setSize(s,h),this.setPixelSize(s,h)),this.clear(),t instanceof Image?this.context.drawImage(t,0,0,t.width,t.height,o,r,s,h):t instanceof ImageData&&this.context.putImageData(t,0,0,o,r,s,h)}putImage(t,n,e,i){if(n||(n=null),void 0===e&&(e=SCanvas.drawtype.LETTER_BOX),void 0===i&&(i=!1),t instanceof Image||t instanceof ImageData)this._putImage(t,i,e),"function"==typeof n&&n();else if("string"==typeof t){const o=this,r=new Image;r.onload=function(){o.putImage(r,i,e,n)},r.src=t}else if(t instanceof SCanvas)this.putImage(t.getElement(),i,e,n);else if(t instanceof Element&&"CANVAS"===t.tagName)this.putImage(t.toDataURL(),i,e,n);else{if(!(t instanceof Blob||t instanceof File))throw"IllegalArgumentException";{const o=this,r=new FileReader;r.onload=function(){o.putImage(r.result,i,e,n)},r.readAsDataURL(t)}}}toDataURL(t){return t||(t="image/png"),this.canvas.toDataURL(t)}}SCanvas.drawtype={ORIGINAL:0,ASPECT_RATIO:1,STRETCH:2,LETTER_BOX:3};class SCheckBox extends SBase{constructor(t){super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.CHECKBOX);const n=document.createElement("input");n.type="checkbox",n.id=this.getId()+"_checkbox",n.className=SBase.CLASS_NAME.CHECKBOX_IMAGE,this.checkbox=n,this.textnode=document.createTextNode(t||"");const e=this.getElement();e.appendChild(this.checkbox),e.appendChild(this.textnode)}getEnabledElement(){return this.checkbox}getTextNode(){return this.textnode}getElementNode(){return this.checkbox}setLabelPosition(t){const n=this.getElement(),e=this.getTextNode(),i=this.getElementNode();this.node_tool.removeChildNodes(n),t===SBase.LABEL_POSITION.LEFT?(n.appendChild(e),n.appendChild(i)):(n.appendChild(i),n.appendChild(e))}setCheckBoxImageSize(t){if("number"!=typeof t)throw"IllegalArgumentException not number";this.checkbox.style.height=t.toString()+this.unit,this.checkbox.style.width=t.toString()+this.unit}addListener(t){this.checkbox.addEventListener("change",t,!1)}setChecked(t){this.checkbox.checked=t}isChecked(){return this.checkbox.checked}}class SColorPicker extends SBase{constructor(){super("div"),this.addClass(SBase.CLASS_NAME.COLORPICKER);const t=this.getElement(),n=this,e={H:{div:document.createElement("div"),split:6,value:0,input:null,gauge:null,color_data:[],color_node:[],is_press:!1},S:{div:document.createElement("div"),split:1,value:.5,input:null,gauge:null,color_data:[],color_node:[],is_press:!1},L:{div:document.createElement("div"),split:2,value:.5,input:null,gauge:null,color_data:[],color_node:[],is_press:!1}};for(let t=0;t<=e.H.split;t++){const n=1/e.H.split*t;e.H.color_data.push(Color.newColorNormalizedHSL([n,1,.5]).getCSSHex())}const i=function(t){return function(i){if(i.length&&(i=i[0]),e[t].is_press){let o=i.target;o=o||i.currentTarget,e[t].value=i.offsetX/o.clientWidth,n.redraw()}}},o=function(t,n){return function(o){o.length&&(o=o[0]);let r=o.target;r=r||o.currentTarget,e[t].is_press=n,n&&i(t)(o)}},r=function(t){return function(i){let o=i.target;o=o||i.currentTarget,e[t].value=o.value/100,n.redraw()}},s=function(t,n){const r=document.createElement("div"),s=document.createElement("div"),h=document.createElement("div");t.style.position="relative",r.style.position="absolute",s.style.position="absolute",h.style.position="absolute",r.style.margin="0px",r.style.padding="0px",s.style.margin="0px",s.style.padding="0px",h.style.margin="0px",h.style.padding="0px",r.addEventListener("mousedown",o(n,!0),!1),r.addEventListener("mouseup",o(n,!1),!1),r.addEventListener("mouseout",o(n,!1),!1),r.addEventListener("mousemove",i(n),!1),r.addEventListener("touchstart",o(n,!0),!1),r.addEventListener("touchend",o(n,!1),!1),r.addEventListener("touchcancel",o(n,!1),!1),r.dataset.name=n,r.style.width="100%",r.style.height="100%",r.style.bottom="0px",s.style.width="33%",s.style.height="100%",s.style.bottom="0px",s.style.borderStyle="ridge",s.style.borderWidth="0px 2px 0px 0px",e[n].gauge=s;const l=e[n].split;h.style.width="100%",h.style.height="100%",h.style.overflow="hidden";for(let t=0;t<l;t++){const t=document.createElement("div");t.style.display="inline-block",t.style.margin="0px",t.style.padding="0px",t.style.height="100%",t.style.width=100/l+"%",t.style.background="linear-gradient(to right, #000, #FFF)",e[n].color_node.push(t),h.appendChild(t)}t.appendChild(h),t.appendChild(s),t.appendChild(r)};for(const t in e)!function(t){const n=document.createElement("span"),i=document.createElement("div"),o=document.createElement("input");n.style.display="inline-block",i.style.display="inline-block",o.style.display="inline-block",n.style.verticalAlign="top",i.style.verticalAlign="top",o.style.verticalAlign="top",n.style.height="100%",i.style.height="100%",o.style.height="100%",n.style.margin="0px",n.style.padding="0px",n.style.textAlign="center",i.style.margin="0px 0.5em 0px 0.5em",i.style.padding="0px",i.style.borderStyle="solid",i.style.borderWidth="1px",o.addEventListener("input",r(t),!1),o.type="number",o.style.margin="0px",o.style.padding="0px",o.style.borderStyle="none",o.min=0,o.max=100,o.step=1,e[t].input=o,n.style.width="1.5em",i.style.width="calc(100% - 6.0em)",o.style.width="3.5em",s(i,t);const h=e[t].div;h.style.height="1.2em",h.style.margin="0.5em 0px 0.5em 0px",n.appendChild(document.createTextNode(t)),h.appendChild(n),h.appendChild(i),h.appendChild(o)}(t);this.hls=e,this.listener=[],this.redraw(),t.appendChild(this.hls.H.div),t.appendChild(this.hls.S.div),t.appendChild(this.hls.L.div)}setColor(t){if(!(t instanceof Color))throw"ArithmeticException";const n=this.hls,e=t.getNormalizedHSL();n.H.value=e.h,n.S.value=e.s,n.L.value=e.l,this.redraw()}getColor(){const t=this.hls,n=t.H.value,e=t.S.value,i=t.L.value;return Color.newColorNormalizedHSL([n,e,i])}redraw(){const t=this.hls,n=t.H.value,e=t.S.value,i=t.L.value;t.S.color_data=[Color.newColorNormalizedHSL([n,0,i]).getCSSHex(),Color.newColorNormalizedHSL([n,1,i]).getCSSHex()],t.L.color_data=[Color.newColorNormalizedHSL([n,e,0]).getCSSHex(),Color.newColorNormalizedHSL([n,e,.5]).getCSSHex(),Color.newColorNormalizedHSL([n,e,1]).getCSSHex()];for(const n in t){const e=t[n].color_data,i=t[n].color_node;for(let t=0;t<i.length;t++)i[t].style.background="linear-gradient(to right, "+e[t]+", "+e[t+1]+")";const o=Math.round(100*t[n].value);t[n].gauge.style.width=o+"%",t[n].input.value=o}for(let t=0;t<this.listener.length;t++)this.listener[t]()}addListener(t){this.listener.push(t)}}class SComboBox extends SBase{constructor(t){super("select",t),this.addClass(SBase.CLASS_NAME.SELECT),this.addClass(SBase.CLASS_NAME.COMBOBOX)}getEnabledElement(){return this.getElement()}addListener(t){this.getElement().addEventListener("change",t,!1)}setText(t){if(t){const n=this.getElement();"string"==typeof t&&t instanceof String&&(t=[t]);let e=n.lastChild;for(;e;)n.removeChild(e),e=n.lastChild;let i=0;for(i=0;i<t.length;i++){const e=document.createElement("option");e.text=t[i].toString(),e.value=t[i].toString(),n.appendChild(e)}}}getText(){const t=this.getElement().children;let n=0;const e=[];for(n=0;n<t.length;n++)"OPTION"===t[n].tagName&&(e[e.length]=t[n].text);return e}setSelectedItem(t){const n=this.getElement().children;let e=0,i=0;for(e=0;e<n.length;e++)if("OPTION"===n[e].tagName){if(n[e].value===t.toString()){this.getElement().selectedIndex=i;break}i++}}getSelectedItem(){const t=this.getElement().children,n=this.getElement().selectedIndex;let e=0,i=0;for(e=0;e<t.length;e++)if("OPTION"===t[e].tagName){if(n===i)return t[e].value;i++}return""}}class SFileLoadButton extends SBase{constructor(t){super("label",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.addClass(SBase.CLASS_NAME.FILELOAD);const n=super.getElement(),e=document.createElement("input");n.style.textAlign="center",e.setAttribute("type","file"),e.id=this.getId()+"_file",e.style.display="none",this.file=e,n.appendChild(e)}getEnabledElement(){return this.file}getFileAccept(){const t=this.file.getAttribute("accept");return null===t?"":t}setFileAccept(t){t===SFileLoadButton.FILE_ACCEPT.DEFAULT?null!==this.file.getAttribute("accept")&&this.file.removeAttribute("accept"):this.file.accept=t}addListener(t){this.file.addEventListener("change",function(n){t(n.target.files)},!1)}}SFileLoadButton.FILE_ACCEPT={DEFAULT:"",IMAGE:"image/*",AUDIO:"audio/*",VIDEO:"video/*",TEXT:"text/*",PNG:"image/png",JPEG:"image/jpg",GIF:"image/gif"};class SFileSaveButton extends SBase{constructor(t){super("a",t),this.addClass(SBase.CLASS_NAME.BUTTON),this.addClass(SBase.CLASS_NAME.FILESAVE),this.filename="",this.url="",this.getElement().setAttribute("download",this.filename)}getFileName(){return this.filename}setFileName(t){this.filename=t,this.getElement().setAttribute("download",this.filenam)}setURL(t){this.getElement().href=t,this.url=t}setEnabled(t){this.isEnabled()!==t&&(t?this.getElement().href=this.url:this.getElement().removeAttribute("href")),super.setEnabled(t)}}class SGroupBox extends SBase{constructor(t){super("fieldset"),this.addClass(SBase.CLASS_NAME.GROUPBOX),this.legend=document.createElement("legend"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.GROUPBOX_LEGEND),this.legend.id=this.getId()+"_legend",this.legend.textContent=t,this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const n=this.getElement();n.appendChild(this.legend),n.appendChild(this.body)}getEnabledElement(){return this.getElement()}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SImagePanel extends SBase{constructor(){super("div"),this.addClass(SBase.CLASS_NAME.IMAGEPANEL);const t=document.createElement("img");t.id=this.id+"_img",this.image=t,this.getElement().appendChild(this.image)}clear(){this.node_tool.removeChildNodes(this.getElement())}toDataURL(){return this.image.src}putImageData(t){this.putImage(t)}putImage(t,n){if(n||(n=null),"string"==typeof t)this.image.onload=function(){"function"==typeof n&&n()},this.image.src=t;else if(t instanceof ImageData){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.putImageData(t,0,0),this.putImage(e,n)}else if(t instanceof Image)this.image.src=t.src;else if(t instanceof SCanvas)this.putImage(t.getElement(),n);else if(t instanceof Element&&"CANVAS"===t.tagName)try{this.putImage(t.toDataURL("image/png"),n)}catch(e){try{this.putImage(t.toDataURL("image/jpeg"),n)}catch(t){}}else{if(!(t instanceof Blob||t instanceof File))throw"IllegalArgumentException";{const e=this,i=new FileReader;i.onload=function(){e.putImage(i.result,n)},i.readAsDataURL(t)}}}}class SLabel extends SBase{constructor(t){super("div",t),this.addClass(SBase.CLASS_NAME.LABEL)}getContainerElement(){return this.getElement()}}class SPanel extends SBase{constructor(t){super("div",null),this.addClass(SBase.CLASS_NAME.PANEL);const n=this.getElement();this.legend=document.createElement("span"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.PANEL_LEGEND),this.legend.id=this.getId()+"_legend",this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const e=this;this.paneltool={setText:function(t){t?(e.legend.textContent=t,e.legend.style.display="block"):e.legend.style.display="none"}},this.paneltool.setText(t),n.appendChild(this.legend),n.appendChild(this.body)}setText(t){this.paneltool&&this.paneltool.setText(t)}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SProgressBar extends SBase{constructor(t,n){if(super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.PROGRESSBAR),this.min=0,this.max=0,this.value=t,this.is_indeterminate=!1,0===arguments.length)this.min=0,this.max=1;else{if(2!==arguments.length)throw"IllegalArgumentException";this.min=t,this.max=n}this.progress=document.createElement("progress"),this.getElement().appendChild(this.progress),this.progress.id=this.getId()+"_progress",this.progress.className=SBase.CLASS_NAME.PROGRESSBAR,this.progress.value=0,this.progress.max=1}setMaximum(t){this.max=t}setMinimum(t){this.min=t}getMaximum(){return this.max}getMinimum(){return this.min}setValue(t){this.value=t,this.progress.value=this.getPercentComplete()}getValue(){return this.value}setIndeterminate(t){this.is_indeterminate=t,this.is_indeterminate?this.progress.removeAttribute("value"):this.setValue(this.value)}isIndeterminate(){return this.is_indeterminate}getPercentComplete(){const t=this.max-this.min;return(this.value-this.min)/t}}class SSlidePanel extends SBase{constructor(t){super("div"),this.addClass(SBase.CLASS_NAME.SLIDEPANEL),this.textnode=document.createTextNode(t||""),this.legend=document.createElement("span"),SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.SLIDEPANEL_LEGEND),this.legend.id=this.getId()+"_legend",this.legend.appendChild(this.textnode),this.slide=document.createElement("div"),SBase.node_tool.addClass(this.slide,SBase.CLASS_NAME.SLIDEPANEL_SLIDE),this.slide.id=this.getId()+"_slide",this.body=document.createElement("div"),SBase.node_tool.addClass(this.body,SBase.CLASS_NAME.CONTENTSBOX),this.body.id=this.getId()+"_body";const n=this,e=function(){n.setOpen(!n.isOpen())};this.legend.addEventListener("click",e),this.setOpen(!1),this.slide.appendChild(this.body);const i=super.getElement();i.appendChild(this.legend),i.appendChild(this.slide)}setOpen(t){this.is_open=t,this.is_open?(this.slide.style.maxHeight=this.body.scrollHeight+"px",SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.OPEN),SBase.node_tool.removeClass(this.legend,SBase.CLASS_NAME.CLOSE)):(this.slide.style.maxHeight=null,SBase.node_tool.addClass(this.legend,SBase.CLASS_NAME.CLOSE),SBase.node_tool.removeClass(this.legend,SBase.CLASS_NAME.OPEN))}isOpen(){return this.is_open}getTextNode(){return this.textnode}getContainerElement(){return this.body}clear(){SBase.node_tool.removeChildNodes(this.body)}}class SSlider extends SBase{constructor(t,n){if(super("label"),this.addClass(SBase.CLASS_NAME.LABEL),this.addClass(SBase.CLASS_NAME.SLIDER),0===arguments.length)t=0,n=1;else if(2!==arguments.length)throw"IllegalArgumentException";this.slider=document.createElement("input"),this.slider.id=this.getId()+"_slider",this.slider.type="range",this.slider.className=SBase.CLASS_NAME.SLIDER,this.slider.value=t,this.slider.min=t,this.slider.max=n,this.slider.step=(n-t)/100,this.datalist=document.createElement("datalist"),this.datalist.id=this.getId()+"_datalist",this.slider.setAttribute("list",this.datalist.id),this.getElement().appendChild(this.slider),this.getElement().appendChild(this.datalist)}getEnabledElement(){return this.slider}setMaximum(t){this.slider.max=t}setMinimum(t){this.slider.min=t}getMaximum(){return parseFloat(this.slider.max)}getMinimum(){return parseFloat(this.slider.min)}setValue(t){this.slider.value=t}getValue(){return parseFloat(this.slider.value)}setMinorTickSpacing(t){this.slider.step=t}getMinorTickSpacing(){return parseFloat(this.slider.step)}setMajorTickSpacing(t){this.majortick=t,this.removeMajorTickSpacing();let n;const e=this.getMinimum(),i=this.getMaximum();for(n=e;n<=i;n+=t){const t=document.createElement("option");t.value=n.toString(),this.datalist.appendChild(t)}}getMajorTickSpacing(){return this.majortick}removeMajorTickSpacing(){const t=this.datalist;let n=t.lastChild;for(;n;)t.removeChild(n),n=t.lastChild}addListener(t){let n=!1;const e=this,i=function(){n=!0},o=function(){n&&("disabled"!==e.slider.disabled&&t(),n=!1)};this.slider.addEventListener("touchstart",i,!1),this.slider.addEventListener("touchend",o,!1),this.slider.addEventListener("mousedown",i,!1),this.slider.addEventListener("mouseup",o,!1)}getWidth(){let t=this.slider.width;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}getHeight(){let t=this.slider.height;return null===t?null:(t=t.match(/[+-]?\s*[0-9]*\.?[0-9]*/)[0],parseFloat(t))}setWidth(t){if("number"!=typeof t)throw"IllegalArgumentException not number";super.setWidth(t),this.slider.style.width=t.toString()+this.unit}setHeight(t){if("number"!=typeof t)throw"IllegalArgumentException not number";super.setHeight(t),this.slider.style.height=t.toString()+this.unit}}const SComponent={Button:SButton,Canvas:SCanvas,CheckBox:SCheckBox,ColorPicker:SColorPicker,ComboBox:SComboBox,FileLoadButton:SFileLoadButton,FileSaveButton:SFileSaveButton,GroupBox:SGroupBox,ImagePanel:SImagePanel,Label:SLabel,Panel:SPanel,ProgressBar:SProgressBar,SlidePanel:SSlidePanel,Slider:SSlider,PUT_TYPE:SBase.PUT_TYPE,UNIT_TYPE:SBase.UNIT_TYPE,LABEL_POSITION:SBase.LABEL_POSITION,FILE_ACCEPT:SFileLoadButton.FILE_ACCEPT},Senko={};Senko._printbuffer="",Senko.ArrayList=ArrayList,Senko.Color=Color,Senko.File=File$1,Senko.HashMap=HashMap,Senko.format=Format.format,Senko.Log=Log,Senko.MathX=MathX,Senko.Device=Device,Senko.ImageProcessing=ImageProcessing,Senko.SComponent=SComponent;export default Senko;
